THREE.SpriteCanvasMaterial=function(g){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,d){};this.setValues(g)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var g=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,g);g.color.copy(this.color);g.program=this.program;return g};
THREE.CanvasRenderer=function(g){function k(h,a,c,Q){G(a);w(c);E(Q);N(h.getStyle());b.stroke();ca.expandByScalar(2*a)}function d(h){z(h.getStyle());b.fill()}function x(h){p(h.target)}function p(h){if(!(h instanceof THREE.CompressedTexture)){var a=h.wrapS===THREE.RepeatWrapping,c=h.wrapT===THREE.RepeatWrapping,Q=h.image,f=document.createElement("canvas");f.width=Q.width;f.height=Q.height;var d=f.getContext("2d");d.setTransform(1,0,0,-1,0,Q.height);d.drawImage(Q,0,0);F[h.id]=b.createPattern(f,!0===
a&&!0===c?"repeat":!0===a&&!1===c?"repeat-x":!1===a&&!0===c?"repeat-y":"no-repeat")}}function a(h,a,c,Q,f,d,g,ba,v,k,m,R,e){if(!(e instanceof THREE.DataTexture)){!1===e.hasEventListener("update",x)&&(void 0!==e.image&&0<e.image.width&&p(e),e.addEventListener("update",x));var l=F[e.id];if(void 0!==l){z(l);var l=e.offset.x/e.repeat.x,I=e.offset.y/e.repeat.y,y=e.image.width*e.repeat.x;e=e.image.height*e.repeat.y;g=(g+l)*y;ba=(ba+I)*e;c-=h;Q-=a;f-=h;d-=a;v=(v+l)*y-g;k=(k+I)*e-ba;m=(m+l)*y-g;R=(R+I)*e-
ba;e=v*R-m*k;0!==e&&(l=1/e,e=(R*c-k*f)*l,k=(R*Q-k*d)*l,c=(v*f-m*c)*l,Q=(v*d-m*Q)*l,h=h-e*g-c*ba,a=a-k*g-Q*ba,b.save(),b.transform(e,k,c,Q,h,a),b.fill(),b.restore())}else z("rgba(0,0,0,1)"),b.fill()}}function e(h,a,c){var b=a.x-h.x,Q=a.y-h.y,f=b*b+Q*Q;0!==f&&(c/=Math.sqrt(f),b*=c,Q*=c,a.x+=b,a.y+=Q,h.x-=b,h.y-=Q)}function s(h){H!==h&&(H=b.globalAlpha=h)}function U(h){wa!==h&&(h===THREE.NormalBlending?b.globalCompositeOperation="source-over":h===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
h===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),wa=h)}function G(h){oa!==h&&(oa=b.lineWidth=h)}function w(h){ha!==h&&(ha=b.lineCap=h)}function E(h){ua!==h&&(ua=b.lineJoin=h)}function N(h){da!==h&&(da=b.strokeStyle=h)}function z(h){A!==h&&(A=b.fillStyle=h)}function D(h){ma.length!==h.length&&(b.setLineDash(h),ma=h)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ka=THREE.Math.smoothstep;g=g||{};var W=this,la,S,ea,V=new THREE.Projector,t=void 0!==g.canvas?g.canvas:document.createElement("canvas"),
r=t.width,u=t.height,l=Math.floor(r/2),M=Math.floor(u/2),O=0,ia=0,m=r,fa=u,c=1,b=t.getContext("2d",{alpha:!0===g.alpha}),Y=new THREE.Color(0),T=!0===g.alpha?0:1,H=1,wa=0,da=null,A=null,oa=null,ha=null,ua=null,ma=[],pa,n,R,ga;new THREE.RenderableVertex;new THREE.RenderableVertex;var aa,xa,y,f,C,qa,v=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var P=new THREE.Color,I=new THREE.Color,ja=new THREE.Color,F={},h,Q,ba,ta,va,Aa,Ba,na=new THREE.Box2,J=new THREE.Box2,ca=
new THREE.Box2,za=new THREE.Color,Ca=new THREE.Color,Da=new THREE.Color,ra=new THREE.Vector3,Ea=new THREE.Vector3,sa=new THREE.Vector3,ya=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=t;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return c};this.setPixelRatio=function(h){c=h};this.setSize=function(h,a,b){r=
h*c;u=a*c;t.width=r;t.height=u;l=Math.floor(r/2);M=Math.floor(u/2);!1!==b&&(t.style.width=h+"px",t.style.height=a+"px");na.min.set(-l,-M);na.max.set(l,M);J.min.set(-l,-M);J.max.set(l,M);H=1;wa=0;ua=ha=oa=A=da=null;this.setViewport(0,0,h,a)};this.setViewport=function(h,a,b,Q){O=h*c;ia=a*c;m=b*c;fa=Q*c};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(h,a){Y.set(h);T=void 0!==a?a:1;J.min.set(-l,-M);J.max.set(l,M)};this.setClearColorHex=function(h,a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(h,a)};this.getClearColor=function(){return Y};this.getClearAlpha=function(){return T};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===J.empty()&&(J.intersect(na),J.expandByScalar(2),J.min.x+=l,J.min.y=-J.min.y+M,J.max.x+=l,J.max.y=-J.max.y+M,1>T&&b.clearRect(J.min.x|0,J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0),0<T&&(U(THREE.NormalBlending),s(1),z("rgba("+Math.floor(255*Y.r)+","+Math.floor(255*Y.g)+","+Math.floor(255*Y.b)+","+T+")"),b.fillRect(J.min.x|0,
J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0)),J.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,g){if(!1===g instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();W.info.render.vertices=0;W.info.render.faces=0;b.setTransform(m/r,0,0,-fa/u,O,u-ia);b.translate(l,M);la=V.projectScene(c,g,this.sortObjects,this.sortElements);S=
la.elements;ea=la.lights;pa=g;ya.getNormalMatrix(g.matrixWorldInverse);za.setRGB(0,0,0);Ca.setRGB(0,0,0);Da.setRGB(0,0,0);for(var Y=0,T=ea.length;Y<T;Y++){var q=ea[Y],L=q.color;q instanceof THREE.AmbientLight?za.add(L):q instanceof THREE.DirectionalLight?Ca.add(L):q instanceof THREE.PointLight&&Da.add(L)}Y=0;for(T=S.length;Y<T;Y++){var B=S[Y],A=B.material;if(void 0!==A&&0!==A.opacity){ca.makeEmpty();if(B instanceof THREE.RenderableSprite){n=B;n.x*=l;n.y*=M;var q=n,K=B,L=A;s(L.opacity);U(L.blending);
var t=K.scale.x*l,K=K.scale.y*M,B=.5*Math.sqrt(t*t+K*K);ca.min.set(q.x-B,q.y-B);ca.max.set(q.x+B,q.y+B);if(L instanceof THREE.SpriteMaterial){var X=L.map;if(null!==X&&void 0!==X.image){!1===X.hasEventListener("update",x)&&(0<X.image.width&&p(X),X.addEventListener("update",x));B=F[X.id];void 0!==B?z(B):z("rgba( 0, 0, 0, 1 )");var Z=X.image,B=Z.width*X.offset.x,A=Z.height*X.offset.y,H=Z.width*X.repeat.x,X=Z.height*X.repeat.y,Z=t/H,da=K/X;b.save();b.translate(q.x,q.y);0!==L.rotation&&b.rotate(L.rotation);
b.translate(-t/2,-K/2);b.scale(Z,da);b.translate(-B,-A);b.fillRect(B,A,H,X)}else z(L.color.getStyle()),b.save(),b.translate(q.x,q.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(t,-K),b.fillRect(-.5,-.5,1,1);b.restore()}else L instanceof THREE.SpriteCanvasMaterial&&(N(L.color.getStyle()),z(L.color.getStyle()),b.save(),b.translate(q.x,q.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(t,K),L.program(b),b.restore())}else if(B instanceof THREE.RenderableLine){if(n=B.v1,R=B.v2,n.positionScreen.x*=l,n.positionScreen.y*=
M,R.positionScreen.x*=l,R.positionScreen.y*=M,ca.setFromPoints([n.positionScreen,R.positionScreen]),!0===na.isIntersectionBox(ca))if(q=n,L=R,t=B,K=A,s(K.opacity),U(K.blending),b.beginPath(),b.moveTo(q.positionScreen.x,q.positionScreen.y),b.lineTo(L.positionScreen.x,L.positionScreen.y),K instanceof THREE.LineBasicMaterial){G(K.linewidth);w(K.linecap);E(K.linejoin);if(K.vertexColors!==THREE.VertexColors)N(K.color.getStyle());else if(B=t.vertexColors[0].getStyle(),t=t.vertexColors[1].getStyle(),B===
t)N(B);else{try{var ha=b.createLinearGradient(q.positionScreen.x,q.positionScreen.y,L.positionScreen.x,L.positionScreen.y);ha.addColorStop(0,B);ha.addColorStop(1,t)}catch(ma){ha=B}N(ha)}b.stroke();ca.expandByScalar(2*K.linewidth)}else K instanceof THREE.LineDashedMaterial&&(G(K.linewidth),w(K.linecap),E(K.linejoin),N(K.color.getStyle()),D([K.dashSize,K.gapSize]),b.stroke(),ca.expandByScalar(2*K.linewidth),D([]))}else if(B instanceof THREE.RenderableFace){n=B.v1;R=B.v2;ga=B.v3;if(-1>n.positionScreen.z||
1<n.positionScreen.z)continue;if(-1>R.positionScreen.z||1<R.positionScreen.z)continue;if(-1>ga.positionScreen.z||1<ga.positionScreen.z)continue;n.positionScreen.x*=l;n.positionScreen.y*=M;R.positionScreen.x*=l;R.positionScreen.y*=M;ga.positionScreen.x*=l;ga.positionScreen.y*=M;0<A.overdraw&&(e(n.positionScreen,R.positionScreen,A.overdraw),e(R.positionScreen,ga.positionScreen,A.overdraw),e(ga.positionScreen,n.positionScreen,A.overdraw));ca.setFromPoints([n.positionScreen,R.positionScreen,ga.positionScreen]);
if(!0===na.isIntersectionBox(ca)){L=n;t=R;K=ga;q=A;W.info.render.vertices+=3;W.info.render.faces++;s(q.opacity);U(q.blending);aa=L.positionScreen.x;xa=L.positionScreen.y;y=t.positionScreen.x;f=t.positionScreen.y;C=K.positionScreen.x;qa=K.positionScreen.y;var A=aa,H=xa,X=y,Z=f,da=C,oa=qa;b.beginPath();b.moveTo(A,H);b.lineTo(X,Z);b.lineTo(da,oa);b.closePath();if((q instanceof THREE.MeshLambertMaterial||q instanceof THREE.MeshPhongMaterial)&&null===q.map){P.copy(q.color);I.copy(q.emissive);q.vertexColors===
THREE.FaceColors&&P.multiply(B.color);v.copy(za);Ea.copy(L.positionWorld).add(t.positionWorld).add(K.positionWorld).divideScalar(3);L=Ea;t=B.normalModel;K=v;B=0;for(A=ea.length;B<A;B++)H=ea[B],ja.copy(H.color),H instanceof THREE.DirectionalLight?(X=ra.setFromMatrixPosition(H.matrixWorld).normalize(),Z=t.dot(X),0>=Z||(Z*=H.intensity,K.add(ja.multiplyScalar(Z)))):H instanceof THREE.PointLight&&(X=ra.setFromMatrixPosition(H.matrixWorld),Z=t.dot(ra.subVectors(X,L).normalize()),0>=Z||(Z*=0==H.distance?
1:1-Math.min(L.distanceTo(X)/H.distance,1),0!=Z&&(Z*=H.intensity,K.add(ja.multiplyScalar(Z)))));v.multiply(P).add(I);!0===q.wireframe?k(v,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):d(v)}else q instanceof THREE.MeshBasicMaterial||q instanceof THREE.MeshLambertMaterial||q instanceof THREE.MeshPhongMaterial?null!==q.map?q.map.mapping===THREE.UVMapping&&(h=B.uvs,a(aa,xa,y,f,C,qa,h[0].x,h[0].y,h[1].x,h[1].y,h[2].x,h[2].y,q.map)):null!==q.envMap?q.envMap.mapping===THREE.SphericalReflectionMapping&&
(sa.copy(B.vertexNormalsModel[0]).applyMatrix3(ya),Q=.5*sa.x+.5,ba=.5*sa.y+.5,sa.copy(B.vertexNormalsModel[1]).applyMatrix3(ya),ta=.5*sa.x+.5,va=.5*sa.y+.5,sa.copy(B.vertexNormalsModel[2]).applyMatrix3(ya),Aa=.5*sa.x+.5,Ba=.5*sa.y+.5,a(aa,xa,y,f,C,qa,Q,ba,ta,va,Aa,Ba,q.envMap)):(v.copy(q.color),q.vertexColors===THREE.FaceColors&&v.multiply(B.color),!0===q.wireframe?k(v,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):d(v)):(q instanceof THREE.MeshDepthMaterial?v.r=v.g=v.b=1-ka(L.positionScreen.z*
L.positionScreen.w,pa.near,pa.far):q instanceof THREE.MeshNormalMaterial?(sa.copy(B.normalModel).applyMatrix3(ya),v.setRGB(sa.x,sa.y,sa.z).multiplyScalar(.5).addScalar(.5)):v.setRGB(1,1,1),!0===q.wireframe?k(v,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):d(v))}}J.union(ca)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(g){this.positionWorld.copy(g.positionWorld);this.positionScreen.copy(g.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function g(){if(E===z){var a=new THREE.RenderableVertex;N.push(a);z++;E++;return a}return N[E++]}function k(){if(ka===la){var a=new THREE.RenderableFace;W.push(a);la++;ka++;return a}return W[ka++]}function d(){if(ea===t){var a=new THREE.RenderableLine;V.push(a);t++;ea++;return a}return V[ea++]}function x(){if(u===M){var a=new THREE.RenderableSprite;l.push(a);M++;u++;return a}return l[u++]}function p(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function a(a,c){var b=
0,d=1,e=a.z+a.w,f=c.z+c.w,g=-a.z+a.w,k=-c.z+c.w;if(0<=e&&0<=f&&0<=g&&0<=k)return!0;if(0>e&&0>f||0>g&&0>k)return!1;0>e?b=Math.max(b,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f)));0>g?b=Math.max(b,g/(g-k)):0>k&&(d=Math.min(d,g/(g-k)));if(d<b)return!1;a.lerp(c,b);c.lerp(a,1-d);return!0}var e,s,U=[],G=0,w,E,N=[],z=0,D,ka,W=[],la=0,S,ea,V=[],t=0,r,u,l=[],M=0,O={objects:[],lights:[],elements:[]},ia=new THREE.Vector3,m=new THREE.Vector3,fa=new THREE.Vector3,c=new THREE.Vector3,b=new THREE.Vector4,Y=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),T=new THREE.Box3,H=Array(3),wa=new THREE.Matrix4,da=new THREE.Matrix4,A,oa=new THREE.Matrix4,ha=new THREE.Matrix3,ua=new THREE.Frustum,ma=new THREE.Vector4,pa=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var n=new function(){var a=[],c=[],b=null,e=null,p=new THREE.Matrix3,f=function(a){var c=a.positionWorld,b=a.positionScreen;c.copy(a.position).applyMatrix4(A);b.copy(c).applyMatrix4(da);c=1/b.w;b.x*=c;b.y*=c;b.z*=c;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},m=function(a,c,b){if(!0===a.visible||!0===c.visible||!0===b.visible)return!0;H[0]=a.positionScreen;H[1]=c.positionScreen;H[2]=b.positionScreen;return Y.isIntersectionBox(T.setFromPoints(H))},l=function(a,c,b){return 0>(b.positionScreen.x-
a.positionScreen.x)*(c.positionScreen.y-a.positionScreen.y)-(b.positionScreen.y-a.positionScreen.y)*(c.positionScreen.x-a.positionScreen.x)};return{setObject:function(f){b=f;e=b.material;p.getNormalMatrix(b.matrixWorld);a.length=0;c.length=0},projectVertex:f,checkTriangleVisibility:m,checkBackfaceCulling:l,pushVertex:function(a,c,b){w=g();w.position.set(a,c,b);f(w)},pushNormal:function(c,b,f){a.push(c,b,f)},pushUv:function(a,b){c.push(a,b)},pushLine:function(a,c){var f=N[a],e=N[c];S=d();S.id=b.id;
S.v1.copy(f);S.v2.copy(e);S.z=(f.positionScreen.z+e.positionScreen.z)/2;S.material=b.material;O.elements.push(S)},pushTriangle:function(f,d,g){var x=N[f],n=N[d],h=N[g];if(!1!==m(x,n,h)&&(e.side===THREE.DoubleSide||!0===l(x,n,h))){D=k();D.id=b.id;D.v1.copy(x);D.v2.copy(n);D.v3.copy(h);D.z=(x.positionScreen.z+n.positionScreen.z+h.positionScreen.z)/3;for(x=0;3>x;x++)n=3*arguments[x],h=D.vertexNormalsModel[x],h.set(a[n],a[n+1],a[n+2]),h.applyMatrix3(p).normalize(),n=2*arguments[x],D.uvs[x].set(c[n],c[n+
1]);D.vertexNormalsLength=3;D.material=b.material;O.elements.push(D)}}}};this.projectScene=function(l,t,Y,H){u=ea=ka=0;O.elements.length=0;!0===l.autoUpdate&&l.updateMatrixWorld();void 0===t.parent&&t.updateMatrixWorld();wa.copy(t.matrixWorldInverse.getInverse(t.matrixWorld));da.multiplyMatrices(t.projectionMatrix,wa);ua.setFromMatrix(da);s=0;O.objects.length=0;O.lights.length=0;l.traverseVisible(function(a){if(a instanceof THREE.Light)O.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===ua.intersectsObject(a))){if(s===G){var h=new THREE.RenderableObject;U.push(h);G++;s++;e=h}else e=U[s++];e.id=a.id;e.object=a;c.setFromMatrixPosition(a.matrixWorld);c.applyProjection(da);e.z=c.z;O.objects.push(e)}});!0===Y&&O.objects.sort(p);l=0;for(Y=O.objects.length;l<Y;l++){var y=O.objects[l].object,f=y.geometry;n.setObject(y);A=y.matrixWorld;E=0;if(y instanceof THREE.Mesh)if(f instanceof THREE.BufferGeometry){var C=
f.attributes,y=f.offsets;if(void 0!==C.position){for(var w=C.position.array,f=0,v=w.length;f<v;f+=3)n.pushVertex(w[f],w[f+1],w[f+2]);if(void 0!==C.normal)for(var P=C.normal.array,f=0,v=P.length;f<v;f+=3)n.pushNormal(P[f],P[f+1],P[f+2]);if(void 0!==C.uv)for(P=C.uv.array,f=0,v=P.length;f<v;f+=2)n.pushUv(P[f],P[f+1]);if(void 0!==C.index)if(C=C.index.array,0<y.length)for(l=0;l<y.length;l++)for(v=y[l],w=v.index,f=v.start,v=v.start+v.count;f<v;f+=3)n.pushTriangle(C[f]+w,C[f+1]+w,C[f+2]+w);else for(f=0,
v=C.length;f<v;f+=3)n.pushTriangle(C[f],C[f+1],C[f+2]);else for(f=0,v=w.length/3;f<v;f+=3)n.pushTriangle(f,f+1,f+2)}}else{if(f instanceof THREE.Geometry){var I=f.vertices,v=f.faces,C=f.faceVertexUvs[0];ha.getNormalMatrix(A);for(var w=y.material instanceof THREE.MeshFaceMaterial,P=!0===w?y.material:null,T=0,F=I.length;T<F;T++){var h=I[T];n.pushVertex(h.x,h.y,h.z)}I=0;for(T=v.length;I<T;I++){var F=v[I],Q=!0===w?P.materials[F.materialIndex]:y.material;if(void 0!==Q){var ba=Q.side,h=N[F.a],ta=N[F.b],
va=N[F.c];if(!0===Q.morphTargets){var z=f.morphTargets,M=y.morphTargetInfluences,na=h.position,J=ta.position,ca=va.position;ia.set(0,0,0);m.set(0,0,0);fa.set(0,0,0);for(var W=0,la=z.length;W<la;W++){var V=M[W];if(0!==V){var ra=z[W].vertices;ia.x+=(ra[F.a].x-na.x)*V;ia.y+=(ra[F.a].y-na.y)*V;ia.z+=(ra[F.a].z-na.z)*V;m.x+=(ra[F.b].x-J.x)*V;m.y+=(ra[F.b].y-J.y)*V;m.z+=(ra[F.b].z-J.z)*V;fa.x+=(ra[F.c].x-ca.x)*V;fa.y+=(ra[F.c].y-ca.y)*V;fa.z+=(ra[F.c].z-ca.z)*V}}h.position.add(ia);ta.position.add(m);va.position.add(fa);
n.projectVertex(h);n.projectVertex(ta);n.projectVertex(va)}if(!1!==n.checkTriangleVisibility(h,ta,va)){z=n.checkBackfaceCulling(h,ta,va);if(ba!==THREE.DoubleSide){if(ba===THREE.FrontSide&&!1===z)continue;if(ba===THREE.BackSide&&!0===z)continue}D=k();D.id=y.id;D.v1.copy(h);D.v2.copy(ta);D.v3.copy(va);D.normalModel.copy(F.normal);!1!==z||ba!==THREE.BackSide&&ba!==THREE.DoubleSide||D.normalModel.negate();D.normalModel.applyMatrix3(ha).normalize();M=F.vertexNormals;na=0;for(J=Math.min(M.length,3);na<
J;na++)ca=D.vertexNormalsModel[na],ca.copy(M[na]),!1!==z||ba!==THREE.BackSide&&ba!==THREE.DoubleSide||ca.negate(),ca.applyMatrix3(ha).normalize();D.vertexNormalsLength=M.length;ba=C[I];if(void 0!==ba)for(z=0;3>z;z++)D.uvs[z].copy(ba[z]);D.color=F.color;D.material=Q;D.z=(h.positionScreen.z+ta.positionScreen.z+va.positionScreen.z)/3;O.elements.push(D)}}}}}else if(y instanceof THREE.Line)if(f instanceof THREE.BufferGeometry){if(C=f.attributes,void 0!==C.position){w=C.position.array;f=0;for(v=w.length;f<
v;f+=3)n.pushVertex(w[f],w[f+1],w[f+2]);if(void 0!==C.index)for(C=C.index.array,f=0,v=C.length;f<v;f+=2)n.pushLine(C[f],C[f+1]);else for(C=y.mode===THREE.LinePieces?2:1,f=0,v=w.length/3-1;f<v;f+=C)n.pushLine(f,f+1)}}else{if(f instanceof THREE.Geometry&&(oa.multiplyMatrices(da,A),I=y.geometry.vertices,0!==I.length))for(h=g(),h.positionScreen.copy(I[0]).applyMatrix4(oa),C=y.mode===THREE.LinePieces?2:1,T=1,F=I.length;T<F;T++)h=g(),h.positionScreen.copy(I[T]).applyMatrix4(oa),0<(T+1)%C||(ta=N[E-2],ma.copy(h.positionScreen),
pa.copy(ta.positionScreen),!0===a(ma,pa)&&(ma.multiplyScalar(1/ma.w),pa.multiplyScalar(1/pa.w),S=d(),S.id=y.id,S.v1.positionScreen.copy(ma),S.v2.positionScreen.copy(pa),S.z=Math.max(ma.z,pa.z),S.material=y.material,y.material.vertexColors===THREE.VertexColors&&(S.vertexColors[0].copy(y.geometry.colors[T]),S.vertexColors[1].copy(y.geometry.colors[T-1])),O.elements.push(S)))}else y instanceof THREE.Sprite&&(b.set(A.elements[12],A.elements[13],A.elements[14],1),b.applyMatrix4(da),f=1/b.w,b.z*=f,-1<=
b.z&&1>=b.z&&(r=x(),r.id=y.id,r.x=b.x*f,r.y=b.y*f,r.z=b.z,r.object=y,r.rotation=y.rotation,r.scale.x=y.scale.x*Math.abs(r.x-(b.x+t.projectionMatrix.elements[0])/(b.w+t.projectionMatrix.elements[12])),r.scale.y=y.scale.y*Math.abs(r.y-(b.y+t.projectionMatrix.elements[5])/(b.w+t.projectionMatrix.elements[13])),r.material=y.material,O.elements.push(r)))}!0===H&&O.elements.sort(p);return O}};
THREE.OrbitControls=function(g,k){function d(c){if(!1!==a.enabled){c.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(l===u.ROTATE){if(!0===a.noRotate)return;s.set(c.clientX,c.clientY);U.subVectors(s,e);a.rotateLeft(2*Math.PI*U.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*U.y/b.clientHeight*a.rotateSpeed);e.copy(s)}else if(l===u.DOLLY){if(!0===a.noZoom)return;ka.set(c.clientX,c.clientY);W.subVectors(ka,D);0<W.y?a.dollyIn():a.dollyOut();D.copy(ka)}else if(l===
u.PAN){if(!0===a.noPan)return;w.set(c.clientX,c.clientY);E.subVectors(w,G);a.pan(E.x,E.y);G.copy(w)}a.update()}}function x(){!1!==a.enabled&&(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",x,!1),a.dispatchEvent(fa),l=u.NONE)}function p(c){if(!1!==a.enabled&&!0!==a.noZoom){c.preventDefault();c.stopPropagation();var b=0;void 0!==c.wheelDelta?b=c.wheelDelta:void 0!==c.detail&&(b=-c.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(m);a.dispatchEvent(fa)}}
this.object=g;this.domElement=void 0!==k?k:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,e=new THREE.Vector2,s=new THREE.Vector2,U=new THREE.Vector2,G=new THREE.Vector2,w=new THREE.Vector2,E=new THREE.Vector2,N=new THREE.Vector3,z=new THREE.Vector3,D=new THREE.Vector2,ka=new THREE.Vector2,W=new THREE.Vector2,la=0,S=0,ea=1,V=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Quaternion,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},l=u.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var M=(new THREE.Quaternion).setFromUnitVectors(g.up,new THREE.Vector3(0,1,0)),O=M.clone().inverse(),ia={type:"change"},m={type:"start"},fa={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);S-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);la-=c};this.panLeft=function(a){var b=this.object.matrix.elements;N.set(b[0],b[1],b[2]);N.multiplyScalar(-a);V.add(N)};this.panUp=function(a){var b=this.object.matrix.elements;N.set(b[4],b[5],
b[6]);N.multiplyScalar(a);V.add(N)};this.panForward=function(a){var b=this.object.matrix.elements;N.set(b[8],b[9],b[10]);N.multiplyScalar(a);V.add(N)};this.pan=function(c,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*d/e.clientHeight);a.panUp(2*b*d/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/e.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*d/e.clientHeight);a.panForward(2*b*d/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/e.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ea/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ea*=c};this.update=function(){var c=this.object.position;z.copy(c).sub(this.target);z.applyQuaternion(M);var b=Math.atan2(z.x,z.z),e=Math.atan2(Math.sqrt(z.x*z.x+z.z*z.z),z.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+S,e=e+la,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),d=z.length()*ea,d=Math.max(this.minDistance,Math.min(this.maxDistance,d));this.target.add(V);z.x=d*Math.sin(e)*Math.sin(b);z.y=d*Math.cos(e);z.z=d*Math.sin(e)*Math.cos(b);z.applyQuaternion(O);c.copy(this.target).add(z);this.object.lookAt(this.target);la=S=0;ea=1;V.set(0,0,0);if(1E-6<
t.distanceToSquared(this.object.position)||1E-6<8*(1-r.dot(this.object.quaternion)))this.dispatchEvent(ia),t.copy(this.object.position),r.copy(this.object.quaternion)};this.reset=function(){l=u.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;l=u.ROTATE;e.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;l=u.DOLLY;D.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.PAN){if(!0===a.noPan)return;l=u.PAN;G.set(c.clientX,c.clientY)}document.addEventListener("mousemove",d,!1);document.addEventListener("mouseup",x,!1);a.dispatchEvent(m)}},!1);this.domElement.addEventListener("mousewheel",p,!1);this.domElement.addEventListener("DOMMouseScroll",p,!1);this.domElement.addEventListener("touchstart",
function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;l=u.TOUCH_ROTATE;e.set(c.touches[0].pageX,c.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;l=u.TOUCH_DOLLY;var b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;b=Math.sqrt(b*b+c*c);D.set(0,b);break;case 3:if(!0===a.noPan)return;l=u.TOUCH_PAN;G.set(c.touches[0].pageX,c.touches[0].pageY);break;default:l=u.NONE}a.dispatchEvent(m)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(fa),l=u.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();c.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(l!==u.TOUCH_ROTATE)break;s.set(c.touches[0].pageX,c.touches[0].pageY);U.subVectors(s,e);a.rotateLeft(2*Math.PI*U.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*U.y/b.clientHeight*a.rotateSpeed);e.copy(s);
a.update();break;case 2:if(!0===a.noZoom)break;if(l!==u.TOUCH_DOLLY)break;b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;c=Math.sqrt(b*b+c*c);ka.set(0,c);W.subVectors(ka,D);0<W.y?a.dollyOut():a.dollyIn();D.copy(ka);a.update();break;case 3:if(!0===a.noPan)break;if(l!==u.TOUCH_PAN)break;w.set(c.touches[0].pageX,c.touches[0].pageY);E.subVectors(w,G);a.pan(E.x,E.y);G.copy(w);a.update();break;default:l=u.NONE}}},!1);window.addEventListener("keydown",function(c){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var g=document.createElement("canvas");return!(!window.WebGLRenderingContext||!g.getContext("webgl")&&!g.getContext("experimental-webgl"))}catch(k){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";
g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){var k,d;g=g||{};k=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";d=Detector.getWebGLErrorMessage();d.id=g;k.appendChild(d)}};"object"===typeof module&&(module.exports=Detector);
(function(g,k,d,x){var p=function(a){this.domParent="object"===typeof a?a:k.body};p.prototype.init=function(a,e,p,U,G,w){g.requestAnimationFrame||(g.requestAnimationFrame=function(){return g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a,e){g.setTimeout(a,1E3/60)}}());this.domParent===k.body&&(this.WINDOW_WIDTH=g.innerWidth,this.WINDOW_HEIGHT=g.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,g.addEventListener("resize",a,!1));this.renderType=x.webgl?"webgl":"canvas";this.renderer=p||(x.webgl?new d.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new d.CanvasRenderer({antialias:!0,preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=U||new d.Scene;this.camera=G||new d.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,
500,1E3);this.camera.lookAt(this.scene.position);w?this.controls=w:(this.controls=new d.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:d.MOUSE.MIDDLE,PAN:d.MOUSE.RIGHT});e()};g.Base=p;"object"===typeof module&&(module.exports=p)})(window,document,THREE,Detector);
(function(){function g(d){return d.charAt(0).toUpperCase()+d.slice(1)}var k={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(d){var g=0;for(d=d.length;g<d;g++);};k.map={};k.Sidebar=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({align:"r",width:320},d),a="sidebar",a=p.align&&"r"!==p.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;p.id&&(this.domElement.id=p.id,k.map[p.id]=this);
this.domElement.style.width=p.width.toString()+"px";p.overflow&&(this.domElement.style.overflow=p.overflow.toString());g.appendChild(this.domElement);k.Utils.domCreationDirector(p.children,this.domElement)};k.Sidebar.prototype=Object.create(_Container.prototype);k.Panel=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({title:""},d);p.id&&(this.domElement.id=p.id,k.map[p.id]=this);var a=this.domElement;a.className="panel panel-tool";g.appendChild(a);var e=document.createElement("div");
e.className="panel-heading";a.appendChild(e);var s=document.createTextNode(p.title);e.appendChild(s);e=document.createElement("div");e.className="panel-body";p.overflow&&(e.style.overflow=p.overflow.toString());a.appendChild(e);k.Utils.domCreationDirector(p.children,e)};k.Panel.prototype=Object.create(_Container.prototype);k.Toolbar=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({title:""},d);p.id&&(this.domElement.id=p.id,k.map[p.id]=this);var a=this.domElement;a.className=
"btn-toolbar";g.appendChild(a);k.Utils.domCreationDirector(p.children,a)};k.Toolbar.prototype=Object.create(_Container.prototype);k.ButtonGroup=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({title:"",buttonType:"radio"},d);p.id&&(this.domElement.id=p.id,k.map[p.id]=this);var a=this.domElement;a.className="btn-group"+(p.appendClass?" "+p.appendClass:"");"button"!==p.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=p.title;g.appendChild(a);var e=
p.buttons;switch(p.buttonType.toLowerCase()){default:case "radio":for(var s=0,U=e.length;s<U;s++){var G=document.createElement("label");G.className="btn btn-tool"+(e[s].checked?" active":"");e[s].height&&(G.style.height=e[s].height+"px");e[s].width&&(G.style.width=e[s].width+"px");if(e[s].bgType&&e[s].bgTypeData){var w;switch(e[s].bgType){case "color":w=e[s].bgTypeData;G.className+=" btn-color";break;case "image":w="url("+e[s].bgTypeData+") no-repeat 50% 50%";G.className+=" btn-image";break;default:return}G.style.background=
w}a.appendChild(G);var E=document.createElement("input");e[s].checked&&E.setAttribute("checked","");E.type=p.buttonType;E.name=p.name;E.id=e[s].id;E.value=s;E.autocomplete="off";G.appendChild(E);w=document.createTextNode(e[s].title);G.appendChild(w)}break;case "button":for(s=0,U=e.length;s<U;s++){E=document.createElement("button");E.className="btn btn-tool";E.id=e[s].id;E.name=p.name;e[s].height&&(E.style.height=e[s].height+"px");e[s].width&&(E.style.width=e[s].width+"px");if(e[s].bgType&&e[s].bgTypeData){switch(e[s].bgType){case "color":w=
e[s].bgTypeData;G.className+=" btn-color";break;case "image":w="url("+e[s].bgTypeData+") no-repeat 50% 50%";G.className+=" btn-image";break;default:return}E.style.background=w}a.appendChild(E);w=document.createTextNode(e[s].title);E.appendChild(w)}}k.Utils.domCreationDirector(p.children,this.domElement)};k.ButtonGroup.prototype=Object.create(_Container.prototype);k.ButtonGroup.prototype.addButton=function(d,g){g||this.setting.buttons.push(d);var k=document.createElement("label");k.className="btn btn-tool"+
(d.checked?" active":"");d.height&&(k.style.height=d.height+"px");d.width&&(k.style.width=d.width+"px");if(d.bgType&&d.bgTypeData){var a;switch(d.bgType){case "color":a=d.bgTypeData;k.className+=" btn-color";break;case "image":a="url("+d.bgTypeData+") no-repeat 50% 50%";k.className+=" btn-image";break;default:return}k.style.background=a}this.domElement.appendChild(k);a=document.createElement("input");d.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
d.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";k.appendChild(a);a=document.createTextNode(d.title);k.appendChild(a);return k};k.ButtonGroup.prototype.addButtons=function(d,g){for(var k=0,a=d.length;k<a;k++)this.addButton(d[k],g)};k.Utils={};k.Utils.settingMixin=function(d,g){if("object"===typeof d&&"object"===typeof g){var k={},a;for(a in d)k[a]=d[a];for(var e in g)void 0!==g[e]&&(k[e]=g[e]);return k}return d};k.Utils.domCreationDirector=function(d,x){if(d)if(d instanceof Array)for(var p=
0,a=d.length;p<a;p++)k.Utils.domCreationDirector(d[p],x?x:document.body);else d instanceof Object&&d.UIType&&k[g(d.UIType)]&&new (k[g(d.UIType)])(d,x?x:document.body)};window.GoUI=k;"object"===typeof module&&(module.exports=k)})();
(function(g,k,d,x,p){var a,e;function s(a,b){var c=b.clone(),e;for(e in a)c[e]=a[e];return c}function U(a){if(null==a.pageX&&null!=a.clientX){var b=k.documentElement,c=k.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}C.set(a.pageX/m.WINDOW_WIDTH*2-1,2*-(a.pageY/m.WINDOW_HEIGHT)+1);v.setFromCamera(C,m.camera);return v.intersectObjects(ga)}function G(a,b){b&&
a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(O.width).floor().multiplyScalar(O.width).addScalar(O.width/2))}function w(a){0<a.length&&G(n,a[0])}function E(a,b,e,d){a=a||U(event);if(0<a.length){a=a[0];var g=A.toolsType,f=!1,k=ga.length;if(k&&a.object!==c)for(var l=k-1;0<l&&l>k-1-3;l--)if(a.object===ga[l]){f=!0;break}0===g?!0===f&&!1===b||!1===f&&!0===b||(b=F.draw(0,oa,void 0,a),d?ja.appendObjectToCurrentAction(b):ja.addAction("draw",b)):1===g&&e&&a.object!==c&&(b=F.erase(a.object),
d?ja.appendObjectToCurrentAction(b):ja.addAction("erase",b))}}function N(a){0===b&&(I.save(I.storageKeys.camera),I.save(I.storageKeys.sidebar),I.save())}function z(a){I.save(I.storageKeys.camera);I.save(I.storageKeys.sidebar);I.save();b=1}function D(a){a.preventDefault();var b;1===qa[0]?(b=U(a),E(b,a.ctrlKey,a.ctrlKey,!0)):(b=A.toolsType,1===b?n.visible&&(n.visible=!1):(!n.visible&&da&&(n.visible=!0),b=U(a),w(b)))}function ka(a){a.preventDefault();switch(a.button){case 0:if(!P.endFlag){P.instantComplete(P.loadBoxAnimation);
break}qa[0]=1;a=U(a);E(a,void 0,!0,!1);0===A.toolsType&&w(a);break;case 1:qa[1]=1;break;case 2:qa[2]=1}}function W(h){if("label"===this.nodeName.toLowerCase())switch(h=this.getElementsByTagName("input")[0],A[h.name]=Number(h.value),h.name){case "toolsType":1===Number(h.value)?n.visible&&(n.visible=!1):!n.visible&&da&&(n.visible=!0);break;case "textures":oa=A[h.name];ha=H[oa];ua=ha.data;ma=ha.helperData=H[A[h.name]].helperData||s(T,ua);n.material=ma;k.getElementById("cube").parentElement.click();switch(A.texturesType){case 0:a=
h.value;break;default:case 1:e=h.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===h.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":h=h.id,"imageTexture"===h?($(".btn-color").hide(),$(".btn-image").show(),k.getElementById("texture"+a).parentElement.click()):"colorTexture"===h&&($(".btn-color").show(),$(".btn-image").hide(),k.getElementById("texture"+e).parentElement.click())}else if("button"===this.type||"button"===
this.nodeName.toLowerCase())A[this.id]()}function la(a){switch(a.button){case 0:qa[0]=0;break;case 1:qa[1]=0;break;case 2:qa[2]=0}}function S(a){}function ea(a){if(!qa[0])switch(a.keyCode){case 16:0===A.toolsType?k.getElementById("eraser").parentElement.click():1===A.toolsType&&k.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&ja.undo();break;case 89:a.ctrlKey&&ja.redo()}}function V(){requestAnimationFrame(V);m.renderer.render(m.scene,m.camera)}var t=k.createElement("a");t.id=
"imageCapture";t.style.display="none";t.target="_blank";k.body.appendChild(t);var r=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};r.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=P.currentMeshes;P.currentIterator<a.length?a[P.currentIterator].meshObject.visible=!0:(P.endFlag=!0,clearInterval(P.currentAnimationIntervalHandler));P.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;
this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=P.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var u=function(a){this.isLoadingBoxEnd=a};u.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return g.localStorage&&g.localStorage.getItem(a||
this.storageKeys.meshes)},save:function(b,c){if(g.localStorage){var d="";if(c)d=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>ja.currentActionIndex)return;for(var f=0,k=aa.length;f<k;f++)d+=aa[f].geo.id.replace("geo","")+",",d+=aa[f].material.id.replace("texture","")+",",d+=aa[f].meshObject.position.x+",",d+=aa[f].meshObject.position.y+",",d+=aa[f].meshObject.position.z+";";break;case this.storageKeys.camera:d+=m.controls.target.x+","+m.controls.target.y+
","+m.controls.target.z+";";d+=m.controls.object.position.x+","+m.controls.object.position.y+","+m.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=a+","+e+","+A.texturesType+","+A.sidebarResize}g.localStorage.setItem(b||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var d=[];(a=this.load(a))&&(d=a.split(";"));if(0<d.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=d.length;b<a;b++){var e=d[b].split(",");2<e.length&&F.draw(Number(e[0]),Number(e[1]),
[Number(e[2]),Number(e[3]),Number(e[4])])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=d.length;b<a;b++)e=d[b].split(","),2<e.length&&F.draw(Number(e[0]),Number(e[1]),[Number(e[2]),Number(e[3]),Number(e[4])],void 0,void 0,!0);P.begin(c,aa)}else P.endFlag=!0},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:m.controls.target.set(Number(d[0]),Number(d[1]),Number(d[2]));
break;case 1:m.controls.object.position.set(Number(d[0]),Number(d[1]),Number(d[2]))}}m.controls.update()}},loadSidebarSelectedButtons:function(b){var c=[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var d=c.length;b<d;b++){var f=c[b];switch(b){case 0:a=Number(f);break;case 1:e=Number(f);break;case 2:0===Number(f)?k.getElementById("imageTexture").parentElement.click():k.getElementById("colorTexture").parentElement.click();break;case 3:0===Number(f)?k.getElementById("normalSidebar").parentElement.click():
k.getElementById("minSidebar").parentElement.click()}}}else k.getElementById("imageTexture").parentElement.click()}};var l=function(){this.currentActionIndex=-1;this.actionArray=[]};l.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=F.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":F.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,
e.meshObject.position.z],void 0,e.meshObject);break;case "erase":F.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":F.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;
case "erase":F.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,e=a.length;c<e;c++)b.meshes.push(a[c]);
else b.meshes.push(a)},updateDom:function(){k.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;k.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var M=function(){};M.prototype={calculateIntersectResult:U,setMeshPositionToFitTheGrid:G,updateHelperCube:w,draw:function(a,b,c,e,d,f){if(void 0===a||"number"===typeof a)a=wa[a||0];if(void 0===b||"number"===typeof b)b=H[b||0];var g=a.data,k=b.data;d=d||new x.Mesh(g,k);d.castShadow=!0;d.receiveShadow=
!0;e?G(d,e):d.position.set(c[0],c[1],c[2]);!f||(d.visible=!1);m.scene.add(d);ga.push(d);aa.push({meshObject:d,geo:a,material:b});return aa[aa.length-1]},erase:function(a){m.scene.remove(a);a=ga.indexOf(a);if(!(0>a)){ga.splice(a,1);var b=aa[a-1];aa.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};var O={width:50},ia={webgl:{ambientLightColor:2105376,directionalLightDensity:.4},canvas:{ambientLightColor:9474192,directionalLightDensity:.9}},m,fa,c,b=0;p=u.prototype.LOAD_TYPE.async;
var Y=new x.MeshLambertMaterial({color:592137}),T={opacity:.5,transparent:!0},H=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:Y,helperData:s(T,Y)}],wa=[{name:"default",type:"1",id:"geo0",data:new x.BoxGeometry(O.width,O.width,O.width)}];a=30;e=0;var da=!0,A={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===A.toolsType||(n.visible=!n.visible);R.visible=!R.visible;da=!da},capture:function(){t.href=m.renderer.domElement.toDataURL();t.download="capture.png";
t.click()},clearAll:function(){P.endFlag||P.instantComplete(P.loadBoxAnimation);if(!(1>aa.length)){var a=F.erase(aa[0].meshObject);ja.addAction("erase",a);for(var b=0,c=aa.length;b<c;b++)a=F.erase(aa[0].meshObject),ja.appendObjectToCurrentAction(a)}},undo:function(){ja.undo()},redo:function(){ja.redo()}},oa=0,ha=H[0],ua=ha.data,ma=ha.helperData,pa=wa[0].data,n,R,ga=[],aa=[],xa,y,f,C,qa=[0,0,0],v,P=new r,I=new u(!1),ja=new l,F=new M;m=new d(k.body);m.init(function(a){if(m.WINDOW_WIDTH!==g.innerWidth||
m.WINDOW_HEIGHT!==g.innerHeight)m.WINDOW_WIDTH=g.innerWidth,m.WINDOW_HEIGHT=g.innerHeight,m.WINDOW_HEIGHT_HALF=m.WINDOW_HEIGHT/2,m.WINDOW_WIDTH_HALF=m.WINDOW_WIDTH/2,m.camera.aspect=m.WINDOW_WIDTH/m.WINDOW_HEIGHT,m.camera.updateProjectionMatrix(),m.renderer.setSize(m.WINDOW_WIDTH,m.WINDOW_HEIGHT),k.body.height=m.WINDOW_HEIGHT},function(){R=new x.GridHelper(5E3,O.width);m.scene.add(R);fa=new x.PlaneBufferGeometry(1E4,1E4);fa.applyMatrix((new x.Matrix4).makeRotationX(-Math.PI/2));c=new x.Mesh(fa);c.visible=
!1;m.scene.add(c);ga.push(c);xa=new x.AmbientLight(ia[m.renderType].ambientLightColor);m.scene.add(xa);y=new x.DirectionalLight(15658734,ia[m.renderType].directionalLightDensity);y.position.set(0,6E3,5E3);y.target.position.set(0,0,0);y.castShadow=!0;y.shadowCameraNear=m.camera.near;y.shadowCameraFar=m.camera.far;y.shadowCameraFov=m.camera.fov;y.shadowBias=1E-6;y.shadowDarkness=.5;y.shadowMapWidth=1024;y.shadowMapHeight=1024;m.scene.add(y);f=new x.HemisphereLight(15658734,3158064,.95);m.scene.add(f);
n=new x.Mesh(pa,ma);n.position.set(O.width/2,O.width/2,O.width/2);m.scene.add(n);new x.Mesh(pa,ua);v=new x.Raycaster;C=new x.Vector2;m.renderer.setClearColor(15790320);m.renderer.shadowMapEnabled=!0;m.renderer.shadowMapType=x.PCFShadowMap;g.addEventListener("unload",N,!1);g.addEventListener("reload",z,!1);m.renderer.domElement.addEventListener("mousemove",D,!1);m.renderer.domElement.addEventListener("mousedown",ka,!1);m.renderer.domElement.addEventListener("mouseup",la,!1);k.addEventListener("keydown",
S,!1);k.addEventListener("keyup",ea,!1);setInterval(N,12E4)});V();u={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",
id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",
children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",
title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:H[0].type,bgTypeData:H[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>m.WINDOW_WIDTH)for(l=u.children,r=0,d=l.length;r<d;r++)if("sidebarResize"===l[r].id){r=l[r].buttons;l=0;for(d=r.length;l<d;l++)"normalSidebar"===r[l].id&&delete r[l].checked,"minSidebar"===r[l].id&&(r[l].checked=!0);break}GoUI.Utils.domCreationDirector(u);ja.updateDom();d=k.querySelectorAll(".btn");
if(d instanceof Array||d.length)for(r=d.length-1;0<=r;r--)d[r].addEventListener("click",W,!1);else d instanceof object&&d.addEventListener("click",W,!1);l=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},
{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];r=0;for(d=l.length;r<d;r++)u={name:l[r].color,type:"color",id:"texture"+(r+1),uniqueData:l[r].color,data:new x.MeshLambertMaterial({color:l[r].color})},H.push(u),GoUI.map.buttonGroup2.addButton({title:"",id:u.id,bgType:u.type,bgTypeData:u.uniqueData,width:50,height:50}).addEventListener("click",W,!1);l="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");
x.ImageUtils.crossOrigin="Anonymous";r=0;for(d=l.length;r<d;r++)u={name:l[r].replace("texture/","").replace(".png",""),type:"image",id:"texture"+H.length,uniqueData:l[r],data:new x.MeshLambertMaterial({map:x.ImageUtils.loadTexture(l[r]),transparent:!0})},"glass"===u.data.name&&(u.data.map.opacity=.3),u.data.map.magFilter=x.NearestFilter,u.data.map.minFilter=x.LinearMipMapLinearFilter,H.push(u),GoUI.map.buttonGroup2.addButton({title:"",id:u.id,bgType:u.type,bgTypeData:u.uniqueData,width:50,height:50}).addEventListener("click",
W,!1);I.loadCamera(I.storageKeys.camera);I.loadSidebarSelectedButtons(I.storageKeys.sidebar);I.loadMeshes(void 0,p,P.loadBoxAnimation)})(window,document,Base,THREE,Detector);
