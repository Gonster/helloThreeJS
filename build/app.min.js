THREE.SpriteCanvasMaterial=function(b){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(k,p){};this.setValues(b)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var b=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.program=this.program;return b};
THREE.CanvasRenderer=function(b){function k(a,c,l,K){R(c);E(l);M(K);W(a.getStyle());q.stroke();ga.expandByScalar(2*c)}function p(a){Y(a.getStyle());q.fill()}function t(a){e(a.target)}function e(a){if(!(a instanceof THREE.CompressedTexture)){var c=a.wrapS===THREE.RepeatWrapping,l=a.wrapT===THREE.RepeatWrapping,K=a.image,g=document.createElement("canvas");g.width=K.width;g.height=K.height;var F=g.getContext("2d");F.setTransform(1,0,0,-1,0,K.height);F.drawImage(K,0,0);T[a.id]=q.createPattern(g,!0===
c&&!0===l?"repeat":!0===c&&!1===l?"repeat-x":!1===c&&!0===l?"repeat-y":"no-repeat")}}function v(a,c,l,K,g,F,A,f,k,p,h,m,b){if(!(b instanceof THREE.DataTexture)){!1===b.hasEventListener("update",t)&&(void 0!==b.image&&0<b.image.width&&e(b),b.addEventListener("update",t));var d=T[b.id];if(void 0!==d){Y(d);var d=b.offset.x/b.repeat.x,x=b.offset.y/b.repeat.y,s=b.image.width*b.repeat.x;b=b.image.height*b.repeat.y;A=(A+d)*s;f=(f+x)*b;l-=a;K-=c;g-=a;F-=c;k=(k+d)*s-A;p=(p+x)*b-f;h=(h+d)*s-A;m=(m+x)*b-f;b=
k*m-h*p;0!==b&&(d=1/b,b=(m*l-p*g)*d,p=(m*K-p*F)*d,l=(k*g-h*l)*d,K=(k*F-h*K)*d,a=a-b*A-l*f,c=c-p*A-K*f,q.save(),q.transform(b,p,l,K,a,c),q.fill(),q.restore())}else Y("rgba(0,0,0,1)"),q.fill()}}function u(a,c,l){var K=c.x-a.x,g=c.y-a.y,F=K*K+g*g;0!==F&&(l/=Math.sqrt(F),K*=l,g*=l,c.x+=K,c.y+=g,a.x-=K,a.y-=g)}function a(a){d!==a&&(d=q.globalAlpha=a)}function ea(a){ua!==a&&(a===THREE.NormalBlending?q.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?q.globalCompositeOperation="lighter":
a===THREE.SubtractiveBlending&&(q.globalCompositeOperation="darker"),ua=a)}function R(a){va!==a&&(va=q.lineWidth=a)}function E(a){Q!==a&&(Q=q.lineCap=a)}function M(a){h!==a&&(h=q.lineJoin=a)}function W(a){na!==a&&(na=q.strokeStyle=a)}function Y(a){B!==a&&(B=q.fillStyle=a)}function G(a){r.length!==a.length&&(q.setLineDash(a),r=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var da=THREE.Math.smoothstep;b=b||{};var aa=this,ia,ba,oa,ra=new THREE.Projector,S=void 0!==b.canvas?b.canvas:document.createElement("canvas"),
U=S.width,ka=S.height,I=Math.floor(U/2),C=Math.floor(ka/2),H=0,ja=0,la=U,sa=ka,n=1,q=S.getContext("2d",{alpha:!0===b.alpha}),f=new THREE.Color(0),s=!0===b.alpha?0:1,d=1,ua=0,na=null,B=null,va=null,Q=null,h=null,r=[],ca,y,ha,ma;new THREE.RenderableVertex;new THREE.RenderableVertex;var za,Aa,D,m,J,N,x=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var xa=new THREE.Color,O=new THREE.Color,ya=new THREE.Color,T={},Z,Ca,Da,Ea,X,fa,P,pa=new THREE.Box2,w=new THREE.Box2,ga=
new THREE.Box2,Ba=new THREE.Color,wa=new THREE.Color,qa=new THREE.Color,ta=new THREE.Vector3,V=new THREE.Vector3,c=new THREE.Vector3,L=new THREE.Matrix3;void 0===q.setLineDash&&(q.setLineDash=function(){});this.domElement=S;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return n};this.setPixelRatio=function(a){n=a};this.setSize=function(a,c,l){U=a*n;
ka=c*n;S.width=U;S.height=ka;I=Math.floor(U/2);C=Math.floor(ka/2);!1!==l&&(S.style.width=a+"px",S.style.height=c+"px");pa.min.set(-I,-C);pa.max.set(I,C);w.min.set(-I,-C);w.max.set(I,C);d=1;ua=0;h=Q=va=B=na=null;this.setViewport(0,0,a,c)};this.setViewport=function(a,c,l,K){H=a*n;ja=c*n;la=l*n;sa=K*n};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,c){f.set(a);s=void 0!==c?c:1;w.min.set(-I,-C);w.max.set(I,C)};this.setClearColorHex=function(a,c){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,c)};this.getClearColor=function(){return f};this.getClearAlpha=function(){return s};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===w.empty()&&(w.intersect(pa),w.expandByScalar(2),w.min.x+=I,w.min.y=-w.min.y+C,w.max.x+=I,w.max.y=-w.max.y+C,1>s&&q.clearRect(w.min.x|0,w.max.y|0,w.max.x-w.min.x|0,w.min.y-w.max.y|0),0<s&&(ea(THREE.NormalBlending),a(1),Y("rgba("+Math.floor(255*f.r)+","+Math.floor(255*f.g)+","+Math.floor(255*f.b)+","+s+")"),q.fillRect(w.min.x|
0,w.max.y|0,w.max.x-w.min.x|0,w.min.y-w.max.y|0)),w.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(f,b){if(!1===b instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();aa.info.render.vertices=0;aa.info.render.faces=0;q.setTransform(la/U,0,0,-sa/ka,H,ka-ja);q.translate(I,C);ia=ra.projectScene(f,b,this.sortObjects,this.sortElements);
ba=ia.elements;oa=ia.lights;ca=b;L.getNormalMatrix(b.matrixWorldInverse);Ba.setRGB(0,0,0);wa.setRGB(0,0,0);qa.setRGB(0,0,0);for(var l=0,K=oa.length;l<K;l++){var g=oa[l],F=g.color;g instanceof THREE.AmbientLight?Ba.add(F):g instanceof THREE.DirectionalLight?wa.add(F):g instanceof THREE.PointLight&&qa.add(F)}l=0;for(K=ba.length;l<K;l++){var A=ba[l],h=A.material;if(void 0!==h&&0!==h.opacity){ga.makeEmpty();if(A instanceof THREE.RenderableSprite){y=A;y.x*=I;y.y*=C;var g=y,d=A,F=h;a(F.opacity);ea(F.blending);
var s=d.scale.x*I,d=d.scale.y*C,A=.5*Math.sqrt(s*s+d*d);ga.min.set(g.x-A,g.y-A);ga.max.set(g.x+A,g.y+A);if(F instanceof THREE.SpriteMaterial){var n=F.map;if(null!==n&&void 0!==n.image){!1===n.hasEventListener("update",t)&&(0<n.image.width&&e(n),n.addEventListener("update",t));A=T[n.id];void 0!==A?Y(A):Y("rgba( 0, 0, 0, 1 )");var r=n.image,A=r.width*n.offset.x,h=r.height*n.offset.y,B=r.width*n.repeat.x,n=r.height*n.repeat.y,r=s/B,Q=d/n;q.save();q.translate(g.x,g.y);0!==F.rotation&&q.rotate(F.rotation);
q.translate(-s/2,-d/2);q.scale(r,Q);q.translate(-A,-h);q.fillRect(A,h,B,n)}else Y(F.color.getStyle()),q.save(),q.translate(g.x,g.y),0!==F.rotation&&q.rotate(F.rotation),q.scale(s,-d),q.fillRect(-.5,-.5,1,1);q.restore()}else F instanceof THREE.SpriteCanvasMaterial&&(W(F.color.getStyle()),Y(F.color.getStyle()),q.save(),q.translate(g.x,g.y),0!==F.rotation&&q.rotate(F.rotation),q.scale(s,d),F.program(q),q.restore())}else if(A instanceof THREE.RenderableLine){if(y=A.v1,ha=A.v2,y.positionScreen.x*=I,y.positionScreen.y*=
C,ha.positionScreen.x*=I,ha.positionScreen.y*=C,ga.setFromPoints([y.positionScreen,ha.positionScreen]),!0===pa.isIntersectionBox(ga))if(g=y,F=ha,s=A,d=h,a(d.opacity),ea(d.blending),q.beginPath(),q.moveTo(g.positionScreen.x,g.positionScreen.y),q.lineTo(F.positionScreen.x,F.positionScreen.y),d instanceof THREE.LineBasicMaterial){R(d.linewidth);E(d.linecap);M(d.linejoin);if(d.vertexColors!==THREE.VertexColors)W(d.color.getStyle());else if(A=s.vertexColors[0].getStyle(),s=s.vertexColors[1].getStyle(),
A===s)W(A);else{try{var ua=q.createLinearGradient(g.positionScreen.x,g.positionScreen.y,F.positionScreen.x,F.positionScreen.y);ua.addColorStop(0,A);ua.addColorStop(1,s)}catch(na){ua=A}W(ua)}q.stroke();ga.expandByScalar(2*d.linewidth)}else d instanceof THREE.LineDashedMaterial&&(R(d.linewidth),E(d.linecap),M(d.linejoin),W(d.color.getStyle()),G([d.dashSize,d.gapSize]),q.stroke(),ga.expandByScalar(2*d.linewidth),G([]))}else if(A instanceof THREE.RenderableFace){y=A.v1;ha=A.v2;ma=A.v3;if(-1>y.positionScreen.z||
1<y.positionScreen.z)continue;if(-1>ha.positionScreen.z||1<ha.positionScreen.z)continue;if(-1>ma.positionScreen.z||1<ma.positionScreen.z)continue;y.positionScreen.x*=I;y.positionScreen.y*=C;ha.positionScreen.x*=I;ha.positionScreen.y*=C;ma.positionScreen.x*=I;ma.positionScreen.y*=C;0<h.overdraw&&(u(y.positionScreen,ha.positionScreen,h.overdraw),u(ha.positionScreen,ma.positionScreen,h.overdraw),u(ma.positionScreen,y.positionScreen,h.overdraw));ga.setFromPoints([y.positionScreen,ha.positionScreen,ma.positionScreen]);
if(!0===pa.isIntersectionBox(ga)){F=y;s=ha;d=ma;g=h;aa.info.render.vertices+=3;aa.info.render.faces++;a(g.opacity);ea(g.blending);za=F.positionScreen.x;Aa=F.positionScreen.y;D=s.positionScreen.x;m=s.positionScreen.y;J=d.positionScreen.x;N=d.positionScreen.y;var h=za,B=Aa,n=D,r=m,Q=J,S=N;q.beginPath();q.moveTo(h,B);q.lineTo(n,r);q.lineTo(Q,S);q.closePath();if((g instanceof THREE.MeshLambertMaterial||g instanceof THREE.MeshPhongMaterial)&&null===g.map){xa.copy(g.color);O.copy(g.emissive);g.vertexColors===
THREE.FaceColors&&xa.multiply(A.color);x.copy(Ba);V.copy(F.positionWorld).add(s.positionWorld).add(d.positionWorld).divideScalar(3);F=V;s=A.normalModel;d=x;A=0;for(h=oa.length;A<h;A++)B=oa[A],ya.copy(B.color),B instanceof THREE.DirectionalLight?(n=ta.setFromMatrixPosition(B.matrixWorld).normalize(),r=s.dot(n),0>=r||(r*=B.intensity,d.add(ya.multiplyScalar(r)))):B instanceof THREE.PointLight&&(n=ta.setFromMatrixPosition(B.matrixWorld),r=s.dot(ta.subVectors(n,F).normalize()),0>=r||(r*=0==B.distance?
1:1-Math.min(F.distanceTo(n)/B.distance,1),0!=r&&(r*=B.intensity,d.add(ya.multiplyScalar(r)))));x.multiply(xa).add(O);!0===g.wireframe?k(x,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):p(x)}else g instanceof THREE.MeshBasicMaterial||g instanceof THREE.MeshLambertMaterial||g instanceof THREE.MeshPhongMaterial?null!==g.map?g.map.mapping===THREE.UVMapping&&(Z=A.uvs,v(za,Aa,D,m,J,N,Z[0].x,Z[0].y,Z[1].x,Z[1].y,Z[2].x,Z[2].y,g.map)):null!==g.envMap?g.envMap.mapping===THREE.SphericalReflectionMapping&&
(c.copy(A.vertexNormalsModel[0]).applyMatrix3(L),Ca=.5*c.x+.5,Da=.5*c.y+.5,c.copy(A.vertexNormalsModel[1]).applyMatrix3(L),Ea=.5*c.x+.5,X=.5*c.y+.5,c.copy(A.vertexNormalsModel[2]).applyMatrix3(L),fa=.5*c.x+.5,P=.5*c.y+.5,v(za,Aa,D,m,J,N,Ca,Da,Ea,X,fa,P,g.envMap)):(x.copy(g.color),g.vertexColors===THREE.FaceColors&&x.multiply(A.color),!0===g.wireframe?k(x,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):p(x)):(g instanceof THREE.MeshDepthMaterial?x.r=x.g=x.b=1-da(F.positionScreen.z*F.positionScreen.w,
ca.near,ca.far):g instanceof THREE.MeshNormalMaterial?(c.copy(A.normalModel).applyMatrix3(L),x.setRGB(c.x,c.y,c.z).multiplyScalar(.5).addScalar(.5)):x.setRGB(1,1,1),!0===g.wireframe?k(x,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):p(x))}}w.union(ga)}}q.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function b(){if(M===Y){var a=new THREE.RenderableVertex;W.push(a);Y++;M++;return a}return W[M++]}function k(){if(da===ia){var a=new THREE.RenderableFace;aa.push(a);ia++;da++;return a}return aa[da++]}function p(){if(oa===S){var a=new THREE.RenderableLine;ra.push(a);S++;oa++;return a}return ra[oa++]}function t(){if(ka===C){var a=new THREE.RenderableSprite;I.push(a);C++;ka++;return a}return I[ka++]}function e(a,d){return a.z!==d.z?d.z-a.z:a.id!==d.id?a.id-d.id:0}function v(a,
d){var f=0,h=1,b=a.z+a.w,e=d.z+d.w,k=-a.z+a.w,p=-d.z+d.w;if(0<=b&&0<=e&&0<=k&&0<=p)return!0;if(0>b&&0>e||0>k&&0>p)return!1;0>b?f=Math.max(f,b/(b-e)):0>e&&(h=Math.min(h,b/(b-e)));0>k?f=Math.max(f,k/(k-p)):0>p&&(h=Math.min(h,k/(k-p)));if(h<f)return!1;a.lerp(d,f);d.lerp(a,1-h);return!0}var u,a,ea=[],R=0,E,M,W=[],Y=0,G,da,aa=[],ia=0,ba,oa,ra=[],S=0,U,ka,I=[],C=0,H={objects:[],lights:[],elements:[]},ja=new THREE.Vector3,la=new THREE.Vector3,sa=new THREE.Vector3,n=new THREE.Vector3,q=new THREE.Vector4,
f=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),s=new THREE.Box3,d=Array(3),ua=new THREE.Matrix4,na=new THREE.Matrix4,B,va=new THREE.Matrix4,Q=new THREE.Matrix3,h=new THREE.Frustum,r=new THREE.Vector4,ca=new THREE.Vector4;this.projectVector=function(a,d){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(d)};this.unprojectVector=function(a,d){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(d)};this.pickingRay=
function(a,d){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var y=new function(){var a=[],h=[],e=null,n=null,q=new THREE.Matrix3,m=function(a){var d=a.positionWorld,f=a.positionScreen;d.copy(a.position).applyMatrix4(B);f.copy(d).applyMatrix4(na);d=1/f.w;f.x*=d;f.y*=d;f.z*=d;a.visible=-1<=f.x&&1>=f.x&&-1<=f.y&&1>=f.y&&-1<=f.z&&1>=f.z},t=function(a,h,e){if(!0===a.visible||!0===h.visible||!0===e.visible)return!0;d[0]=a.positionScreen;d[1]=h.positionScreen;d[2]=e.positionScreen;
return f.isIntersectionBox(s.setFromPoints(d))},r=function(a,d,f){return 0>(f.positionScreen.x-a.positionScreen.x)*(d.positionScreen.y-a.positionScreen.y)-(f.positionScreen.y-a.positionScreen.y)*(d.positionScreen.x-a.positionScreen.x)};return{setObject:function(d){e=d;n=e.material;q.getNormalMatrix(e.matrixWorld);a.length=0;h.length=0},projectVertex:m,checkTriangleVisibility:t,checkBackfaceCulling:r,pushVertex:function(a,d,f){E=b();E.position.set(a,d,f);m(E)},pushNormal:function(d,f,h){a.push(d,f,
h)},pushUv:function(a,d){h.push(a,d)},pushLine:function(a,d){var f=W[a],h=W[d];ba=p();ba.id=e.id;ba.v1.copy(f);ba.v2.copy(h);ba.z=(f.positionScreen.z+h.positionScreen.z)/2;ba.material=e.material;H.elements.push(ba)},pushTriangle:function(d,f,b){var p=W[d],s=W[f],m=W[b];if(!1!==t(p,s,m)&&(n.side===THREE.DoubleSide||!0===r(p,s,m))){G=k();G.id=e.id;G.v1.copy(p);G.v2.copy(s);G.v3.copy(m);G.z=(p.positionScreen.z+s.positionScreen.z+m.positionScreen.z)/3;for(p=0;3>p;p++)s=3*arguments[p],m=G.vertexNormalsModel[p],
m.set(a[s],a[s+1],a[s+2]),m.applyMatrix3(q).normalize(),s=2*arguments[p],G.uvs[p].set(h[s],h[s+1]);G.vertexNormalsLength=3;G.material=e.material;H.elements.push(G)}}}};this.projectScene=function(d,f,s,C){ka=oa=da=0;H.elements.length=0;!0===d.autoUpdate&&d.updateMatrixWorld();void 0===f.parent&&f.updateMatrixWorld();ua.copy(f.matrixWorldInverse.getInverse(f.matrixWorld));na.multiplyMatrices(f.projectionMatrix,ua);h.setFromMatrix(na);a=0;H.objects.length=0;H.lights.length=0;d.traverseVisible(function(d){if(d instanceof
THREE.Light)H.lights.push(d);else if((d instanceof THREE.Mesh||d instanceof THREE.Line||d instanceof THREE.Sprite)&&!1!==d.material.visible&&(!1===d.frustumCulled||!0===h.intersectsObject(d))){if(a===R){var c=new THREE.RenderableObject;ea.push(c);R++;a++;u=c}else u=ea[a++];u.id=d.id;u.object=d;n.setFromMatrixPosition(d.matrixWorld);n.applyProjection(na);u.z=n.z;H.objects.push(u)}});!0===s&&H.objects.sort(e);d=0;for(s=H.objects.length;d<s;d++){var D=H.objects[d].object,m=D.geometry;y.setObject(D);
B=D.matrixWorld;M=0;if(D instanceof THREE.Mesh)if(m instanceof THREE.BufferGeometry){var J=m.attributes,D=m.offsets;if(void 0!==J.position){for(var N=J.position.array,m=0,x=N.length;m<x;m+=3)y.pushVertex(N[m],N[m+1],N[m+2]);if(void 0!==J.normal)for(var E=J.normal.array,m=0,x=E.length;m<x;m+=3)y.pushNormal(E[m],E[m+1],E[m+2]);if(void 0!==J.uv)for(E=J.uv.array,m=0,x=E.length;m<x;m+=2)y.pushUv(E[m],E[m+1]);if(void 0!==J.index)if(J=J.index.array,0<D.length)for(d=0;d<D.length;d++)for(x=D[d],N=x.index,
m=x.start,x=x.start+x.count;m<x;m+=3)y.pushTriangle(J[m]+N,J[m+1]+N,J[m+2]+N);else for(m=0,x=J.length;m<x;m+=3)y.pushTriangle(J[m],J[m+1],J[m+2]);else for(m=0,x=N.length/3;m<x;m+=3)y.pushTriangle(m,m+1,m+2)}}else{if(m instanceof THREE.Geometry){var O=m.vertices,x=m.faces,J=m.faceVertexUvs[0];Q.getNormalMatrix(B);for(var N=D.material instanceof THREE.MeshFaceMaterial,E=!0===N?D.material:null,I=0,T=O.length;I<T;I++){var Z=O[I];y.pushVertex(Z.x,Z.y,Z.z)}O=0;for(I=x.length;O<I;O++){var T=x[O],Y=!0===
N?E.materials[T.materialIndex]:D.material;if(void 0!==Y){var S=Y.side,Z=W[T.a],aa=W[T.b],X=W[T.c];if(!0===Y.morphTargets){var fa=m.morphTargets,P=D.morphTargetInfluences,pa=Z.position,w=aa.position,ga=X.position;ja.set(0,0,0);la.set(0,0,0);sa.set(0,0,0);for(var ia=0,ra=fa.length;ia<ra;ia++){var qa=P[ia];if(0!==qa){var ta=fa[ia].vertices;ja.x+=(ta[T.a].x-pa.x)*qa;ja.y+=(ta[T.a].y-pa.y)*qa;ja.z+=(ta[T.a].z-pa.z)*qa;la.x+=(ta[T.b].x-w.x)*qa;la.y+=(ta[T.b].y-w.y)*qa;la.z+=(ta[T.b].z-w.z)*qa;sa.x+=(ta[T.c].x-
ga.x)*qa;sa.y+=(ta[T.c].y-ga.y)*qa;sa.z+=(ta[T.c].z-ga.z)*qa}}Z.position.add(ja);aa.position.add(la);X.position.add(sa);y.projectVertex(Z);y.projectVertex(aa);y.projectVertex(X)}if(!1!==y.checkTriangleVisibility(Z,aa,X)){fa=y.checkBackfaceCulling(Z,aa,X);if(S!==THREE.DoubleSide){if(S===THREE.FrontSide&&!1===fa)continue;if(S===THREE.BackSide&&!0===fa)continue}G=k();G.id=D.id;G.v1.copy(Z);G.v2.copy(aa);G.v3.copy(X);G.normalModel.copy(T.normal);!1!==fa||S!==THREE.BackSide&&S!==THREE.DoubleSide||G.normalModel.negate();
G.normalModel.applyMatrix3(Q).normalize();P=T.vertexNormals;pa=0;for(w=Math.min(P.length,3);pa<w;pa++)ga=G.vertexNormalsModel[pa],ga.copy(P[pa]),!1!==fa||S!==THREE.BackSide&&S!==THREE.DoubleSide||ga.negate(),ga.applyMatrix3(Q).normalize();G.vertexNormalsLength=P.length;S=J[O];if(void 0!==S)for(fa=0;3>fa;fa++)G.uvs[fa].copy(S[fa]);G.color=T.color;G.material=Y;G.z=(Z.positionScreen.z+aa.positionScreen.z+X.positionScreen.z)/3;H.elements.push(G)}}}}}else if(D instanceof THREE.Line)if(m instanceof THREE.BufferGeometry){if(J=
m.attributes,void 0!==J.position){N=J.position.array;m=0;for(x=N.length;m<x;m+=3)y.pushVertex(N[m],N[m+1],N[m+2]);if(void 0!==J.index)for(J=J.index.array,m=0,x=J.length;m<x;m+=2)y.pushLine(J[m],J[m+1]);else for(J=D.mode===THREE.LinePieces?2:1,m=0,x=N.length/3-1;m<x;m+=J)y.pushLine(m,m+1)}}else{if(m instanceof THREE.Geometry&&(va.multiplyMatrices(na,B),O=D.geometry.vertices,0!==O.length))for(Z=b(),Z.positionScreen.copy(O[0]).applyMatrix4(va),J=D.mode===THREE.LinePieces?2:1,I=1,T=O.length;I<T;I++)Z=
b(),Z.positionScreen.copy(O[I]).applyMatrix4(va),0<(I+1)%J||(aa=W[M-2],r.copy(Z.positionScreen),ca.copy(aa.positionScreen),!0===v(r,ca)&&(r.multiplyScalar(1/r.w),ca.multiplyScalar(1/ca.w),ba=p(),ba.id=D.id,ba.v1.positionScreen.copy(r),ba.v2.positionScreen.copy(ca),ba.z=Math.max(r.z,ca.z),ba.material=D.material,D.material.vertexColors===THREE.VertexColors&&(ba.vertexColors[0].copy(D.geometry.colors[I]),ba.vertexColors[1].copy(D.geometry.colors[I-1])),H.elements.push(ba)))}else D instanceof THREE.Sprite&&
(q.set(B.elements[12],B.elements[13],B.elements[14],1),q.applyMatrix4(na),m=1/q.w,q.z*=m,-1<=q.z&&1>=q.z&&(U=t(),U.id=D.id,U.x=q.x*m,U.y=q.y*m,U.z=q.z,U.object=D,U.rotation=D.rotation,U.scale.x=D.scale.x*Math.abs(U.x-(q.x+f.projectionMatrix.elements[0])/(q.w+f.projectionMatrix.elements[12])),U.scale.y=D.scale.y*Math.abs(U.y-(q.y+f.projectionMatrix.elements[5])/(q.w+f.projectionMatrix.elements[13])),U.material=D.material,H.elements.push(U)))}!0===C&&H.elements.sort(e);return H}};
THREE.OrbitControls=function(b,k,p){function t(f){if(!1!==a.enabled){f.preventDefault();var e=a.domElement===document?a.domElement.body:a.domElement;if(H===C.ROTATE){if(!0===a.noRotate)return;R.set(f.clientX,f.clientY);E.subVectors(R,ea);a.rotateLeft(2*Math.PI*E.x/e.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*E.y/e.clientHeight*a.rotateSpeed);ea.copy(R)}else if(H===C.DOLLY){if(!0===a.noZoom)return;ia.set(f.clientX,f.clientY);ba.subVectors(ia,aa);0<ba.y?a.dollyIn():a.dollyOut();aa.copy(ia)}else if(H===
C.PAN){if(!0===a.noPan)return;W.set(f.clientX,f.clientY);Y.subVectors(W,M);a.pan(Y.x*a.panSpeed,-Y.y*a.panSpeed);M.copy(W)}a.update()}}function e(){!1!==a.enabled&&(document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",e,!1),a.dispatchEvent(q),H=C.NONE)}function v(f){if(!1!==a.enabled&&!0!==a.noPan){f.preventDefault();f.stopPropagation();var e=0;void 0!==f.wheelDelta?e=f.wheelDelta:void 0!==f.detail&&(e=-f.detail);a.panXZ(0,e*a.panSpeed);a.update();a.dispatchEvent(n);
a.dispatchEvent(q)}}function u(f){if(!1!==a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(f.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();
a.update();break;case a.keys.DOLLY_OUT:if(!0===a.noZoom)break;a.dollyOut();a.update()}}this.settings=p;this.object=b;this.domElement=void 0!==k?k:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.panSpeed=.3;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=
Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,ea=new THREE.Vector2,R=new THREE.Vector2,E=new THREE.Vector2,M=new THREE.Vector2,W=new THREE.Vector2,Y=new THREE.Vector2,G=new THREE.Vector3,da=new THREE.Vector3,aa=new THREE.Vector2,ia=new THREE.Vector2,ba=new THREE.Vector2,oa=0,ra=0,S=1,U=new THREE.Vector3,ka=new THREE.Vector3,I=new THREE.Quaternion,C={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,
TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},H=C.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var ja=(new THREE.Quaternion).setFromUnitVectors(b.up,new THREE.Vector3(0,1,0)),la=ja.clone().inverse(),sa={type:"change"},n={type:"start"},q={type:"end"};this.rotateLeft=function(f){void 0===f&&(f=2*Math.PI/60/60*a.autoRotateSpeed);ra-=f};this.rotateUp=function(f){void 0===f&&(f=2*Math.PI/60/60*a.autoRotateSpeed);oa-=f};this.panLeft=function(a){var e=this.object.matrix.elements;
G.set(e[0],e[1],e[2]);G.multiplyScalar(-a);U.add(G)};this.panUp=function(a){var e=this.object.matrix.elements;G.set(e[4],e[5],e[6]);G.multiplyScalar(a);U.add(G)};this.panForward=function(a){var e=this.object.matrix.elements;G.set(e[8],e[9],e[10]);G.multiplyScalar(a);U.add(G)};this.pan=function(f,e){var d=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var b=a.object.position.clone().sub(a.target).length(),b=b*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*f*b/d.clientHeight);
a.panUp(2*e*b/d.clientHeight)}else void 0!==a.object.top?(a.panLeft(f*(a.object.right-a.object.left)/d.clientWidth),a.panUp(e*(a.object.top-a.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(f,e){var d=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var b=a.object.position.clone().sub(a.target).length(),b=b*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*f*b/d.clientHeight);
a.panForward(2*e*b/d.clientHeight)}else void 0!==a.object.top?(a.panLeft(f*(a.object.right-a.object.left)/d.clientWidth),a.panForward(e*(a.object.top-a.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(f){void 0===f&&(f=Math.pow(.95,a.zoomSpeed));S/=f};this.dollyOut=function(f){void 0===f&&(f=Math.pow(.95,a.zoomSpeed));S*=f};this.update=function(){var f=this.object.position,e=this.settings&&this.settings.cameraAsOrbitCenter?
f:this.target,d=this.settings&&this.settings.cameraAsOrbitCenter?this.target:f;da.copy(f).sub(this.target);da.applyQuaternion(ja);var f=Math.atan2(da.x,da.z),b=Math.atan2(Math.sqrt(da.x*da.x+da.z*da.z),da.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*a.autoRotateSpeed);var f=f+ra,b=b+oa,f=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,f)),b=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,b)),b=Math.max(1E-6,Math.min(Math.PI-1E-6,b)),p=this.settings&&this.settings.cameraAsOrbitCenter?
5E3*S*this.settings.boxScale:da.length()*S,p=Math.max(this.minDistance,Math.min(this.maxDistance,p));e.add(U);da.x=p*Math.sin(b)*Math.sin(f);da.y=p*Math.cos(b);da.z=p*Math.sin(b)*Math.cos(f);da.applyQuaternion(la);this.settings&&this.settings.cameraAsOrbitCenter?d.copy(e).sub(da):d.copy(e).add(da);this.object.lookAt(this.target);oa=ra=0;S=1;U.set(0,0,0);if(1E-6<ka.distanceToSquared(e)||1E-6<8*(1-I.dot(this.object.quaternion)))this.dispatchEvent(sa),ka.copy(e),I.copy(this.object.quaternion)};this.reset=
function(){H=C.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(f){if(!1!==a.enabled){f.preventDefault();if(f.button===a.mouseButtons.ORBIT){if(!0===a.noRotate)return;H=C.ROTATE;ea.set(f.clientX,f.clientY)}else if(f.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;H=C.DOLLY;aa.set(f.clientX,f.clientY)}else if(f.button===
a.mouseButtons.PAN){if(!0===a.noPan)return;H=C.PAN;M.set(f.clientX,f.clientY)}document.addEventListener("mousemove",t,!1);document.addEventListener("mouseup",e,!1);a.dispatchEvent(n)}},!1);this.domElement.addEventListener("mousewheel",v,!1);this.domElement.addEventListener("DOMMouseScroll",v,!1);this.domElement.addEventListener("touchstart",function(f){if(!1!==a.enabled){switch(f.touches.length){case 1:if(!0===a.noRotate)return;H=C.TOUCH_ROTATE;ea.set(f.touches[0].pageX,f.touches[0].pageY);break;
case 2:if(!0===a.noPan)return;H=C.TOUCH_DOLLY;var e=f.touches[0].pageX-f.touches[1].pageX;f=f.touches[0].pageY-f.touches[1].pageY;e=Math.sqrt(e*e+f*f);aa.set(0,e);break;case 3:if(!0===a.noPan)return;H=C.TOUCH_PAN;M.set(f.touches[0].pageX,f.touches[0].pageY);break;default:H=C.NONE}a.dispatchEvent(n)}},!1);this.domElement.addEventListener("touchend",function(){!1!==a.enabled&&(a.dispatchEvent(q),H=C.NONE)},!1);this.domElement.addEventListener("touchmove",function(e){if(!1!==a.enabled){e.preventDefault();
e.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(e.touches.length){case 1:if(!0===a.noRotate)break;if(H!==C.TOUCH_ROTATE)break;R.set(e.touches[0].pageX,e.touches[0].pageY);E.subVectors(R,ea);a.rotateLeft(2*Math.PI*E.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*E.y/b.clientHeight*a.rotateSpeed);ea.copy(R);a.update();break;case 2:if(!0===a.noPan)break;if(H!==C.TOUCH_DOLLY)break;b=e.touches[0].pageX-e.touches[1].pageX;e=e.touches[0].pageY-e.touches[1].pageY;
e=Math.sqrt(b*b+e*e);ia.set(0,e);ba.subVectors(ia,aa);a.panXZ(0,-ba.y*a.panSpeed);aa.copy(ia);a.update();break;case 3:if(!0===a.noPan)break;if(H!==C.TOUCH_PAN)break;W.set(e.touches[0].pageX,e.touches[0].pageY);Y.subVectors(W,M);a.pan(Y.x*a.panSpeed,-Y.y*a.panSpeed);M.copy(W);a.update();break;default:H=C.NONE}}},!1);window.addEventListener("keydown",u,!1);this.update();this.removeKeyEventListener=function(){window.removeEventListener("keydown",u,!1)};this.addKeyEventListener=function(){window.addEventListener("keydown",
u,!1)}};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var b=document.createElement("canvas");return!(!window.WebGLRenderingContext||!b.getContext("webgl")&&!b.getContext("experimental-webgl"))}catch(k){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var b=document.createElement("div");b.id="webgl-error-message";b.style.fontFamily="monospace";b.style.fontSize="13px";b.style.fontWeight="normal";
b.style.textAlign="center";b.style.background="#fff";b.style.color="#000";b.style.padding="1.5em";b.style.width="400px";b.style.margin="5em auto 0";this.webgl||(b.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return b},addGetWebGLMessage:function(b){var k,p;b=b||{};k=void 0!==b.parent?b.parent:document.body;b=void 0!==b.id?b.id:"oldie";p=Detector.getWebGLErrorMessage();p.id=b;k.appendChild(p)}};"object"===typeof module&&(module.exports=Detector);
(function(b,k,p,t){var e=function(e){this.domParent="object"===typeof e?e:k.body};e.prototype.init=function(e,u,a,ea,R,E){b.requestAnimationFrame||(b.requestAnimationFrame=function(){return b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a,e){b.setTimeout(a,1E3/60)}}());this.domParent===k.body&&(this.WINDOW_WIDTH=b.innerWidth,this.WINDOW_HEIGHT=b.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,b.addEventListener("resize",e,!1));this.renderType=t.webgl?"webgl":"canvas";this.renderer=a||(t.webgl?new p.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new p.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=ea||new p.Scene;this.camera=R||new p.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
E?this.controls=E:(this.controls=new p.OrbitControls(this.camera,this.renderer.domElement,{cameraAsOrbitCenter:!0}),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.keyPanSpeed=10,this.controls.panSpeed=1,this.controls.noZoom=!0,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:81,BOTTOM:69},this.controls.mouseButtons={ORBIT:p.MOUSE.MIDDLE,PAN:p.MOUSE.RIGHT});this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top=
"0px";this.stats.domElement.style.zIndex="999";this.stats.domElement.style.display="none";k.body.appendChild(this.stats.domElement);this.stats.end();u()};b.Base=e;"object"===typeof module&&(module.exports=e)})(window,document,THREE,Detector);
(function(){function b(b){return b.charAt(0).toUpperCase()+b.slice(1)}var k={Animation:{bubble:function(b,k){var e=$('<div class="alert alert-info alert-vp fade"></div>').appendTo(b);e.text(k);e.finish().fadeTo(400,1).delay(3E3).fadeTo(200,0,function(){$(this).remove()})}}};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(b){var k=0;for(b=b.length;k<b;k++);};k.map={};k.Sidebar=function(b,t){_Container.call(this);var e=this.setting=
k.Utils.settingMixin({align:"r",width:320},b),v="sidebar",v=e.align&&"r"!==e.align?v+" sidebar-left":v+" sidebar-right";this.domElement.className=v;e.id&&(this.domElement.id=e.id,k.map[e.id]=this);this.domElement.style.width=e.width.toString()+"px";e.overflow&&(this.domElement.style.overflow=e.overflow.toString());t.appendChild(this.domElement);k.Utils.domCreationDirector(e.children,this.domElement)};k.Sidebar.prototype=Object.create(_Container.prototype);k.Panel=function(b,t){_Container.call(this);
var e=this.setting=k.Utils.settingMixin({title:""},b);e.id&&(this.domElement.id=e.id,k.map[e.id]=this);var v=this.domElement;v.className="panel panel-tool";t.appendChild(v);var u=document.createElement("div");u.className="panel-heading";v.appendChild(u);var a=document.createTextNode(e.title);u.appendChild(a);u=document.createElement("div");u.className="panel-body";e.overflow&&(u.style.overflow=e.overflow.toString());v.appendChild(u);k.Utils.domCreationDirector(e.children,u)};k.Panel.prototype=Object.create(_Container.prototype);
k.Toolbar=function(b,t){_Container.call(this);var e=this.setting=k.Utils.settingMixin({title:""},b);e.id&&(this.domElement.id=e.id,k.map[e.id]=this);var v=this.domElement;v.className="btn-toolbar";t.appendChild(v);k.Utils.domCreationDirector(e.children,v)};k.Toolbar.prototype=Object.create(_Container.prototype);k.ButtonGroup=function(b,t){_Container.call(this);var e=this.setting=k.Utils.settingMixin({title:"",buttonType:"radio"},b);e.id&&(this.domElement.id=e.id,k.map[e.id]=this);var v=this.domElement;
v.className="btn-group"+(e.appendClass?" "+e.appendClass:"");"button"!==e.buttonType.toLowerCase()&&v.setAttribute("data-toggle","buttons");v.title=e.title;t.appendChild(v);var u=e.buttons;switch(e.buttonType.toLowerCase()){default:case "radio":for(var a=0,ea=u.length;a<ea;a++){var R=document.createElement("label");R.className="btn btn-tool"+(u[a].checked?" active":"");u[a].height&&(R.style.height=u[a].height+"px");u[a].width&&(R.style.width=u[a].width+"px");if(u[a].bgType&&u[a].bgTypeData){var E;
switch(u[a].bgType){case "color":E=u[a].bgTypeData;R.className+=" btn-color";break;case "image":E="url("+u[a].bgTypeData+") no-repeat 50% 50%";R.className+=" btn-image";break;default:return}R.style.background=E}v.appendChild(R);var M=document.createElement("input");u[a].checked&&M.setAttribute("checked","");M.type=e.buttonType;M.name=e.name;M.id=u[a].id;M.value=a;M.autocomplete="off";R.appendChild(M);E=document.createTextNode(u[a].title);R.appendChild(E)}break;case "button":for(a=0,ea=u.length;a<
ea;a++){M=document.createElement("button");M.className="btn btn-tool";M.id=u[a].id;M.name=e.name;u[a].height&&(M.style.height=u[a].height+"px");u[a].width&&(M.style.width=u[a].width+"px");if(u[a].bgType&&u[a].bgTypeData){switch(u[a].bgType){case "color":E=u[a].bgTypeData;R.className+=" btn-color";break;case "image":E="url("+u[a].bgTypeData+") no-repeat 50% 50%";R.className+=" btn-image";break;default:return}M.style.background=E}v.appendChild(M);E=document.createTextNode(u[a].title);M.appendChild(E)}}k.Utils.domCreationDirector(e.children,
this.domElement)};k.ButtonGroup.prototype=Object.create(_Container.prototype);k.ButtonGroup.prototype.addButton=function(b,k){k||this.setting.buttons.push(b);var e=document.createElement("label");e.className="btn btn-tool"+(b.checked?" active":"");b.height&&(e.style.height=b.height+"px");b.width&&(e.style.width=b.width+"px");if(b.bgType&&b.bgTypeData){var v;switch(b.bgType){case "color":v=b.bgTypeData;e.className+=" btn-color";break;case "image":v="url("+b.bgTypeData+") no-repeat 50% 50%";e.className+=
" btn-image";break;default:return}e.style.background=v}this.domElement.appendChild(e);v=document.createElement("input");b.checked&&v.setAttribute("checked","");v.type=this.setting.buttonType;v.name=this.setting.name;v.id=b.id;v.value=this.setting.buttons.length-1;v.autocomplete="off";e.appendChild(v);v=document.createTextNode(b.title);e.appendChild(v);return e};k.ButtonGroup.prototype.addButtons=function(b,k){for(var e=0,v=b.length;e<v;e++)this.addButton(b[e],k)};k.Utils={};k.Utils.settingMixin=function(b,
k){if("object"===typeof b&&"object"===typeof k){var e={},v;for(v in b)e[v]=b[v];for(var u in k)void 0!==k[u]&&(e[u]=k[u]);return e}return b};k.Utils.domCreationDirector=function(p,t){if(p)if(p instanceof Array)for(var e=0,v=p.length;e<v;e++)k.Utils.domCreationDirector(p[e],t?t:document.body);else p instanceof Object&&p.UIType&&k[b(p.UIType)]&&new (k[b(p.UIType)])(p,t?t:document.body)};window.GoUI=k;"object"===typeof module&&(module.exports=k)})();
var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
AV.initialize("i5m1bad33f8bm725g0lan5wd8hhc1c4qhyz3cyq4b0qoyvja","2w44ugxt0z512vitlk5in4c4a95acbyj8qiqlgcuh3p9xm5t");
(function(b,k,p,t,e){var v,u;function a(){return AV.User.current()&&d&&d.get("user")&&AV.User.current().id!==d.get("user").id}function ea(l){var a=O.textures+(l?-1:1),a=k.getElementById("texture"+a);if(!a&&(a=l?N.length-1:0,a=k.getElementById("texture"+a),!a))return;l=a.parentElement.className.indexOf("btn-color");var g=a.parentElement.className.indexOf("btn-image");-1<l?(v=Number(a.value),k.getElementById("colorTexture").parentElement.click()):-1<g&&(u=Number(a.value),k.getElementById("imageTexture").parentElement.click())}
function R(l,a){var g=a.clone(),c;for(c in l)g[c]=l[c];return g}function E(l){if(null==l.pageX&&null!=l.clientX){var a=k.documentElement,g=k.body;l.pageX=l.clientX+(a&&a.scrollLeft||g&&g.scrollLeft||0)-(a&&a.clientLeft||g&&g.clientLeft||0);l.pageY=l.clientY+(a&&a.scrollTop||g&&g.scrollTop||0)-(a&&a.clientTop||g&&g.clientTop||0)}Ba.set(l.pageX/h.WINDOW_WIDTH*2-1,2*-(l.pageY/h.WINDOW_HEIGHT)+1);qa.setFromCamera(Ba,h.camera);return qa.intersectObjects(fa)}function M(l,a){a&&l&&(l.position.copy(a.point).add(a.face.normal),
l.position.divideScalar(r.width).floor().multiplyScalar(r.width).addScalar(r.width/2))}function W(l){0<l.length&&M(X,l[0])}function Y(l,a,g,c,b){var d=g||"openModal",e=c||["myBox","myKeep"];l&&l.then(function(l){$("#"+d+" .modal-body #"+e[0]).html("");for(var a=0,g=l.length;a<g;a++)$("#"+d+" .modal-body #"+e[0]).append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="myBoxData'+a+'" value="'+l[a].id+'" autocomplete="off">  <label id="myBoxDataLabel'+a+'"></label></label>'),
$("#"+d+" .modal-body #myBoxDataLabel"+a).text(l[a].get("name"));1>l.length?$("#openModal .modal-body #boxTitle").hide():$("#openModal .modal-body #boxTitle").show()});a&&a.then(function(l){$("#"+d+" .modal-body #"+e[1]).html("");for(var a=0,g=l.length;a<g;a++)$("#"+d+" .modal-body #"+e[1]).append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="keepBoxData'+a+'" value="'+(b?l[a].id:l[a].get("box")?l[a].get("box").id:"-1")+'" autocomplete="off">  <label id="keepBoxDataLabel'+
a+'"></label></label>'),$("#"+d+" .modal-body #keepBoxDataLabel"+a).text(l[a].get("name")+(l[a].get("box")?"("+l[a].get("box").get("user").get("username")+"/"+l[a].get("box").get("name")+")":""));1>l.length?$("#openModal .modal-body #keepTitle").hide():$("#openModal .modal-body #keepTitle").show()});$("#"+d+"").modal("show")}function G(l,a,g,c,d){l=l||E(event);if(0<l.length){l=l[0];d=O.toolsType;var b=!1,e=fa.length;if(e&&l.object!==ma)for(var f=e-1;0<f&&f>e-1-3;f--)if(l.object===fa[f]){b=!0;break}if(0===
d)if(z.isInsertingFlag){if(c)return;(a=z.deleteMesh())&&0<a.length&&L.addAction("erase",a);a=z.insert();L.addAction("draw",a);z.insertTimes++}else{if(!0===b&&!1===a||!1===b&&!0===a)return;g=z.draw(Da,ya,void 0,l);c?L.appendObjectToCurrentAction("draw",g):L.addAction("draw",g);h.renderer.render(h.scene,h.camera);return}1===d&&g&&(z.isInsertingFlag?c||(a=z.deleteMesh(),L.addAction("erase",a),z.insertTimes++):l.object!==ma&&(g=z.erase(l.object),c?L.appendObjectToCurrentAction("erase",g):L.addAction("erase",
g)))}}function da(){a()||(c.save(c.storageKeys.localChanges,L.changed),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save())}function aa(l){0!==Aa||a()||("0"===L.changed||1>P.length&&(!d||d&&!d.id)||!AV.User.current||c.save(c.storageKeys.localChanges,L.changed),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save())}function ia(l){Aa=1;a()||("0"===L.changed||1>P.length&&(!d||d&&!d.id)?(c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save()):confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")?
O.save():(c.save(c.storageKeys.localChanges,L.changed),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save()))}function ba(l){l.preventDefault();var a;if(1===wa[0])try{1===Fa?Fa=0:(Fa=1,a=E(l),G(a,l.ctrlKey,l.ctrlKey,!0))}catch(g){console.warn("draw/erase failed")}finally{Fa=0}else a=O.toolsType,1===a?X.visible&&(X.visible=!1):!X.visible&&xa&&(X.visible=!0),a=E(l),W(a),z.isInsertingFlag&&z.updateInsertHelper(z.insertMeshes,a)}function oa(a){a.preventDefault();switch(a.button){case 0:if(!V.endFlag){V.instantComplete(V.loadBoxAnimation);
break}wa[0]=1;var K=E(a);G(K,void 0,!0,!1,a.ctrlKey);W(K);z.isInsertingFlag&&z.updateInsertHelper(z.insertMeshes,K);break;case 1:wa[1]=1;break;case 2:wa[2]=1}}function ra(a){if("label"===this.nodeName.toLowerCase())switch(a=this.getElementsByTagName("input")[0],O[a.name]=Number(a.value),a.name){case "toolsType":1===Number(a.value)?X.visible&&(X.visible=!1):!X.visible&&xa&&(X.visible=!0);break;case "textures":ya=O[a.name];T=N[ya];Z=T.data;Ca=T.helperData=N[O[a.name]].helperData||R(J,Z);X.material=
Ca;k.getElementById("cube").parentElement.click();switch(O.texturesType){case 0:u=a.value;break;default:case 1:v=a.value}break;case "sidebarResize":var K=GoUI.map.sidebar.domElement;"0"===a.value?$(K).animate({top:"0",height:"100%"}):$(K).animate({top:"60%",height:"40%"});break;case "texturesType":a=a.id,"imageTexture"===a?($(".btn-color").hide(),$(".btn-image").show(),k.getElementById("texture"+u).parentElement.click()):"colorTexture"===a&&($(".btn-color").show(),$(".btn-image").hide(),k.getElementById("texture"+
v).parentElement.click())}else if(("button"===this.type||"button"===this.nodeName.toLowerCase())&&O[this.id])O[this.id]()}function S(a){switch(a.button){case 0:wa[0]=0;L.isCurrentActionAlive=!1;break;case 1:wa[1]=0;break;case 2:wa[2]=0}}function U(a){switch(a.keyCode){case 67:z.isInsertingFlag?z.rotateMeshes(-Math.PI/2):ea();break;case 88:z.isInsertingFlag?z.rotateMeshes(Math.PI/2):ea(!0);break;case 70:z.isInsertingFlag&&z.reflectMeshes(!0);break;case 71:z.isInsertingFlag&&z.reflectMeshes(!1)}}function ka(a){if(!wa[0])switch(a.keyCode){case 16:z.isInsertingFlag?
(z.insertMaterialOverrideFlag=!z.insertMaterialOverrideFlag,z.insertMaterialOverrideFlag?n("\u63d2\u5165\u65b9\u5757\u7684\u6750\u8d28\u5c06\u4f7f\u7528\u5f53\u524d\u9009\u62e9\u6750\u8d28"):n("\u63d2\u5165\u65b9\u5757\u7684\u6750\u8d28\u5c06\u4f7f\u7528\u539f\u6587\u4ef6\u4e2d\u7684\u6750\u8d28")):0===O.toolsType?(k.getElementById("eraser").parentElement.click(),n("\u5df2\u5207\u6362\u81f3\u64e6\u9664")):1===O.toolsType&&(k.getElementById("cube").parentElement.click(),n("\u5df2\u5207\u6362\u81f3\u753b\u7b14"));
break;case 90:a.ctrlKey&&L.undo();break;case 89:a.ctrlKey&&L.redo();break;case 27:z.isInsertingFlag&&z.endInsert()}}function I(){requestAnimationFrame(I);h.renderer.render(h.scene,h.camera);h.stats.update()}function C(){var a=$("#openModal input[type=radio]:checked").val();"-1"===a?($("#openModal").modal("hide"),n("\u6536\u85cf\u7684\u6587\u4ef6\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u80fd\u88ab\u4f5c\u8005\u5220\u9664\u6216\u9690\u85cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5220\u9664\u529f\u80fd\u5220\u9664\u6b64\u6536\u85cf\u6216\u8054\u7cfb\u4f5c\u8005")):
(k.getElementById("openIt").removeEventListener("click",C,!1),"0"===L.changed||1>P.length&&(!d||d&&!d.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&O.save(),a&&(new AV.Query(s)).get(a,{success:function(a){z.endInsert();O.clearAll();L=new va;L.updateDom();d=a;c.loadCamera(a.get("camera"),!0);c.loadMeshes(a.get("meshes"),D,V.loadBoxAnimation,!0);a.get("user").id===AV.User.current().id&&(c.save(c.storageKeys.localChanges,"0"),c.save(c.storageKeys.boxName,d.get("name")),c.save(c.storageKeys.boxId,
d.id),c.save(c.storageKeys.updatedAt,d.updatedAt),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save())},error:function(){n("\u6253\u5f00\u5931\u8d25")}}),$("#openModal").modal("hide"))}function H(){var a;a="myBox"===$("#openModal input[type=radio]:checked").parent().parent()[0].id?"Box":"Keep";var K=$("#openModal input[type=radio]:checked").val();K&&confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&AV.Object.createWithoutData(a,K).destroy().then(function(g){"Box"==a&&d.id==K&&
(c.save(c.storageKeys.localChanges,"1"),c.save(c.storageKeys.boxName,d.get("name")),c.save(c.storageKeys.boxId,""),c.save(c.storageKeys.updatedAt,""),g=new s,g.set("meshes",s.get("meshes")),g.set("camera",s.get("camera")),d=g);n("\u5df2\u5220\u9664")},function(a){n("\u5220\u9664\u5931\u8d25")});$("#openModal").modal("hide")}function ja(){k.getElementById("openIt").removeEventListener("click",ja,!1);var a=$("#openModal input[type=radio]:checked").val();"-1"===a?($("#openModal").modal("hide"),n("\u6536\u85cf\u7684\u6587\u4ef6\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u80fd\u88ab\u4f5c\u8005\u5220\u9664\u6216\u9690\u85cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5220\u9664\u529f\u80fd\u5220\u9664\u6b64\u6536\u85cf\u6216\u8054\u7cfb\u4f5c\u8005")):
(a&&(new AV.Query(s)).get(a,{success:function(a){ua=a;z.isInsertingFlag=!0;z.insertMeshes=c.dataStringToMeshes(ua.get("meshes"));z.insertMeshes&&0<z.insertMeshes.length?(z.addInsertHelperToScene(z.insertMeshes),n("shift\u5207\u6362\u63d2\u5165\u4f7f\u7528\u7684\u6750\u8d28\uff0cESC\u6216\u518d\u6b21\u70b9\u51fb\u63d2\u5165\u7ed3\u675f\uff1bx\u3001c\u65cb\u8f6c\uff0cf\u3001g\u955c\u50cf")):(z.endInsert(),n("\u8f7d\u5165\u6587\u4ef6\u4e3a\u7a7a\uff0c\u5df2\u53d6\u6d88\u63d2\u5165"))},error:function(){n("\u8f7d\u5165\u5931\u8d25\uff0c\u65e0\u6cd5\u63d2\u5165")}}),
$("#openModal").modal("hide"))}function la(a){a?($("#loginOpener").hide(),$("#logout").show(),$("#signInOpener").hide(),$("#loginMessage").html("\u4f60\u597d "+AV.User.current().escape("username")),$("#loginMessage").show(),$("#open").removeAttr("disabled"),$("#newFile").removeAttr("disabled"),$("#share").removeAttr("disabled"),$("#delete").removeAttr("disabled"),$("#insert").removeAttr("disabled"),$("#keep").removeAttr("disabled"),$("#currentFileState").show(),$("#currentFileName").show()):($("#loginOpener").show(),
$("#logout").hide(),$("#signInOpener").show(),$("#loginMessage").hide(),$("#open").attr("disabled","disabled"),$("#newFile").attr("disabled","disabled"),$("#share").attr("disabled","disabled"),$("#delete").attr("disabled","disabled"),$("#insert").attr("disabled","disabled"),$("#keep").attr("disabled","disabled"),$("#currentFileState").hide(),$("#currentFileName").hide())}function sa(){var a=d.escape("name")||"\u672a\u547d\u540d",c=("0"===L.changed?"\u672a\u4fee\u6539":"\u4fee\u6539\u672a\u4fdd\u5b58")+
(d.id?" - \u4e91\u7aef\u5b58\u50a8":" - \u672c\u5730\u5b58\u50a8");$("#currentFileName").text("\u6587\u4ef6\u540d\uff1a"+a);$("#currentFileState").text("\u6587\u4ef6\u72b6\u6001\uff1a"+c)}function n(a){GoUI.Animation.bubble($("#bubble"),a);sa()}var q=!1,f=k.createElement("a");f.id="imageCapture";f.style.display="none";f.target="_blank";k.body.appendChild(f);var s=AV.Object.extend("Box"),d=new s,ua=void 0,na=AV.Object.extend("Keep");new na;e=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=
-1;this.currentMeshes=[];this.currentIterator=0};e.prototype={asyncLoadDefaultInterval:0,loadBoxAnimation:function(){var a=V.currentMeshes;V.currentIterator<a.length?a[V.currentIterator].meshObject.visible=!0:(V.endFlag=!0,clearInterval(V.currentAnimationIntervalHandler));V.currentIterator++},begin:function(a,c,g){this.endFlag=!1;this.currentMeshes=c;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,g||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var c=
V.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<c.length;)a();this.endFlag=!0}}};var B=function(a){this.isLoadingBoxEnd=a};B.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar",boxId:"vp_box_id",updatedAt:"vp_updatedAt",boxName:"vp_box_name",localChanges:"vp_local_changes"},load:function(a){return b.localStorage&&b.localStorage.getItem(a||this.storageKeys.meshes)},save:function(a,c){if(b.localStorage){var g=
"";if(void 0===c||null===c)switch(a){default:case this.storageKeys.meshes:case void 0:for(var g=g+(r.width+":"),d=0,e=P.length;d<e;d++)g+=P[d].geo.id.replace("geo","")+",",g+=P[d].material.id.replace("texture","")+",",g+=P[d].meshObject.position.x+",",g+=P[d].meshObject.position.y+",",g+=P[d].meshObject.position.z+";";break;case this.storageKeys.camera:g+=h.controls.target.x+","+h.controls.target.y+","+h.controls.target.z+";";g+=h.controls.object.position.x+","+h.controls.object.position.y+","+h.controls.object.position.z+
";";break;case this.storageKeys.sidebar:g+=u+","+v+","+O.texturesType+","+O.sidebarResize}else g=c;b.localStorage.setItem(a||this.storageKeys.meshes,g)}},loadMeshes:function(a,c,g,d){this.isLoadingBoxEnd=!1;var b=[],e=r.width;if(a=d?a:this.load(a))if(a=a.split(":"))2===a.length?(e=(Number(a[0])||50)/r.width,b=a[1].split(";")):(e=50/r.width,b=a[0].split(";"));if(0<b.length)switch(c){case this.LOAD_TYPE.sync:c=0;for(a=b.length;c<a;c++){var f=b[c].split(",");2<f.length&&z.draw(Number(f[0]),Number(f[1]),
[Number(f[2])/e,Number(f[3])/e,Number(f[4])/e])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:c=0;for(a=b.length;c<a;c++)f=b[c].split(","),2<f.length&&z.draw(Number(f[0]),Number(f[1]),[Number(f[2])/e,Number(f[3])/e,Number(f[4])/e],void 0,void 0,!0);V.begin(g,P);d?n("\u8f7d\u5165\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b"):n("\u8f7d\u5165\u672c\u5730\u6570\u636e\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b")}else n("\u65e0\u672c\u5730\u6570\u636e\uff0c\u65b0\u5efa\u6587\u4ef6"),
V.endFlag=!0},dataStringToMeshes:function(a){var c=[],g=[],d=r.width;a&&(a=a.split(":"))&&(2===a.length?(d=(Number(a[0])||50)/r.width,c=a[1].split(";")):(d=50/r.width,c=a[0].split(";")));if(0<c.length){a=0;for(var e=c.length;a<e;a++){var b=c[a].split(",");if(2<b.length){var f=new t.Mesh(x[Number(b[0])||0].data,N[Number(b[1])||0].data);f.position.set(Number(b[2])/d,Number(b[3])/d,Number(b[4])/d);g.push(f)}}}return g},loadRemote:function(){if(b.localStorage){var a=this.load(this.storageKeys.boxId),
e=this.load(this.storageKeys.updatedAt);if(a){n("\u8f7d\u5165\u4e91\u7aef\u6587\u4ef6...");var g=new AV.Query(s);g.select("name","user");g.equalTo("objectId",a);g.first({success:function(a){if(a.updatedAt.toString()===e)d=a,a.set("meshes",c.load(c.storageKeys.meshes)),a.set("camera",c.load(c.storageKeys.camera)),c.save(c.storageKeys.boxName,d.get("name")),L.changed=c.load(c.storageKeys.localChanges),c.loadCamera(d.get("camera"),!0),c.loadMeshes(d.get("meshes"),D,V.loadBoxAnimation,!0);else if(d=a,
a.get("user").id===AV.User.current().id){var l=L.changed=c.load(c.storageKeys.localChanges);"0"===l||"0"!==l&&confirm("\u4e0a\u6b21\u5173\u95ed\u524d\u53ef\u80fd\u672a\u5b8c\u6210\u4fdd\u5b58\uff0c\u662f\u5426\u8f7d\u5165\u4e91\u7aef\u6587\u4ef6\uff1f\u82e5\u53d6\u6d88\u5219\u5c06\u672c\u5730\u7248\u672c\u89c6\u4e3a\u65b0\u6587\u4ef6")?(l=new AV.Query(s),l.get(a.id,{success:function(a){d=a;c.loadCamera(d.get("camera"),!0);c.loadMeshes(d.get("meshes"),D,V.loadBoxAnimation,!0);c.save(c.storageKeys.boxName,
d.get("name"));c.save(c.storageKeys.updatedAt,d.updatedAt);c.save(c.storageKeys.camera);c.save()},error:function(l,g){a.set("meshes",c.load(c.storageKeys.meshes));a.set("camera",c.load(c.storageKeys.camera));c.loadMeshes(void 0,D,V.loadBoxAnimation)}})):(d=new s,c.save(c.storageKeys.boxId,""),c.save(c.storageKeys.updatedAt,""),c.save(c.storageKeys.boxName,""),c.save(c.storageKeys.localChanges,"1"),this.changed=1,c.loadMeshes(void 0,D,V.loadBoxAnimation),n("\u7531\u4e8e\u672c\u5730\u6b64\u6587\u4ef6\u4e0e\u4e91\u7aef\u6587\u4ef6\u5728\u540c\u4e00\u6587\u4ef6\u7684\u57fa\u7840\u4e0a\u505a\u4e86\u4e0d\u540c\u7684\u6539\u52a8\uff0c\u5c06\u672c\u5730\u7248\u672c\u4e0e\u4e91\u7aef\u6b64\u6587\u4ef6\u89c6\u4e3a\u4e0d\u540c\u7684\u6587\u4ef6"))}else l=
new AV.Query(s),l.get(a.id,{success:function(a){d=a;c.loadCamera(d.get("camera"),!0);c.loadMeshes(d.get("meshes"),D,V.loadBoxAnimation,!0)},error:function(a,l){c.loadMeshes(void 0,D,V.loadBoxAnimation)}})},error:function(a,l){c.loadMeshes(void 0,D,V.loadBoxAnimation);n("\u8f7d\u5165\u5931\u8d25\uff0c"+l.message)}})}else c.loadMeshes(void 0,D,V.loadBoxAnimation)}},loadShared:function(a,b){(new AV.Query(s)).get(a,{success:function(a){d=a;c.loadCamera(d.get("camera"),!0);c.loadMeshes(d.get("meshes"),
D,V.loadBoxAnimation,!0);n("\u5df2\u8f7d\u5165\u5206\u4eab\u6587\u4ef6")},error:function(a,l){b()}})},loadCamera:function(a,c){var g=[],d=c?a:this.load(a);d&&(g=d.split(";"));if(0<g.length){for(var d=0,b=g.length;d<b;d++){var e=g[d].split(",");switch(d){case 0:h.controls.target.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0);break;case 1:h.controls.object.position.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0)}}h.controls.update()}},loadSidebarSelectedButtons:function(a,c){var g=[],d=c?
a:this.load(a);d&&(g=d.split(","));if(0<g.length)for(var d=0,e=g.length;d<e;d++){var b=g[d];if(""!==b&&!isNaN(Number(b)))switch(d){case 0:u=Number(b)||0;break;case 1:v=Number(b)||0;break;case 2:1===Number(b)?k.getElementById("colorTexture").parentElement.click():k.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(b)?k.getElementById("minSidebar").parentElement.click():k.getElementById("normalSidebar").parentElement.click()}}else k.getElementById("imageTexture").parentElement.click()}};
var va=function(){this.currentActionIndex=-1;this.actionArray=[];this.isCurrentActionAlive=void 0;this.changed="0"};va.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var c=z.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var g=0,d=a.length;g<d;g++){var b=a[g];if(b)switch(c){case "draw":z.draw(b.geo,b.material,[b.meshObject.position.x,b.meshObject.position.y,b.meshObject.position.z],void 0,b.meshObject);break;case "erase":z.erase(b.meshObject)}}this.currentActionIndex--;
this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var c=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var g=0,d=a.length;g<d;g++){var b=a[g];if(b)switch(c){case "draw":z.draw(b.geo,b.material,[b.meshObject.position.x,b.meshObject.position.y,b.meshObject.position.z],void 0,b.meshObject);break;case "erase":z.erase(b.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(l,b){this.actionArray.length=
-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.isCurrentActionAlive=!0;this.actionArray.push({type:l,meshes:b});this.currentActionIndex++;this.updateDom();if(a())if(confirm("\u786e\u5b9a\u8981\u4fee\u6539\u5417\uff1f\uff08\u5c06\u4f1a\u4f5c\u4e3a\u65b0\u5efa\u7684\u6587\u4ef6\u8986\u76d6\u672c\u5730\u4fdd\u5b58\u7684\u6570\u636e\uff09"))d=new s,c.save(c.storageKeys.boxId,""),c.save(c.storageKeys.updatedAt,""),c.save(c.storageKeys.boxName,""),c.save(c.storageKeys.localChanges,"1"),n("\u5df2\u6839\u636e\u5f53\u524d\u5185\u5bb9\u65b0\u5efa\u6587\u4ef6");
else{this.undo();return}this.changed=1;sa()},appendObjectToCurrentAction:function(a,b){var g=this.actionArray[this.currentActionIndex];if(!0!==this.isCurrentActionAlive)this.addAction(a,b);else if(void 0===g.meshes)g.meshes=b;else if(g.meshes instanceof Array||(g.meshes=[g.meshes]),b instanceof Array)for(var c=0,d=b.length;c<d;c++)g.meshes.push(b[c]);else g.meshes.push(b)},updateDom:function(){k.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;k.getElementById("redo").disabled=this.currentActionIndex>=
this.actionArray.length-1?!0:!1}};var Q=function(){this.isInsertingFlag=this.drawFlag=!1;this.insertMeshesBase=this.insertMeshes=void 0;this.insertMeshesNormal=new t.Vector3(0,1,0);this.insertTimes=0;this.insertMaterialOverrideFlag=!1};Q.prototype={calculateIntersectResult:E,setMeshPositionToFitTheGrid:M,updateHelperCube:W,adjustInsertMeshes:function(a){if(!a||1>a.length)return a;for(var b=new t.Vector3(r.width/2,r.width/2,r.width/2),c=a[0].position.length(),d=a[0].position.y,e=0,f=1,h=a.length;f<
h;f++){var k=a[f].position.y;k<d?(d=k,c=a[f].position.length(),e=f):k==d&&(k=a[f].position.length(),k<c&&(c=k,e=f))}b=(this.insertMeshesBase=a[e]).position.clone().sub(b);f=0;for(h=a.length;f<h;f++)a[f].position.sub(b);return a},offsetInsertMeshesBasedOnHelperBox:function(a){if(!a||1>a.length)return a;for(var b=new t.Vector3(r.width/2,r.width/2,r.width/2),b=X.position.clone().sub(b),c=0,d=a.length;c<d;c++)a[c].position.sub(b)},addInsertHelperToScene:function(a){this.adjustInsertMeshes(a);this.offsetInsertMeshesBasedOnHelperBox(a);
for(var b=0,c=a.length;b<c;b++)h.scene.add(a[b])},updateInsertHelper:function(a,b){if(b&&!(1>b.length)){var c=b[0];if(!a||!c||1>a.length)return a;var c=c.face.normal.clone(),d=new t.Quaternion;d.setFromUnitVectors(this.insertMeshesNormal,c);for(var e=X.position.clone().sub(this.insertMeshesBase.position),f=X.position.clone(),h=0,k=a.length;h<k;h++){a[h].position.add(e);var m=a[h].position.clone().sub(f);m.applyQuaternion(d);a[h].position.copy(f.clone().add(m));a[h].position.divideScalar(r.width).floor().multiplyScalar(r.width).addScalar(r.width/
2)}this.insertMeshesNormal=c}},endInsert:function(){if(this.insertMeshes&&0<this.insertMeshes.length)for(var a=0,b=this.insertMeshes.length;a<b;a++)h.scene.remove(this.insertMeshes[a]);this.isInsertingFlag=!1;this.insertMeshesBase=this.insertMeshes=void 0;this.insertMeshesNormal=new t.Vector3(0,1,0);this.insertTimes=0;this.insertMaterialOverrideFlag=!1;n("\u63d2\u5165\u7ed3\u675f")},rotateMeshes:function(a,b,c,d){c=c||this.insertMeshes;b=b||this.insertMeshesNormal;d=(d||this.insertMeshesBase).position.clone();
for(var e=c.length-1;0<=e;e--){var f=c[e].position.clone().sub(d);f.applyAxisAngle(b,a);c[e].position.copy(d.clone().add(f));c[e].position.divideScalar(r.width).floor().multiplyScalar(r.width).addScalar(r.width/2)}},reflectMeshes:function(a,b,c,d){c=c||this.insertMeshes;d=d||this.insertMeshesBase;b=b||this.insertMeshesNormal;b=b.clone();d=d.position.clone();a?(a=b.z,b.z=b.y,b.y=b.x,b.x=a):(a=b.x,b.x=b.y,b.y=b.z,b.z=a);for(a=c.length-1;0<=a;a--){var e=c[a].position.clone().sub(d);e.reflect(b);c[a].position.copy(d.clone().add(e));
c[a].position.divideScalar(r.width).floor().multiplyScalar(r.width).addScalar(r.width/2)}},draw:function(a,b,c,d,e,f){if(void 0===a||"number"===typeof a)a=x[a||0];if(void 0===b||"number"===typeof b)b=N[b||0];var k=a.data,m=b.data;e=e||new t.Mesh(k,m);e.castShadow=!0;e.receiveShadow=!0;d?M(e,d):e.position.set(c[0],c[1],c[2]);!f||(e.visible=!1);h.scene.add(e);fa.push(e);P.push({meshObject:e,geo:a,material:b});return P[P.length-1]},erase:function(a){h.scene.remove(a);a=fa.indexOf(a);if(!(0>a)){fa.splice(a,
1);var b=P[a-1];P.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"},deleteMesh:function(a){a=a||this.insertMeshes;for(var b=[],c=0,d=a.length;c<d;c++)for(var e=0,f=P.length;e<f;e++){var h=P[e].meshObject;if(a[c].position.equals(h.position)){b.push(this.erase(h));break}}return b},insert:function(a){a=a||this.insertMeshes;for(var b=[],c=0,d=a.length;c<d;c++){if(this.insertMaterialOverrideFlag)var e=this.draw(Da,ya,[a[c].position.x,a[c].position.y,a[c].position.z]);else{for(var f=
e=0,h=x.length;f<h;f++)if(x[f].data===a[c].geometry){e=f;break}for(var h=f=0,k=N.length;h<k;h++)if(N[h].data===a[c].material){f=h;break}e=this.draw(e,f,[a[c].position.x,a[c].position.y,a[c].position.z],void 0,a[c].clone())}b.push(e)}return b}};t.ImageUtils.crossOrigin="Anonymous";var h,r={width:50},ca=r.width/50,y={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*ca,basePlaneTextureRepeat:80,fogNear:8E3*ca,fogFar:25E3*ca,sphereRadius:25E3*ca},canvas:{ambientLightColor:9474192,
directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*ca,basePlaneTextureRepeat:16,fogNear:2E3*ca,fogFar:3E3*ca,sphereRadius:3E3*ca}},ha,ma,za,Aa=0,D=B.prototype.LOAD_TYPE.async,m=new t.MeshLambertMaterial({color:592137}),J={opacity:.5,transparent:!0},N=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:m,helperData:R(J,m)}],x=[{name:"default",type:"1",id:"geo0",data:new t.BoxGeometry(r.width+1,r.width+1,r.width+1,1,1,1)}];u=30;v=0;var xa=!0,O={toolsType:0,toolsRadius:0,
textures:0,texturesType:0,toggleShadow:function(){w.castShadow=!w.castShadow;h.renderer.shadowMapEnabled=!h.renderer.shadowMapEnabled;w.castShadow?n("\u9634\u5f71\u6253\u5f00"):n("\u9634\u5f71\u5173\u95ed")},toggleAux:function(){1===O.toolsType||(X.visible=!X.visible);(xa=!xa)?n("\u8f85\u52a9\u7269\u4f53\u6253\u5f00"):n("\u8f85\u52a9\u7269\u4f53\u5173\u95ed")},toggleFPS:function(){"none"==h.stats.domElement.style.display?(h.stats.domElement.style.display="block",h.stats.begin(),n("FPS\u76d1\u6d4b\u6253\u5f00")):
(h.stats.domElement.style.display="none",h.stats.end(),n("FPS\u76d1\u6d4b\u5173\u95ed"))},capture:function(){var a=h.renderer.domElement,c=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var d=navigator.userAgent,e=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=e.exec(d)?c=parseFloat(RegExp.$1):(e=/rv:([0-9]{1,}[.0-9]{0,})/,null!=e.exec(d)&&(c=parseFloat(RegExp.$1)))}-1!==c?(b.navigator.saveBlob=b.navigator.saveBlob||b.navigator.msSaveBlob,a.msToBlob&&
b.navigator.saveBlob?b.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(f.href=a.toDataURL(),f.download="capture.png",f.click())},clearAll:function(){V.endFlag||V.instantComplete(V.loadBoxAnimation);if(!(1>P.length)){var a=z.erase(P[0].meshObject);L.addAction("erase",a);for(var b=0,c=P.length;b<c;b++)a=z.erase(P[0].meshObject),L.appendObjectToCurrentAction("erase",a)}},undo:function(){L.undo()},redo:function(){L.redo()},signInOpener:function(){$("#signInEmail").val("");
$("#signInUsername").val("");$("#signInPassword").val("");$("#signInError").parent().hide();$("#signInModal").modal("show");$("#signInEmail").focus()},loginOpener:function(){$("#loginUsername").val("");$("#loginPassword").val("");$("#loginError").parent().hide();$("#loginModal").modal("show");$("#loginUsername").focus()},logout:function(){AV.User.current()&&AV.User.logOut();la(!1);n("\u5df2\u767b\u51fa")},save:function(){if(AV.User.current()){if("0"!==L.changed||d.id){var a;a=""+(r.width+":");for(var b=
0,e=P.length;b<e;b++)a+=P[b].geo.id.replace("geo","")+",",a+=P[b].material.id.replace("texture","")+",",a+=P[b].meshObject.position.x+",",a+=P[b].meshObject.position.y+",",a+=P[b].meshObject.position.z+";";b=""+(h.controls.target.x+","+h.controls.target.y+","+h.controls.target.z+";");b+=h.controls.object.position.x+","+h.controls.object.position.y+","+h.controls.object.position.z+";";d.set("camera",b||"0,0,0;1000,500,1000");d.set("meshes",a||"");d.id||(a=prompt("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d",
d.get("name")||c.load(c.storageKeys.boxName)||"\u672a\u547d\u540d"),d.set("name",a||"\u672a\u547d\u540d"),d.set("user",AV.User.current()),d.setACL(new AV.ACL(AV.User.current())));d.save({success:function(a){c.save(c.storageKeys.updatedAt,a.updatedAt);c.save(c.storageKeys.boxId,a.id);c.save(c.storageKeys.boxName,a.get("name"));n("\u5df2\u4fdd\u5b58\u81f3\u4e91\u7aef")},error:function(a,b){c.save(c.storageKeys.boxName,a.get("name"));L.changed="1";c.save(c.storageKeys.localChanges,"1");n("\u4e91\u7aef\u4fdd\u5b58\u5931\u8d25\uff0c\u5c06\u4f1a\u4fdd\u5b58\u5728\u672c\u5730"+
b.message)}})}else n("\u6587\u4ef6\u672a\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u5c06\u672c\u5730\u4fdd\u5b58");L.changed="0";c.save(c.storageKeys.localChanges,"0");c.save(c.storageKeys.camera);c.save(c.storageKeys.sidebar);c.save()}else c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save(),a="\u5df2\u4fdd\u5b58\u5728\u672c\u5730",q||(a+="\uff0c\u767b\u5f55\u540e\u53ef\u5411\u4e91\u7aef\u4fdd\u5b58\u591a\u4e2a\u6587\u4ef6",q=!0),n(a)},newFile:function(){"0"===L.changed||1>P.length&&(!d||
d&&!d.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&O.save();z.endInsert();O.clearAll();L=new va;L.updateDom();d=new s;c.save(c.storageKeys.localChanges,"0");c.save(c.storageKeys.camera);c.save(c.storageKeys.sidebar);c.save(c.storageKeys.updatedAt,"");c.save(c.storageKeys.boxId,"");c.save(c.storageKeys.boxName,"");c.save();n("\u65b0\u5efa")},open:function(){k.getElementById("openIt").removeEventListener("click",C,!1);k.getElementById("openIt").removeEventListener("click",
H,!1);k.getElementById("openIt").removeEventListener("click",ja,!1);k.getElementById("openIt").addEventListener("click",C,!1);var a=new AV.Query(s);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(na);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());Y(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},
share:function(){var a=new AV.Query(s);a.select("name");a.equalTo("user",AV.User.current());Y(a.find(),void 0,"shareModal",["boxToShare"])},"delete":function(){k.getElementById("openIt").removeEventListener("click",C,!1);k.getElementById("openIt").removeEventListener("click",H,!1);k.getElementById("openIt").removeEventListener("click",ja,!1);k.getElementById("openIt").addEventListener("click",H,!1);var a=new AV.Query(s);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(na);b.select("name");
b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());Y(a.find(),b.find(),void 0,void 0,!0);$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},keep:function(){if(d&&d.id){var a=AV.Object.createWithoutData("Box",d.id),b=new AV.Query(na);b.equalTo("user",AV.User.current());b.equalTo("box",a);b.count().then(function(b){0<b?n("\u60a8\u5df2\u6536\u85cf\u8fc7\u6b64\u6587\u4ef6"):
(b=new na,b.set("box",a),b.set("name",prompt("\u6536\u85cf\u540d\u79f0")),b.set("user",AV.User.current()),b.setACL(new AV.ACL(AV.User.current())),b.save().then(function(){n("\u5df2\u6536\u85cf")},function(){n("\u6536\u85cf\u5931\u8d25")}))},function(a){n("\u6536\u85cf\u5931\u8d25")})}else n("\u53ea\u80fd\u6536\u85cf\u5df2\u4fdd\u5b58\u7684\u6587\u4ef6")},insert:function(){if(z.isInsertingFlag)z.endInsert();else{k.getElementById("openIt").removeEventListener("click",C,!1);k.getElementById("openIt").removeEventListener("click",
H,!1);k.getElementById("openIt").removeEventListener("click",ja,!1);k.getElementById("openIt").addEventListener("click",ja,!1);var a=new AV.Query(s);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(na);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());Y(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")}}},
ya=0,T=N[0],Z=T.data,Ca=T.helperData,Da=0,Ea=x[0].data,X,fa=[],P=[],pa,w,ga,Ba,wa=[0,0,0],qa,ta,V=new e,c=new B(!1),L=new va,z=new Q,Fa=0;h=new p(k.body);h.init(function(a){if(h.WINDOW_WIDTH!==b.innerWidth||h.WINDOW_HEIGHT!==b.innerHeight)h.WINDOW_WIDTH=b.innerWidth,h.WINDOW_HEIGHT=b.innerHeight,h.WINDOW_HEIGHT_HALF=h.WINDOW_HEIGHT/2,h.WINDOW_WIDTH_HALF=h.WINDOW_WIDTH/2,h.camera.aspect=h.WINDOW_WIDTH/h.WINDOW_HEIGHT,h.camera.updateProjectionMatrix(),h.renderer.setSize(h.WINDOW_WIDTH,h.WINDOW_HEIGHT),
k.body.height=h.WINDOW_HEIGHT},function(){ha=new t.PlaneBufferGeometry(y[h.renderType].basePlaneWidth,y[h.renderType].basePlaneWidth,y[h.renderType].basePlaneSegments,y[h.renderType].basePlaneSegments);for(var a=(new t.Matrix4).makeRotationX(-Math.PI/2),c=a.elements.length-1;0<=c;c--)a.elements[c]=Math.floor(a.elements[c]);ha.applyMatrix(a);c=t.ImageUtils.loadTexture("texture/grasslight-big.jpg");a=t.ImageUtils.loadTexture("texture/sky.jpg");c.wrapT=c.wrapS=t.RepeatWrapping;c.repeat.set(y[h.renderType].basePlaneTextureRepeat,
y[h.renderType].basePlaneTextureRepeat);za=new t.MeshPhongMaterial({ambient:16777215,color:14535731,map:c,bumpMap:c,bumpScale:3,specular:3364147,shininess:15,emissive:16777215});ma=new t.Mesh(ha,za);ma.receiveShadow=!0;ma.material.side=t.DoubleSide;h.scene.add(ma);fa.push(ma);pa=new t.AmbientLight(y[h.renderType].ambientLightColor);h.scene.add(pa);w=new t.DirectionalLight(15658734,y[h.renderType].directionalLightDensity);w.position.set(0,6E3,5E3);w.target.position.set(0,0,0);w.castShadow=!0;w.shadowCameraNear=
h.camera.near;w.shadowCameraFar=h.camera.far;w.shadowCameraFov=h.cam;w.shadowCameraTop=-1024*ca;w.shadowCameraLeft=-1024*ca;w.shadowCameraBottom=1024*ca;w.shadowCameraRight=1024*ca;w.shadowBias=1E-5;w.shadowDarkness=.4;w.shadowMapWidth=1024*ca;w.shadowMapHeight=1024*ca;h.scene.add(w);ga=new t.HemisphereLight(16777215,6316128,1);h.scene.add(ga);c=new t.SphereGeometry(y[h.renderType].sphereRadius,32,15,0,2*Math.PI,0,Math.PI/2);a=new t.MeshLambertMaterial({color:3368703,map:a,side:t.BackSide,emissive:16777215});
a=new t.Mesh(c,a);h.scene.add(a);X=new t.Mesh(Ea,Ca);X.position.set(r.width/2,r.width/2,r.width/2);h.scene.add(X);new t.Mesh(Ea,Z);qa=new t.Raycaster;Ba=new t.Vector2;ta=new t.FogExp2(16777215,5.3E-5);h.scene.fog=ta;h.controls.settings.boxScale=ca;h.renderer.setClearColor(15790320);h.renderer.shadowMapEnabled=!0;h.renderer.shadowMapType=t.PCFSoftShadowMap;h.renderer.shadowMapCullFace=t.CullFaceBack;h.renderer.gammaInput=!0;h.renderer.gammaOutput=!0;b.addEventListener("unload",aa,!1);b.addEventListener("reload",
ia,!1);h.renderer.domElement.addEventListener("mousemove",ba,!1);h.renderer.domElement.addEventListener("mousedown",oa,!1);h.renderer.domElement.addEventListener("mouseup",S,!1);k.addEventListener("keydown",U,!1);k.addEventListener("keyup",ka,!1);setInterval(da,12E4)});I();B={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"buttonGroup",id:"accountControl",
name:"accountControl",buttonType:"button",appendClass:"btn-group-accountbtn",buttons:[{title:"\u6ce8\u518c",id:"signInOpener"},{title:"\u767b\u5f55",id:"loginOpener"},{title:"\u767b\u51fa",id:"logout"},{title:"\u767b\u5f55\u540e\u65b9\u53ef\u4fdd\u5b58\u6570\u636e\u5230\u4e91\u7aef",id:"loginMessage"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",
id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]},{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo"},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6587\u4ef6",name:"files",id:"panelFiles",children:[{UIType:"buttonGroup",id:"currentFileNameGroup",name:"cfn",buttonType:"button",appendClass:"btn-group-cfnbtn",buttons:[{title:"",
id:"currentFileName"}]},{UIType:"buttonGroup",id:"currentFileStateGroup",name:"cfs",buttonType:"button",appendClass:"btn-group-cfsbtn",buttons:[{title:"",id:"currentFileState"}]},{UIType:"buttonGroup",id:"buttonGroupADM",name:"adm",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u65b0\u5efa",id:"newFile"},{title:"\u4fdd\u5b58",id:"save"},{title:"\u6536\u85cf",id:"keep"},{title:"\u6253\u5f00...",id:"open"},{title:"\u63d2\u5165...",id:"insert"},{title:"\u5220\u9664...",id:"delete"},
{title:"\u5171\u4eab...",id:"share"}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u9634\u5f71\u5f00\u5173",id:"toggleShadow"},{title:"FPS\u5f00\u5173",id:"toggleFPS"},{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux"},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",
id:"clearAll"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:N[0].type,bgTypeData:N[0].uniqueData,width:50,height:50,checked:!0}]}]}]};
if(600>h.WINDOW_WIDTH){Q=B.children;e=0;for(p=Q.length;e<p;e++)if("sidebarResize"===Q[e].id){e=Q[e].buttons;Q=0;for(p=e.length;Q<p;Q++)"normalSidebar"===e[Q].id&&delete e[Q].checked,"minSidebar"===e[Q].id&&(e[Q].checked=!0);break}O.sidebarResize=1}else O.sidebarResize=0;GoUI.Utils.domCreationDirector(B);L.updateDom();p=k.querySelectorAll(".btn");if(p instanceof Array||p.length)for(e=p.length-1;0<=e;e--)p[e].addEventListener("click",ra,!1);else p instanceof object&&p.addEventListener("click",ra,!1);
Q=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},
{color:"#ff432e"}];e=0;for(p=Q.length;e<p;e++)B={name:Q[e].color,type:"color",id:"texture"+(e+1),uniqueData:Q[e].color,data:new t.MeshLambertMaterial({color:Q[e].color})},N.push(B),GoUI.map.buttonGroup2.addButton({title:"",id:B.id,bgType:B.type,bgTypeData:B.uniqueData,width:50,height:50}).addEventListener("click",ra,!1);Q="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");e=0;for(p=Q.length;e<p;e++)B=
{name:Q[e].replace("texture/","").replace(".png",""),type:"image",id:"texture"+N.length,uniqueData:Q[e],data:new t.MeshLambertMaterial({map:t.ImageUtils.loadTexture(Q[e]),transparent:!0})},"glass"===B.data.name&&(B.data.map.opacity=.3),B.data.map.magFilter=t.NearestFilter,B.data.map.minFilter=t.LinearMipMapLinearFilter,N.push(B),GoUI.map.buttonGroup2.addButton({title:"",id:B.id,bgType:B.type,bgTypeData:B.uniqueData,width:50,height:50}).addEventListener("click",ra,!1);$("#loginUsername").on("keyup",
function(a){13===a.which&&k.getElementById("login").click()});$("#loginPassword").on("keyup",function(a){13===a.which&&k.getElementById("login").click()});k.getElementById("login").addEventListener("click",function(){var a=$("#loginUsername").val(),b=$("#loginPassword").val(),d=$("#login");d.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.logIn(a,b,{success:function(a){la(!0);d.removeAttr("disabled");$("#loginModal").modal("hide");n("\u4f60\u597d"+AV.User.current().escape("username"));
$("#loginUsername").val("");$("#loginPassword").val("");c.loadRemote()},error:function(a,b){$("#loginError").html(b.message);$("#loginError").parent().show();d.removeAttr("disabled")}})},!1);k.getElementById("signIn").addEventListener("click",function(){var a=$("#signInEmail").val(),b=$("#signInUsername").val(),d=$("#signInPassword").val(),e=$("#signIn");e.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.signUp(b,d,{ACL:new AV.ACL,email:a},{success:function(a){la(!0);e.removeAttr("disabled");
$("#signInModal").modal("hide");n("\u4f60\u597d"+AV.User.current().escape("username"));$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");c.loadRemote()},error:function(a,b){$("#signInError").html(b.message);$("#signInError").parent().show();e.removeAttr("disabled")}})},!1);k.getElementById("shareIt").addEventListener("click",function(){var a=$("#shareModal input[type=radio]:checked").val();if(a){var b=new AV.Query(s);b.equalTo("objectId",a);b.select("shared");b.first().then(function(b){if(!b.get("shared")){var c=
new AV.ACL(AV.User.current());c.setPublicReadAccess(!0);b.setACL(c);b.set("shared",!0);b.save().then(function(){n("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")},function(){n("\u5206\u4eab\u5931\u8d25")})}$("#shareLink").val("http://gonster.github.io/helloThreeJS/voxel-paint#"+a);n("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")})}},!1);k.getElementById("setItPrivate").addEventListener("click",
function(){var a=$("#shareModal input[type=radio]:checked").val();if(a){var b=new AV.Query(s);b.equalTo("objectId",a);b.select("shared");b.first().then(function(a){if(a.get("shared")){var b=new AV.ACL(AV.User.current());a.setACL(b);a.set("shared",!1);a.save().then(function(){n("\u53d6\u6d88\u5206\u4eab\u6210\u529f")},function(){n("\u53d6\u6d88\u5206\u4eab\u5931\u8d25")})}})}},!1);c.loadCamera(c.storageKeys.camera);c.loadSidebarSelectedButtons(c.storageKeys.sidebar);AV.User.current()?(la(!0),(p=b.location.hash)?
(p=p.substring(1),c.loadShared(p,function(){c.loadRemote();n("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25")})):c.loadRemote()):(la(!1),(p=b.location.hash)?(p=p.substring(1),c.loadShared(p,function(){c.loadMeshes(void 0,D,V.loadBoxAnimation);n("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25")})):c.loadMeshes(void 0,D,V.loadBoxAnimation));b.addEventListener("hashchange",function(){var a=b.location.hash;a&&(a=a.substring(1),c.loadShared(a,function(){n("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25")}))},
!1);$(".modal").on("hidden.bs.modal",function(){k.addEventListener("keydown",U,!1);k.addEventListener("keyup",ka,!1);h.controls.addKeyEventListener()});$(".modal").on("shown.bs.modal",function(){k.removeEventListener("keydown",U,!1);k.removeEventListener("keyup",ka,!1);h.controls.removeKeyEventListener()})})(window,document,Base,THREE,Detector);
