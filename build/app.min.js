THREE.SpriteCanvasMaterial=function(g){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,d){};this.setValues(g)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var g=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,g);g.color.copy(this.color);g.program=this.program;return g};
THREE.CanvasRenderer=function(g){function k(h,a,c,Q){I(a);z(c);G(Q);N(h.getStyle());b.stroke();ba.expandByScalar(2*a)}function d(h){A(h.getStyle());b.fill()}function w(h){p(h.target)}function p(h){if(!(h instanceof THREE.CompressedTexture)){var a=h.wrapS===THREE.RepeatWrapping,c=h.wrapT===THREE.RepeatWrapping,Q=h.image,f=document.createElement("canvas");f.width=Q.width;f.height=Q.height;var d=f.getContext("2d");d.setTransform(1,0,0,-1,0,Q.height);d.drawImage(Q,0,0);H[h.id]=b.createPattern(f,!0===
a&&!0===c?"repeat":!0===a&&!1===c?"repeat-x":!1===a&&!0===c?"repeat-y":"no-repeat")}}function a(h,a,c,Q,f,d,g,aa,v,k,m,R,e){if(!(e instanceof THREE.DataTexture)){!1===e.hasEventListener("update",w)&&(void 0!==e.image&&0<e.image.width&&p(e),e.addEventListener("update",w));var l=H[e.id];if(void 0!==l){A(l);var l=e.offset.x/e.repeat.x,J=e.offset.y/e.repeat.y,ka=e.image.width*e.repeat.x;e=e.image.height*e.repeat.y;g=(g+l)*ka;aa=(aa+J)*e;c-=h;Q-=a;f-=h;d-=a;v=(v+l)*ka-g;k=(k+J)*e-aa;m=(m+l)*ka-g;R=(R+
J)*e-aa;e=v*R-m*k;0!==e&&(l=1/e,e=(R*c-k*f)*l,k=(R*Q-k*d)*l,c=(v*f-m*c)*l,Q=(v*d-m*Q)*l,h=h-e*g-c*aa,a=a-k*g-Q*aa,b.save(),b.transform(e,k,c,Q,h,a),b.fill(),b.restore())}else A("rgba(0,0,0,1)"),b.fill()}}function e(h,a,c){var b=a.x-h.x,Q=a.y-h.y,f=b*b+Q*Q;0!==f&&(c/=Math.sqrt(f),b*=c,Q*=c,a.x+=b,a.y+=Q,h.x-=b,h.y-=Q)}function s(h){t!==h&&(t=b.globalAlpha=h)}function T(h){xa!==h&&(h===THREE.NormalBlending?b.globalCompositeOperation="source-over":h===THREE.AdditiveBlending?b.globalCompositeOperation=
"lighter":h===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),xa=h)}function I(h){pa!==h&&(pa=b.lineWidth=h)}function z(h){ga!==h&&(ga=b.lineCap=h)}function G(h){va!==h&&(va=b.lineJoin=h)}function N(h){ca!==h&&(ca=b.strokeStyle=h)}function A(h){O!==h&&(O=b.fillStyle=h)}function E(h){na.length!==h.length&&(b.setLineDash(h),na=h)}console.log("THREE.CanvasRenderer",THREE.REVISION);var la=THREE.Math.smoothstep;g=g||{};var U=this,ha,S,da,ma=new THREE.Projector,y=void 0!==g.canvas?g.canvas:
document.createElement("canvas"),r=y.width,u=y.height,l=Math.floor(r/2),D=Math.floor(u/2),P=0,ia=0,m=r,ea=u,c=1,b=y.getContext("2d",{alpha:!0===g.alpha}),Y=new THREE.Color(0),F=!0===g.alpha?0:1,t=1,xa=0,ca=null,O=null,pa=null,ga=null,va=null,na=[],qa,n,R,fa;new THREE.RenderableVertex;new THREE.RenderableVertex;var X,ya,x,f,C,ra,v=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var Z=new THREE.Color,J=new THREE.Color,ja=new THREE.Color,H={},h,Q,aa,ka,wa,Ba,Ca,oa=new THREE.Box2,
K=new THREE.Box2,ba=new THREE.Box2,Aa=new THREE.Color,Da=new THREE.Color,sa=new THREE.Color,ta=new THREE.Vector3,Ea=new THREE.Vector3,ua=new THREE.Vector3,za=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=y;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return c};this.setPixelRatio=function(h){c=h};this.setSize=
function(h,a,b){r=h*c;u=a*c;y.width=r;y.height=u;l=Math.floor(r/2);D=Math.floor(u/2);!1!==b&&(y.style.width=h+"px",y.style.height=a+"px");oa.min.set(-l,-D);oa.max.set(l,D);K.min.set(-l,-D);K.max.set(l,D);t=1;xa=0;va=ga=pa=O=ca=null;this.setViewport(0,0,h,a)};this.setViewport=function(h,a,b,Q){P=h*c;ia=a*c;m=b*c;ea=Q*c};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(h,a){Y.set(h);F=void 0!==a?a:1;K.min.set(-l,-D);K.max.set(l,D)};this.setClearColorHex=function(h,
a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(h,a)};this.getClearColor=function(){return Y};this.getClearAlpha=function(){return F};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===K.empty()&&(K.intersect(oa),K.expandByScalar(2),K.min.x+=l,K.min.y=-K.min.y+D,K.max.x+=l,K.max.y=-K.max.y+D,1>F&&b.clearRect(K.min.x|0,K.max.y|0,K.max.x-K.min.x|0,K.min.y-K.max.y|0),0<F&&(T(THREE.NormalBlending),s(1),
A("rgba("+Math.floor(255*Y.r)+","+Math.floor(255*Y.g)+","+Math.floor(255*Y.b)+","+F+")"),b.fillRect(K.min.x|0,K.max.y|0,K.max.x-K.min.x|0,K.min.y-K.max.y|0)),K.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,g){if(!1===g instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();U.info.render.vertices=0;U.info.render.faces=0;b.setTransform(m/
r,0,0,-ea/u,P,u-ia);b.translate(l,D);ha=ma.projectScene(c,g,this.sortObjects,this.sortElements);S=ha.elements;da=ha.lights;qa=g;za.getNormalMatrix(g.matrixWorldInverse);Aa.setRGB(0,0,0);Da.setRGB(0,0,0);sa.setRGB(0,0,0);for(var Y=0,O=da.length;Y<O;Y++){var q=da[Y],M=q.color;q instanceof THREE.AmbientLight?Aa.add(M):q instanceof THREE.DirectionalLight?Da.add(M):q instanceof THREE.PointLight&&sa.add(M)}Y=0;for(O=S.length;Y<O;Y++){var B=S[Y],F=B.material;if(void 0!==F&&0!==F.opacity){ba.makeEmpty();
if(B instanceof THREE.RenderableSprite){n=B;n.x*=l;n.y*=D;var q=n,L=B,M=F;s(M.opacity);T(M.blending);var y=L.scale.x*l,L=L.scale.y*D,B=.5*Math.sqrt(y*y+L*L);ba.min.set(q.x-B,q.y-B);ba.max.set(q.x+B,q.y+B);if(M instanceof THREE.SpriteMaterial){var V=M.map;if(null!==V&&void 0!==V.image){!1===V.hasEventListener("update",w)&&(0<V.image.width&&p(V),V.addEventListener("update",w));B=H[V.id];void 0!==B?A(B):A("rgba( 0, 0, 0, 1 )");var W=V.image,B=W.width*V.offset.x,F=W.height*V.offset.y,t=W.width*V.repeat.x,
V=W.height*V.repeat.y,W=y/t,ca=L/V;b.save();b.translate(q.x,q.y);0!==M.rotation&&b.rotate(M.rotation);b.translate(-y/2,-L/2);b.scale(W,ca);b.translate(-B,-F);b.fillRect(B,F,t,V)}else A(M.color.getStyle()),b.save(),b.translate(q.x,q.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(y,-L),b.fillRect(-.5,-.5,1,1);b.restore()}else M instanceof THREE.SpriteCanvasMaterial&&(N(M.color.getStyle()),A(M.color.getStyle()),b.save(),b.translate(q.x,q.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(y,L),M.program(b),
b.restore())}else if(B instanceof THREE.RenderableLine){if(n=B.v1,R=B.v2,n.positionScreen.x*=l,n.positionScreen.y*=D,R.positionScreen.x*=l,R.positionScreen.y*=D,ba.setFromPoints([n.positionScreen,R.positionScreen]),!0===oa.isIntersectionBox(ba))if(q=n,M=R,y=B,L=F,s(L.opacity),T(L.blending),b.beginPath(),b.moveTo(q.positionScreen.x,q.positionScreen.y),b.lineTo(M.positionScreen.x,M.positionScreen.y),L instanceof THREE.LineBasicMaterial){I(L.linewidth);z(L.linecap);G(L.linejoin);if(L.vertexColors!==
THREE.VertexColors)N(L.color.getStyle());else if(B=y.vertexColors[0].getStyle(),y=y.vertexColors[1].getStyle(),B===y)N(B);else{try{var ga=b.createLinearGradient(q.positionScreen.x,q.positionScreen.y,M.positionScreen.x,M.positionScreen.y);ga.addColorStop(0,B);ga.addColorStop(1,y)}catch(na){ga=B}N(ga)}b.stroke();ba.expandByScalar(2*L.linewidth)}else L instanceof THREE.LineDashedMaterial&&(I(L.linewidth),z(L.linecap),G(L.linejoin),N(L.color.getStyle()),E([L.dashSize,L.gapSize]),b.stroke(),ba.expandByScalar(2*
L.linewidth),E([]))}else if(B instanceof THREE.RenderableFace){n=B.v1;R=B.v2;fa=B.v3;if(-1>n.positionScreen.z||1<n.positionScreen.z)continue;if(-1>R.positionScreen.z||1<R.positionScreen.z)continue;if(-1>fa.positionScreen.z||1<fa.positionScreen.z)continue;n.positionScreen.x*=l;n.positionScreen.y*=D;R.positionScreen.x*=l;R.positionScreen.y*=D;fa.positionScreen.x*=l;fa.positionScreen.y*=D;0<F.overdraw&&(e(n.positionScreen,R.positionScreen,F.overdraw),e(R.positionScreen,fa.positionScreen,F.overdraw),
e(fa.positionScreen,n.positionScreen,F.overdraw));ba.setFromPoints([n.positionScreen,R.positionScreen,fa.positionScreen]);if(!0===oa.isIntersectionBox(ba)){M=n;y=R;L=fa;q=F;U.info.render.vertices+=3;U.info.render.faces++;s(q.opacity);T(q.blending);X=M.positionScreen.x;ya=M.positionScreen.y;x=y.positionScreen.x;f=y.positionScreen.y;C=L.positionScreen.x;ra=L.positionScreen.y;var F=X,t=ya,V=x,W=f,ca=C,pa=ra;b.beginPath();b.moveTo(F,t);b.lineTo(V,W);b.lineTo(ca,pa);b.closePath();if((q instanceof THREE.MeshLambertMaterial||
q instanceof THREE.MeshPhongMaterial)&&null===q.map){Z.copy(q.color);J.copy(q.emissive);q.vertexColors===THREE.FaceColors&&Z.multiply(B.color);v.copy(Aa);Ea.copy(M.positionWorld).add(y.positionWorld).add(L.positionWorld).divideScalar(3);M=Ea;y=B.normalModel;L=v;B=0;for(F=da.length;B<F;B++)t=da[B],ja.copy(t.color),t instanceof THREE.DirectionalLight?(V=ta.setFromMatrixPosition(t.matrixWorld).normalize(),W=y.dot(V),0>=W||(W*=t.intensity,L.add(ja.multiplyScalar(W)))):t instanceof THREE.PointLight&&(V=
ta.setFromMatrixPosition(t.matrixWorld),W=y.dot(ta.subVectors(V,M).normalize()),0>=W||(W*=0==t.distance?1:1-Math.min(M.distanceTo(V)/t.distance,1),0!=W&&(W*=t.intensity,L.add(ja.multiplyScalar(W)))));v.multiply(Z).add(J);!0===q.wireframe?k(v,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):d(v)}else q instanceof THREE.MeshBasicMaterial||q instanceof THREE.MeshLambertMaterial||q instanceof THREE.MeshPhongMaterial?null!==q.map?q.map.mapping===THREE.UVMapping&&(h=B.uvs,a(X,ya,x,f,C,ra,h[0].x,
h[0].y,h[1].x,h[1].y,h[2].x,h[2].y,q.map)):null!==q.envMap?q.envMap.mapping===THREE.SphericalReflectionMapping&&(ua.copy(B.vertexNormalsModel[0]).applyMatrix3(za),Q=.5*ua.x+.5,aa=.5*ua.y+.5,ua.copy(B.vertexNormalsModel[1]).applyMatrix3(za),ka=.5*ua.x+.5,wa=.5*ua.y+.5,ua.copy(B.vertexNormalsModel[2]).applyMatrix3(za),Ba=.5*ua.x+.5,Ca=.5*ua.y+.5,a(X,ya,x,f,C,ra,Q,aa,ka,wa,Ba,Ca,q.envMap)):(v.copy(q.color),q.vertexColors===THREE.FaceColors&&v.multiply(B.color),!0===q.wireframe?k(v,q.wireframeLinewidth,
q.wireframeLinecap,q.wireframeLinejoin):d(v)):(q instanceof THREE.MeshDepthMaterial?v.r=v.g=v.b=1-la(M.positionScreen.z*M.positionScreen.w,qa.near,qa.far):q instanceof THREE.MeshNormalMaterial?(ua.copy(B.normalModel).applyMatrix3(za),v.setRGB(ua.x,ua.y,ua.z).multiplyScalar(.5).addScalar(.5)):v.setRGB(1,1,1),!0===q.wireframe?k(v,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):d(v))}}K.union(ba)}}b.setTransform(1,0,0,1,0,0)}}};
THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(g){this.positionWorld.copy(g.positionWorld);this.positionScreen.copy(g.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function g(){if(G===A){var a=new THREE.RenderableVertex;N.push(a);A++;G++;return a}return N[G++]}function k(){if(la===ha){var a=new THREE.RenderableFace;U.push(a);ha++;la++;return a}return U[la++]}function d(){if(da===y){var a=new THREE.RenderableLine;ma.push(a);y++;da++;return a}return ma[da++]}function w(){if(u===D){var a=new THREE.RenderableSprite;l.push(a);D++;u++;return a}return l[u++]}function p(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function a(a,c){var b=
0,d=1,g=a.z+a.w,f=c.z+c.w,e=-a.z+a.w,k=-c.z+c.w;if(0<=g&&0<=f&&0<=e&&0<=k)return!0;if(0>g&&0>f||0>e&&0>k)return!1;0>g?b=Math.max(b,g/(g-f)):0>f&&(d=Math.min(d,g/(g-f)));0>e?b=Math.max(b,e/(e-k)):0>k&&(d=Math.min(d,e/(e-k)));if(d<b)return!1;a.lerp(c,b);c.lerp(a,1-d);return!0}var e,s,T=[],I=0,z,G,N=[],A=0,E,la,U=[],ha=0,S,da,ma=[],y=0,r,u,l=[],D=0,P={objects:[],lights:[],elements:[]},ia=new THREE.Vector3,m=new THREE.Vector3,ea=new THREE.Vector3,c=new THREE.Vector3,b=new THREE.Vector4,Y=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),F=new THREE.Box3,t=Array(3),xa=new THREE.Matrix4,ca=new THREE.Matrix4,O,pa=new THREE.Matrix4,ga=new THREE.Matrix3,va=new THREE.Frustum,na=new THREE.Vector4,qa=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var n=new function(){var a=[],c=[],b=null,e=null,p=new THREE.Matrix3,f=function(a){var c=a.positionWorld,b=a.positionScreen;c.copy(a.position).applyMatrix4(O);b.copy(c).applyMatrix4(ca);c=1/b.w;b.x*=c;b.y*=c;b.z*=c;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},m=function(a,c,b){if(!0===a.visible||!0===c.visible||!0===b.visible)return!0;t[0]=a.positionScreen;t[1]=c.positionScreen;t[2]=b.positionScreen;return Y.isIntersectionBox(F.setFromPoints(t))},l=function(a,c,b){return 0>(b.positionScreen.x-
a.positionScreen.x)*(c.positionScreen.y-a.positionScreen.y)-(b.positionScreen.y-a.positionScreen.y)*(c.positionScreen.x-a.positionScreen.x)};return{setObject:function(f){b=f;e=b.material;p.getNormalMatrix(b.matrixWorld);a.length=0;c.length=0},projectVertex:f,checkTriangleVisibility:m,checkBackfaceCulling:l,pushVertex:function(a,c,b){z=g();z.position.set(a,c,b);f(z)},pushNormal:function(c,b,f){a.push(c,b,f)},pushUv:function(a,b){c.push(a,b)},pushLine:function(a,c){var f=N[a],e=N[c];S=d();S.id=b.id;
S.v1.copy(f);S.v2.copy(e);S.z=(f.positionScreen.z+e.positionScreen.z)/2;S.material=b.material;P.elements.push(S)},pushTriangle:function(f,d,g){var w=N[f],n=N[d],h=N[g];if(!1!==m(w,n,h)&&(e.side===THREE.DoubleSide||!0===l(w,n,h))){E=k();E.id=b.id;E.v1.copy(w);E.v2.copy(n);E.v3.copy(h);E.z=(w.positionScreen.z+n.positionScreen.z+h.positionScreen.z)/3;for(w=0;3>w;w++)n=3*arguments[w],h=E.vertexNormalsModel[w],h.set(a[n],a[n+1],a[n+2]),h.applyMatrix3(p).normalize(),n=2*arguments[w],E.uvs[w].set(c[n],c[n+
1]);E.vertexNormalsLength=3;E.material=b.material;P.elements.push(E)}}}};this.projectScene=function(l,F,y,Y){u=da=la=0;P.elements.length=0;!0===l.autoUpdate&&l.updateMatrixWorld();void 0===F.parent&&F.updateMatrixWorld();xa.copy(F.matrixWorldInverse.getInverse(F.matrixWorld));ca.multiplyMatrices(F.projectionMatrix,xa);va.setFromMatrix(ca);s=0;P.objects.length=0;P.lights.length=0;l.traverseVisible(function(a){if(a instanceof THREE.Light)P.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===va.intersectsObject(a))){if(s===I){var h=new THREE.RenderableObject;T.push(h);I++;s++;e=h}else e=T[s++];e.id=a.id;e.object=a;c.setFromMatrixPosition(a.matrixWorld);c.applyProjection(ca);e.z=c.z;P.objects.push(e)}});!0===y&&P.objects.sort(p);l=0;for(y=P.objects.length;l<y;l++){var x=P.objects[l].object,f=x.geometry;n.setObject(x);O=x.matrixWorld;G=0;if(x instanceof THREE.Mesh)if(f instanceof THREE.BufferGeometry){var C=
f.attributes,x=f.offsets;if(void 0!==C.position){for(var t=C.position.array,f=0,v=t.length;f<v;f+=3)n.pushVertex(t[f],t[f+1],t[f+2]);if(void 0!==C.normal)for(var z=C.normal.array,f=0,v=z.length;f<v;f+=3)n.pushNormal(z[f],z[f+1],z[f+2]);if(void 0!==C.uv)for(z=C.uv.array,f=0,v=z.length;f<v;f+=2)n.pushUv(z[f],z[f+1]);if(void 0!==C.index)if(C=C.index.array,0<x.length)for(l=0;l<x.length;l++)for(v=x[l],t=v.index,f=v.start,v=v.start+v.count;f<v;f+=3)n.pushTriangle(C[f]+t,C[f+1]+t,C[f+2]+t);else for(f=0,
v=C.length;f<v;f+=3)n.pushTriangle(C[f],C[f+1],C[f+2]);else for(f=0,v=t.length/3;f<v;f+=3)n.pushTriangle(f,f+1,f+2)}}else{if(f instanceof THREE.Geometry){var J=f.vertices,v=f.faces,C=f.faceVertexUvs[0];ga.getNormalMatrix(O);for(var t=x.material instanceof THREE.MeshFaceMaterial,z=!0===t?x.material:null,A=0,H=J.length;A<H;A++){var h=J[A];n.pushVertex(h.x,h.y,h.z)}J=0;for(A=v.length;J<A;J++){var H=v[J],Q=!0===t?z.materials[H.materialIndex]:x.material;if(void 0!==Q){var aa=Q.side,h=N[H.a],ka=N[H.b],
wa=N[H.c];if(!0===Q.morphTargets){var D=f.morphTargets,U=x.morphTargetInfluences,oa=h.position,K=ka.position,ba=wa.position;ia.set(0,0,0);m.set(0,0,0);ea.set(0,0,0);for(var ha=0,ma=D.length;ha<ma;ha++){var sa=U[ha];if(0!==sa){var ta=D[ha].vertices;ia.x+=(ta[H.a].x-oa.x)*sa;ia.y+=(ta[H.a].y-oa.y)*sa;ia.z+=(ta[H.a].z-oa.z)*sa;m.x+=(ta[H.b].x-K.x)*sa;m.y+=(ta[H.b].y-K.y)*sa;m.z+=(ta[H.b].z-K.z)*sa;ea.x+=(ta[H.c].x-ba.x)*sa;ea.y+=(ta[H.c].y-ba.y)*sa;ea.z+=(ta[H.c].z-ba.z)*sa}}h.position.add(ia);ka.position.add(m);
wa.position.add(ea);n.projectVertex(h);n.projectVertex(ka);n.projectVertex(wa)}if(!1!==n.checkTriangleVisibility(h,ka,wa)){D=n.checkBackfaceCulling(h,ka,wa);if(aa!==THREE.DoubleSide){if(aa===THREE.FrontSide&&!1===D)continue;if(aa===THREE.BackSide&&!0===D)continue}E=k();E.id=x.id;E.v1.copy(h);E.v2.copy(ka);E.v3.copy(wa);E.normalModel.copy(H.normal);!1!==D||aa!==THREE.BackSide&&aa!==THREE.DoubleSide||E.normalModel.negate();E.normalModel.applyMatrix3(ga).normalize();U=H.vertexNormals;oa=0;for(K=Math.min(U.length,
3);oa<K;oa++)ba=E.vertexNormalsModel[oa],ba.copy(U[oa]),!1!==D||aa!==THREE.BackSide&&aa!==THREE.DoubleSide||ba.negate(),ba.applyMatrix3(ga).normalize();E.vertexNormalsLength=U.length;aa=C[J];if(void 0!==aa)for(D=0;3>D;D++)E.uvs[D].copy(aa[D]);E.color=H.color;E.material=Q;E.z=(h.positionScreen.z+ka.positionScreen.z+wa.positionScreen.z)/3;P.elements.push(E)}}}}}else if(x instanceof THREE.Line)if(f instanceof THREE.BufferGeometry){if(C=f.attributes,void 0!==C.position){t=C.position.array;f=0;for(v=t.length;f<
v;f+=3)n.pushVertex(t[f],t[f+1],t[f+2]);if(void 0!==C.index)for(C=C.index.array,f=0,v=C.length;f<v;f+=2)n.pushLine(C[f],C[f+1]);else for(C=x.mode===THREE.LinePieces?2:1,f=0,v=t.length/3-1;f<v;f+=C)n.pushLine(f,f+1)}}else{if(f instanceof THREE.Geometry&&(pa.multiplyMatrices(ca,O),J=x.geometry.vertices,0!==J.length))for(h=g(),h.positionScreen.copy(J[0]).applyMatrix4(pa),C=x.mode===THREE.LinePieces?2:1,A=1,H=J.length;A<H;A++)h=g(),h.positionScreen.copy(J[A]).applyMatrix4(pa),0<(A+1)%C||(ka=N[G-2],na.copy(h.positionScreen),
qa.copy(ka.positionScreen),!0===a(na,qa)&&(na.multiplyScalar(1/na.w),qa.multiplyScalar(1/qa.w),S=d(),S.id=x.id,S.v1.positionScreen.copy(na),S.v2.positionScreen.copy(qa),S.z=Math.max(na.z,qa.z),S.material=x.material,x.material.vertexColors===THREE.VertexColors&&(S.vertexColors[0].copy(x.geometry.colors[A]),S.vertexColors[1].copy(x.geometry.colors[A-1])),P.elements.push(S)))}else x instanceof THREE.Sprite&&(b.set(O.elements[12],O.elements[13],O.elements[14],1),b.applyMatrix4(ca),f=1/b.w,b.z*=f,-1<=
b.z&&1>=b.z&&(r=w(),r.id=x.id,r.x=b.x*f,r.y=b.y*f,r.z=b.z,r.object=x,r.rotation=x.rotation,r.scale.x=x.scale.x*Math.abs(r.x-(b.x+F.projectionMatrix.elements[0])/(b.w+F.projectionMatrix.elements[12])),r.scale.y=x.scale.y*Math.abs(r.y-(b.y+F.projectionMatrix.elements[5])/(b.w+F.projectionMatrix.elements[13])),r.material=x.material,P.elements.push(r)))}!0===Y&&P.elements.sort(p);return P}};
THREE.OrbitControls=function(g,k){function d(c){if(!1!==a.enabled){c.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(l===u.ROTATE){if(!0===a.noRotate)return;s.set(c.clientX,c.clientY);T.subVectors(s,e);a.rotateLeft(2*Math.PI*T.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*T.y/b.clientHeight*a.rotateSpeed);e.copy(s)}else if(l===u.DOLLY){if(!0===a.noZoom)return;la.set(c.clientX,c.clientY);U.subVectors(la,E);0<U.y?a.dollyIn():a.dollyOut();E.copy(la)}else if(l===
u.PAN){if(!0===a.noPan)return;z.set(c.clientX,c.clientY);G.subVectors(z,I);a.pan(G.x,G.y);I.copy(z)}a.update()}}function w(){!1!==a.enabled&&(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",w,!1),a.dispatchEvent(ea),l=u.NONE)}function p(c){if(!1!==a.enabled&&!0!==a.noZoom){c.preventDefault();c.stopPropagation();var b=0;void 0!==c.wheelDelta?b=c.wheelDelta:void 0!==c.detail&&(b=-c.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(m);a.dispatchEvent(ea)}}
this.object=g;this.domElement=void 0!==k?k:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,e=new THREE.Vector2,s=new THREE.Vector2,T=new THREE.Vector2,I=new THREE.Vector2,z=new THREE.Vector2,G=new THREE.Vector2,N=new THREE.Vector3,A=new THREE.Vector3,E=new THREE.Vector2,la=new THREE.Vector2,U=new THREE.Vector2,ha=0,S=0,da=1,ma=new THREE.Vector3,y=new THREE.Vector3,r=new THREE.Quaternion,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},l=u.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var D=(new THREE.Quaternion).setFromUnitVectors(g.up,new THREE.Vector3(0,1,0)),P=D.clone().inverse(),ia={type:"change"},m={type:"start"},ea={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);S-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);ha-=c};this.panLeft=function(a){var b=this.object.matrix.elements;N.set(b[0],b[1],b[2]);N.multiplyScalar(-a);ma.add(N)};this.panUp=function(a){var b=this.object.matrix.elements;N.set(b[4],
b[5],b[6]);N.multiplyScalar(a);ma.add(N)};this.panForward=function(a){var b=this.object.matrix.elements;N.set(b[8],b[9],b[10]);N.multiplyScalar(a);ma.add(N)};this.pan=function(c,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*d/e.clientHeight);a.panUp(2*b*d/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/e.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*d/e.clientHeight);a.panForward(2*b*d/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/e.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));da/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));da*=c};this.update=function(){var c=this.object.position;A.copy(c).sub(this.target);A.applyQuaternion(D);var b=Math.atan2(A.x,A.z),e=Math.atan2(Math.sqrt(A.x*A.x+A.z*A.z),A.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+S,e=e+ha,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),d=A.length()*da,d=Math.max(this.minDistance,Math.min(this.maxDistance,d));this.target.add(ma);A.x=d*Math.sin(e)*Math.sin(b);A.y=d*Math.cos(e);A.z=d*Math.sin(e)*Math.cos(b);A.applyQuaternion(P);c.copy(this.target).add(A);this.object.lookAt(this.target);ha=S=0;da=1;ma.set(0,0,0);if(1E-6<
y.distanceToSquared(this.object.position)||1E-6<8*(1-r.dot(this.object.quaternion)))this.dispatchEvent(ia),y.copy(this.object.position),r.copy(this.object.quaternion)};this.reset=function(){l=u.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;l=u.ROTATE;e.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;l=u.DOLLY;E.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.PAN){if(!0===a.noPan)return;l=u.PAN;I.set(c.clientX,c.clientY)}document.addEventListener("mousemove",d,!1);document.addEventListener("mouseup",w,!1);a.dispatchEvent(m)}},!1);this.domElement.addEventListener("mousewheel",p,!1);this.domElement.addEventListener("DOMMouseScroll",p,!1);this.domElement.addEventListener("touchstart",
function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;l=u.TOUCH_ROTATE;e.set(c.touches[0].pageX,c.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;l=u.TOUCH_DOLLY;var b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;b=Math.sqrt(b*b+c*c);E.set(0,b);break;case 3:if(!0===a.noPan)return;l=u.TOUCH_PAN;I.set(c.touches[0].pageX,c.touches[0].pageY);break;default:l=u.NONE}a.dispatchEvent(m)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(ea),l=u.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();c.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(l!==u.TOUCH_ROTATE)break;s.set(c.touches[0].pageX,c.touches[0].pageY);T.subVectors(s,e);a.rotateLeft(2*Math.PI*T.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*T.y/b.clientHeight*a.rotateSpeed);e.copy(s);
a.update();break;case 2:if(!0===a.noZoom)break;if(l!==u.TOUCH_DOLLY)break;b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;c=Math.sqrt(b*b+c*c);la.set(0,c);U.subVectors(la,E);0<U.y?a.dollyOut():a.dollyIn();E.copy(la);a.update();break;case 3:if(!0===a.noPan)break;if(l!==u.TOUCH_PAN)break;z.set(c.touches[0].pageX,c.touches[0].pageY);G.subVectors(z,I);a.pan(G.x,G.y);I.copy(z);a.update();break;default:l=u.NONE}}},!1);window.addEventListener("keydown",function(c){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var g=document.createElement("canvas");return!(!window.WebGLRenderingContext||!g.getContext("webgl")&&!g.getContext("experimental-webgl"))}catch(k){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";
g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){var k,d;g=g||{};k=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";d=Detector.getWebGLErrorMessage();d.id=g;k.appendChild(d)}};"object"===typeof module&&(module.exports=Detector);
(function(g,k,d,w){var p=function(a){this.domParent="object"===typeof a?a:k.body};p.prototype.init=function(a,e,p,T,I,z){g.requestAnimationFrame||(g.requestAnimationFrame=function(){return g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a,e){g.setTimeout(a,1E3/60)}}());this.domParent===k.body&&(this.WINDOW_WIDTH=g.innerWidth,this.WINDOW_HEIGHT=g.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,g.addEventListener("resize",a,!1));this.renderType=w.webgl?"webgl":"canvas";this.renderer=p||(w.webgl?new d.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new d.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=T||new d.Scene;this.camera=I||new d.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
z?this.controls=z:(this.controls=new d.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:d.MOUSE.MIDDLE,PAN:d.MOUSE.RIGHT});e()};g.Base=p;"object"===typeof module&&(module.exports=p)})(window,document,THREE,Detector);
(function(){function g(d){return d.charAt(0).toUpperCase()+d.slice(1)}var k={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(d){var g=0;for(d=d.length;g<d;g++);};k.map={};k.Sidebar=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({align:"r",width:320},d),a="sidebar",a=p.align&&"r"!==p.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;p.id&&(this.domElement.id=p.id,k.map[p.id]=this);
this.domElement.style.width=p.width.toString()+"px";p.overflow&&(this.domElement.style.overflow=p.overflow.toString());g.appendChild(this.domElement);k.Utils.domCreationDirector(p.children,this.domElement)};k.Sidebar.prototype=Object.create(_Container.prototype);k.Panel=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({title:""},d);p.id&&(this.domElement.id=p.id,k.map[p.id]=this);var a=this.domElement;a.className="panel panel-tool";g.appendChild(a);var e=document.createElement("div");
e.className="panel-heading";a.appendChild(e);var s=document.createTextNode(p.title);e.appendChild(s);e=document.createElement("div");e.className="panel-body";p.overflow&&(e.style.overflow=p.overflow.toString());a.appendChild(e);k.Utils.domCreationDirector(p.children,e)};k.Panel.prototype=Object.create(_Container.prototype);k.Toolbar=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({title:""},d);p.id&&(this.domElement.id=p.id,k.map[p.id]=this);var a=this.domElement;a.className=
"btn-toolbar";g.appendChild(a);k.Utils.domCreationDirector(p.children,a)};k.Toolbar.prototype=Object.create(_Container.prototype);k.ButtonGroup=function(d,g){_Container.call(this);var p=this.setting=k.Utils.settingMixin({title:"",buttonType:"radio"},d);p.id&&(this.domElement.id=p.id,k.map[p.id]=this);var a=this.domElement;a.className="btn-group"+(p.appendClass?" "+p.appendClass:"");"button"!==p.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=p.title;g.appendChild(a);var e=
p.buttons;switch(p.buttonType.toLowerCase()){default:case "radio":for(var s=0,T=e.length;s<T;s++){var I=document.createElement("label");I.className="btn btn-tool"+(e[s].checked?" active":"");e[s].height&&(I.style.height=e[s].height+"px");e[s].width&&(I.style.width=e[s].width+"px");if(e[s].bgType&&e[s].bgTypeData){var z;switch(e[s].bgType){case "color":z=e[s].bgTypeData;I.className+=" btn-color";break;case "image":z="url("+e[s].bgTypeData+") no-repeat 50% 50%";I.className+=" btn-image";break;default:return}I.style.background=
z}a.appendChild(I);var G=document.createElement("input");e[s].checked&&G.setAttribute("checked","");G.type=p.buttonType;G.name=p.name;G.id=e[s].id;G.value=s;G.autocomplete="off";I.appendChild(G);z=document.createTextNode(e[s].title);I.appendChild(z)}break;case "button":for(s=0,T=e.length;s<T;s++){G=document.createElement("button");G.className="btn btn-tool";G.id=e[s].id;G.name=p.name;e[s].height&&(G.style.height=e[s].height+"px");e[s].width&&(G.style.width=e[s].width+"px");if(e[s].bgType&&e[s].bgTypeData){switch(e[s].bgType){case "color":z=
e[s].bgTypeData;I.className+=" btn-color";break;case "image":z="url("+e[s].bgTypeData+") no-repeat 50% 50%";I.className+=" btn-image";break;default:return}G.style.background=z}a.appendChild(G);z=document.createTextNode(e[s].title);G.appendChild(z)}}k.Utils.domCreationDirector(p.children,this.domElement)};k.ButtonGroup.prototype=Object.create(_Container.prototype);k.ButtonGroup.prototype.addButton=function(d,g){g||this.setting.buttons.push(d);var k=document.createElement("label");k.className="btn btn-tool"+
(d.checked?" active":"");d.height&&(k.style.height=d.height+"px");d.width&&(k.style.width=d.width+"px");if(d.bgType&&d.bgTypeData){var a;switch(d.bgType){case "color":a=d.bgTypeData;k.className+=" btn-color";break;case "image":a="url("+d.bgTypeData+") no-repeat 50% 50%";k.className+=" btn-image";break;default:return}k.style.background=a}this.domElement.appendChild(k);a=document.createElement("input");d.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
d.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";k.appendChild(a);a=document.createTextNode(d.title);k.appendChild(a);return k};k.ButtonGroup.prototype.addButtons=function(d,g){for(var k=0,a=d.length;k<a;k++)this.addButton(d[k],g)};k.Utils={};k.Utils.settingMixin=function(d,g){if("object"===typeof d&&"object"===typeof g){var k={},a;for(a in d)k[a]=d[a];for(var e in g)void 0!==g[e]&&(k[e]=g[e]);return k}return d};k.Utils.domCreationDirector=function(d,w){if(d)if(d instanceof Array)for(var p=
0,a=d.length;p<a;p++)k.Utils.domCreationDirector(d[p],w?w:document.body);else d instanceof Object&&d.UIType&&k[g(d.UIType)]&&new (k[g(d.UIType)])(d,w?w:document.body)};window.GoUI=k;"object"===typeof module&&(module.exports=k)})();
(function(g,k,d,w,p){var a,e;function s(a,b){var c=b.clone(),e;for(e in a)c[e]=a[e];return c}function T(a){if(null==a.pageX&&null!=a.clientX){var b=k.documentElement,c=k.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}C.set(a.pageX/m.WINDOW_WIDTH*2-1,2*-(a.pageY/m.WINDOW_HEIGHT)+1);v.setFromCamera(C,m.camera);return v.intersectObjects(fa)}function I(a,b){b&&
a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(P.width).floor().multiplyScalar(P.width).addScalar(P.width/2))}function z(a){0<a.length&&I(n,a[0])}function G(a,b,e,g){a=a||T(event);if(0<a.length){a=a[0];var d=O.toolsType,f=!1,k=fa.length;if(k&&a.object!==c)for(var l=k-1;0<l&&l>k-1-3;l--)if(a.object===fa[l]){f=!0;break}0===d?!0===f&&!1===b||!1===f&&!0===b||(b=H.draw(0,pa,void 0,a),g?ja.appendObjectToCurrentAction(b):ja.addAction("draw",b)):1===d&&e&&a.object!==c&&(b=H.erase(a.object),
g?ja.appendObjectToCurrentAction(b):ja.addAction("erase",b))}}function N(a){0===b&&(J.save(J.storageKeys.camera),J.save(J.storageKeys.sidebar),J.save())}function A(a){J.save(J.storageKeys.camera);J.save(J.storageKeys.sidebar);J.save();b=1}function E(a){a.preventDefault();var b;1===ra[0]?(b=T(a),G(b,a.ctrlKey,a.ctrlKey,!0)):(b=O.toolsType,1===b?n.visible&&(n.visible=!1):(!n.visible&&ca&&(n.visible=!0),b=T(a),z(b)))}function la(a){a.preventDefault();switch(a.button){case 0:if(!Z.endFlag){Z.instantComplete(Z.loadBoxAnimation);
break}ra[0]=1;a=T(a);G(a,void 0,!0,!1);0===O.toolsType&&z(a);break;case 1:ra[1]=1;break;case 2:ra[2]=1}}function U(h){if("label"===this.nodeName.toLowerCase())switch(h=this.getElementsByTagName("input")[0],O[h.name]=Number(h.value),h.name){case "toolsType":1===Number(h.value)?n.visible&&(n.visible=!1):!n.visible&&ca&&(n.visible=!0);break;case "textures":pa=O[h.name];ga=t[pa];va=ga.data;na=ga.helperData=t[O[h.name]].helperData||s(F,va);n.material=na;k.getElementById("cube").parentElement.click();switch(O.texturesType){case 0:a=
h.value;break;default:case 1:e=h.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===h.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":h=h.id,"imageTexture"===h?($(".btn-color").hide(),$(".btn-image").show(),k.getElementById("texture"+a).parentElement.click()):"colorTexture"===h&&($(".btn-color").show(),$(".btn-image").hide(),k.getElementById("texture"+e).parentElement.click())}else if("button"===this.type||"button"===
this.nodeName.toLowerCase())O[this.id]()}function ha(a){switch(a.button){case 0:ra[0]=0;break;case 1:ra[1]=0;break;case 2:ra[2]=0}}function S(a){}function da(a){if(!ra[0])switch(a.keyCode){case 16:0===O.toolsType?k.getElementById("eraser").parentElement.click():1===O.toolsType&&k.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&ja.undo();break;case 89:a.ctrlKey&&ja.redo()}}function ma(){requestAnimationFrame(ma);m.renderer.render(m.scene,m.camera)}var y=k.createElement("a");y.id=
"imageCapture";y.style.display="none";y.target="_blank";k.body.appendChild(y);var r=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};r.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=Z.currentMeshes;Z.currentIterator<a.length?a[Z.currentIterator].meshObject.visible=!0:(Z.endFlag=!0,clearInterval(Z.currentAnimationIntervalHandler));Z.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;
this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=Z.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var u=function(a){this.isLoadingBoxEnd=a};u.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return g.localStorage&&g.localStorage.getItem(a||
this.storageKeys.meshes)},save:function(b,c){if(g.localStorage){var d="";if(c)d=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>ja.currentActionIndex)return;for(var f=0,k=X.length;f<k;f++)d+=X[f].geo.id.replace("geo","")+",",d+=X[f].material.id.replace("texture","")+",",d+=X[f].meshObject.position.x+",",d+=X[f].meshObject.position.y+",",d+=X[f].meshObject.position.z+";";break;case this.storageKeys.camera:d+=m.controls.target.x+","+m.controls.target.y+
","+m.controls.target.z+";";d+=m.controls.object.position.x+","+m.controls.object.position.y+","+m.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=a+","+e+","+O.texturesType+","+O.sidebarResize}g.localStorage.setItem(b||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var d=[];(a=this.load(a))&&(d=a.split(";"));if(0<d.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=d.length;b<a;b++){var e=d[b].split(",");2<e.length&&H.draw(Number(e[0]),Number(e[1]),
[Number(e[2]),Number(e[3]),Number(e[4])])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=d.length;b<a;b++)e=d[b].split(","),2<e.length&&H.draw(Number(e[0]),Number(e[1]),[Number(e[2]),Number(e[3]),Number(e[4])],void 0,void 0,!0);Z.begin(c,X)}else Z.endFlag=!0},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:m.controls.target.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||
0);break;case 1:m.controls.object.position.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0)}}m.controls.update()}},loadSidebarSelectedButtons:function(b){var c=[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var d=c.length;b<d;b++){var f=c[b];if(""!==f&&NaN!==Number(f))switch(b){case 0:a=Number(f)||0;break;case 1:e=Number(f)||0;break;case 2:1===Number(f)?k.getElementById("colorTexture").parentElement.click():k.getElementById("imageTexture").parentElement.click();break;case 3:1===
Number(f)?k.getElementById("minSidebar").parentElement.click():k.getElementById("normalSidebar").parentElement.click()}}}else k.getElementById("imageTexture").parentElement.click()}};var l=function(){this.currentActionIndex=-1;this.actionArray=[]};l.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=H.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":H.draw(e.geo,
e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":H.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":H.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,
e.meshObject.position.z],void 0,e.meshObject);break;case "erase":H.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof
Array)for(var c=0,e=a.length;c<e;c++)b.meshes.push(a[c]);else b.meshes.push(a)},updateDom:function(){k.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;k.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var D=function(){};D.prototype={calculateIntersectResult:T,setMeshPositionToFitTheGrid:I,updateHelperCube:z,draw:function(a,b,c,e,d,f){if(void 0===a||"number"===typeof a)a=xa[a||0];if(void 0===b||"number"===typeof b)b=t[b||0];var g=a.data,k=
b.data;d=d||new w.Mesh(g,k);d.castShadow=!0;d.receiveShadow=!0;e?I(d,e):d.position.set(c[0],c[1],c[2]);!f||(d.visible=!1);m.scene.add(d);fa.push(d);X.push({meshObject:d,geo:a,material:b});return X[X.length-1]},erase:function(a){m.scene.remove(a);a=fa.indexOf(a);if(!(0>a)){fa.splice(a,1);var b=X[a-1];X.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};var P={width:50},ia={webgl:{ambientLightColor:2105376,directionalLightDensity:.4},canvas:{ambientLightColor:9474192,directionalLightDensity:.9}},
m,ea,c,b=0;p=u.prototype.LOAD_TYPE.async;var Y=new w.MeshLambertMaterial({color:592137}),F={opacity:.5,transparent:!0},t=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:Y,helperData:s(F,Y)}],xa=[{name:"default",type:"1",id:"geo0",data:new w.BoxGeometry(P.width,P.width,P.width)}];a=30;e=0;var ca=!0,O={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===O.toolsType||(n.visible=!n.visible);R.visible=!R.visible;ca=!ca},capture:function(){var a=m.renderer.domElement,
b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)?b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(g.navigator.saveBlob=g.navigator.saveBlob||g.navigator.msSaveBlob,a.msToBlob&&g.navigator.saveBlob?g.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):
(y.href=a.toDataURL(),y.download="capture.png",y.click())},clearAll:function(){Z.endFlag||Z.instantComplete(Z.loadBoxAnimation);if(!(1>X.length)){var a=H.erase(X[0].meshObject);ja.addAction("erase",a);for(var b=0,c=X.length;b<c;b++)a=H.erase(X[0].meshObject),ja.appendObjectToCurrentAction(a)}},undo:function(){ja.undo()},redo:function(){ja.redo()}},pa=0,ga=t[0],va=ga.data,na=ga.helperData,qa=xa[0].data,n,R,fa=[],X=[],ya,x,f,C,ra=[0,0,0],v,Z=new r,J=new u(!1),ja=new l,H=new D;m=new d(k.body);m.init(function(a){if(m.WINDOW_WIDTH!==
g.innerWidth||m.WINDOW_HEIGHT!==g.innerHeight)m.WINDOW_WIDTH=g.innerWidth,m.WINDOW_HEIGHT=g.innerHeight,m.WINDOW_HEIGHT_HALF=m.WINDOW_HEIGHT/2,m.WINDOW_WIDTH_HALF=m.WINDOW_WIDTH/2,m.camera.aspect=m.WINDOW_WIDTH/m.WINDOW_HEIGHT,m.camera.updateProjectionMatrix(),m.renderer.setSize(m.WINDOW_WIDTH,m.WINDOW_HEIGHT),k.body.height=m.WINDOW_HEIGHT},function(){R=new w.GridHelper(5E3,P.width);m.scene.add(R);ea=new w.PlaneBufferGeometry(1E4,1E4);ea.applyMatrix((new w.Matrix4).makeRotationX(-Math.PI/2));c=new w.Mesh(ea);
c.visible=!1;m.scene.add(c);fa.push(c);ya=new w.AmbientLight(ia[m.renderType].ambientLightColor);m.scene.add(ya);x=new w.DirectionalLight(15658734,ia[m.renderType].directionalLightDensity);x.position.set(0,6E3,5E3);x.target.position.set(0,0,0);x.castShadow=!0;x.shadowCameraNear=m.camera.near;x.shadowCameraFar=m.camera.far;x.shadowCameraFov=m.camera.fov;x.shadowBias=1E-6;x.shadowDarkness=.5;x.shadowMapWidth=1024;x.shadowMapHeight=1024;m.scene.add(x);f=new w.HemisphereLight(15658734,3158064,.95);m.scene.add(f);
n=new w.Mesh(qa,na);n.position.set(P.width/2,P.width/2,P.width/2);m.scene.add(n);new w.Mesh(qa,va);v=new w.Raycaster;C=new w.Vector2;m.renderer.setClearColor(15790320);m.renderer.shadowMapEnabled=!0;m.renderer.shadowMapType=w.PCFShadowMap;g.addEventListener("unload",N,!1);g.addEventListener("reload",A,!1);m.renderer.domElement.addEventListener("mousemove",E,!1);m.renderer.domElement.addEventListener("mousedown",la,!1);m.renderer.domElement.addEventListener("mouseup",ha,!1);k.addEventListener("keydown",
S,!1);k.addEventListener("keyup",da,!1);setInterval(N,12E4)});ma();u={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",
id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",
children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",
title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:t[0].type,bgTypeData:t[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>m.WINDOW_WIDTH){l=u.children;r=0;for(d=l.length;r<d;r++)if("sidebarResize"===l[r].id){r=l[r].buttons;l=0;for(d=r.length;l<d;l++)"normalSidebar"===r[l].id&&delete r[l].checked,"minSidebar"===r[l].id&&(r[l].checked=!0);break}O.sidebarResize=1}else O.sidebarResize=0;GoUI.Utils.domCreationDirector(u);
ja.updateDom();d=k.querySelectorAll(".btn");if(d instanceof Array||d.length)for(r=d.length-1;0<=r;r--)d[r].addEventListener("click",U,!1);else d instanceof object&&d.addEventListener("click",U,!1);l=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},
{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];r=0;for(d=l.length;r<d;r++)u={name:l[r].color,type:"color",id:"texture"+(r+1),uniqueData:l[r].color,data:new w.MeshLambertMaterial({color:l[r].color})},t.push(u),GoUI.map.buttonGroup2.addButton({title:"",id:u.id,bgType:u.type,bgTypeData:u.uniqueData,width:50,height:50}).addEventListener("click",
U,!1);l="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");w.ImageUtils.crossOrigin="Anonymous";r=0;for(d=l.length;r<d;r++)u={name:l[r].replace("texture/","").replace(".png",""),type:"image",id:"texture"+t.length,uniqueData:l[r],data:new w.MeshLambertMaterial({map:w.ImageUtils.loadTexture(l[r]),transparent:!0})},"glass"===u.data.name&&(u.data.map.opacity=.3),u.data.map.magFilter=w.NearestFilter,u.data.map.minFilter=
w.LinearMipMapLinearFilter,t.push(u),GoUI.map.buttonGroup2.addButton({title:"",id:u.id,bgType:u.type,bgTypeData:u.uniqueData,width:50,height:50}).addEventListener("click",U,!1);J.loadCamera(J.storageKeys.camera);J.loadSidebarSelectedButtons(J.storageKeys.sidebar);J.loadMeshes(void 0,p,Z.loadBoxAnimation)})(window,document,Base,THREE,Detector);
