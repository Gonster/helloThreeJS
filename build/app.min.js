THREE.SpriteCanvasMaterial=function(c){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(c,e){};this.setValues(c)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var c=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,c);c.color.copy(this.color);c.program=this.program;return c};
THREE.CanvasRenderer=function(c){function k(a,m,D,d){K(m);A(D);I(d);O(a.getStyle());b.stroke();ea.expandByScalar(2*m)}function e(a){H(a.getStyle());b.fill()}function E(a){l(a.target)}function l(a){if(!(a instanceof THREE.CompressedTexture)){var m=a.wrapS===THREE.RepeatWrapping,D=a.wrapT===THREE.RepeatWrapping,d=a.image,f=document.createElement("canvas");f.width=d.width;f.height=d.height;var e=f.getContext("2d");e.setTransform(1,0,0,-1,0,d.height);e.drawImage(d,0,0);U[a.id]=b.createPattern(f,!0===
m&&!0===D?"repeat":!0===m&&!1===D?"repeat-x":!1===m&&!0===D?"repeat-y":"no-repeat")}}function a(a,m,D,d,f,e,Y,p,h,c,R,G,g){if(!(g instanceof THREE.DataTexture)){!1===g.hasEventListener("update",E)&&(void 0!==g.image&&0<g.image.width&&l(g),g.addEventListener("update",E));var k=U[g.id];if(void 0!==k){H(k);var k=g.offset.x/g.repeat.x,n=g.offset.y/g.repeat.y,t=g.image.width*g.repeat.x;g=g.image.height*g.repeat.y;Y=(Y+k)*t;p=(p+n)*g;D-=a;d-=m;f-=a;e-=m;h=(h+k)*t-Y;c=(c+n)*g-p;R=(R+k)*t-Y;G=(G+n)*g-p;g=
h*G-R*c;0!==g&&(k=1/g,g=(G*D-c*f)*k,c=(G*d-c*e)*k,D=(h*f-R*D)*k,d=(h*e-R*d)*k,a=a-g*Y-D*p,m=m-c*Y-d*p,b.save(),b.transform(g,c,D,d,a,m),b.fill(),b.restore())}else H("rgba(0,0,0,1)"),b.fill()}}function g(a,m,D){var b=m.x-a.x,d=m.y-a.y,f=b*b+d*d;0!==f&&(D/=Math.sqrt(f),b*=D,d*=D,m.x+=b,m.y+=d,a.x-=b,a.y-=d)}function s(a){w!==a&&(w=b.globalAlpha=a)}function V(a){ra!==a&&(a===THREE.NormalBlending?b.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
a===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),ra=a)}function K(a){na!==a&&(na=b.lineWidth=a)}function A(a){sa!==a&&(sa=b.lineCap=a)}function I(a){N!==a&&(N=b.lineJoin=a)}function O(a){ba!==a&&(ba=b.strokeStyle=a)}function H(a){ca!==a&&(ca=b.fillStyle=a)}function B(a){ka.length!==a.length&&(b.setLineDash(a),ka=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var la=THREE.Math.smoothstep;c=c||{};var P=this,fa,Q,S,v=new THREE.Projector,x=void 0!==c.canvas?c.canvas:document.createElement("canvas"),
u=x.width,z=x.height,q=Math.floor(u/2),h=Math.floor(z/2),W=0,da=0,ga=u,ha=z,d=1,b=x.getContext("2d",{alpha:!0===c.alpha}),T=new THREE.Color(0),F=!0===c.alpha?0:1,w=1,ra=0,ba=null,ca=null,na=null,sa=null,N=null,ka=[],ia,n,R,X;new THREE.RenderableVertex;new THREE.RenderableVertex;var va,ta,y,f,t,ja,p=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var m=new THREE.Color,D=new THREE.Color,Y=new THREE.Color,U={},G,ya,za,Aa,Ba,Ca,Da,ma=new THREE.Box2,J=new THREE.Box2,ea=
new THREE.Box2,ua=new THREE.Color,xa=new THREE.Color,oa=new THREE.Color,pa=new THREE.Vector3,Ea=new THREE.Vector3,qa=new THREE.Vector3,wa=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=x;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return d};this.setPixelRatio=function(a){d=a};this.setSize=function(a,m,D){u=
a*d;z=m*d;x.width=u;x.height=z;q=Math.floor(u/2);h=Math.floor(z/2);!1!==D&&(x.style.width=a+"px",x.style.height=m+"px");ma.min.set(-q,-h);ma.max.set(q,h);J.min.set(-q,-h);J.max.set(q,h);w=1;ra=0;N=sa=na=ca=ba=null;this.setViewport(0,0,a,m)};this.setViewport=function(a,m,D,b){W=a*d;da=m*d;ga=D*d;ha=b*d};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,m){T.set(a);F=void 0!==m?m:1;J.min.set(-q,-h);J.max.set(q,h)};this.setClearColorHex=function(a,m){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,m)};this.getClearColor=function(){return T};this.getClearAlpha=function(){return F};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===J.empty()&&(J.intersect(ma),J.expandByScalar(2),J.min.x+=q,J.min.y=-J.min.y+h,J.max.x+=q,J.max.y=-J.max.y+h,1>F&&b.clearRect(J.min.x|0,J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0),0<F&&(V(THREE.NormalBlending),s(1),H("rgba("+Math.floor(255*T.r)+","+Math.floor(255*T.g)+","+Math.floor(255*T.b)+","+F+")"),b.fillRect(J.min.x|0,
J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0)),J.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(d,c){if(!1===c instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();P.info.render.vertices=0;P.info.render.faces=0;b.setTransform(ga/u,0,0,-ha/z,W,z-da);b.translate(q,h);fa=v.projectScene(d,c,this.sortObjects,this.sortElements);
Q=fa.elements;S=fa.lights;ia=c;wa.getNormalMatrix(c.matrixWorldInverse);ua.setRGB(0,0,0);xa.setRGB(0,0,0);oa.setRGB(0,0,0);for(var x=0,T=S.length;x<T;x++){var r=S[x],M=r.color;r instanceof THREE.AmbientLight?ua.add(M):r instanceof THREE.DirectionalLight?xa.add(M):r instanceof THREE.PointLight&&oa.add(M)}x=0;for(T=Q.length;x<T;x++){var C=Q[x],F=C.material;if(void 0!==F&&0!==F.opacity){ea.makeEmpty();if(C instanceof THREE.RenderableSprite){n=C;n.x*=q;n.y*=h;var r=n,L=C,M=F;s(M.opacity);V(M.blending);
var w=L.scale.x*q,L=L.scale.y*h,C=.5*Math.sqrt(w*w+L*L);ea.min.set(r.x-C,r.y-C);ea.max.set(r.x+C,r.y+C);if(M instanceof THREE.SpriteMaterial){var Z=M.map;if(null!==Z&&void 0!==Z.image){!1===Z.hasEventListener("update",E)&&(0<Z.image.width&&l(Z),Z.addEventListener("update",E));C=U[Z.id];void 0!==C?H(C):H("rgba( 0, 0, 0, 1 )");var aa=Z.image,C=aa.width*Z.offset.x,F=aa.height*Z.offset.y,N=aa.width*Z.repeat.x,Z=aa.height*Z.repeat.y,aa=w/N,ba=L/Z;b.save();b.translate(r.x,r.y);0!==M.rotation&&b.rotate(M.rotation);
b.translate(-w/2,-L/2);b.scale(aa,ba);b.translate(-C,-F);b.fillRect(C,F,N,Z)}else H(M.color.getStyle()),b.save(),b.translate(r.x,r.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(w,-L),b.fillRect(-.5,-.5,1,1);b.restore()}else M instanceof THREE.SpriteCanvasMaterial&&(O(M.color.getStyle()),H(M.color.getStyle()),b.save(),b.translate(r.x,r.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(w,L),M.program(b),b.restore())}else if(C instanceof THREE.RenderableLine){if(n=C.v1,R=C.v2,n.positionScreen.x*=q,n.positionScreen.y*=
h,R.positionScreen.x*=q,R.positionScreen.y*=h,ea.setFromPoints([n.positionScreen,R.positionScreen]),!0===ma.isIntersectionBox(ea))if(r=n,M=R,w=C,L=F,s(L.opacity),V(L.blending),b.beginPath(),b.moveTo(r.positionScreen.x,r.positionScreen.y),b.lineTo(M.positionScreen.x,M.positionScreen.y),L instanceof THREE.LineBasicMaterial){K(L.linewidth);A(L.linecap);I(L.linejoin);if(L.vertexColors!==THREE.VertexColors)O(L.color.getStyle());else if(C=w.vertexColors[0].getStyle(),w=w.vertexColors[1].getStyle(),C===
w)O(C);else{try{var ca=b.createLinearGradient(r.positionScreen.x,r.positionScreen.y,M.positionScreen.x,M.positionScreen.y);ca.addColorStop(0,C);ca.addColorStop(1,w)}catch(ka){ca=C}O(ca)}b.stroke();ea.expandByScalar(2*L.linewidth)}else L instanceof THREE.LineDashedMaterial&&(K(L.linewidth),A(L.linecap),I(L.linejoin),O(L.color.getStyle()),B([L.dashSize,L.gapSize]),b.stroke(),ea.expandByScalar(2*L.linewidth),B([]))}else if(C instanceof THREE.RenderableFace){n=C.v1;R=C.v2;X=C.v3;if(-1>n.positionScreen.z||
1<n.positionScreen.z)continue;if(-1>R.positionScreen.z||1<R.positionScreen.z)continue;if(-1>X.positionScreen.z||1<X.positionScreen.z)continue;n.positionScreen.x*=q;n.positionScreen.y*=h;R.positionScreen.x*=q;R.positionScreen.y*=h;X.positionScreen.x*=q;X.positionScreen.y*=h;0<F.overdraw&&(g(n.positionScreen,R.positionScreen,F.overdraw),g(R.positionScreen,X.positionScreen,F.overdraw),g(X.positionScreen,n.positionScreen,F.overdraw));ea.setFromPoints([n.positionScreen,R.positionScreen,X.positionScreen]);
if(!0===ma.isIntersectionBox(ea)){M=n;w=R;L=X;r=F;P.info.render.vertices+=3;P.info.render.faces++;s(r.opacity);V(r.blending);va=M.positionScreen.x;ta=M.positionScreen.y;y=w.positionScreen.x;f=w.positionScreen.y;t=L.positionScreen.x;ja=L.positionScreen.y;var F=va,N=ta,Z=y,aa=f,ba=t,na=ja;b.beginPath();b.moveTo(F,N);b.lineTo(Z,aa);b.lineTo(ba,na);b.closePath();if((r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&null===r.map){m.copy(r.color);D.copy(r.emissive);r.vertexColors===
THREE.FaceColors&&m.multiply(C.color);p.copy(ua);Ea.copy(M.positionWorld).add(w.positionWorld).add(L.positionWorld).divideScalar(3);M=Ea;w=C.normalModel;L=p;C=0;for(F=S.length;C<F;C++)N=S[C],Y.copy(N.color),N instanceof THREE.DirectionalLight?(Z=pa.setFromMatrixPosition(N.matrixWorld).normalize(),aa=w.dot(Z),0>=aa||(aa*=N.intensity,L.add(Y.multiplyScalar(aa)))):N instanceof THREE.PointLight&&(Z=pa.setFromMatrixPosition(N.matrixWorld),aa=w.dot(pa.subVectors(Z,M).normalize()),0>=aa||(aa*=0==N.distance?
1:1-Math.min(M.distanceTo(Z)/N.distance,1),0!=aa&&(aa*=N.intensity,L.add(Y.multiplyScalar(aa)))));p.multiply(m).add(D);!0===r.wireframe?k(p,r.wireframeLinewidth,r.wireframeLinecap,r.wireframeLinejoin):e(p)}else r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial?null!==r.map?r.map.mapping===THREE.UVMapping&&(G=C.uvs,a(va,ta,y,f,t,ja,G[0].x,G[0].y,G[1].x,G[1].y,G[2].x,G[2].y,r.map)):null!==r.envMap?r.envMap.mapping===THREE.SphericalReflectionMapping&&
(qa.copy(C.vertexNormalsModel[0]).applyMatrix3(wa),ya=.5*qa.x+.5,za=.5*qa.y+.5,qa.copy(C.vertexNormalsModel[1]).applyMatrix3(wa),Aa=.5*qa.x+.5,Ba=.5*qa.y+.5,qa.copy(C.vertexNormalsModel[2]).applyMatrix3(wa),Ca=.5*qa.x+.5,Da=.5*qa.y+.5,a(va,ta,y,f,t,ja,ya,za,Aa,Ba,Ca,Da,r.envMap)):(p.copy(r.color),r.vertexColors===THREE.FaceColors&&p.multiply(C.color),!0===r.wireframe?k(p,r.wireframeLinewidth,r.wireframeLinecap,r.wireframeLinejoin):e(p)):(r instanceof THREE.MeshDepthMaterial?p.r=p.g=p.b=1-la(M.positionScreen.z*
M.positionScreen.w,ia.near,ia.far):r instanceof THREE.MeshNormalMaterial?(qa.copy(C.normalModel).applyMatrix3(wa),p.setRGB(qa.x,qa.y,qa.z).multiplyScalar(.5).addScalar(.5)):p.setRGB(1,1,1),!0===r.wireframe?k(p,r.wireframeLinewidth,r.wireframeLinecap,r.wireframeLinejoin):e(p))}}J.union(ea)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(c){this.positionWorld.copy(c.positionWorld);this.positionScreen.copy(c.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function c(){if(I===H){var a=new THREE.RenderableVertex;O.push(a);H++;I++;return a}return O[I++]}function k(){if(la===fa){var a=new THREE.RenderableFace;P.push(a);fa++;la++;return a}return P[la++]}function e(){if(S===x){var a=new THREE.RenderableLine;v.push(a);x++;S++;return a}return v[S++]}function E(){if(z===h){var a=new THREE.RenderableSprite;q.push(a);h++;z++;return a}return q[z++]}function l(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function a(a,b){var d=
0,e=1,g=a.z+a.w,f=b.z+b.w,c=-a.z+a.w,h=-b.z+b.w;if(0<=g&&0<=f&&0<=c&&0<=h)return!0;if(0>g&&0>f||0>c&&0>h)return!1;0>g?d=Math.max(d,g/(g-f)):0>f&&(e=Math.min(e,g/(g-f)));0>c?d=Math.max(d,c/(c-h)):0>h&&(e=Math.min(e,c/(c-h)));if(e<d)return!1;a.lerp(b,d);b.lerp(a,1-e);return!0}var g,s,V=[],K=0,A,I,O=[],H=0,B,la,P=[],fa=0,Q,S,v=[],x=0,u,z,q=[],h=0,W={objects:[],lights:[],elements:[]},da=new THREE.Vector3,ga=new THREE.Vector3,ha=new THREE.Vector3,d=new THREE.Vector3,b=new THREE.Vector4,T=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),F=new THREE.Box3,w=Array(3),ra=new THREE.Matrix4,ba=new THREE.Matrix4,ca,na=new THREE.Matrix4,sa=new THREE.Matrix3,N=new THREE.Frustum,ka=new THREE.Vector4,ia=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var n=new function(){var a=[],b=[],d=null,g=null,h=new THREE.Matrix3,f=function(a){var m=a.positionWorld,b=a.positionScreen;m.copy(a.position).applyMatrix4(ca);b.copy(m).applyMatrix4(ba);m=1/b.w;b.x*=m;b.y*=m;b.z*=m;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},l=function(a,m,b){if(!0===a.visible||!0===m.visible||!0===b.visible)return!0;w[0]=a.positionScreen;w[1]=m.positionScreen;w[2]=b.positionScreen;return T.isIntersectionBox(F.setFromPoints(w))},n=function(a,m,b){return 0>(b.positionScreen.x-
a.positionScreen.x)*(m.positionScreen.y-a.positionScreen.y)-(b.positionScreen.y-a.positionScreen.y)*(m.positionScreen.x-a.positionScreen.x)};return{setObject:function(f){d=f;g=d.material;h.getNormalMatrix(d.matrixWorld);a.length=0;b.length=0},projectVertex:f,checkTriangleVisibility:l,checkBackfaceCulling:n,pushVertex:function(a,m,b){A=c();A.position.set(a,m,b);f(A)},pushNormal:function(b,m,d){a.push(b,m,d)},pushUv:function(a,m){b.push(a,m)},pushLine:function(a,m){var b=O[a],f=O[m];Q=e();Q.id=d.id;
Q.v1.copy(b);Q.v2.copy(f);Q.z=(b.positionScreen.z+f.positionScreen.z)/2;Q.material=d.material;W.elements.push(Q)},pushTriangle:function(f,m,D){var e=O[f],c=O[m],G=O[D];if(!1!==l(e,c,G)&&(g.side===THREE.DoubleSide||!0===n(e,c,G))){B=k();B.id=d.id;B.v1.copy(e);B.v2.copy(c);B.v3.copy(G);B.z=(e.positionScreen.z+c.positionScreen.z+G.positionScreen.z)/3;for(e=0;3>e;e++)c=3*arguments[e],G=B.vertexNormalsModel[e],G.set(a[c],a[c+1],a[c+2]),G.applyMatrix3(h).normalize(),c=2*arguments[e],B.uvs[e].set(b[c],b[c+
1]);B.vertexNormalsLength=3;B.material=d.material;W.elements.push(B)}}}};this.projectScene=function(h,F,v,x){z=S=la=0;W.elements.length=0;!0===h.autoUpdate&&h.updateMatrixWorld();void 0===F.parent&&F.updateMatrixWorld();ra.copy(F.matrixWorldInverse.getInverse(F.matrixWorld));ba.multiplyMatrices(F.projectionMatrix,ra);N.setFromMatrix(ba);s=0;W.objects.length=0;W.lights.length=0;h.traverseVisible(function(a){if(a instanceof THREE.Light)W.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===N.intersectsObject(a))){if(s===K){var m=new THREE.RenderableObject;V.push(m);K++;s++;g=m}else g=V[s++];g.id=a.id;g.object=a;d.setFromMatrixPosition(a.matrixWorld);d.applyProjection(ba);g.z=d.z;W.objects.push(g)}});!0===v&&W.objects.sort(l);h=0;for(v=W.objects.length;h<v;h++){var y=W.objects[h].object,f=y.geometry;n.setObject(y);ca=y.matrixWorld;I=0;if(y instanceof THREE.Mesh)if(f instanceof THREE.BufferGeometry){var t=
f.attributes,y=f.offsets;if(void 0!==t.position){for(var q=t.position.array,f=0,p=q.length;f<p;f+=3)n.pushVertex(q[f],q[f+1],q[f+2]);if(void 0!==t.normal)for(var m=t.normal.array,f=0,p=m.length;f<p;f+=3)n.pushNormal(m[f],m[f+1],m[f+2]);if(void 0!==t.uv)for(m=t.uv.array,f=0,p=m.length;f<p;f+=2)n.pushUv(m[f],m[f+1]);if(void 0!==t.index)if(t=t.index.array,0<y.length)for(h=0;h<y.length;h++)for(p=y[h],q=p.index,f=p.start,p=p.start+p.count;f<p;f+=3)n.pushTriangle(t[f]+q,t[f+1]+q,t[f+2]+q);else for(f=0,
p=t.length;f<p;f+=3)n.pushTriangle(t[f],t[f+1],t[f+2]);else for(f=0,p=q.length/3;f<p;f+=3)n.pushTriangle(f,f+1,f+2)}}else{if(f instanceof THREE.Geometry){var D=f.vertices,p=f.faces,t=f.faceVertexUvs[0];sa.getNormalMatrix(ca);for(var q=y.material instanceof THREE.MeshFaceMaterial,m=!0===q?y.material:null,Y=0,U=D.length;Y<U;Y++){var G=D[Y];n.pushVertex(G.x,G.y,G.z)}D=0;for(Y=p.length;D<Y;D++){var U=p[D],w=!0===q?m.materials[U.materialIndex]:y.material;if(void 0!==w){var T=w.side,G=O[U.a],A=O[U.b],H=
O[U.c];if(!0===w.morphTargets){var P=f.morphTargets,fa=y.morphTargetInfluences,ma=G.position,J=A.position,ea=H.position;da.set(0,0,0);ga.set(0,0,0);ha.set(0,0,0);for(var ua=0,xa=P.length;ua<xa;ua++){var oa=fa[ua];if(0!==oa){var pa=P[ua].vertices;da.x+=(pa[U.a].x-ma.x)*oa;da.y+=(pa[U.a].y-ma.y)*oa;da.z+=(pa[U.a].z-ma.z)*oa;ga.x+=(pa[U.b].x-J.x)*oa;ga.y+=(pa[U.b].y-J.y)*oa;ga.z+=(pa[U.b].z-J.z)*oa;ha.x+=(pa[U.c].x-ea.x)*oa;ha.y+=(pa[U.c].y-ea.y)*oa;ha.z+=(pa[U.c].z-ea.z)*oa}}G.position.add(da);A.position.add(ga);
H.position.add(ha);n.projectVertex(G);n.projectVertex(A);n.projectVertex(H)}if(!1!==n.checkTriangleVisibility(G,A,H)){P=n.checkBackfaceCulling(G,A,H);if(T!==THREE.DoubleSide){if(T===THREE.FrontSide&&!1===P)continue;if(T===THREE.BackSide&&!0===P)continue}B=k();B.id=y.id;B.v1.copy(G);B.v2.copy(A);B.v3.copy(H);B.normalModel.copy(U.normal);!1!==P||T!==THREE.BackSide&&T!==THREE.DoubleSide||B.normalModel.negate();B.normalModel.applyMatrix3(sa).normalize();fa=U.vertexNormals;ma=0;for(J=Math.min(fa.length,
3);ma<J;ma++)ea=B.vertexNormalsModel[ma],ea.copy(fa[ma]),!1!==P||T!==THREE.BackSide&&T!==THREE.DoubleSide||ea.negate(),ea.applyMatrix3(sa).normalize();B.vertexNormalsLength=fa.length;T=t[D];if(void 0!==T)for(P=0;3>P;P++)B.uvs[P].copy(T[P]);B.color=U.color;B.material=w;B.z=(G.positionScreen.z+A.positionScreen.z+H.positionScreen.z)/3;W.elements.push(B)}}}}}else if(y instanceof THREE.Line)if(f instanceof THREE.BufferGeometry){if(t=f.attributes,void 0!==t.position){q=t.position.array;f=0;for(p=q.length;f<
p;f+=3)n.pushVertex(q[f],q[f+1],q[f+2]);if(void 0!==t.index)for(t=t.index.array,f=0,p=t.length;f<p;f+=2)n.pushLine(t[f],t[f+1]);else for(t=y.mode===THREE.LinePieces?2:1,f=0,p=q.length/3-1;f<p;f+=t)n.pushLine(f,f+1)}}else{if(f instanceof THREE.Geometry&&(na.multiplyMatrices(ba,ca),D=y.geometry.vertices,0!==D.length))for(G=c(),G.positionScreen.copy(D[0]).applyMatrix4(na),t=y.mode===THREE.LinePieces?2:1,Y=1,U=D.length;Y<U;Y++)G=c(),G.positionScreen.copy(D[Y]).applyMatrix4(na),0<(Y+1)%t||(A=O[I-2],ka.copy(G.positionScreen),
ia.copy(A.positionScreen),!0===a(ka,ia)&&(ka.multiplyScalar(1/ka.w),ia.multiplyScalar(1/ia.w),Q=e(),Q.id=y.id,Q.v1.positionScreen.copy(ka),Q.v2.positionScreen.copy(ia),Q.z=Math.max(ka.z,ia.z),Q.material=y.material,y.material.vertexColors===THREE.VertexColors&&(Q.vertexColors[0].copy(y.geometry.colors[Y]),Q.vertexColors[1].copy(y.geometry.colors[Y-1])),W.elements.push(Q)))}else y instanceof THREE.Sprite&&(b.set(ca.elements[12],ca.elements[13],ca.elements[14],1),b.applyMatrix4(ba),f=1/b.w,b.z*=f,-1<=
b.z&&1>=b.z&&(u=E(),u.id=y.id,u.x=b.x*f,u.y=b.y*f,u.z=b.z,u.object=y,u.rotation=y.rotation,u.scale.x=y.scale.x*Math.abs(u.x-(b.x+F.projectionMatrix.elements[0])/(b.w+F.projectionMatrix.elements[12])),u.scale.y=y.scale.y*Math.abs(u.y-(b.y+F.projectionMatrix.elements[5])/(b.w+F.projectionMatrix.elements[13])),u.material=y.material,W.elements.push(u)))}!0===x&&W.elements.sort(l);return W}};
THREE.OrbitControls=function(c,k){function e(d){if(!1!==a.enabled){d.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(q===z.ROTATE){if(!0===a.noRotate)return;s.set(d.clientX,d.clientY);V.subVectors(s,g);a.rotateLeft(2*Math.PI*V.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*V.y/b.clientHeight*a.rotateSpeed);g.copy(s)}else if(q===z.DOLLY){if(!0===a.noZoom)return;la.set(d.clientX,d.clientY);P.subVectors(la,B);0<P.y?a.dollyIn():a.dollyOut();B.copy(la)}else if(q===
z.PAN){if(!0===a.noPan)return;A.set(d.clientX,d.clientY);I.subVectors(A,K);a.pan(I.x,I.y);K.copy(A)}a.update()}}function E(){!1!==a.enabled&&(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",E,!1),a.dispatchEvent(ha),q=z.NONE)}function l(d){if(!1!==a.enabled&&!0!==a.noZoom){d.preventDefault();d.stopPropagation();var b=0;void 0!==d.wheelDelta?b=d.wheelDelta:void 0!==d.detail&&(b=-d.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(ga);a.dispatchEvent(ha)}}
this.object=c;this.domElement=void 0!==k?k:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,g=new THREE.Vector2,s=new THREE.Vector2,V=new THREE.Vector2,K=new THREE.Vector2,A=new THREE.Vector2,I=new THREE.Vector2,O=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Vector2,la=new THREE.Vector2,P=new THREE.Vector2,fa=0,Q=0,S=1,v=new THREE.Vector3,x=new THREE.Vector3,u=new THREE.Quaternion,z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},q=z.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var h=(new THREE.Quaternion).setFromUnitVectors(c.up,new THREE.Vector3(0,1,0)),W=h.clone().inverse(),da={type:"change"},ga={type:"start"},ha={type:"end"};this.rotateLeft=function(d){void 0===d&&(d=2*Math.PI/60/60*a.autoRotateSpeed);Q-=d};this.rotateUp=function(d){void 0===d&&(d=2*Math.PI/60/60*a.autoRotateSpeed);fa-=d};this.panLeft=function(a){var b=this.object.matrix.elements;O.set(b[0],b[1],b[2]);O.multiplyScalar(-a);v.add(O)};this.panUp=function(a){var b=this.object.matrix.elements;O.set(b[4],
b[5],b[6]);O.multiplyScalar(a);v.add(O)};this.panForward=function(a){var b=this.object.matrix.elements;O.set(b[8],b[9],b[10]);O.multiplyScalar(a);v.add(O)};this.pan=function(d,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var c=a.object.position.clone().sub(a.target).length(),c=c*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*d*c/e.clientHeight);a.panUp(2*b*c/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(d*(a.object.right-a.object.left)/e.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(d,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var c=a.object.position.clone().sub(a.target).length(),c=c*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*d*c/e.clientHeight);a.panForward(2*b*c/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(d*(a.object.right-a.object.left)/e.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(d){void 0===d&&(d=Math.pow(.95,a.zoomSpeed));S/=d};this.dollyOut=function(d){void 0===d&&(d=Math.pow(.95,a.zoomSpeed));S*=d};this.update=function(){var d=this.object.position;H.copy(d).sub(this.target);H.applyQuaternion(h);var b=Math.atan2(H.x,H.z),e=Math.atan2(Math.sqrt(H.x*H.x+H.z*H.z),H.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+Q,e=e+fa,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),c=H.length()*S,c=Math.max(this.minDistance,Math.min(this.maxDistance,c));this.target.add(v);H.x=c*Math.sin(e)*Math.sin(b);H.y=c*Math.cos(e);H.z=c*Math.sin(e)*Math.cos(b);H.applyQuaternion(W);d.copy(this.target).add(H);this.object.lookAt(this.target);fa=Q=0;S=1;v.set(0,0,0);if(1E-6<
x.distanceToSquared(this.object.position)||1E-6<8*(1-u.dot(this.object.quaternion)))this.dispatchEvent(da),x.copy(this.object.position),u.copy(this.object.quaternion)};this.reset=function(){q=z.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(d){if(!1!==a.enabled){d.preventDefault();if(d.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;q=z.ROTATE;g.set(d.clientX,d.clientY)}else if(d.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;q=z.DOLLY;B.set(d.clientX,d.clientY)}else if(d.button===a.mouseButtons.PAN){if(!0===a.noPan)return;q=z.PAN;K.set(d.clientX,d.clientY)}document.addEventListener("mousemove",e,!1);document.addEventListener("mouseup",E,!1);a.dispatchEvent(ga)}},!1);this.domElement.addEventListener("mousewheel",l,!1);this.domElement.addEventListener("DOMMouseScroll",l,!1);this.domElement.addEventListener("touchstart",
function(d){if(!1!==a.enabled){switch(d.touches.length){case 1:if(!0===a.noRotate)return;q=z.TOUCH_ROTATE;g.set(d.touches[0].pageX,d.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;q=z.TOUCH_DOLLY;var b=d.touches[0].pageX-d.touches[1].pageX;d=d.touches[0].pageY-d.touches[1].pageY;b=Math.sqrt(b*b+d*d);B.set(0,b);break;case 3:if(!0===a.noPan)return;q=z.TOUCH_PAN;K.set(d.touches[0].pageX,d.touches[0].pageY);break;default:q=z.NONE}a.dispatchEvent(ga)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(ha),q=z.NONE)},!1);this.domElement.addEventListener("touchmove",function(d){if(!1!==a.enabled){d.preventDefault();d.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(d.touches.length){case 1:if(!0===a.noRotate)break;if(q!==z.TOUCH_ROTATE)break;s.set(d.touches[0].pageX,d.touches[0].pageY);V.subVectors(s,g);a.rotateLeft(2*Math.PI*V.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*V.y/b.clientHeight*a.rotateSpeed);g.copy(s);
a.update();break;case 2:if(!0===a.noZoom)break;if(q!==z.TOUCH_DOLLY)break;b=d.touches[0].pageX-d.touches[1].pageX;d=d.touches[0].pageY-d.touches[1].pageY;d=Math.sqrt(b*b+d*d);la.set(0,d);P.subVectors(la,B);0<P.y?a.dollyOut():a.dollyIn();B.copy(la);a.update();break;case 3:if(!0===a.noPan)break;if(q!==z.TOUCH_PAN)break;A.set(d.touches[0].pageX,d.touches[0].pageY);I.subVectors(A,K);a.pan(I.x,I.y);K.copy(A);a.update();break;default:q=z.NONE}}},!1);window.addEventListener("keydown",function(d){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(d.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var c=document.createElement("canvas");return!(!window.WebGLRenderingContext||!c.getContext("webgl")&&!c.getContext("experimental-webgl"))}catch(k){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var c=document.createElement("div");c.id="webgl-error-message";c.style.fontFamily="monospace";c.style.fontSize="13px";c.style.fontWeight="normal";
c.style.textAlign="center";c.style.background="#fff";c.style.color="#000";c.style.padding="1.5em";c.style.width="400px";c.style.margin="5em auto 0";this.webgl||(c.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return c},addGetWebGLMessage:function(c){var k,e;c=c||{};k=void 0!==c.parent?c.parent:document.body;c=void 0!==c.id?c.id:"oldie";e=Detector.getWebGLErrorMessage();e.id=c;k.appendChild(e)}};"object"===typeof module&&(module.exports=Detector);
(function(c,k,e,E){var l=function(a){this.domParent="object"===typeof a?a:k.body};l.prototype.init=function(a,g,l,V,K,A){c.requestAnimationFrame||(c.requestAnimationFrame=function(){return c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame||c.oRequestAnimationFrame||c.msRequestAnimationFrame||function(a,e){c.setTimeout(a,1E3/60)}}());this.domParent===k.body&&(this.WINDOW_WIDTH=c.innerWidth,this.WINDOW_HEIGHT=c.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,c.addEventListener("resize",a,!1));this.renderType=E.webgl?"webgl":"canvas";this.renderer=l||(E.webgl?new e.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new e.CanvasRenderer({antialias:!0,preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=V||new e.Scene;this.camera=K||new e.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,
500,1E3);this.camera.lookAt(this.scene.position);A?this.controls=A:(this.controls=new e.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT});g()};c.Base=l;"object"===typeof module&&(module.exports=l)})(window,document,THREE,Detector);
(function(){function c(e){return e.charAt(0).toUpperCase()+e.slice(1)}var k={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(e){var c=0;for(e=e.length;c<e;c++);};k.map={};k.Sidebar=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({align:"r",width:320},e),a="sidebar",a=l.align&&"r"!==l.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;l.id&&(this.domElement.id=l.id,k.map[l.id]=this);
this.domElement.style.width=l.width.toString()+"px";l.overflow&&(this.domElement.style.overflow=l.overflow.toString());c.appendChild(this.domElement);k.Utils.domCreationDirector(l.children,this.domElement)};k.Sidebar.prototype=Object.create(_Container.prototype);k.Panel=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({title:""},e);l.id&&(this.domElement.id=l.id,k.map[l.id]=this);var a=this.domElement;a.className="panel panel-tool";c.appendChild(a);var g=document.createElement("div");
g.className="panel-heading";a.appendChild(g);var s=document.createTextNode(l.title);g.appendChild(s);g=document.createElement("div");g.className="panel-body";l.overflow&&(g.style.overflow=l.overflow.toString());a.appendChild(g);k.Utils.domCreationDirector(l.children,g)};k.Panel.prototype=Object.create(_Container.prototype);k.Toolbar=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({title:""},e);l.id&&(this.domElement.id=l.id,k.map[l.id]=this);var a=this.domElement;a.className=
"btn-toolbar";c.appendChild(a);k.Utils.domCreationDirector(l.children,a)};k.Toolbar.prototype=Object.create(_Container.prototype);k.ButtonGroup=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({title:"",buttonType:"radio"},e);l.id&&(this.domElement.id=l.id,k.map[l.id]=this);var a=this.domElement;a.className="btn-group"+(l.appendClass?" "+l.appendClass:"");"button"!==l.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=l.title;c.appendChild(a);var g=
l.buttons;switch(l.buttonType.toLowerCase()){default:case "radio":for(var s=0,V=g.length;s<V;s++){var K=document.createElement("label");K.className="btn btn-tool"+(g[s].checked?" active":"");g[s].height&&(K.style.height=g[s].height+"px");g[s].width&&(K.style.width=g[s].width+"px");if(g[s].bgType&&g[s].bgTypeData){var A;switch(g[s].bgType){case "color":A=g[s].bgTypeData;K.className+=" btn-color";break;case "image":A="url("+g[s].bgTypeData+") no-repeat 50% 50%";K.className+=" btn-image";break;default:return}K.style.background=
A}a.appendChild(K);var I=document.createElement("input");g[s].checked&&I.setAttribute("checked","");I.type=l.buttonType;I.name=l.name;I.id=g[s].id;I.value=s;I.autocomplete="off";K.appendChild(I);A=document.createTextNode(g[s].title);K.appendChild(A)}break;case "button":for(s=0,V=g.length;s<V;s++){I=document.createElement("button");I.className="btn btn-tool";I.id=g[s].id;I.name=l.name;g[s].height&&(I.style.height=g[s].height+"px");g[s].width&&(I.style.width=g[s].width+"px");if(g[s].bgType&&g[s].bgTypeData){switch(g[s].bgType){case "color":A=
g[s].bgTypeData;K.className+=" btn-color";break;case "image":A="url("+g[s].bgTypeData+") no-repeat 50% 50%";K.className+=" btn-image";break;default:return}I.style.background=A}a.appendChild(I);A=document.createTextNode(g[s].title);I.appendChild(A)}}k.Utils.domCreationDirector(l.children,this.domElement)};k.ButtonGroup.prototype=Object.create(_Container.prototype);k.ButtonGroup.prototype.addButton=function(c,k){k||this.setting.buttons.push(c);var l=document.createElement("label");l.className="btn btn-tool"+
(c.checked?" active":"");c.height&&(l.style.height=c.height+"px");c.width&&(l.style.width=c.width+"px");if(c.bgType&&c.bgTypeData){var a;switch(c.bgType){case "color":a=c.bgTypeData;l.className+=" btn-color";break;case "image":a="url("+c.bgTypeData+") no-repeat 50% 50%";l.className+=" btn-image";break;default:return}l.style.background=a}this.domElement.appendChild(l);a=document.createElement("input");c.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
c.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";l.appendChild(a);a=document.createTextNode(c.title);l.appendChild(a);return l};k.ButtonGroup.prototype.addButtons=function(c,k){for(var l=0,a=c.length;l<a;l++)this.addButton(c[l],k)};k.Utils={};k.Utils.settingMixin=function(c,k){if("object"===typeof c&&"object"===typeof k){var l={},a;for(a in c)l[a]=c[a];for(var g in k)void 0!==k[g]&&(l[g]=k[g]);return l}return c};k.Utils.domCreationDirector=function(e,E){if(e)if(e instanceof Array)for(var l=
0,a=e.length;l<a;l++)k.Utils.domCreationDirector(e[l],E?E:document.body);else e instanceof Object&&e.UIType&&k[c(e.UIType)]&&new (k[c(e.UIType)])(e,E?E:document.body)};window.GoUI=k;"object"===typeof module&&(module.exports=k)})();
(function(c,k,e,E,l){function a(a,b){var c=b.clone(),d;for(d in a)c[d]=a[d];return c}function g(a){if(null==a.pageX&&null!=a.clientX){var b=k.documentElement,c=k.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}ta.set(a.pageX/h.WINDOW_WIDTH*2-1,2*-(a.pageY/h.WINDOW_HEIGHT)+1);f.setFromCamera(ta,h.camera);return f.intersectObjects(ia)}function s(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),
a.position.divideScalar(z.width).floor().multiplyScalar(z.width).addScalar(z.width/2))}function V(a){0<a.length&&s(N,a[0])}function K(a,b,c,d){a=a||g(event);if(0<a.length){a=a[0];var f=w.toolsType,e=!1,h=ia.length;if(h&&a.object!==da)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===ia[k]){e=!0;break}0===f?!0===e&&!1===b||!1===e&&!0===b||(b=p.draw(0,ra,void 0,a),d?ja.appendObjectToCurrentAction(b):ja.addAction("draw",b)):1===f&&c&&a.object!==da&&(b=p.erase(a.object),d?ja.appendObjectToCurrentAction(b):
ja.addAction("erase",b))}}function A(a){0===ga&&(t.save(t.storageKeys.camera),t.save())}function I(a){t.save(t.storageKeys.camera);t.save();ga=1}function O(a){a.preventDefault();var b;1===y[0]?(b=g(a),K(b,a.ctrlKey,a.ctrlKey,!0)):(b=w.toolsType,1===b?N.visible&&(N.visible=!1):(!N.visible&&F&&(N.visible=!0),b=g(a),V(b)))}function H(a){a.preventDefault();switch(a.button){case 0:y[0]=1;a=g(a);K(a,void 0,!0,!1);0===w.toolsType&&V(a);break;case 1:y[1]=1;break;case 2:y[2]=1}}function B(c){if("label"===
this.nodeName.toLowerCase())switch(c=this.getElementsByTagName("input")[0],w[c.name]=Number(c.value),c.name){case "textures":ra=w[c.name];ba=b[ra];ca=ba.data;na=ba.helperData=b[w[c.name]].helperData||a(d,ca);N.material=na;break;case "sidebarResize":var e=GoUI.map.sidebar.domElement;"0"===c.value?$(e).animate({top:"0",height:"100%"}):$(e).animate({top:"60%",height:"40%"});break;case "texturesType":c=c.id,"imageTexture"===c?($(".btn-color").hide(),$(".btn-image").show()):"colorTexture"===c&&($(".btn-color").show(),
$(".btn-image").hide())}else if("button"===this.type||"button"===this.nodeName.toLowerCase())w[this.id]()}function la(a){switch(a.button){case 0:y[0]=0;break;case 1:y[1]=0;break;case 2:y[2]=0}}function P(a){}function fa(a){if(!y[0])switch(a.keyCode){case 16:0===w.toolsType?k.getElementById("eraser").parentElement.click():1===w.toolsType&&k.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&ja.undo();break;case 89:a.ctrlKey&&ja.redo()}}function Q(){requestAnimationFrame(Q);h.renderer.render(h.scene,
h.camera)}var S=k.createElement("a");S.id="imageCapture";S.style.display="none";S.target="_blank";k.body.appendChild(S);var v=function(){};v.prototype={LOAD_TYPE:{async:0,sync:1},asyncLoadDefaultInterval:0,storageKeys:{meshes:"vp_meshs",camera:"vp_camera"},load:function(a){return c.localStorage&&c.localStorage.getItem(a||this.storageKeys.meshes)},save:function(a,b){if(c.localStorage){var d="";if(b)d=b;else switch(a){default:case this.storageKeys.meshes:case void 0:for(var e=0,f=n.length;e<f;e++)d+=
n[e].geo.id.replace("geo","")+",",d+=n[e].material.id.replace("texture","")+",",d+=n[e].meshObject.position.x+",",d+=n[e].meshObject.position.y+",",d+=n[e].meshObject.position.z+";";break;case this.storageKeys.camera:d+=h.controls.target.x+","+h.controls.target.y+","+h.controls.target.z+";",d+=h.controls.object.position.x+","+h.controls.object.position.y+","+h.controls.object.position.z+";"}c.localStorage.setItem(a||this.storageKeys.meshes,d)}},loadMeshes:function(a,b){var c=0,d=[],e,f=this.load(a);
f&&(d=f.split(";"));if(0<d.length)switch(b){case this.LOAD_TYPE.sync:for(var f=0,h=d.length;f<h;f++){var g=d[f].split(",");2<g.length&&p.draw(Number(g[0]),Number(g[1]),[Number(g[2]),Number(g[3]),Number(g[4])])}break;default:case this.LOAD_TYPE.async:e=setInterval(function(){if(c<d.length){var a=d[c].split(",");2<a.length&&p.draw(Number(a[0]),Number(a[1]),[Number(a[2]),Number(a[3]),Number(a[4])]);c++}else clearInterval(e)},this.asyncLoadDefaultInterval)}},loadCamera:function(a){var b=[];(a=this.load(a))&&
(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:h.controls.target.set(Number(d[0]),Number(d[1]),Number(d[2]));break;case 1:h.controls.object.position.set(Number(d[0]),Number(d[1]),Number(d[2]))}}h.controls.update()}}};var x=function(){this.currentActionIndex=-1;this.actionArray=[]};x.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=p.reverseOperationMap[a.type];a=a.meshes;a instanceof
Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":p.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":p.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=
a[c];if(e)switch(b){case "draw":p.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":p.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];
if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,d=a.length;c<d;c++)b.meshes.push(a[c]);else b.meshes.push(a)},updateDom:function(){k.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;k.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var u=function(){};u.prototype={calculateIntersectResult:g,setMeshPositionToFitTheGrid:s,updateHelperCube:V,draw:function(a,c,d,e,f){if(void 0===
a||"number"===typeof a)a=T[a||0];if(void 0===c||"number"===typeof c)c=b[c||0];var g=a.data,k=c.data;f=f||new E.Mesh(g,k);f.castShadow=!0;f.receiveShadow=!0;e?s(f,e):f.position.set(d[0],d[1],d[2]);h.scene.add(f);ia.push(f);n.push({meshObject:f,geo:a,material:c});return n[n.length-1]},erase:function(a){h.scene.remove(a);a=ia.indexOf(a);if(!(0>a)){ia.splice(a,1);var b=n[a-1];n.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};var z={width:50},q={webgl:{ambientLightColor:2105376,
directionalLightDensity:.4},canvas:{ambientLightColor:9474192,directionalLightDensity:.9}},h,W,da,ga=0;l=v.prototype.LOAD_TYPE.async;var ha=new E.MeshLambertMaterial({color:592137}),d={opacity:.5,transparent:!0},b=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:ha,helperData:a(d,ha)}],T=[{name:"default",type:"1",id:"geo0",data:new E.BoxGeometry(z.width,z.width,z.width)}],F=!0,w={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===w.toolsType||(N.visible=
!N.visible);ka.visible=!ka.visible;F=!F},capture:function(){S.href=h.renderer.domElement.toDataURL();S.download="capture.png";S.click()},clearAll:function(){if(!(1>n.length)){var a=p.erase(n[0].meshObject);ja.addAction("erase",a);for(var b=0,c=n.length;b<c;b++)a=p.erase(n[0].meshObject),ja.appendObjectToCurrentAction(a)}},undo:function(){ja.undo()},redo:function(){ja.redo()}},ra=0,ba=b[0],ca=ba.data,na=ba.helperData,sa=T[0].data,N,ka,ia=[],n=[],R,X,va,ta,y=[0,0,0],f,t=new v,ja=new x,p=new u;h=new e(k.body);
h.init(function(a){if(h.WINDOW_WIDTH!==c.innerWidth||h.WINDOW_HEIGHT!==c.innerHeight)h.WINDOW_WIDTH=c.innerWidth,h.WINDOW_HEIGHT=c.innerHeight,h.WINDOW_HEIGHT_HALF=h.WINDOW_HEIGHT/2,h.WINDOW_WIDTH_HALF=h.WINDOW_WIDTH/2,h.camera.aspect=h.WINDOW_WIDTH/h.WINDOW_HEIGHT,h.camera.updateProjectionMatrix(),h.renderer.setSize(h.WINDOW_WIDTH,h.WINDOW_HEIGHT),k.body.height=h.WINDOW_HEIGHT},function(){ka=new E.GridHelper(5E3,z.width);h.scene.add(ka);W=new E.PlaneBufferGeometry(1E4,1E4);W.applyMatrix((new E.Matrix4).makeRotationX(-Math.PI/
2));da=new E.Mesh(W);da.visible=!1;h.scene.add(da);ia.push(da);R=new E.AmbientLight(q[h.renderType].ambientLightColor);h.scene.add(R);X=new E.DirectionalLight(15658734,q[h.renderType].directionalLightDensity);X.position.set(0,6E3,5E3);X.target.position.set(0,0,0);X.castShadow=!0;X.shadowCameraNear=h.camera.near;X.shadowCameraFar=h.camera.far;X.shadowCameraFov=h.camera.fov;X.shadowBias=1E-6;X.shadowDarkness=.5;X.shadowMapWidth=1024;X.shadowMapHeight=1024;h.scene.add(X);va=new E.HemisphereLight(15658734,
3158064,.95);h.scene.add(va);N=new E.Mesh(sa,na);N.position.set(z.width/2,z.width/2,z.width/2);h.scene.add(N);new E.Mesh(sa,ca);f=new E.Raycaster;ta=new E.Vector2;h.renderer.setClearColor(15790320);h.renderer.shadowMapEnabled=!0;h.renderer.shadowMapType=E.PCFShadowMap;c.addEventListener("unload",A,!1);c.addEventListener("reload",I,!1);h.renderer.domElement.addEventListener("mousemove",O,!1);h.renderer.domElement.addEventListener("mousedown",H,!1);h.renderer.domElement.addEventListener("mouseup",la,
!1);k.addEventListener("keydown",P,!1);k.addEventListener("keyup",fa,!1);setInterval(A,12E4)});Q();x={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",
id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",
children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",
title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:b[0].type,bgTypeData:b[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>h.WINDOW_WIDTH)for(u=x.children,v=0,e=u.length;v<e;v++)if("sidebarResize"===u[v].id){v=u[v].buttons;u=0;for(e=v.length;u<e;u++)"normalSidebar"===v[u].id&&delete v[u].checked,"minSidebar"===v[u].id&&(v[u].checked=!0);break}GoUI.Utils.domCreationDirector(x);ja.updateDom();e=k.querySelectorAll(".btn");
if(e instanceof Array||e.length)for(v=e.length-1;0<=v;v--)e[v].addEventListener("click",B,!1);else e instanceof object&&e.addEventListener("click",B,!1);u=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},
{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];v=0;for(e=u.length;v<e;v++)x={name:u[v].color,type:"color",id:"texture"+(v+1),uniqueData:u[v].color,data:new E.MeshLambertMaterial({color:u[v].color})},b.push(x),GoUI.map.buttonGroup2.addButton({title:"",id:x.id,bgType:x.type,bgTypeData:x.uniqueData,width:50,height:50}).addEventListener("click",B,!1);u="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");
E.ImageUtils.crossOrigin="Anonymous";v=0;for(e=u.length;v<e;v++)x={name:u[v].replace("texture/","").replace(".png",""),type:"image",id:"texture"+b.length,uniqueData:u[v],data:new E.MeshLambertMaterial({map:E.ImageUtils.loadTexture(u[v]),transparent:!0})},"glass"===x.data.name&&(x.data.map.opacity=.3),x.data.map.magFilter=E.NearestFilter,x.data.map.minFilter=E.LinearMipMapLinearFilter,b.push(x),GoUI.map.buttonGroup2.addButton({title:"",id:x.id,bgType:x.type,bgTypeData:x.uniqueData,width:50,height:50}).addEventListener("click",
B,!1);t.loadMeshes(void 0,l);t.loadCamera(t.storageKeys.camera)})(window,document,Base,THREE,Detector);
