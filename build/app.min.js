THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,m){};this.setValues(e)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.program=this.program;return e};
THREE.CanvasRenderer=function(e){function g(a,b,n,P){R(b);D(n);L(P);W(a.getStyle());q.stroke();ha.expandByScalar(2*b)}function m(a){Y(a.getStyle());q.fill()}function r(a){d(a.target)}function d(a){if(!(a instanceof THREE.CompressedTexture)){var b=a.wrapS===THREE.RepeatWrapping,n=a.wrapT===THREE.RepeatWrapping,P=a.image,h=document.createElement("canvas");h.width=P.width;h.height=P.height;var E=h.getContext("2d");E.setTransform(1,0,0,-1,0,P.height);E.drawImage(P,0,0);T[a.id]=q.createPattern(h,!0===
b&&!0===n?"repeat":!0===b&&!1===n?"repeat-x":!1===b&&!0===n?"repeat-y":"no-repeat")}}function u(a,b,n,P,h,E,z,c,g,m,l,k,e){if(!(e instanceof THREE.DataTexture)){!1===e.hasEventListener("update",r)&&(void 0!==e.image&&0<e.image.width&&d(e),e.addEventListener("update",r));var f=T[e.id];if(void 0!==f){Y(f);var f=e.offset.x/e.repeat.x,x=e.offset.y/e.repeat.y,da=e.image.width*e.repeat.x;e=e.image.height*e.repeat.y;z=(z+f)*da;c=(c+x)*e;n-=a;P-=b;h-=a;E-=b;g=(g+f)*da-z;m=(m+x)*e-c;l=(l+f)*da-z;k=(k+x)*e-
c;e=g*k-l*m;0!==e&&(f=1/e,e=(k*n-m*h)*f,m=(k*P-m*E)*f,n=(g*h-l*n)*f,P=(g*E-l*P)*f,a=a-e*z-n*c,b=b-m*z-P*c,q.save(),q.transform(e,m,n,P,a,b),q.fill(),q.restore())}else Y("rgba(0,0,0,1)"),q.fill()}}function s(a,b,n){var P=b.x-a.x,h=b.y-a.y,E=P*P+h*h;0!==E&&(n/=Math.sqrt(E),P*=n,h*=n,b.x+=P,b.y+=h,a.x-=P,a.y-=h)}function a(a){f!==a&&(f=q.globalAlpha=a)}function fa(a){ua!==a&&(a===THREE.NormalBlending?q.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?q.globalCompositeOperation="lighter":
a===THREE.SubtractiveBlending&&(q.globalCompositeOperation="darker"),ua=a)}function R(a){va!==a&&(va=q.lineWidth=a)}function D(a){Q!==a&&(Q=q.lineCap=a)}function L(a){k!==a&&(k=q.lineJoin=a)}function W(a){na!==a&&(na=q.strokeStyle=a)}function Y(a){A!==a&&(A=q.fillStyle=a)}function F(a){t.length!==a.length&&(q.setLineDash(a),t=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ea=THREE.Math.smoothstep;e=e||{};var aa=this,ia,ba,oa,ra=new THREE.Projector,S=void 0!==e.canvas?e.canvas:document.createElement("canvas"),
U=S.width,ka=S.height,I=Math.floor(U/2),B=Math.floor(ka/2),G=0,ja=0,la=U,sa=ka,p=1,q=S.getContext("2d",{alpha:!0===e.alpha}),c=new THREE.Color(0),v=!0===e.alpha?0:1,f=1,ua=0,na=null,A=null,va=null,Q=null,k=null,t=[],ca,y,da,ma;new THREE.RenderableVertex;new THREE.RenderableVertex;var za,Aa,C,l,J,M,x=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var xa=new THREE.Color,N=new THREE.Color,ya=new THREE.Color,T={},Z,Ca,Da,Ea,X,ga,O,pa=new THREE.Box2,w=new THREE.Box2,ha=
new THREE.Box2,Ba=new THREE.Color,wa=new THREE.Color,qa=new THREE.Color,ta=new THREE.Vector3,V=new THREE.Vector3,b=new THREE.Vector3,K=new THREE.Matrix3;void 0===q.setLineDash&&(q.setLineDash=function(){});this.domElement=S;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return p};this.setPixelRatio=function(a){p=a};this.setSize=function(a,b,n){U=a*p;
ka=b*p;S.width=U;S.height=ka;I=Math.floor(U/2);B=Math.floor(ka/2);!1!==n&&(S.style.width=a+"px",S.style.height=b+"px");pa.min.set(-I,-B);pa.max.set(I,B);w.min.set(-I,-B);w.max.set(I,B);f=1;ua=0;k=Q=va=A=na=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,n,P){G=a*p;ja=b*p;la=n*p;sa=P*p};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,b){c.set(a);v=void 0!==b?b:1;w.min.set(-I,-B);w.max.set(I,B)};this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,b)};this.getClearColor=function(){return c};this.getClearAlpha=function(){return v};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===w.empty()&&(w.intersect(pa),w.expandByScalar(2),w.min.x+=I,w.min.y=-w.min.y+B,w.max.x+=I,w.max.y=-w.max.y+B,1>v&&q.clearRect(w.min.x|0,w.max.y|0,w.max.x-w.min.x|0,w.min.y-w.max.y|0),0<v&&(fa(THREE.NormalBlending),a(1),Y("rgba("+Math.floor(255*c.r)+","+Math.floor(255*c.g)+","+Math.floor(255*c.b)+","+v+")"),q.fillRect(w.min.x|
0,w.max.y|0,w.max.x-w.min.x|0,w.min.y-w.max.y|0)),w.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,e){if(!1===e instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();aa.info.render.vertices=0;aa.info.render.faces=0;q.setTransform(la/U,0,0,-sa/ka,G,ka-ja);q.translate(I,B);ia=ra.projectScene(c,e,this.sortObjects,this.sortElements);
ba=ia.elements;oa=ia.lights;ca=e;K.getNormalMatrix(e.matrixWorldInverse);Ba.setRGB(0,0,0);wa.setRGB(0,0,0);qa.setRGB(0,0,0);for(var n=0,P=oa.length;n<P;n++){var h=oa[n],E=h.color;h instanceof THREE.AmbientLight?Ba.add(E):h instanceof THREE.DirectionalLight?wa.add(E):h instanceof THREE.PointLight&&qa.add(E)}n=0;for(P=ba.length;n<P;n++){var z=ba[n],k=z.material;if(void 0!==k&&0!==k.opacity){ha.makeEmpty();if(z instanceof THREE.RenderableSprite){y=z;y.x*=I;y.y*=B;var h=y,f=z,E=k;a(E.opacity);fa(E.blending);
var v=f.scale.x*I,f=f.scale.y*B,z=.5*Math.sqrt(v*v+f*f);ha.min.set(h.x-z,h.y-z);ha.max.set(h.x+z,h.y+z);if(E instanceof THREE.SpriteMaterial){var p=E.map;if(null!==p&&void 0!==p.image){!1===p.hasEventListener("update",r)&&(0<p.image.width&&d(p),p.addEventListener("update",r));z=T[p.id];void 0!==z?Y(z):Y("rgba( 0, 0, 0, 1 )");var t=p.image,z=t.width*p.offset.x,k=t.height*p.offset.y,A=t.width*p.repeat.x,p=t.height*p.repeat.y,t=v/A,Q=f/p;q.save();q.translate(h.x,h.y);0!==E.rotation&&q.rotate(E.rotation);
q.translate(-v/2,-f/2);q.scale(t,Q);q.translate(-z,-k);q.fillRect(z,k,A,p)}else Y(E.color.getStyle()),q.save(),q.translate(h.x,h.y),0!==E.rotation&&q.rotate(E.rotation),q.scale(v,-f),q.fillRect(-.5,-.5,1,1);q.restore()}else E instanceof THREE.SpriteCanvasMaterial&&(W(E.color.getStyle()),Y(E.color.getStyle()),q.save(),q.translate(h.x,h.y),0!==E.rotation&&q.rotate(E.rotation),q.scale(v,f),E.program(q),q.restore())}else if(z instanceof THREE.RenderableLine){if(y=z.v1,da=z.v2,y.positionScreen.x*=I,y.positionScreen.y*=
B,da.positionScreen.x*=I,da.positionScreen.y*=B,ha.setFromPoints([y.positionScreen,da.positionScreen]),!0===pa.isIntersectionBox(ha))if(h=y,E=da,v=z,f=k,a(f.opacity),fa(f.blending),q.beginPath(),q.moveTo(h.positionScreen.x,h.positionScreen.y),q.lineTo(E.positionScreen.x,E.positionScreen.y),f instanceof THREE.LineBasicMaterial){R(f.linewidth);D(f.linecap);L(f.linejoin);if(f.vertexColors!==THREE.VertexColors)W(f.color.getStyle());else if(z=v.vertexColors[0].getStyle(),v=v.vertexColors[1].getStyle(),
z===v)W(z);else{try{var ua=q.createLinearGradient(h.positionScreen.x,h.positionScreen.y,E.positionScreen.x,E.positionScreen.y);ua.addColorStop(0,z);ua.addColorStop(1,v)}catch(na){ua=z}W(ua)}q.stroke();ha.expandByScalar(2*f.linewidth)}else f instanceof THREE.LineDashedMaterial&&(R(f.linewidth),D(f.linecap),L(f.linejoin),W(f.color.getStyle()),F([f.dashSize,f.gapSize]),q.stroke(),ha.expandByScalar(2*f.linewidth),F([]))}else if(z instanceof THREE.RenderableFace){y=z.v1;da=z.v2;ma=z.v3;if(-1>y.positionScreen.z||
1<y.positionScreen.z)continue;if(-1>da.positionScreen.z||1<da.positionScreen.z)continue;if(-1>ma.positionScreen.z||1<ma.positionScreen.z)continue;y.positionScreen.x*=I;y.positionScreen.y*=B;da.positionScreen.x*=I;da.positionScreen.y*=B;ma.positionScreen.x*=I;ma.positionScreen.y*=B;0<k.overdraw&&(s(y.positionScreen,da.positionScreen,k.overdraw),s(da.positionScreen,ma.positionScreen,k.overdraw),s(ma.positionScreen,y.positionScreen,k.overdraw));ha.setFromPoints([y.positionScreen,da.positionScreen,ma.positionScreen]);
if(!0===pa.isIntersectionBox(ha)){E=y;v=da;f=ma;h=k;aa.info.render.vertices+=3;aa.info.render.faces++;a(h.opacity);fa(h.blending);za=E.positionScreen.x;Aa=E.positionScreen.y;C=v.positionScreen.x;l=v.positionScreen.y;J=f.positionScreen.x;M=f.positionScreen.y;var k=za,A=Aa,p=C,t=l,Q=J,S=M;q.beginPath();q.moveTo(k,A);q.lineTo(p,t);q.lineTo(Q,S);q.closePath();if((h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial)&&null===h.map){xa.copy(h.color);N.copy(h.emissive);h.vertexColors===
THREE.FaceColors&&xa.multiply(z.color);x.copy(Ba);V.copy(E.positionWorld).add(v.positionWorld).add(f.positionWorld).divideScalar(3);E=V;v=z.normalModel;f=x;z=0;for(k=oa.length;z<k;z++)A=oa[z],ya.copy(A.color),A instanceof THREE.DirectionalLight?(p=ta.setFromMatrixPosition(A.matrixWorld).normalize(),t=v.dot(p),0>=t||(t*=A.intensity,f.add(ya.multiplyScalar(t)))):A instanceof THREE.PointLight&&(p=ta.setFromMatrixPosition(A.matrixWorld),t=v.dot(ta.subVectors(p,E).normalize()),0>=t||(t*=0==A.distance?
1:1-Math.min(E.distanceTo(p)/A.distance,1),0!=t&&(t*=A.intensity,f.add(ya.multiplyScalar(t)))));x.multiply(xa).add(N);!0===h.wireframe?g(x,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):m(x)}else h instanceof THREE.MeshBasicMaterial||h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial?null!==h.map?h.map.mapping===THREE.UVMapping&&(Z=z.uvs,u(za,Aa,C,l,J,M,Z[0].x,Z[0].y,Z[1].x,Z[1].y,Z[2].x,Z[2].y,h.map)):null!==h.envMap?h.envMap.mapping===THREE.SphericalReflectionMapping&&
(b.copy(z.vertexNormalsModel[0]).applyMatrix3(K),Ca=.5*b.x+.5,Da=.5*b.y+.5,b.copy(z.vertexNormalsModel[1]).applyMatrix3(K),Ea=.5*b.x+.5,X=.5*b.y+.5,b.copy(z.vertexNormalsModel[2]).applyMatrix3(K),ga=.5*b.x+.5,O=.5*b.y+.5,u(za,Aa,C,l,J,M,Ca,Da,Ea,X,ga,O,h.envMap)):(x.copy(h.color),h.vertexColors===THREE.FaceColors&&x.multiply(z.color),!0===h.wireframe?g(x,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):m(x)):(h instanceof THREE.MeshDepthMaterial?x.r=x.g=x.b=1-ea(E.positionScreen.z*E.positionScreen.w,
ca.near,ca.far):h instanceof THREE.MeshNormalMaterial?(b.copy(z.normalModel).applyMatrix3(K),x.setRGB(b.x,b.y,b.z).multiplyScalar(.5).addScalar(.5)):x.setRGB(1,1,1),!0===h.wireframe?g(x,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):m(x))}}w.union(ha)}}q.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld);this.positionScreen.copy(e.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function e(){if(L===Y){var a=new THREE.RenderableVertex;W.push(a);Y++;L++;return a}return W[L++]}function g(){if(ea===ia){var a=new THREE.RenderableFace;aa.push(a);ia++;ea++;return a}return aa[ea++]}function m(){if(oa===S){var a=new THREE.RenderableLine;ra.push(a);S++;oa++;return a}return ra[oa++]}function r(){if(ka===B){var a=new THREE.RenderableSprite;I.push(a);B++;ka++;return a}return I[ka++]}function d(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function u(a,
c){var f=0,e=1,d=a.z+a.w,k=c.z+c.w,g=-a.z+a.w,m=-c.z+c.w;if(0<=d&&0<=k&&0<=g&&0<=m)return!0;if(0>d&&0>k||0>g&&0>m)return!1;0>d?f=Math.max(f,d/(d-k)):0>k&&(e=Math.min(e,d/(d-k)));0>g?f=Math.max(f,g/(g-m)):0>m&&(e=Math.min(e,g/(g-m)));if(e<f)return!1;a.lerp(c,f);c.lerp(a,1-e);return!0}var s,a,fa=[],R=0,D,L,W=[],Y=0,F,ea,aa=[],ia=0,ba,oa,ra=[],S=0,U,ka,I=[],B=0,G={objects:[],lights:[],elements:[]},ja=new THREE.Vector3,la=new THREE.Vector3,sa=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector4,
c=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),v=new THREE.Box3,f=Array(3),ua=new THREE.Matrix4,na=new THREE.Matrix4,A,va=new THREE.Matrix4,Q=new THREE.Matrix3,k=new THREE.Frustum,t=new THREE.Vector4,ca=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=
function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var y=new function(){var a=[],d=[],k=null,p=null,q=new THREE.Matrix3,l=function(a){var c=a.positionWorld,f=a.positionScreen;c.copy(a.position).applyMatrix4(A);f.copy(c).applyMatrix4(na);c=1/f.w;f.x*=c;f.y*=c;f.z*=c;a.visible=-1<=f.x&&1>=f.x&&-1<=f.y&&1>=f.y&&-1<=f.z&&1>=f.z},r=function(a,k,d){if(!0===a.visible||!0===k.visible||!0===d.visible)return!0;f[0]=a.positionScreen;f[1]=k.positionScreen;f[2]=d.positionScreen;
return c.isIntersectionBox(v.setFromPoints(f))},s=function(a,c,f){return 0>(f.positionScreen.x-a.positionScreen.x)*(c.positionScreen.y-a.positionScreen.y)-(f.positionScreen.y-a.positionScreen.y)*(c.positionScreen.x-a.positionScreen.x)};return{setObject:function(c){k=c;p=k.material;q.getNormalMatrix(k.matrixWorld);a.length=0;d.length=0},projectVertex:l,checkTriangleVisibility:r,checkBackfaceCulling:s,pushVertex:function(a,c,f){D=e();D.position.set(a,c,f);l(D)},pushNormal:function(c,f,k){a.push(c,f,
k)},pushUv:function(a,c){d.push(a,c)},pushLine:function(a,c){var f=W[a],d=W[c];ba=m();ba.id=k.id;ba.v1.copy(f);ba.v2.copy(d);ba.z=(f.positionScreen.z+d.positionScreen.z)/2;ba.material=k.material;G.elements.push(ba)},pushTriangle:function(c,f,e){var m=W[c],l=W[f],v=W[e];if(!1!==r(m,l,v)&&(p.side===THREE.DoubleSide||!0===s(m,l,v))){F=g();F.id=k.id;F.v1.copy(m);F.v2.copy(l);F.v3.copy(v);F.z=(m.positionScreen.z+l.positionScreen.z+v.positionScreen.z)/3;for(m=0;3>m;m++)l=3*arguments[m],v=F.vertexNormalsModel[m],
v.set(a[l],a[l+1],a[l+2]),v.applyMatrix3(q).normalize(),l=2*arguments[m],F.uvs[m].set(d[l],d[l+1]);F.vertexNormalsLength=3;F.material=k.material;G.elements.push(F)}}}};this.projectScene=function(c,f,v,B){ka=oa=ea=0;G.elements.length=0;!0===c.autoUpdate&&c.updateMatrixWorld();void 0===f.parent&&f.updateMatrixWorld();ua.copy(f.matrixWorldInverse.getInverse(f.matrixWorld));na.multiplyMatrices(f.projectionMatrix,ua);k.setFromMatrix(na);a=0;G.objects.length=0;G.lights.length=0;c.traverseVisible(function(c){if(c instanceof
THREE.Light)G.lights.push(c);else if((c instanceof THREE.Mesh||c instanceof THREE.Line||c instanceof THREE.Sprite)&&!1!==c.material.visible&&(!1===c.frustumCulled||!0===k.intersectsObject(c))){if(a===R){var b=new THREE.RenderableObject;fa.push(b);R++;a++;s=b}else s=fa[a++];s.id=c.id;s.object=c;p.setFromMatrixPosition(c.matrixWorld);p.applyProjection(na);s.z=p.z;G.objects.push(s)}});!0===v&&G.objects.sort(d);c=0;for(v=G.objects.length;c<v;c++){var C=G.objects[c].object,l=C.geometry;y.setObject(C);
A=C.matrixWorld;L=0;if(C instanceof THREE.Mesh)if(l instanceof THREE.BufferGeometry){var J=l.attributes,C=l.offsets;if(void 0!==J.position){for(var M=J.position.array,l=0,x=M.length;l<x;l+=3)y.pushVertex(M[l],M[l+1],M[l+2]);if(void 0!==J.normal)for(var D=J.normal.array,l=0,x=D.length;l<x;l+=3)y.pushNormal(D[l],D[l+1],D[l+2]);if(void 0!==J.uv)for(D=J.uv.array,l=0,x=D.length;l<x;l+=2)y.pushUv(D[l],D[l+1]);if(void 0!==J.index)if(J=J.index.array,0<C.length)for(c=0;c<C.length;c++)for(x=C[c],M=x.index,
l=x.start,x=x.start+x.count;l<x;l+=3)y.pushTriangle(J[l]+M,J[l+1]+M,J[l+2]+M);else for(l=0,x=J.length;l<x;l+=3)y.pushTriangle(J[l],J[l+1],J[l+2]);else for(l=0,x=M.length/3;l<x;l+=3)y.pushTriangle(l,l+1,l+2)}}else{if(l instanceof THREE.Geometry){var N=l.vertices,x=l.faces,J=l.faceVertexUvs[0];Q.getNormalMatrix(A);for(var M=C.material instanceof THREE.MeshFaceMaterial,D=!0===M?C.material:null,I=0,T=N.length;I<T;I++){var Z=N[I];y.pushVertex(Z.x,Z.y,Z.z)}N=0;for(I=x.length;N<I;N++){var T=x[N],Y=!0===
M?D.materials[T.materialIndex]:C.material;if(void 0!==Y){var S=Y.side,Z=W[T.a],aa=W[T.b],X=W[T.c];if(!0===Y.morphTargets){var ga=l.morphTargets,O=C.morphTargetInfluences,pa=Z.position,w=aa.position,ha=X.position;ja.set(0,0,0);la.set(0,0,0);sa.set(0,0,0);for(var ia=0,ra=ga.length;ia<ra;ia++){var qa=O[ia];if(0!==qa){var ta=ga[ia].vertices;ja.x+=(ta[T.a].x-pa.x)*qa;ja.y+=(ta[T.a].y-pa.y)*qa;ja.z+=(ta[T.a].z-pa.z)*qa;la.x+=(ta[T.b].x-w.x)*qa;la.y+=(ta[T.b].y-w.y)*qa;la.z+=(ta[T.b].z-w.z)*qa;sa.x+=(ta[T.c].x-
ha.x)*qa;sa.y+=(ta[T.c].y-ha.y)*qa;sa.z+=(ta[T.c].z-ha.z)*qa}}Z.position.add(ja);aa.position.add(la);X.position.add(sa);y.projectVertex(Z);y.projectVertex(aa);y.projectVertex(X)}if(!1!==y.checkTriangleVisibility(Z,aa,X)){ga=y.checkBackfaceCulling(Z,aa,X);if(S!==THREE.DoubleSide){if(S===THREE.FrontSide&&!1===ga)continue;if(S===THREE.BackSide&&!0===ga)continue}F=g();F.id=C.id;F.v1.copy(Z);F.v2.copy(aa);F.v3.copy(X);F.normalModel.copy(T.normal);!1!==ga||S!==THREE.BackSide&&S!==THREE.DoubleSide||F.normalModel.negate();
F.normalModel.applyMatrix3(Q).normalize();O=T.vertexNormals;pa=0;for(w=Math.min(O.length,3);pa<w;pa++)ha=F.vertexNormalsModel[pa],ha.copy(O[pa]),!1!==ga||S!==THREE.BackSide&&S!==THREE.DoubleSide||ha.negate(),ha.applyMatrix3(Q).normalize();F.vertexNormalsLength=O.length;S=J[N];if(void 0!==S)for(ga=0;3>ga;ga++)F.uvs[ga].copy(S[ga]);F.color=T.color;F.material=Y;F.z=(Z.positionScreen.z+aa.positionScreen.z+X.positionScreen.z)/3;G.elements.push(F)}}}}}else if(C instanceof THREE.Line)if(l instanceof THREE.BufferGeometry){if(J=
l.attributes,void 0!==J.position){M=J.position.array;l=0;for(x=M.length;l<x;l+=3)y.pushVertex(M[l],M[l+1],M[l+2]);if(void 0!==J.index)for(J=J.index.array,l=0,x=J.length;l<x;l+=2)y.pushLine(J[l],J[l+1]);else for(J=C.mode===THREE.LinePieces?2:1,l=0,x=M.length/3-1;l<x;l+=J)y.pushLine(l,l+1)}}else{if(l instanceof THREE.Geometry&&(va.multiplyMatrices(na,A),N=C.geometry.vertices,0!==N.length))for(Z=e(),Z.positionScreen.copy(N[0]).applyMatrix4(va),J=C.mode===THREE.LinePieces?2:1,I=1,T=N.length;I<T;I++)Z=
e(),Z.positionScreen.copy(N[I]).applyMatrix4(va),0<(I+1)%J||(aa=W[L-2],t.copy(Z.positionScreen),ca.copy(aa.positionScreen),!0===u(t,ca)&&(t.multiplyScalar(1/t.w),ca.multiplyScalar(1/ca.w),ba=m(),ba.id=C.id,ba.v1.positionScreen.copy(t),ba.v2.positionScreen.copy(ca),ba.z=Math.max(t.z,ca.z),ba.material=C.material,C.material.vertexColors===THREE.VertexColors&&(ba.vertexColors[0].copy(C.geometry.colors[I]),ba.vertexColors[1].copy(C.geometry.colors[I-1])),G.elements.push(ba)))}else C instanceof THREE.Sprite&&
(q.set(A.elements[12],A.elements[13],A.elements[14],1),q.applyMatrix4(na),l=1/q.w,q.z*=l,-1<=q.z&&1>=q.z&&(U=r(),U.id=C.id,U.x=q.x*l,U.y=q.y*l,U.z=q.z,U.object=C,U.rotation=C.rotation,U.scale.x=C.scale.x*Math.abs(U.x-(q.x+f.projectionMatrix.elements[0])/(q.w+f.projectionMatrix.elements[12])),U.scale.y=C.scale.y*Math.abs(U.y-(q.y+f.projectionMatrix.elements[5])/(q.w+f.projectionMatrix.elements[13])),U.material=C.material,G.elements.push(U)))}!0===B&&G.elements.sort(d);return G}};
THREE.OrbitControls=function(e,g,m){function r(c){if(!1!==a.enabled){c.preventDefault();var d=a.domElement===document?a.domElement.body:a.domElement;if(G===B.ROTATE){if(!0===a.noRotate)return;R.set(c.clientX,c.clientY);D.subVectors(R,fa);a.rotateLeft(2*Math.PI*D.x/d.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*D.y/d.clientHeight*a.rotateSpeed);fa.copy(R)}else if(G===B.DOLLY){if(!0===a.noZoom)return;ia.set(c.clientX,c.clientY);ba.subVectors(ia,aa);0<ba.y?a.dollyIn():a.dollyOut();aa.copy(ia)}else if(G===
B.PAN){if(!0===a.noPan)return;W.set(c.clientX,c.clientY);Y.subVectors(W,L);a.pan(Y.x*a.panSpeed,-Y.y*a.panSpeed);L.copy(W)}a.update()}}function d(){!1!==a.enabled&&(document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",d,!1),a.dispatchEvent(q),G=B.NONE)}function u(c){if(!1!==a.enabled&&!0!==a.noPan){c.preventDefault();c.stopPropagation();var d=0;void 0!==c.wheelDelta?d=c.wheelDelta:void 0!==c.detail&&(d=-c.detail);a.panXZ(0,d*a.panSpeed);a.update();a.dispatchEvent(p);
a.dispatchEvent(q)}}function s(c){if(!1!==a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();
a.update();break;case a.keys.DOLLY_OUT:if(!0===a.noZoom)break;a.dollyOut();a.update()}}this.settings=m;this.object=e;this.domElement=void 0!==g?g:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.panSpeed=.3;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=
Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,fa=new THREE.Vector2,R=new THREE.Vector2,D=new THREE.Vector2,L=new THREE.Vector2,W=new THREE.Vector2,Y=new THREE.Vector2,F=new THREE.Vector3,ea=new THREE.Vector3,aa=new THREE.Vector2,ia=new THREE.Vector2,ba=new THREE.Vector2,oa=0,ra=0,S=1,U=new THREE.Vector3,ka=new THREE.Vector3,I=new THREE.Quaternion,B={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,
TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},G=B.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var ja=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),la=ja.clone().inverse(),sa={type:"change"},p={type:"start"},q={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);ra-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);oa-=c};this.panLeft=function(a){var d=this.object.matrix.elements;
F.set(d[0],d[1],d[2]);F.multiplyScalar(-a);U.add(F)};this.panUp=function(a){var d=this.object.matrix.elements;F.set(d[4],d[5],d[6]);F.multiplyScalar(a);U.add(F)};this.panForward=function(a){var d=this.object.matrix.elements;F.set(d[8],d[9],d[10]);F.multiplyScalar(a);U.add(F)};this.pan=function(c,d){var f=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var e=a.object.position.clone().sub(a.target).length(),e=e*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*e/f.clientHeight);
a.panUp(2*d*e/f.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/f.clientWidth),a.panUp(d*(a.object.top-a.object.bottom)/f.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,d){var f=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var e=a.object.position.clone().sub(a.target).length(),e=e*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*e/f.clientHeight);
a.panForward(2*d*e/f.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/f.clientWidth),a.panForward(d*(a.object.top-a.object.bottom)/f.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));S/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));S*=c};this.update=function(){var c=this.object.position,d=this.settings&&this.settings.cameraAsOrbitCenter?
c:this.target,f=this.settings&&this.settings.cameraAsOrbitCenter?this.target:c;ea.copy(c).sub(this.target);ea.applyQuaternion(ja);var c=Math.atan2(ea.x,ea.z),e=Math.atan2(Math.sqrt(ea.x*ea.x+ea.z*ea.z),ea.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*a.autoRotateSpeed);var c=c+ra,e=e+oa,c=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,c)),e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),m=this.settings&&this.settings.cameraAsOrbitCenter?
5E3*S*this.settings.boxScale:ea.length()*S,m=Math.max(this.minDistance,Math.min(this.maxDistance,m));d.add(U);ea.x=m*Math.sin(e)*Math.sin(c);ea.y=m*Math.cos(e);ea.z=m*Math.sin(e)*Math.cos(c);ea.applyQuaternion(la);this.settings&&this.settings.cameraAsOrbitCenter?f.copy(d).sub(ea):f.copy(d).add(ea);this.object.lookAt(this.target);oa=ra=0;S=1;U.set(0,0,0);if(1E-6<ka.distanceToSquared(d)||1E-6<8*(1-I.dot(this.object.quaternion)))this.dispatchEvent(sa),ka.copy(d),I.copy(this.object.quaternion)};this.reset=
function(){G=B.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===a.noRotate)return;G=B.ROTATE;fa.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;G=B.DOLLY;aa.set(c.clientX,c.clientY)}else if(c.button===
a.mouseButtons.PAN){if(!0===a.noPan)return;G=B.PAN;L.set(c.clientX,c.clientY)}document.addEventListener("mousemove",r,!1);document.addEventListener("mouseup",d,!1);a.dispatchEvent(p)}},!1);this.domElement.addEventListener("mousewheel",u,!1);this.domElement.addEventListener("DOMMouseScroll",u,!1);this.domElement.addEventListener("touchstart",function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;G=B.TOUCH_ROTATE;fa.set(c.touches[0].pageX,c.touches[0].pageY);break;
case 2:if(!0===a.noZoom)return;G=B.TOUCH_DOLLY;var d=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;d=Math.sqrt(d*d+c*c);aa.set(0,d);break;case 3:if(!0===a.noPan)return;G=B.TOUCH_PAN;L.set(c.touches[0].pageX,c.touches[0].pageY);break;default:G=B.NONE}a.dispatchEvent(p)}},!1);this.domElement.addEventListener("touchend",function(){!1!==a.enabled&&(a.dispatchEvent(q),G=B.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();
c.stopPropagation();var d=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(G!==B.TOUCH_ROTATE)break;R.set(c.touches[0].pageX,c.touches[0].pageY);D.subVectors(R,fa);a.rotateLeft(2*Math.PI*D.x/d.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*D.y/d.clientHeight*a.rotateSpeed);fa.copy(R);a.update();break;case 2:if(!0===a.noZoom)break;if(G!==B.TOUCH_DOLLY)break;d=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;
c=Math.sqrt(d*d+c*c);ia.set(0,c);ba.subVectors(ia,aa);0<ba.y?a.dollyOut():a.dollyIn();aa.copy(ia);a.update();break;case 3:if(!0===a.noPan)break;if(G!==B.TOUCH_PAN)break;W.set(c.touches[0].pageX,c.touches[0].pageY);Y.subVectors(W,L);a.panXZ(Y.x*a.panSpeed,-Y.y*a.panSpeed);L.copy(W);a.update();break;default:G=B.NONE}}},!1);window.addEventListener("keydown",s,!1);this.update();this.removeKeyEventListener=function(){window.removeEventListener("keydown",s,!1)};this.addKeyEventListener=function(){window.addEventListener("keydown",
s,!1)}};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(g){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");e.id="webgl-error-message";e.style.fontFamily="monospace";e.style.fontSize="13px";e.style.fontWeight="normal";
e.style.textAlign="center";e.style.background="#fff";e.style.color="#000";e.style.padding="1.5em";e.style.width="400px";e.style.margin="5em auto 0";this.webgl||(e.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return e},addGetWebGLMessage:function(e){var g,m;e=e||{};g=void 0!==e.parent?e.parent:document.body;e=void 0!==e.id?e.id:"oldie";m=Detector.getWebGLErrorMessage();m.id=e;g.appendChild(m)}};"object"===typeof module&&(module.exports=Detector);
(function(e,g,m,r){var d=function(d){this.domParent="object"===typeof d?d:g.body};d.prototype.init=function(d,s,a,fa,R,D){e.requestAnimationFrame||(e.requestAnimationFrame=function(){return e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(a,d){e.setTimeout(a,1E3/60)}}());this.domParent===g.body&&(this.WINDOW_WIDTH=e.innerWidth,this.WINDOW_HEIGHT=e.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,e.addEventListener("resize",d,!1));this.renderType=r.webgl?"webgl":"canvas";this.renderer=a||(r.webgl?new m.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new m.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=fa||new m.Scene;this.camera=R||new m.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
D?this.controls=D:(this.controls=new m.OrbitControls(this.camera,this.renderer.domElement,{cameraAsOrbitCenter:!0}),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.keyPanSpeed=10,this.controls.panSpeed=1,this.controls.noZoom=!0,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:81,BOTTOM:69},this.controls.mouseButtons={ORBIT:m.MOUSE.MIDDLE,PAN:m.MOUSE.RIGHT});this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top=
"0px";this.stats.domElement.style.zIndex="999";g.body.appendChild(this.stats.domElement);s()};e.Base=d;"object"===typeof module&&(module.exports=d)})(window,document,THREE,Detector);
(function(){function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}var g={Animation:{bubble:function(e,g){var d=$('<div class="alert alert-info alert-vp fade"></div>').appendTo(e);d.text(g);d.finish().fadeTo(400,1).delay(3E3).fadeTo(200,0,function(){$(this).remove()})}}};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(e){var g=0;for(e=e.length;g<e;g++);};g.map={};g.Sidebar=function(e,r){_Container.call(this);var d=this.setting=
g.Utils.settingMixin({align:"r",width:320},e),u="sidebar",u=d.align&&"r"!==d.align?u+" sidebar-left":u+" sidebar-right";this.domElement.className=u;d.id&&(this.domElement.id=d.id,g.map[d.id]=this);this.domElement.style.width=d.width.toString()+"px";d.overflow&&(this.domElement.style.overflow=d.overflow.toString());r.appendChild(this.domElement);g.Utils.domCreationDirector(d.children,this.domElement)};g.Sidebar.prototype=Object.create(_Container.prototype);g.Panel=function(e,r){_Container.call(this);
var d=this.setting=g.Utils.settingMixin({title:""},e);d.id&&(this.domElement.id=d.id,g.map[d.id]=this);var u=this.domElement;u.className="panel panel-tool";r.appendChild(u);var s=document.createElement("div");s.className="panel-heading";u.appendChild(s);var a=document.createTextNode(d.title);s.appendChild(a);s=document.createElement("div");s.className="panel-body";d.overflow&&(s.style.overflow=d.overflow.toString());u.appendChild(s);g.Utils.domCreationDirector(d.children,s)};g.Panel.prototype=Object.create(_Container.prototype);
g.Toolbar=function(e,r){_Container.call(this);var d=this.setting=g.Utils.settingMixin({title:""},e);d.id&&(this.domElement.id=d.id,g.map[d.id]=this);var u=this.domElement;u.className="btn-toolbar";r.appendChild(u);g.Utils.domCreationDirector(d.children,u)};g.Toolbar.prototype=Object.create(_Container.prototype);g.ButtonGroup=function(e,r){_Container.call(this);var d=this.setting=g.Utils.settingMixin({title:"",buttonType:"radio"},e);d.id&&(this.domElement.id=d.id,g.map[d.id]=this);var u=this.domElement;
u.className="btn-group"+(d.appendClass?" "+d.appendClass:"");"button"!==d.buttonType.toLowerCase()&&u.setAttribute("data-toggle","buttons");u.title=d.title;r.appendChild(u);var s=d.buttons;switch(d.buttonType.toLowerCase()){default:case "radio":for(var a=0,fa=s.length;a<fa;a++){var R=document.createElement("label");R.className="btn btn-tool"+(s[a].checked?" active":"");s[a].height&&(R.style.height=s[a].height+"px");s[a].width&&(R.style.width=s[a].width+"px");if(s[a].bgType&&s[a].bgTypeData){var D;
switch(s[a].bgType){case "color":D=s[a].bgTypeData;R.className+=" btn-color";break;case "image":D="url("+s[a].bgTypeData+") no-repeat 50% 50%";R.className+=" btn-image";break;default:return}R.style.background=D}u.appendChild(R);var L=document.createElement("input");s[a].checked&&L.setAttribute("checked","");L.type=d.buttonType;L.name=d.name;L.id=s[a].id;L.value=a;L.autocomplete="off";R.appendChild(L);D=document.createTextNode(s[a].title);R.appendChild(D)}break;case "button":for(a=0,fa=s.length;a<
fa;a++){L=document.createElement("button");L.className="btn btn-tool";L.id=s[a].id;L.name=d.name;s[a].height&&(L.style.height=s[a].height+"px");s[a].width&&(L.style.width=s[a].width+"px");if(s[a].bgType&&s[a].bgTypeData){switch(s[a].bgType){case "color":D=s[a].bgTypeData;R.className+=" btn-color";break;case "image":D="url("+s[a].bgTypeData+") no-repeat 50% 50%";R.className+=" btn-image";break;default:return}L.style.background=D}u.appendChild(L);D=document.createTextNode(s[a].title);L.appendChild(D)}}g.Utils.domCreationDirector(d.children,
this.domElement)};g.ButtonGroup.prototype=Object.create(_Container.prototype);g.ButtonGroup.prototype.addButton=function(e,g){g||this.setting.buttons.push(e);var d=document.createElement("label");d.className="btn btn-tool"+(e.checked?" active":"");e.height&&(d.style.height=e.height+"px");e.width&&(d.style.width=e.width+"px");if(e.bgType&&e.bgTypeData){var u;switch(e.bgType){case "color":u=e.bgTypeData;d.className+=" btn-color";break;case "image":u="url("+e.bgTypeData+") no-repeat 50% 50%";d.className+=
" btn-image";break;default:return}d.style.background=u}this.domElement.appendChild(d);u=document.createElement("input");e.checked&&u.setAttribute("checked","");u.type=this.setting.buttonType;u.name=this.setting.name;u.id=e.id;u.value=this.setting.buttons.length-1;u.autocomplete="off";d.appendChild(u);u=document.createTextNode(e.title);d.appendChild(u);return d};g.ButtonGroup.prototype.addButtons=function(e,g){for(var d=0,u=e.length;d<u;d++)this.addButton(e[d],g)};g.Utils={};g.Utils.settingMixin=function(e,
g){if("object"===typeof e&&"object"===typeof g){var d={},u;for(u in e)d[u]=e[u];for(var s in g)void 0!==g[s]&&(d[s]=g[s]);return d}return e};g.Utils.domCreationDirector=function(m,r){if(m)if(m instanceof Array)for(var d=0,u=m.length;d<u;d++)g.Utils.domCreationDirector(m[d],r?r:document.body);else m instanceof Object&&m.UIType&&g[e(m.UIType)]&&new (g[e(m.UIType)])(m,r?r:document.body)};window.GoUI=g;"object"===typeof module&&(module.exports=g)})();
var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
AV.initialize("i5m1bad33f8bm725g0lan5wd8hhc1c4qhyz3cyq4b0qoyvja","2w44ugxt0z512vitlk5in4c4a95acbyj8qiqlgcuh3p9xm5t");
(function(e,g,m,r,d){var u,s;function a(){return AV.User.current()&&f&&f.get("user")&&AV.User.current().id!==f.get("user").id}function fa(n){var a=N.textures+(n?-1:1),a=g.getElementById("texture"+a);if(!a&&(a=n?M.length-1:0,a=g.getElementById("texture"+a),!a))return;n=a.parentElement.className.indexOf("btn-color");var h=a.parentElement.className.indexOf("btn-image");-1<n?(u=Number(a.value),g.getElementById("colorTexture").parentElement.click()):-1<h&&(s=Number(a.value),g.getElementById("imageTexture").parentElement.click())}
function R(n,a){var h=a.clone(),b;for(b in n)h[b]=n[b];return h}function D(n){if(null==n.pageX&&null!=n.clientX){var a=g.documentElement,h=g.body;n.pageX=n.clientX+(a&&a.scrollLeft||h&&h.scrollLeft||0)-(a&&a.clientLeft||h&&h.clientLeft||0);n.pageY=n.clientY+(a&&a.scrollTop||h&&h.scrollTop||0)-(a&&a.clientTop||h&&h.clientTop||0)}Ba.set(n.pageX/k.WINDOW_WIDTH*2-1,2*-(n.pageY/k.WINDOW_HEIGHT)+1);qa.setFromCamera(Ba,k.camera);return qa.intersectObjects(ga)}function L(n,a){a&&n&&(n.position.copy(a.point).add(a.face.normal),
n.position.divideScalar(t.width).floor().multiplyScalar(t.width).addScalar(t.width/2))}function W(n){0<n.length&&L(X,n[0])}function Y(n,a,h,b,e){var c=h||"openModal",d=b||["myBox","myKeep"];n&&n.then(function(n){$("#"+c+" .modal-body #"+d[0]).html("");for(var a=0,h=n.length;a<h;a++)$("#"+c+" .modal-body #"+d[0]).append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="myBoxData'+a+'" value="'+n[a].id+'" autocomplete="off">  <label id="myBoxDataLabel'+a+'"></label></label>'),
$("#"+c+" .modal-body #myBoxDataLabel"+a).text(n[a].get("name"));1>n.length?$("#openModal .modal-body #boxTitle").hide():$("#openModal .modal-body #boxTitle").show()});a&&a.then(function(n){$("#"+c+" .modal-body #"+d[1]).html("");for(var a=0,h=n.length;a<h;a++)$("#"+c+" .modal-body #"+d[1]).append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="keepBoxData'+a+'" value="'+(e?n[a].id:n[a].get("box")?n[a].get("box").id:"-1")+'" autocomplete="off">  <label id="keepBoxDataLabel'+
a+'"></label></label>'),$("#"+c+" .modal-body #keepBoxDataLabel"+a).text(n[a].get("name")+(n[a].get("box")?"("+n[a].get("box").get("user").get("username")+"/"+n[a].get("box").get("name")+")":""));1>n.length?$("#openModal .modal-body #keepTitle").hide():$("#openModal .modal-body #keepTitle").show()});$("#"+c+"").modal("show")}function F(a,P,h,b,e){a=a||D(event);if(0<a.length){a=a[0];var c=N.toolsType,d=!1,f=ga.length;if(f&&a.object!==ma)for(var g=f-1;0<g&&g>f-1-3;g--)if(a.object===ga[g]){d=!0;break}if(0===
c)if(H.isInsertingFlag){if(0<H.insertTimes&&!e){H.endInsert();return}if(b)return;P=H.deleteMesh();K.addAction("erase",P);P=H.insert();K.addAction("draw",P);H.insertTimes++;e||H.endInsert()}else{if(!0===d&&!1===P||!1===d&&!0===P)return;h=H.draw(Da,ya,void 0,a);b?K.appendObjectToCurrentAction("draw",h):K.addAction("draw",h);k.renderer.render(k.scene,k.camera);return}1===c&&h&&(H.isInsertingFlag?0<H.insertTimes&&!e?H.endInsert():b||(P=H.deleteMesh(),K.addAction("erase",P),H.insertTimes++,e||H.endInsert()):
a.object!==ma&&(h=H.erase(a.object),b?K.appendObjectToCurrentAction("erase",h):K.addAction("erase",h)))}}function ea(){a()||(b.save(b.storageKeys.localChanges,K.changed),b.save(b.storageKeys.camera),b.save(b.storageKeys.sidebar),b.save())}function aa(n){0!==Aa||a()||("0"===K.changed||1>O.length&&(!f||f&&!f.id)||!AV.User.current||b.save(b.storageKeys.localChanges,K.changed),b.save(b.storageKeys.camera),b.save(b.storageKeys.sidebar),b.save())}function ia(n){Aa=1;a()||("0"===K.changed||1>O.length&&(!f||
f&&!f.id)?(b.save(b.storageKeys.camera),b.save(b.storageKeys.sidebar),b.save()):confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")?N.save():(b.save(b.storageKeys.localChanges,K.changed),b.save(b.storageKeys.camera),b.save(b.storageKeys.sidebar),b.save()))}function ba(a){a.preventDefault();var b;if(1===wa[0])try{1===Fa?Fa=0:(Fa=1,b=D(a),F(b,a.ctrlKey,a.ctrlKey,!0))}catch(h){console.warn("draw/erase failed")}finally{Fa=0}else b=N.toolsType,1===b?X.visible&&(X.visible=!1):!X.visible&&
xa&&(X.visible=!0),b=D(a),W(b),H.isInsertingFlag&&H.updateInsertHelper(H.insertMeshes,b)}function oa(a){a.preventDefault();switch(a.button){case 0:if(!V.endFlag){V.instantComplete(V.loadBoxAnimation);break}wa[0]=1;var b=D(a);F(b,void 0,!0,!1,a.ctrlKey);W(b);H.isInsertingFlag&&H.updateInsertHelper(H.insertMeshes,b);break;case 1:wa[1]=1;break;case 2:wa[2]=1}}function ra(a){if("label"===this.nodeName.toLowerCase())switch(a=this.getElementsByTagName("input")[0],N[a.name]=Number(a.value),a.name){case "toolsType":1===
Number(a.value)?X.visible&&(X.visible=!1):!X.visible&&xa&&(X.visible=!0);break;case "textures":ya=N[a.name];T=M[ya];Z=T.data;Ca=T.helperData=M[N[a.name]].helperData||R(J,Z);X.material=Ca;g.getElementById("cube").parentElement.click();switch(N.texturesType){case 0:s=a.value;break;default:case 1:u=a.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===a.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":a=a.id,"imageTexture"===
a?($(".btn-color").hide(),$(".btn-image").show(),g.getElementById("texture"+s).parentElement.click()):"colorTexture"===a&&($(".btn-color").show(),$(".btn-image").hide(),g.getElementById("texture"+u).parentElement.click())}else if(("button"===this.type||"button"===this.nodeName.toLowerCase())&&N[this.id])N[this.id]()}function S(a){switch(a.button){case 0:wa[0]=0;K.isCurrentActionAlive=!1;break;case 1:wa[1]=0;break;case 2:wa[2]=0}}function U(a){switch(a.keyCode){case 67:fa();break;case 88:fa(!0)}}function ka(a){if(!wa[0])switch(a.keyCode){case 16:H.isInsertingFlag?
(H.insertMaterialOverrideFlag=!H.insertMaterialOverrideFlag,H.insertMaterialOverrideFlag?p("\u63d2\u5165\u65b9\u5757\u7684\u6750\u8d28\u5c06\u4f7f\u7528\u5f53\u524d\u9009\u62e9\u6750\u8d28"):p("\u63d2\u5165\u65b9\u5757\u7684\u6750\u8d28\u5c06\u4f7f\u7528\u539f\u6587\u4ef6\u4e2d\u7684\u6750\u8d28")):0===N.toolsType?(g.getElementById("eraser").parentElement.click(),p("\u5df2\u5207\u6362\u81f3\u64e6\u9664")):1===N.toolsType&&(g.getElementById("cube").parentElement.click(),p("\u5df2\u5207\u6362\u81f3\u753b\u7b14"));
break;case 90:a.ctrlKey&&K.undo();break;case 89:a.ctrlKey&&K.redo();break;case 27:H.isInsertingFlag&&H.endInsert()}}function I(){requestAnimationFrame(I);k.renderer.render(k.scene,k.camera);k.stats.update()}function B(){var a=$("#openModal input[type=radio]:checked").val();"-1"===a?($("#openModal").modal("hide"),p("\u6536\u85cf\u7684\u6587\u4ef6\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u80fd\u88ab\u4f5c\u8005\u5220\u9664\u6216\u9690\u85cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5220\u9664\u529f\u80fd\u5220\u9664\u6b64\u6536\u85cf\u6216\u8054\u7cfb\u4f5c\u8005")):
(g.getElementById("openIt").removeEventListener("click",B,!1),"0"===K.changed||1>O.length&&(!f||f&&!f.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&N.save(),a&&(new AV.Query(v)).get(a,{success:function(a){N.clearAll();K=new va;K.updateDom();f=a;b.loadCamera(a.get("camera"),!0);b.loadMeshes(a.get("meshes"),C,V.loadBoxAnimation,!0);a.get("user").id===AV.User.current().id&&(b.save(b.storageKeys.localChanges,"0"),b.save(b.storageKeys.boxName,f.get("name")),b.save(b.storageKeys.boxId,
f.id),b.save(b.storageKeys.updatedAt,f.updatedAt),b.save(b.storageKeys.camera),b.save(b.storageKeys.sidebar),b.save())}}),$("#openModal").modal("hide"))}function G(){var a;a="myBox"===$("#openModal input[type=radio]:checked").parent().parent()[0].id?"Box":"Keep";var b=$("#openModal input[type=radio]:checked").val();b&&confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&AV.Object.createWithoutData(a,b).destroy().then(function(a){p("\u5df2\u5220\u9664")},function(a){p("\u5220\u9664\u5931\u8d25")});
$("#openModal").modal("hide")}function ja(){g.getElementById("openIt").removeEventListener("click",ja,!1);var a=$("#openModal input[type=radio]:checked").val();"-1"===a?($("#openModal").modal("hide"),p("\u6536\u85cf\u7684\u6587\u4ef6\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u80fd\u88ab\u4f5c\u8005\u5220\u9664\u6216\u9690\u85cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5220\u9664\u529f\u80fd\u5220\u9664\u6b64\u6536\u85cf\u6216\u8054\u7cfb\u4f5c\u8005")):(a&&(new AV.Query(v)).get(a,{success:function(a){ua=a;H.isInsertingFlag=
!0;H.insertMeshes=b.dataStringToMeshes(ua.get("meshes"));H.addInsertHelperToScene(H.insertMeshes);p("\u6309\u4f4fctrl\u952e\u53ef\u63d2\u5165\u591a\u4e2a\uff0cshift\u5207\u6362\u4f7f\u7528\u7684\u6750\u8d28\uff0cESC\u53d6\u6d88\u63d2\u5165")},error:function(){p("\u8f7d\u5165\u5931\u8d25\uff0c\u65e0\u6cd5\u63d2\u5165")}}),$("#openModal").modal("hide"))}function la(a){a?($("#loginOpener").hide(),$("#logout").show(),$("#signInOpener").hide(),$("#loginMessage").html("\u4f60\u597d "+AV.User.current().escape("username")),
$("#loginMessage").show(),$("#open").removeAttr("disabled"),$("#newFile").removeAttr("disabled"),$("#share").removeAttr("disabled"),$("#delete").removeAttr("disabled"),$("#insert").removeAttr("disabled"),$("#keep").removeAttr("disabled"),$("#currentFileState").show(),$("#currentFileName").show()):($("#loginOpener").show(),$("#logout").hide(),$("#signInOpener").show(),$("#loginMessage").hide(),$("#open").attr("disabled","disabled"),$("#newFile").attr("disabled","disabled"),$("#share").attr("disabled",
"disabled"),$("#delete").attr("disabled","disabled"),$("#insert").attr("disabled","disabled"),$("#keep").attr("disabled","disabled"),$("#currentFileState").hide(),$("#currentFileName").hide())}function sa(){var a=f.escape("name")||"\u672a\u547d\u540d",b=("0"===K.changed?"\u672a\u4fee\u6539":"\u4fee\u6539\u672a\u4fdd\u5b58")+(f.id?" - \u4e91\u7aef\u5b58\u50a8":" - \u672c\u5730\u5b58\u50a8");$("#currentFileName").text("\u6587\u4ef6\u540d\uff1a"+a);$("#currentFileState").text("\u6587\u4ef6\u72b6\u6001\uff1a"+
b)}function p(a){GoUI.Animation.bubble($("#bubble"),a);sa()}var q=!1,c=g.createElement("a");c.id="imageCapture";c.style.display="none";c.target="_blank";g.body.appendChild(c);var v=AV.Object.extend("Box"),f=new v,ua=void 0,na=AV.Object.extend("Keep");new na;d=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};d.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=V.currentMeshes;V.currentIterator<a.length?a[V.currentIterator].meshObject.visible=
!0:(V.endFlag=!0,clearInterval(V.currentAnimationIntervalHandler));V.currentIterator++},begin:function(a,b,h){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,h||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=V.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var A=function(a){this.isLoadingBoxEnd=a};A.prototype={LOAD_TYPE:{async:0,
sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar",boxId:"vp_box_id",updatedAt:"vp_updatedAt",boxName:"vp_box_name",localChanges:"vp_local_changes"},load:function(a){return e.localStorage&&e.localStorage.getItem(a||this.storageKeys.meshes)},save:function(a,b){if(e.localStorage){var h="";if(b)h=b;else switch(a){default:case this.storageKeys.meshes:case void 0:for(var h=h+(t.width+":"),c=0,d=O.length;c<d;c++)h+=O[c].geo.id.replace("geo","")+",",h+=O[c].material.id.replace("texture",
"")+",",h+=O[c].meshObject.position.x+",",h+=O[c].meshObject.position.y+",",h+=O[c].meshObject.position.z+";";break;case this.storageKeys.camera:h+=k.controls.target.x+","+k.controls.target.y+","+k.controls.target.z+";";h+=k.controls.object.position.x+","+k.controls.object.position.y+","+k.controls.object.position.z+";";break;case this.storageKeys.sidebar:h+=s+","+u+","+N.texturesType+","+N.sidebarResize}e.localStorage.setItem(a||this.storageKeys.meshes,h)}},loadMeshes:function(a,b,h,c){this.isLoadingBoxEnd=
!1;var e=[],d=t.width;if(a=c?a:this.load(a))if(a=a.split(":"))2===a.length?(d=(Number(a[0])||50)/t.width,e=a[1].split(";")):(d=50/t.width,e=a[0].split(";"));if(0<e.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=e.length;b<a;b++){var f=e[b].split(",");2<f.length&&H.draw(Number(f[0]),Number(f[1]),[Number(f[2])/d,Number(f[3])/d,Number(f[4])/d])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=e.length;b<a;b++)f=e[b].split(","),2<f.length&&H.draw(Number(f[0]),Number(f[1]),
[Number(f[2])/d,Number(f[3])/d,Number(f[4])/d],void 0,void 0,!0);V.begin(h,O);c?p("\u8f7d\u5165\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b"):p("\u8f7d\u5165\u672c\u5730\u6570\u636e\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b")}else p("\u65e0\u672c\u5730\u6570\u636e\uff0c\u65b0\u5efa\u6587\u4ef6"),V.endFlag=!0},dataStringToMeshes:function(a){var b=[],h=[],c=t.width;a&&(a=a.split(":"))&&(2===a.length?(c=(Number(a[0])||
50)/t.width,b=a[1].split(";")):(c=50/t.width,b=a[0].split(";")));if(0<b.length){a=0;for(var e=b.length;a<e;a++){var d=b[a].split(",");if(2<d.length){var f=new r.Mesh(x[Number(d[0])||0].data,M[Number(d[1])||0].data);f.position.set(Number(d[2])/c,Number(d[3])/c,Number(d[4])/c);h.push(f)}}}return h},loadRemote:function(){if(e.localStorage){var a=this.load(this.storageKeys.boxId),c=this.load(this.storageKeys.updatedAt);if(a){p("\u8f7d\u5165\u4e91\u7aef\u6587\u4ef6...");var h=new AV.Query(v);h.select("name",
"user");h.equalTo("objectId",a);h.first({success:function(a){if(a.updatedAt.toString()===c)f=a,a.set("meshes",b.load(b.storageKeys.meshes)),a.set("camera",b.load(b.storageKeys.camera)),b.save(b.storageKeys.boxName,f.get("name")),K.changed=b.load(b.storageKeys.localChanges),b.loadCamera(f.get("camera"),!0),b.loadMeshes(f.get("meshes"),C,V.loadBoxAnimation,!0);else if(f=a,a.get("user").id===AV.User.current().id){var n=K.changed=b.load(b.storageKeys.localChanges);"0"===n||"0"!==n&&confirm("\u4e0a\u6b21\u5173\u95ed\u524d\u53ef\u80fd\u672a\u5b8c\u6210\u4fdd\u5b58\uff0c\u662f\u5426\u8f7d\u5165\u4e91\u7aef\u6587\u4ef6\uff1f\u82e5\u53d6\u6d88\u5219\u5c06\u672c\u5730\u7248\u672c\u89c6\u4e3a\u65b0\u6587\u4ef6")?
(n=new AV.Query(v),n.get(a.id,{success:function(a){f=a;b.loadCamera(f.get("camera"),!0);b.loadMeshes(f.get("meshes"),C,V.loadBoxAnimation,!0);b.save(b.storageKeys.boxName,f.get("name"));b.save(b.storageKeys.updatedAt,f.updatedAt);b.save(b.storageKeys.camera);b.save()},error:function(n,h){a.set("meshes",b.load(b.storageKeys.meshes));a.set("camera",b.load(b.storageKeys.camera));b.loadMeshes(void 0,C,V.loadBoxAnimation)}})):(f=new v,b.save(b.storageKeys.boxId,""),b.save(b.storageKeys.updatedAt,""),b.save(b.storageKeys.boxName,
""),b.save(b.storageKeys.localChanges,"1"),this.changed=1,b.loadMeshes(void 0,C,V.loadBoxAnimation),p("\u7531\u4e8e\u672c\u5730\u6b64\u6587\u4ef6\u4e0e\u4e91\u7aef\u6587\u4ef6\u5728\u540c\u4e00\u6587\u4ef6\u7684\u57fa\u7840\u4e0a\u505a\u4e86\u4e0d\u540c\u7684\u6539\u52a8\uff0c\u5c06\u672c\u5730\u7248\u672c\u4e0e\u4e91\u7aef\u6b64\u6587\u4ef6\u89c6\u4e3a\u4e0d\u540c\u7684\u6587\u4ef6"))}else n=new AV.Query(v),n.get(a.id,{success:function(a){f=a;b.loadCamera(f.get("camera"),!0);b.loadMeshes(f.get("meshes"),
C,V.loadBoxAnimation,!0)},error:function(a,n){b.loadMeshes(void 0,C,V.loadBoxAnimation)}})},error:function(a,n){p("\u8f7d\u5165\u5931\u8d25\uff0c"+n.message);b.loadMeshes(void 0,C,V.loadBoxAnimation)}})}else b.loadMeshes(void 0,C,V.loadBoxAnimation)}},loadShared:function(a,c){(new AV.Query(v)).get(a,{success:function(a){f=a;b.loadCamera(f.get("camera"),!0);b.loadMeshes(f.get("meshes"),C,V.loadBoxAnimation,!0);p("\u5df2\u8f7d\u5165\u5206\u4eab\u6587\u4ef6")},error:function(a,n){c()}})},loadCamera:function(a,
b){var h=[],c=b?a:this.load(a);c&&(h=c.split(";"));if(0<h.length){for(var c=0,d=h.length;c<d;c++){var e=h[c].split(",");switch(c){case 0:k.controls.target.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0);break;case 1:k.controls.object.position.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0)}}k.controls.update()}},loadSidebarSelectedButtons:function(a,b){var h=[],c=b?a:this.load(a);c&&(h=c.split(","));if(0<h.length)for(var c=0,e=h.length;c<e;c++){var d=h[c];if(""!==d&&!isNaN(Number(d)))switch(c){case 0:s=
Number(d)||0;break;case 1:u=Number(d)||0;break;case 2:1===Number(d)?g.getElementById("colorTexture").parentElement.click():g.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(d)?g.getElementById("minSidebar").parentElement.click():g.getElementById("normalSidebar").parentElement.click()}}else g.getElementById("imageTexture").parentElement.click()}};var va=function(){this.currentActionIndex=-1;this.actionArray=[];this.isCurrentActionAlive=void 0;this.changed="0"};va.prototype=
{undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=H.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var h=0,c=a.length;h<c;h++){var d=a[h];if(d)switch(b){case "draw":H.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":H.erase(d.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=
this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":H.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":H.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(n,c){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+
1:0;this.isCurrentActionAlive=!0;this.actionArray.push({type:n,meshes:c});this.currentActionIndex++;this.updateDom();if(a())if(confirm("\u786e\u5b9a\u8981\u4fee\u6539\u5417\uff1f\uff08\u5c06\u4f1a\u4f5c\u4e3a\u65b0\u5efa\u7684\u6587\u4ef6\u8986\u76d6\u672c\u5730\u4fdd\u5b58\u7684\u6570\u636e\uff09"))f=new v,b.save(b.storageKeys.boxId,""),b.save(b.storageKeys.updatedAt,""),b.save(b.storageKeys.boxName,""),b.save(b.storageKeys.localChanges,"1"),p("\u5df2\u6839\u636e\u5f53\u524d\u5185\u5bb9\u65b0\u5efa\u6587\u4ef6");
else{this.undo();return}this.changed=1;sa()},appendObjectToCurrentAction:function(a,b){var c=this.actionArray[this.currentActionIndex];if(!0!==this.isCurrentActionAlive)this.addAction(a,b);else if(void 0===c.meshes)c.meshes=b;else if(c.meshes instanceof Array||(c.meshes=[c.meshes]),b instanceof Array)for(var d=0,e=b.length;d<e;d++)c.meshes.push(b[d]);else c.meshes.push(b)},updateDom:function(){g.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;g.getElementById("redo").disabled=this.currentActionIndex>=
this.actionArray.length-1?!0:!1}};var Q=function(){this.isInsertingFlag=this.drawFlag=!1;this.insertMeshesBase=this.insertMeshes=void 0;this.insertMeshesNormal=new r.Vector3(0,1,0);this.insertTimes=0;this.insertMaterialOverrideFlag=!1};Q.prototype={calculateIntersectResult:D,setMeshPositionToFitTheGrid:L,updateHelperCube:W,adjustInsertMeshes:function(a){if(!a||1>a.length)return a;for(var b=new r.Vector3(t.width/2,t.width/2,t.width/2),c=a[0].position.length(),d=a[0].position.y,e=0,f=1,g=a.length;f<
g;f++){var k=a[f].position.y;k<d?(d=k,c=a[f].position.length(),e=f):k==d&&(k=a[f].position.length(),k<c&&(c=k,e=f))}b=(this.insertMeshesBase=a[e]).position.clone().sub(b);f=0;for(g=a.length;f<g;f++)a[f].position.sub(b);return a},offsetInsertMeshesBasedOnHelperBox:function(a){if(!a||1>a.length)return a;for(var b=new r.Vector3(t.width/2,t.width/2,t.width/2),b=X.position.clone().sub(b),c=0,d=a.length;c<d;c++)a[c].position.sub(b)},addInsertHelperToScene:function(a){this.adjustInsertMeshes(a);this.offsetInsertMeshesBasedOnHelperBox(a);
for(var b=0,c=a.length;b<c;b++)k.scene.add(a[b])},updateInsertHelper:function(a,b){if(b&&!(1>b.length)){var c=b[0];if(!a||!c||1>a.length)return a;var c=c.face.normal.clone(),d=new r.Quaternion;d.setFromUnitVectors(this.insertMeshesNormal,c);for(var e=X.position.clone().sub(this.insertMeshesBase.position),f=X.position.clone(),g=0,k=a.length;g<k;g++){a[g].position.add(e);var l=a[g].position.clone().sub(f);l.applyQuaternion(d);a[g].position.copy(f.clone().add(l));a[g].position.divideScalar(t.width).floor().multiplyScalar(t.width).addScalar(t.width/
2)}this.insertMeshesNormal=c}},endInsert:function(){for(var a=0,b=this.insertMeshes.length;a<b;a++)k.scene.remove(this.insertMeshes[a]);this.isInsertingFlag=!1;this.insertMeshesBase=this.insertMeshes=void 0;this.insertMeshesNormal=new r.Vector3(0,1,0);this.insertTimes=0;this.insertMaterialOverrideFlag=!1;p("\u63d2\u5165\u7ed3\u675f")},draw:function(a,b,c,d,e,f){if(void 0===a||"number"===typeof a)a=x[a||0];if(void 0===b||"number"===typeof b)b=M[b||0];var g=a.data,l=b.data;e=e||new r.Mesh(g,l);e.castShadow=
!0;e.receiveShadow=!0;d?L(e,d):e.position.set(c[0],c[1],c[2]);!f||(e.visible=!1);k.scene.add(e);ga.push(e);O.push({meshObject:e,geo:a,material:b});return O[O.length-1]},erase:function(a){k.scene.remove(a);a=ga.indexOf(a);if(!(0>a)){ga.splice(a,1);var b=O[a-1];O.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"},deleteMesh:function(a){a=a||this.insertMeshes;for(var b=[],c=0,d=a.length;c<d;c++)for(var e=0,f=O.length;e<f;e++){var g=O[e].meshObject;if(a[c].position.equals(g.position)){b.push(this.erase(g));
break}}return b},insert:function(a){a=a||this.insertMeshes;for(var b=[],c=0,e=a.length;c<e;c++){if(this.insertMaterialOverrideFlag)var d=this.draw(Da,ya,[a[c].position.x,a[c].position.y,a[c].position.z]);else{for(var f=d=0,g=x.length;f<g;f++)if(x[f].data===a[c].geometry){d=f;break}for(var g=f=0,k=M.length;g<k;g++)if(M[g].data===a[c].material){f=g;break}d=this.draw(d,f,[a[c].position.x,a[c].position.y,a[c].position.z],void 0,a[c].clone())}b.push(d)}return b}};r.ImageUtils.crossOrigin="Anonymous";var k,
t={width:50},ca=t.width/50,y={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*ca,basePlaneTextureRepeat:80,fogNear:8E3*ca,fogFar:25E3*ca,sphereRadius:25E3*ca},canvas:{ambientLightColor:9474192,directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*ca,basePlaneTextureRepeat:16,fogNear:2E3*ca,fogFar:3E3*ca,sphereRadius:3E3*ca}},da,ma,za,Aa=0,C=A.prototype.LOAD_TYPE.async,l=new r.MeshLambertMaterial({color:592137}),J={opacity:.5,transparent:!0},
M=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:l,helperData:R(J,l)}],x=[{name:"default",type:"1",id:"geo0",data:new r.BoxGeometry(t.width,t.width,t.width,1,1,1)}];s=30;u=0;var xa=!0,N={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleShadow:function(){w.castShadow=!w.castShadow;w.castShadow?p("\u9634\u5f71\u6253\u5f00"):p("\u9634\u5f71\u5173\u95ed")},toggleAux:function(){1===N.toolsType||(X.visible=!X.visible);(xa=!xa)?p("\u8f85\u52a9\u7269\u4f53\u6253\u5f00"):p("\u8f85\u52a9\u7269\u4f53\u5173\u95ed")},
capture:function(){var a=k.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var d=navigator.userAgent,f=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=f.exec(d)?b=parseFloat(RegExp.$1):(f=/rv:([0-9]{1,}[.0-9]{0,})/,null!=f.exec(d)&&(b=parseFloat(RegExp.$1)))}-1!==b?(e.navigator.saveBlob=e.navigator.saveBlob||e.navigator.msSaveBlob,a.msToBlob&&e.navigator.saveBlob?e.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):
(c.href=a.toDataURL(),c.download="capture.png",c.click())},clearAll:function(){V.endFlag||V.instantComplete(V.loadBoxAnimation);if(!(1>O.length)){var a=H.erase(O[0].meshObject);K.addAction("erase",a);for(var b=0,c=O.length;b<c;b++)a=H.erase(O[0].meshObject),K.appendObjectToCurrentAction("erase",a)}},undo:function(){K.undo()},redo:function(){K.redo()},signInOpener:function(){$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");$("#signInError").parent().hide();$("#signInModal").modal("show");
$("#signInEmail").focus()},loginOpener:function(){$("#loginUsername").val("");$("#loginPassword").val("");$("#loginError").parent().hide();$("#loginModal").modal("show");$("#loginUsername").focus()},logout:function(){AV.User.current()&&AV.User.logOut();la(!1);p("\u5df2\u767b\u51fa")},save:function(){if(AV.User.current()){if("0"!==K.changed||f.id){var a;a=""+(t.width+":");for(var c=0,d=O.length;c<d;c++)a+=O[c].geo.id.replace("geo","")+",",a+=O[c].material.id.replace("texture","")+",",a+=O[c].meshObject.position.x+
",",a+=O[c].meshObject.position.y+",",a+=O[c].meshObject.position.z+";";c=""+(k.controls.target.x+","+k.controls.target.y+","+k.controls.target.z+";");c+=k.controls.object.position.x+","+k.controls.object.position.y+","+k.controls.object.position.z+";";f.set("camera",c||"0,0,0;1000,500,1000");f.set("meshes",a||"");f.id||(a=prompt("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d",f.get("name")||b.load(b.storageKeys.boxName)||"\u672a\u547d\u540d"),f.set("name",a||"\u672a\u547d\u540d"),f.set("user",AV.User.current()),
f.setACL(new AV.ACL(AV.User.current())));f.save({success:function(a){p("\u5df2\u4fdd\u5b58\u81f3\u4e91\u7aef");b.save(b.storageKeys.updatedAt,a.updatedAt);b.save(b.storageKeys.boxId,a.id);b.save(b.storageKeys.boxName,a.get("name"))},error:function(a,c){p("\u4e91\u7aef\u4fdd\u5b58\u5931\u8d25\uff0c\u5c06\u4f1a\u4fdd\u5b58\u5728\u672c\u5730"+c.message);b.save(b.storageKeys.boxName,a.get("name"));K.changed="1";b.save(b.storageKeys.localChanges,"1")}})}else p("\u6587\u4ef6\u672a\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u5c06\u672c\u5730\u4fdd\u5b58");
K.changed="0";b.save(b.storageKeys.localChanges,"0");b.save(b.storageKeys.camera);b.save(b.storageKeys.sidebar);b.save()}else b.save(b.storageKeys.camera),b.save(b.storageKeys.sidebar),b.save(),a="\u5df2\u4fdd\u5b58\u5728\u672c\u5730",q||(a+="\uff0c\u767b\u5f55\u540e\u53ef\u5411\u4e91\u7aef\u4fdd\u5b58\u591a\u4e2a\u6587\u4ef6",q=!0),p(a)},newFile:function(){"0"===K.changed||1>O.length&&(!f||f&&!f.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&N.save();N.clearAll();K=new va;
K.updateDom();f=new v;b.save(b.storageKeys.localChanges,"0");b.save(b.storageKeys.camera);b.save(b.storageKeys.sidebar);b.save(b.storageKeys.updatedAt,"");b.save(b.storageKeys.boxName,"");b.save();p("\u65b0\u5efa")},open:function(){g.getElementById("openIt").removeEventListener("click",B,!1);g.getElementById("openIt").removeEventListener("click",G,!1);g.getElementById("openIt").removeEventListener("click",ja,!1);g.getElementById("openIt").addEventListener("click",B,!1);var a=new AV.Query(v);a.select("name");
a.equalTo("user",AV.User.current());var b=new AV.Query(na);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());Y(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},share:function(){var a=new AV.Query(v);a.select("name");a.equalTo("user",AV.User.current());Y(a.find(),void 0,"shareModal",["boxToShare"])},"delete":function(){g.getElementById("openIt").removeEventListener("click",
B,!1);g.getElementById("openIt").removeEventListener("click",G,!1);g.getElementById("openIt").removeEventListener("click",ja,!1);g.getElementById("openIt").addEventListener("click",G,!1);var a=new AV.Query(v);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(na);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());Y(a.find(),b.find(),void 0,void 0,!0);$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");
$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},keep:function(){if(f&&f.id){var a=AV.Object.createWithoutData("Box",f.id),b=new AV.Query(na);b.equalTo("user",AV.User.current());b.equalTo("box",a);b.count().then(function(b){0<b?p("\u60a8\u5df2\u6536\u85cf\u8fc7\u6b64\u6587\u4ef6"):(b=new na,b.set("box",a),b.set("name",prompt("\u6536\u85cf\u540d\u79f0")),b.set("user",AV.User.current()),b.setACL(new AV.ACL(AV.User.current())),b.save().then(function(){p("\u5df2\u6536\u85cf")},
function(){p("\u6536\u85cf\u5931\u8d25")}))},function(a){p("\u6536\u85cf\u5931\u8d25")})}else p("\u53ea\u80fd\u6536\u85cf\u5df2\u4fdd\u5b58\u7684\u6587\u4ef6")},insert:function(){g.getElementById("openIt").removeEventListener("click",B,!1);g.getElementById("openIt").removeEventListener("click",G,!1);g.getElementById("openIt").removeEventListener("click",ja,!1);g.getElementById("openIt").addEventListener("click",ja,!1);var a=new AV.Query(v);a.select("name");a.equalTo("user",AV.User.current());var b=
new AV.Query(na);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());Y(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")}},ya=0,T=M[0],Z=T.data,Ca=T.helperData,Da=0,Ea=x[0].data,X,ga=[],O=[],pa,w,ha,Ba,wa=[0,0,0],qa,ta,V=new d,b=new A(!1),K=new va,H=new Q,Fa=0;k=new m(g.body);k.init(function(a){if(k.WINDOW_WIDTH!==
e.innerWidth||k.WINDOW_HEIGHT!==e.innerHeight)k.WINDOW_WIDTH=e.innerWidth,k.WINDOW_HEIGHT=e.innerHeight,k.WINDOW_HEIGHT_HALF=k.WINDOW_HEIGHT/2,k.WINDOW_WIDTH_HALF=k.WINDOW_WIDTH/2,k.camera.aspect=k.WINDOW_WIDTH/k.WINDOW_HEIGHT,k.camera.updateProjectionMatrix(),k.renderer.setSize(k.WINDOW_WIDTH,k.WINDOW_HEIGHT),g.body.height=k.WINDOW_HEIGHT},function(){da=new r.PlaneBufferGeometry(y[k.renderType].basePlaneWidth,y[k.renderType].basePlaneWidth,y[k.renderType].basePlaneSegments,y[k.renderType].basePlaneSegments);
da.applyMatrix((new r.Matrix4).makeRotationX(-Math.PI/2));var a=r.ImageUtils.loadTexture("texture/grasslight-big.jpg"),b=r.ImageUtils.loadTexture("texture/sky.jpg");a.wrapT=a.wrapS=r.RepeatWrapping;a.repeat.set(y[k.renderType].basePlaneTextureRepeat,y[k.renderType].basePlaneTextureRepeat);za=new r.MeshPhongMaterial({ambient:16777215,color:14535731,map:a,bumpMap:a,bumpScale:3,specular:3364147,shininess:15,emissive:16777215});ma=new r.Mesh(da,za);ma.receiveShadow=!0;ma.material.side=r.DoubleSide;k.scene.add(ma);
ga.push(ma);pa=new r.AmbientLight(y[k.renderType].ambientLightColor);k.scene.add(pa);w=new r.DirectionalLight(15658734,y[k.renderType].directionalLightDensity);w.position.set(0,6E3,5E3);w.target.position.set(0,0,0);w.castShadow=!0;w.shadowCameraNear=k.camera.near;w.shadowCameraFar=k.camera.far;w.shadowCameraFov=k.cam;w.shadowCameraTop=-1024*ca;w.shadowCameraLeft=-1024*ca;w.shadowCameraBottom=1024*ca;w.shadowCameraRight=1024*ca;w.shadowBias=2E-5;w.shadowDarkness=.4;w.shadowMapWidth=2048*ca;w.shadowMapHeight=
2048*ca;k.scene.add(w);ha=new r.HemisphereLight(16777215,6316128,1);k.scene.add(ha);a=new r.SphereGeometry(y[k.renderType].sphereRadius,32,15,0,2*Math.PI,0,Math.PI/2);b=new r.MeshLambertMaterial({color:3368703,map:b,side:r.BackSide,emissive:16777215});b=new r.Mesh(a,b);k.scene.add(b);X=new r.Mesh(Ea,Ca);X.position.set(t.width/2,t.width/2,t.width/2);k.scene.add(X);new r.Mesh(Ea,Z);qa=new r.Raycaster;Ba=new r.Vector2;ta=new r.FogExp2(16777215,5.3E-5);k.scene.fog=ta;k.controls.settings.boxScale=ca;k.renderer.setClearColor(15790320);
k.renderer.shadowMapEnabled=!0;k.renderer.shadowMapType=r.PCFSoftShadowMap;k.renderer.shadowMapCullFace=r.CullFaceBack;k.renderer.gammaInput=!0;k.renderer.gammaOutput=!0;e.addEventListener("unload",aa,!1);e.addEventListener("reload",ia,!1);k.renderer.domElement.addEventListener("mousemove",ba,!1);k.renderer.domElement.addEventListener("mousedown",oa,!1);k.renderer.domElement.addEventListener("mouseup",S,!1);g.addEventListener("keydown",U,!1);g.addEventListener("keyup",ka,!1);setInterval(ea,12E4)});
I();A={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"buttonGroup",id:"accountControl",name:"accountControl",buttonType:"button",appendClass:"btn-group-accountbtn",buttons:[{title:"\u6ce8\u518c",id:"signInOpener"},{title:"\u767b\u5f55",id:"loginOpener"},{title:"\u767b\u51fa",id:"logout"},{title:"\u767b\u5f55\u540e\u65b9\u53ef\u4fdd\u5b58\u6570\u636e\u5230\u4e91\u7aef",
id:"loginMessage"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]},{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",
buttons:[{title:"\u64a4\u9500",id:"undo"},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6587\u4ef6",name:"files",id:"panelFiles",children:[{UIType:"buttonGroup",id:"currentFileNameGroup",name:"cfn",buttonType:"button",appendClass:"btn-group-cfnbtn",buttons:[{title:"",id:"currentFileName"}]},{UIType:"buttonGroup",id:"currentFileStateGroup",name:"cfs",buttonType:"button",appendClass:"btn-group-cfsbtn",buttons:[{title:"",id:"currentFileState"}]},{UIType:"buttonGroup",id:"buttonGroupADM",
name:"adm",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u65b0\u5efa",id:"newFile"},{title:"\u4fdd\u5b58",id:"save"},{title:"\u6536\u85cf",id:"keep"},{title:"\u6253\u5f00...",id:"open"},{title:"\u63d2\u5165...",id:"insert"},{title:"\u5220\u9664...",id:"delete"},{title:"\u5171\u4eab...",id:"share"}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",
name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u9634\u5f71\u5f00\u5173",id:"toggleShadow"},{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux"},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",
id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:M[0].type,bgTypeData:M[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>k.WINDOW_WIDTH){Q=A.children;d=0;for(m=Q.length;d<m;d++)if("sidebarResize"===Q[d].id){d=Q[d].buttons;Q=0;for(m=d.length;Q<m;Q++)"normalSidebar"===d[Q].id&&delete d[Q].checked,"minSidebar"===d[Q].id&&(d[Q].checked=!0);break}N.sidebarResize=1}else N.sidebarResize=
0;GoUI.Utils.domCreationDirector(A);K.updateDom();m=g.querySelectorAll(".btn");if(m instanceof Array||m.length)for(d=m.length-1;0<=d;d--)m[d].addEventListener("click",ra,!1);else m instanceof object&&m.addEventListener("click",ra,!1);Q=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},
{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];d=0;for(m=Q.length;d<m;d++)A={name:Q[d].color,type:"color",id:"texture"+(d+1),uniqueData:Q[d].color,data:new r.MeshLambertMaterial({color:Q[d].color})},M.push(A),GoUI.map.buttonGroup2.addButton({title:"",id:A.id,bgType:A.type,bgTypeData:A.uniqueData,
width:50,height:50}).addEventListener("click",ra,!1);Q="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");d=0;for(m=Q.length;d<m;d++)A={name:Q[d].replace("texture/","").replace(".png",""),type:"image",id:"texture"+M.length,uniqueData:Q[d],data:new r.MeshLambertMaterial({map:r.ImageUtils.loadTexture(Q[d]),transparent:!0})},"glass"===A.data.name&&(A.data.map.opacity=.3),A.data.map.magFilter=r.NearestFilter,
A.data.map.minFilter=r.LinearMipMapLinearFilter,M.push(A),GoUI.map.buttonGroup2.addButton({title:"",id:A.id,bgType:A.type,bgTypeData:A.uniqueData,width:50,height:50}).addEventListener("click",ra,!1);$("#loginUsername").on("keyup",function(a){13===a.which&&g.getElementById("login").click()});$("#loginPassword").on("keyup",function(a){13===a.which&&g.getElementById("login").click()});g.getElementById("login").addEventListener("click",function(){var a=$("#loginUsername").val(),c=$("#loginPassword").val(),
d=$("#login");d.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.logIn(a,c,{success:function(a){la(!0);d.removeAttr("disabled");$("#loginModal").modal("hide");p("\u4f60\u597d"+AV.User.current().escape("username"));$("#loginUsername").val("");$("#loginPassword").val("");b.loadRemote()},error:function(a,b){$("#loginError").html(b.message);$("#loginError").parent().show();d.removeAttr("disabled")}})},!1);g.getElementById("signIn").addEventListener("click",function(){var a=$("#signInEmail").val(),
c=$("#signInUsername").val(),d=$("#signInPassword").val(),e=$("#signIn");e.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.signUp(c,d,{ACL:new AV.ACL,email:a},{success:function(a){la(!0);e.removeAttr("disabled");$("#signInModal").modal("hide");p("\u4f60\u597d"+AV.User.current().escape("username"));$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");b.loadRemote()},error:function(a,b){$("#signInError").html(b.message);$("#signInError").parent().show();
e.removeAttr("disabled")}})},!1);g.getElementById("shareIt").addEventListener("click",function(){var a=$("#shareModal input[type=radio]:checked").val();if(a){var b=new AV.Query(v);b.equalTo("objectId",a);b.select("shared");b.first().then(function(b){if(!b.get("shared")){var c=new AV.ACL(AV.User.current());c.setPublicReadAccess(!0);b.setACL(c);b.set("shared",!0);b.save().then(function(){p("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")},
function(){p("\u5206\u4eab\u5931\u8d25")})}$("#shareLink").val("http://gonster.github.io/helloThreeJS/voxel-paint#"+a);p("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")})}},!1);g.getElementById("setItPrivate").addEventListener("click",function(){var a=$("#shareModal input[type=radio]:checked").val();if(a){var b=new AV.Query(v);b.equalTo("objectId",a);b.select("shared");b.first().then(function(a){if(a.get("shared")){var b=new AV.ACL(AV.User.current());
a.setACL(b);a.set("shared",!1);a.save().then(function(){p("\u53d6\u6d88\u5206\u4eab\u6210\u529f")},function(){p("\u53d6\u6d88\u5206\u4eab\u5931\u8d25")})}})}},!1);b.loadCamera(b.storageKeys.camera);b.loadSidebarSelectedButtons(b.storageKeys.sidebar);AV.User.current()?(la(!0),(m=e.location.hash)?(m=m.substring(1),b.loadShared(m,function(){p("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25");b.loadRemote()})):b.loadRemote()):(la(!1),(m=e.location.hash)?(m=m.substring(1),b.loadShared(m,function(){p("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25");
b.loadMeshes(void 0,C,V.loadBoxAnimation)})):b.loadMeshes(void 0,C,V.loadBoxAnimation));e.addEventListener("hashchange",function(){var a=e.location.hash;a&&(a=a.substring(1),b.loadShared(a,function(){p("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25")}))},!1);$(".modal").on("hidden.bs.modal",function(){g.addEventListener("keydown",U,!1);g.addEventListener("keyup",ka,!1);k.controls.addKeyEventListener()});$(".modal").on("shown.bs.modal",function(){g.removeEventListener("keydown",U,!1);g.removeEventListener("keyup",
ka,!1);k.controls.removeKeyEventListener()})})(window,document,Base,THREE,Detector);
