THREE.SpriteCanvasMaterial=function(g){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,d){};this.setValues(g)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var g=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,g);g.color.copy(this.color);g.program=this.program;return g};
THREE.CanvasRenderer=function(g){function h(l,a,M,c){G(a);J(M);H(c);N(l.getStyle());b.stroke();fa.expandByScalar(2*a)}function d(l){z(l.getStyle());b.fill()}function p(l){q(l.target)}function q(l){if(!(l instanceof THREE.CompressedTexture)){var a=l.wrapS===THREE.RepeatWrapping,M=l.wrapT===THREE.RepeatWrapping,c=l.image,f=document.createElement("canvas");f.width=c.width;f.height=c.height;var d=f.getContext("2d");d.setTransform(1,0,0,-1,0,c.height);d.drawImage(c,0,0);A[l.id]=b.createPattern(f,!0===
a&&!0===M?"repeat":!0===a&&!1===M?"repeat-x":!1===a&&!0===M?"repeat-y":"no-repeat")}}function a(l,a,M,c,f,d,k,g,da,h,v,S,e){if(!(e instanceof THREE.DataTexture)){!1===e.hasEventListener("update",p)&&(void 0!==e.image&&0<e.image.width&&q(e),e.addEventListener("update",p));var n=A[e.id];if(void 0!==n){z(n);var n=e.offset.x/e.repeat.x,t=e.offset.y/e.repeat.y,ka=e.image.width*e.repeat.x;e=e.image.height*e.repeat.y;k=(k+n)*ka;g=(g+t)*e;M-=l;c-=a;f-=l;d-=a;da=(da+n)*ka-k;h=(h+t)*e-g;v=(v+n)*ka-k;S=(S+t)*
e-g;e=da*S-v*h;0!==e&&(n=1/e,e=(S*M-h*f)*n,h=(S*c-h*d)*n,M=(da*f-v*M)*n,c=(da*d-v*c)*n,l=l-e*k-M*g,a=a-h*k-c*g,b.save(),b.transform(e,h,M,c,l,a),b.fill(),b.restore())}else z("rgba(0,0,0,1)"),b.fill()}}function e(l,a,M){var c=a.x-l.x,b=a.y-l.y,f=c*c+b*b;0!==f&&(M/=Math.sqrt(f),c*=M,b*=M,a.x+=c,a.y+=b,l.x-=c,l.y-=b)}function r(l){W!==l&&(W=b.globalAlpha=l)}function X(l){va!==l&&(l===THREE.NormalBlending?b.globalCompositeOperation="source-over":l===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
l===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),va=l)}function G(l){oa!==l&&(oa=b.lineWidth=l)}function J(l){B!==l&&(B=b.lineCap=l)}function H(l){ua!==l&&(ua=b.lineJoin=l)}function N(l){C!==l&&(C=b.strokeStyle=l)}function z(l){ga!==l&&(ga=b.fillStyle=l)}function F(l){ha.length!==l.length&&(b.setLineDash(l),ha=l)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ma=THREE.Math.smoothstep;g=g||{};var la=this,ca,Q,ia,ra=new THREE.Projector,w=void 0!==g.canvas?g.canvas:document.createElement("canvas"),
O=w.width,n=w.height,m=Math.floor(O/2),s=Math.floor(n/2),Y=0,k=0,U=O,P=n,c=1,b=w.getContext("2d",{alpha:!0===g.alpha}),aa=new THREE.Color(0),R=!0===g.alpha?0:1,W=1,va=0,C=null,ga=null,oa=null,B=null,ua=null,ha=[],na,y,S,T;new THREE.RenderableVertex;new THREE.RenderableVertex;var wa,sa,t,f,x,ya,v=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var ta=new THREE.Color,za=new THREE.Color,ja=new THREE.Color,A={},E,ea,V,l,M,da,xa,ka=new THREE.Box2,I=new THREE.Box2,fa=new THREE.Box2,
Ba=new THREE.Color,Ca=new THREE.Color,Da=new THREE.Color,pa=new THREE.Vector3,Ea=new THREE.Vector3,qa=new THREE.Vector3,Aa=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=w;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return c};this.setPixelRatio=function(l){c=l};this.setSize=function(l,a,M){O=l*c;n=a*c;w.width=
O;w.height=n;m=Math.floor(O/2);s=Math.floor(n/2);!1!==M&&(w.style.width=l+"px",w.style.height=a+"px");ka.min.set(-m,-s);ka.max.set(m,s);I.min.set(-m,-s);I.max.set(m,s);W=1;va=0;ua=B=oa=ga=C=null;this.setViewport(0,0,l,a)};this.setViewport=function(l,a,M,b){Y=l*c;k=a*c;U=M*c;P=b*c};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(l,a){aa.set(l);R=void 0!==a?a:1;I.min.set(-m,-s);I.max.set(m,s)};this.setClearColorHex=function(l,a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(l,a)};this.getClearColor=function(){return aa};this.getClearAlpha=function(){return R};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===I.empty()&&(I.intersect(ka),I.expandByScalar(2),I.min.x+=m,I.min.y=-I.min.y+s,I.max.x+=m,I.max.y=-I.max.y+s,1>R&&b.clearRect(I.min.x|0,I.max.y|0,I.max.x-I.min.x|0,I.min.y-I.max.y|0),0<R&&(X(THREE.NormalBlending),r(1),z("rgba("+Math.floor(255*aa.r)+","+Math.floor(255*aa.g)+","+Math.floor(255*aa.b)+","+R+")"),b.fillRect(I.min.x|
0,I.max.y|0,I.max.x-I.min.x|0,I.min.y-I.max.y|0)),I.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,g){if(!1===g instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();la.info.render.vertices=0;la.info.render.faces=0;b.setTransform(U/O,0,0,-P/n,Y,n-k);b.translate(m,s);ca=ra.projectScene(c,g,this.sortObjects,this.sortElements);
Q=ca.elements;ia=ca.lights;na=g;Aa.getNormalMatrix(g.matrixWorldInverse);Ba.setRGB(0,0,0);Ca.setRGB(0,0,0);Da.setRGB(0,0,0);for(var aa=0,R=ia.length;aa<R;aa++){var u=ia[aa],L=u.color;u instanceof THREE.AmbientLight?Ba.add(L):u instanceof THREE.DirectionalLight?Ca.add(L):u instanceof THREE.PointLight&&Da.add(L)}aa=0;for(R=Q.length;aa<R;aa++){var D=Q[aa],B=D.material;if(void 0!==B&&0!==B.opacity){fa.makeEmpty();if(D instanceof THREE.RenderableSprite){y=D;y.x*=m;y.y*=s;var u=y,K=D,L=B;r(L.opacity);X(L.blending);
var C=K.scale.x*m,K=K.scale.y*s,D=.5*Math.sqrt(C*C+K*K);fa.min.set(u.x-D,u.y-D);fa.max.set(u.x+D,u.y+D);if(L instanceof THREE.SpriteMaterial){var Z=L.map;if(null!==Z&&void 0!==Z.image){!1===Z.hasEventListener("update",p)&&(0<Z.image.width&&q(Z),Z.addEventListener("update",p));D=A[Z.id];void 0!==D?z(D):z("rgba( 0, 0, 0, 1 )");var ba=Z.image,D=ba.width*Z.offset.x,B=ba.height*Z.offset.y,w=ba.width*Z.repeat.x,Z=ba.height*Z.repeat.y,ba=C/w,ha=K/Z;b.save();b.translate(u.x,u.y);0!==L.rotation&&b.rotate(L.rotation);
b.translate(-C/2,-K/2);b.scale(ba,ha);b.translate(-D,-B);b.fillRect(D,B,w,Z)}else z(L.color.getStyle()),b.save(),b.translate(u.x,u.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(C,-K),b.fillRect(-.5,-.5,1,1);b.restore()}else L instanceof THREE.SpriteCanvasMaterial&&(N(L.color.getStyle()),z(L.color.getStyle()),b.save(),b.translate(u.x,u.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(C,K),L.program(b),b.restore())}else if(D instanceof THREE.RenderableLine){if(y=D.v1,S=D.v2,y.positionScreen.x*=m,y.positionScreen.y*=
s,S.positionScreen.x*=m,S.positionScreen.y*=s,fa.setFromPoints([y.positionScreen,S.positionScreen]),!0===ka.isIntersectionBox(fa))if(u=y,L=S,C=D,K=B,r(K.opacity),X(K.blending),b.beginPath(),b.moveTo(u.positionScreen.x,u.positionScreen.y),b.lineTo(L.positionScreen.x,L.positionScreen.y),K instanceof THREE.LineBasicMaterial){G(K.linewidth);J(K.linecap);H(K.linejoin);if(K.vertexColors!==THREE.VertexColors)N(K.color.getStyle());else if(D=C.vertexColors[0].getStyle(),C=C.vertexColors[1].getStyle(),D===
C)N(D);else{try{var ga=b.createLinearGradient(u.positionScreen.x,u.positionScreen.y,L.positionScreen.x,L.positionScreen.y);ga.addColorStop(0,D);ga.addColorStop(1,C)}catch(oa){ga=D}N(ga)}b.stroke();fa.expandByScalar(2*K.linewidth)}else K instanceof THREE.LineDashedMaterial&&(G(K.linewidth),J(K.linecap),H(K.linejoin),N(K.color.getStyle()),F([K.dashSize,K.gapSize]),b.stroke(),fa.expandByScalar(2*K.linewidth),F([]))}else if(D instanceof THREE.RenderableFace){y=D.v1;S=D.v2;T=D.v3;if(-1>y.positionScreen.z||
1<y.positionScreen.z)continue;if(-1>S.positionScreen.z||1<S.positionScreen.z)continue;if(-1>T.positionScreen.z||1<T.positionScreen.z)continue;y.positionScreen.x*=m;y.positionScreen.y*=s;S.positionScreen.x*=m;S.positionScreen.y*=s;T.positionScreen.x*=m;T.positionScreen.y*=s;0<B.overdraw&&(e(y.positionScreen,S.positionScreen,B.overdraw),e(S.positionScreen,T.positionScreen,B.overdraw),e(T.positionScreen,y.positionScreen,B.overdraw));fa.setFromPoints([y.positionScreen,S.positionScreen,T.positionScreen]);
if(!0===ka.isIntersectionBox(fa)){L=y;C=S;K=T;u=B;la.info.render.vertices+=3;la.info.render.faces++;r(u.opacity);X(u.blending);wa=L.positionScreen.x;sa=L.positionScreen.y;t=C.positionScreen.x;f=C.positionScreen.y;x=K.positionScreen.x;ya=K.positionScreen.y;var B=wa,w=sa,Z=t,ba=f,ha=x,W=ya;b.beginPath();b.moveTo(B,w);b.lineTo(Z,ba);b.lineTo(ha,W);b.closePath();if((u instanceof THREE.MeshLambertMaterial||u instanceof THREE.MeshPhongMaterial)&&null===u.map){ta.copy(u.color);za.copy(u.emissive);u.vertexColors===
THREE.FaceColors&&ta.multiply(D.color);v.copy(Ba);Ea.copy(L.positionWorld).add(C.positionWorld).add(K.positionWorld).divideScalar(3);L=Ea;C=D.normalModel;K=v;D=0;for(B=ia.length;D<B;D++)w=ia[D],ja.copy(w.color),w instanceof THREE.DirectionalLight?(Z=pa.setFromMatrixPosition(w.matrixWorld).normalize(),ba=C.dot(Z),0>=ba||(ba*=w.intensity,K.add(ja.multiplyScalar(ba)))):w instanceof THREE.PointLight&&(Z=pa.setFromMatrixPosition(w.matrixWorld),ba=C.dot(pa.subVectors(Z,L).normalize()),0>=ba||(ba*=0==w.distance?
1:1-Math.min(L.distanceTo(Z)/w.distance,1),0!=ba&&(ba*=w.intensity,K.add(ja.multiplyScalar(ba)))));v.multiply(ta).add(za);!0===u.wireframe?h(v,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):d(v)}else u instanceof THREE.MeshBasicMaterial||u instanceof THREE.MeshLambertMaterial||u instanceof THREE.MeshPhongMaterial?null!==u.map?u.map.mapping===THREE.UVMapping&&(E=D.uvs,a(wa,sa,t,f,x,ya,E[0].x,E[0].y,E[1].x,E[1].y,E[2].x,E[2].y,u.map)):null!==u.envMap?u.envMap.mapping===THREE.SphericalReflectionMapping&&
(qa.copy(D.vertexNormalsModel[0]).applyMatrix3(Aa),ea=.5*qa.x+.5,V=.5*qa.y+.5,qa.copy(D.vertexNormalsModel[1]).applyMatrix3(Aa),l=.5*qa.x+.5,M=.5*qa.y+.5,qa.copy(D.vertexNormalsModel[2]).applyMatrix3(Aa),da=.5*qa.x+.5,xa=.5*qa.y+.5,a(wa,sa,t,f,x,ya,ea,V,l,M,da,xa,u.envMap)):(v.copy(u.color),u.vertexColors===THREE.FaceColors&&v.multiply(D.color),!0===u.wireframe?h(v,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):d(v)):(u instanceof THREE.MeshDepthMaterial?v.r=v.g=v.b=1-ma(L.positionScreen.z*
L.positionScreen.w,na.near,na.far):u instanceof THREE.MeshNormalMaterial?(qa.copy(D.normalModel).applyMatrix3(Aa),v.setRGB(qa.x,qa.y,qa.z).multiplyScalar(.5).addScalar(.5)):v.setRGB(1,1,1),!0===u.wireframe?h(v,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):d(v))}}I.union(fa)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(g){this.positionWorld.copy(g.positionWorld);this.positionScreen.copy(g.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function g(){if(H===z){var a=new THREE.RenderableVertex;N.push(a);z++;H++;return a}return N[H++]}function h(){if(ma===ca){var a=new THREE.RenderableFace;la.push(a);ca++;ma++;return a}return la[ma++]}function d(){if(ia===w){var a=new THREE.RenderableLine;ra.push(a);w++;ia++;return a}return ra[ia++]}function p(){if(n===s){var a=new THREE.RenderableSprite;m.push(a);s++;n++;return a}return m[n++]}function q(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function a(a,
c){var b=0,d=1,g=a.z+a.w,f=c.z+c.w,e=-a.z+a.w,k=-c.z+c.w;if(0<=g&&0<=f&&0<=e&&0<=k)return!0;if(0>g&&0>f||0>e&&0>k)return!1;0>g?b=Math.max(b,g/(g-f)):0>f&&(d=Math.min(d,g/(g-f)));0>e?b=Math.max(b,e/(e-k)):0>k&&(d=Math.min(d,e/(e-k)));if(d<b)return!1;a.lerp(c,b);c.lerp(a,1-d);return!0}var e,r,X=[],G=0,J,H,N=[],z=0,F,ma,la=[],ca=0,Q,ia,ra=[],w=0,O,n,m=[],s=0,Y={objects:[],lights:[],elements:[]},k=new THREE.Vector3,U=new THREE.Vector3,P=new THREE.Vector3,c=new THREE.Vector3,b=new THREE.Vector4,aa=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),R=new THREE.Box3,W=Array(3),va=new THREE.Matrix4,C=new THREE.Matrix4,ga,oa=new THREE.Matrix4,B=new THREE.Matrix3,ua=new THREE.Frustum,ha=new THREE.Vector4,na=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var y=new function(){var a=[],c=[],b=null,e=null,k=new THREE.Matrix3,f=function(a){var c=a.positionWorld,b=a.positionScreen;c.copy(a.position).applyMatrix4(ga);b.copy(c).applyMatrix4(C);c=1/b.w;b.x*=c;b.y*=c;b.z*=c;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},q=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;W[0]=a.positionScreen;W[1]=b.positionScreen;W[2]=c.positionScreen;return aa.isIntersectionBox(R.setFromPoints(W))},n=function(a,b,c){return 0>(c.positionScreen.x-
a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(f){b=f;e=b.material;k.getNormalMatrix(b.matrixWorld);a.length=0;c.length=0},projectVertex:f,checkTriangleVisibility:q,checkBackfaceCulling:n,pushVertex:function(a,b,c){J=g();J.position.set(a,b,c);f(J)},pushNormal:function(b,c,f){a.push(b,c,f)},pushUv:function(a,b){c.push(a,b)},pushLine:function(a,c){var f=N[a],e=N[c];Q=d();Q.id=b.id;
Q.v1.copy(f);Q.v2.copy(e);Q.z=(f.positionScreen.z+e.positionScreen.z)/2;Q.material=b.material;Y.elements.push(Q)},pushTriangle:function(f,d,g){var p=N[f],m=N[d],r=N[g];if(!1!==q(p,m,r)&&(e.side===THREE.DoubleSide||!0===n(p,m,r))){F=h();F.id=b.id;F.v1.copy(p);F.v2.copy(m);F.v3.copy(r);F.z=(p.positionScreen.z+m.positionScreen.z+r.positionScreen.z)/3;for(p=0;3>p;p++)m=3*arguments[p],r=F.vertexNormalsModel[p],r.set(a[m],a[m+1],a[m+2]),r.applyMatrix3(k).normalize(),m=2*arguments[p],F.uvs[p].set(c[m],c[m+
1]);F.vertexNormalsLength=3;F.material=b.material;Y.elements.push(F)}}}};this.projectScene=function(m,s,aa,J){n=ia=ma=0;Y.elements.length=0;!0===m.autoUpdate&&m.updateMatrixWorld();void 0===s.parent&&s.updateMatrixWorld();va.copy(s.matrixWorldInverse.getInverse(s.matrixWorld));C.multiplyMatrices(s.projectionMatrix,va);ua.setFromMatrix(C);r=0;Y.objects.length=0;Y.lights.length=0;m.traverseVisible(function(a){if(a instanceof THREE.Light)Y.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===ua.intersectsObject(a))){if(r===G){var l=new THREE.RenderableObject;X.push(l);G++;r++;e=l}else e=X[r++];e.id=a.id;e.object=a;c.setFromMatrixPosition(a.matrixWorld);c.applyProjection(C);e.z=c.z;Y.objects.push(e)}});!0===aa&&Y.objects.sort(q);m=0;for(aa=Y.objects.length;m<aa;m++){var t=Y.objects[m].object,f=t.geometry;y.setObject(t);ga=t.matrixWorld;H=0;if(t instanceof THREE.Mesh)if(f instanceof THREE.BufferGeometry){var x=
f.attributes,t=f.offsets;if(void 0!==x.position){for(var w=x.position.array,f=0,v=w.length;f<v;f+=3)y.pushVertex(w[f],w[f+1],w[f+2]);if(void 0!==x.normal)for(var z=x.normal.array,f=0,v=z.length;f<v;f+=3)y.pushNormal(z[f],z[f+1],z[f+2]);if(void 0!==x.uv)for(z=x.uv.array,f=0,v=z.length;f<v;f+=2)y.pushUv(z[f],z[f+1]);if(void 0!==x.index)if(x=x.index.array,0<t.length)for(m=0;m<t.length;m++)for(v=t[m],w=v.index,f=v.start,v=v.start+v.count;f<v;f+=3)y.pushTriangle(x[f]+w,x[f+1]+w,x[f+2]+w);else for(f=0,
v=x.length;f<v;f+=3)y.pushTriangle(x[f],x[f+1],x[f+2]);else for(f=0,v=w.length/3;f<v;f+=3)y.pushTriangle(f,f+1,f+2)}}else{if(f instanceof THREE.Geometry){var R=f.vertices,v=f.faces,x=f.faceVertexUvs[0];B.getNormalMatrix(ga);for(var w=t.material instanceof THREE.MeshFaceMaterial,z=!0===w?t.material:null,ja=0,A=R.length;ja<A;ja++){var E=R[ja];y.pushVertex(E.x,E.y,E.z)}R=0;for(ja=v.length;R<ja;R++){var A=v[R],ea=!0===w?z.materials[A.materialIndex]:t.material;if(void 0!==ea){var V=ea.side,E=N[A.a],l=
N[A.b],M=N[A.c];if(!0===ea.morphTargets){var da=f.morphTargets,xa=t.morphTargetInfluences,ka=E.position,I=l.position,fa=M.position;k.set(0,0,0);U.set(0,0,0);P.set(0,0,0);for(var ca=0,la=da.length;ca<la;ca++){var W=xa[ca];if(0!==W){var pa=da[ca].vertices;k.x+=(pa[A.a].x-ka.x)*W;k.y+=(pa[A.a].y-ka.y)*W;k.z+=(pa[A.a].z-ka.z)*W;U.x+=(pa[A.b].x-I.x)*W;U.y+=(pa[A.b].y-I.y)*W;U.z+=(pa[A.b].z-I.z)*W;P.x+=(pa[A.c].x-fa.x)*W;P.y+=(pa[A.c].y-fa.y)*W;P.z+=(pa[A.c].z-fa.z)*W}}E.position.add(k);l.position.add(U);
M.position.add(P);y.projectVertex(E);y.projectVertex(l);y.projectVertex(M)}if(!1!==y.checkTriangleVisibility(E,l,M)){da=y.checkBackfaceCulling(E,l,M);if(V!==THREE.DoubleSide){if(V===THREE.FrontSide&&!1===da)continue;if(V===THREE.BackSide&&!0===da)continue}F=h();F.id=t.id;F.v1.copy(E);F.v2.copy(l);F.v3.copy(M);F.normalModel.copy(A.normal);!1!==da||V!==THREE.BackSide&&V!==THREE.DoubleSide||F.normalModel.negate();F.normalModel.applyMatrix3(B).normalize();xa=A.vertexNormals;ka=0;for(I=Math.min(xa.length,
3);ka<I;ka++)fa=F.vertexNormalsModel[ka],fa.copy(xa[ka]),!1!==da||V!==THREE.BackSide&&V!==THREE.DoubleSide||fa.negate(),fa.applyMatrix3(B).normalize();F.vertexNormalsLength=xa.length;V=x[R];if(void 0!==V)for(da=0;3>da;da++)F.uvs[da].copy(V[da]);F.color=A.color;F.material=ea;F.z=(E.positionScreen.z+l.positionScreen.z+M.positionScreen.z)/3;Y.elements.push(F)}}}}}else if(t instanceof THREE.Line)if(f instanceof THREE.BufferGeometry){if(x=f.attributes,void 0!==x.position){w=x.position.array;f=0;for(v=
w.length;f<v;f+=3)y.pushVertex(w[f],w[f+1],w[f+2]);if(void 0!==x.index)for(x=x.index.array,f=0,v=x.length;f<v;f+=2)y.pushLine(x[f],x[f+1]);else for(x=t.mode===THREE.LinePieces?2:1,f=0,v=w.length/3-1;f<v;f+=x)y.pushLine(f,f+1)}}else{if(f instanceof THREE.Geometry&&(oa.multiplyMatrices(C,ga),R=t.geometry.vertices,0!==R.length))for(E=g(),E.positionScreen.copy(R[0]).applyMatrix4(oa),x=t.mode===THREE.LinePieces?2:1,ja=1,A=R.length;ja<A;ja++)E=g(),E.positionScreen.copy(R[ja]).applyMatrix4(oa),0<(ja+1)%
x||(l=N[H-2],ha.copy(E.positionScreen),na.copy(l.positionScreen),!0===a(ha,na)&&(ha.multiplyScalar(1/ha.w),na.multiplyScalar(1/na.w),Q=d(),Q.id=t.id,Q.v1.positionScreen.copy(ha),Q.v2.positionScreen.copy(na),Q.z=Math.max(ha.z,na.z),Q.material=t.material,t.material.vertexColors===THREE.VertexColors&&(Q.vertexColors[0].copy(t.geometry.colors[ja]),Q.vertexColors[1].copy(t.geometry.colors[ja-1])),Y.elements.push(Q)))}else t instanceof THREE.Sprite&&(b.set(ga.elements[12],ga.elements[13],ga.elements[14],
1),b.applyMatrix4(C),f=1/b.w,b.z*=f,-1<=b.z&&1>=b.z&&(O=p(),O.id=t.id,O.x=b.x*f,O.y=b.y*f,O.z=b.z,O.object=t,O.rotation=t.rotation,O.scale.x=t.scale.x*Math.abs(O.x-(b.x+s.projectionMatrix.elements[0])/(b.w+s.projectionMatrix.elements[12])),O.scale.y=t.scale.y*Math.abs(O.y-(b.y+s.projectionMatrix.elements[5])/(b.w+s.projectionMatrix.elements[13])),O.material=t.material,Y.elements.push(O)))}!0===J&&Y.elements.sort(q);return Y}};
THREE.OrbitControls=function(g,h){function d(c){if(!1!==a.enabled){c.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(m===n.ROTATE){if(!0===a.noRotate)return;r.set(c.clientX,c.clientY);X.subVectors(r,e);a.rotateLeft(2*Math.PI*X.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*X.y/b.clientHeight*a.rotateSpeed);e.copy(r)}else if(m===n.DOLLY){if(!0===a.noZoom)return;ma.set(c.clientX,c.clientY);la.subVectors(ma,F);0<la.y?a.dollyIn():a.dollyOut();F.copy(ma)}else if(m===
n.PAN){if(!0===a.noPan)return;J.set(c.clientX,c.clientY);H.subVectors(J,G);a.pan(H.x,H.y);G.copy(J)}a.update()}}function p(){!1!==a.enabled&&(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",p,!1),a.dispatchEvent(P),m=n.NONE)}function q(c){if(!1!==a.enabled&&!0!==a.noZoom){c.preventDefault();c.stopPropagation();var b=0;void 0!==c.wheelDelta?b=c.wheelDelta:void 0!==c.detail&&(b=-c.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(U);a.dispatchEvent(P)}}
this.object=g;this.domElement=void 0!==h?h:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,e=new THREE.Vector2,r=new THREE.Vector2,X=new THREE.Vector2,G=new THREE.Vector2,J=new THREE.Vector2,H=new THREE.Vector2,N=new THREE.Vector3,z=new THREE.Vector3,F=new THREE.Vector2,ma=new THREE.Vector2,la=new THREE.Vector2,ca=0,Q=0,ia=1,ra=new THREE.Vector3,w=new THREE.Vector3,O=new THREE.Quaternion,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},m=n.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var s=(new THREE.Quaternion).setFromUnitVectors(g.up,new THREE.Vector3(0,1,0)),Y=s.clone().inverse(),k={type:"change"},U={type:"start"},P={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);Q-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);ca-=c};this.panLeft=function(a){var b=this.object.matrix.elements;N.set(b[0],b[1],b[2]);N.multiplyScalar(-a);ra.add(N)};this.panUp=function(a){var b=this.object.matrix.elements;N.set(b[4],b[5],
b[6]);N.multiplyScalar(a);ra.add(N)};this.panForward=function(a){var b=this.object.matrix.elements;N.set(b[8],b[9],b[10]);N.multiplyScalar(a);ra.add(N)};this.pan=function(c,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*d/e.clientHeight);a.panUp(2*b*d/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/e.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*d/e.clientHeight);a.panForward(2*b*d/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/e.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ia/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ia*=c};this.update=function(){var c=this.object.position;z.copy(c).sub(this.target);z.applyQuaternion(s);var b=Math.atan2(z.x,z.z),e=Math.atan2(Math.sqrt(z.x*z.x+z.z*z.z),z.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+Q,e=e+ca,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),d=z.length()*ia,d=Math.max(this.minDistance,Math.min(this.maxDistance,d));this.target.add(ra);z.x=d*Math.sin(e)*Math.sin(b);z.y=d*Math.cos(e);z.z=d*Math.sin(e)*Math.cos(b);z.applyQuaternion(Y);c.copy(this.target).add(z);this.object.lookAt(this.target);ca=Q=0;ia=1;ra.set(0,0,0);if(1E-6<
w.distanceToSquared(this.object.position)||1E-6<8*(1-O.dot(this.object.quaternion)))this.dispatchEvent(k),w.copy(this.object.position),O.copy(this.object.quaternion)};this.reset=function(){m=n.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;m=n.ROTATE;e.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;m=n.DOLLY;F.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.PAN){if(!0===a.noPan)return;m=n.PAN;G.set(c.clientX,c.clientY)}document.addEventListener("mousemove",d,!1);document.addEventListener("mouseup",p,!1);a.dispatchEvent(U)}},!1);this.domElement.addEventListener("mousewheel",q,!1);this.domElement.addEventListener("DOMMouseScroll",q,!1);this.domElement.addEventListener("touchstart",
function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;m=n.TOUCH_ROTATE;e.set(c.touches[0].pageX,c.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;m=n.TOUCH_DOLLY;var b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;b=Math.sqrt(b*b+c*c);F.set(0,b);break;case 3:if(!0===a.noPan)return;m=n.TOUCH_PAN;G.set(c.touches[0].pageX,c.touches[0].pageY);break;default:m=n.NONE}a.dispatchEvent(U)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(P),m=n.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();c.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(m!==n.TOUCH_ROTATE)break;r.set(c.touches[0].pageX,c.touches[0].pageY);X.subVectors(r,e);a.rotateLeft(2*Math.PI*X.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*X.y/b.clientHeight*a.rotateSpeed);e.copy(r);
a.update();break;case 2:if(!0===a.noZoom)break;if(m!==n.TOUCH_DOLLY)break;b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;c=Math.sqrt(b*b+c*c);ma.set(0,c);la.subVectors(ma,F);0<la.y?a.dollyOut():a.dollyIn();F.copy(ma);a.update();break;case 3:if(!0===a.noPan)break;if(m!==n.TOUCH_PAN)break;J.set(c.touches[0].pageX,c.touches[0].pageY);H.subVectors(J,G);a.pan(H.x,H.y);G.copy(J);a.update();break;default:m=n.NONE}}},!1);window.addEventListener("keydown",function(c){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var g=document.createElement("canvas");return!(!window.WebGLRenderingContext||!g.getContext("webgl")&&!g.getContext("experimental-webgl"))}catch(h){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";
g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){var h,d;g=g||{};h=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";d=Detector.getWebGLErrorMessage();d.id=g;h.appendChild(d)}};"object"===typeof module&&(module.exports=Detector);
(function(g,h,d,p){var q=function(a){this.domParent="object"===typeof a?a:h.body};q.prototype.init=function(a,e,q,X,G,J){g.requestAnimationFrame||(g.requestAnimationFrame=function(){return g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a,e){g.setTimeout(a,1E3/60)}}());this.domParent===h.body&&(this.WINDOW_WIDTH=g.innerWidth,this.WINDOW_HEIGHT=g.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,g.addEventListener("resize",a,!1));this.renderType=p.webgl?"webgl":"canvas";this.renderer=q||(p.webgl?new d.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new d.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=X||new d.Scene;this.camera=G||new d.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
J?this.controls=J:(this.controls=new d.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:d.MOUSE.MIDDLE,PAN:d.MOUSE.RIGHT});e()};g.Base=q;"object"===typeof module&&(module.exports=q)})(window,document,THREE,Detector);
(function(){function g(d){return d.charAt(0).toUpperCase()+d.slice(1)}var h={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(d){var g=0;for(d=d.length;g<d;g++);};h.map={};h.Sidebar=function(d,g){_Container.call(this);var q=this.setting=h.Utils.settingMixin({align:"r",width:320},d),a="sidebar",a=q.align&&"r"!==q.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;q.id&&(this.domElement.id=q.id,h.map[q.id]=this);
this.domElement.style.width=q.width.toString()+"px";q.overflow&&(this.domElement.style.overflow=q.overflow.toString());g.appendChild(this.domElement);h.Utils.domCreationDirector(q.children,this.domElement)};h.Sidebar.prototype=Object.create(_Container.prototype);h.Panel=function(d,g){_Container.call(this);var q=this.setting=h.Utils.settingMixin({title:""},d);q.id&&(this.domElement.id=q.id,h.map[q.id]=this);var a=this.domElement;a.className="panel panel-tool";g.appendChild(a);var e=document.createElement("div");
e.className="panel-heading";a.appendChild(e);var r=document.createTextNode(q.title);e.appendChild(r);e=document.createElement("div");e.className="panel-body";q.overflow&&(e.style.overflow=q.overflow.toString());a.appendChild(e);h.Utils.domCreationDirector(q.children,e)};h.Panel.prototype=Object.create(_Container.prototype);h.Toolbar=function(d,g){_Container.call(this);var q=this.setting=h.Utils.settingMixin({title:""},d);q.id&&(this.domElement.id=q.id,h.map[q.id]=this);var a=this.domElement;a.className=
"btn-toolbar";g.appendChild(a);h.Utils.domCreationDirector(q.children,a)};h.Toolbar.prototype=Object.create(_Container.prototype);h.ButtonGroup=function(d,g){_Container.call(this);var q=this.setting=h.Utils.settingMixin({title:"",buttonType:"radio"},d);q.id&&(this.domElement.id=q.id,h.map[q.id]=this);var a=this.domElement;a.className="btn-group"+(q.appendClass?" "+q.appendClass:"");"button"!==q.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=q.title;g.appendChild(a);var e=
q.buttons;switch(q.buttonType.toLowerCase()){default:case "radio":for(var r=0,X=e.length;r<X;r++){var G=document.createElement("label");G.className="btn btn-tool"+(e[r].checked?" active":"");e[r].height&&(G.style.height=e[r].height+"px");e[r].width&&(G.style.width=e[r].width+"px");if(e[r].bgType&&e[r].bgTypeData){var J;switch(e[r].bgType){case "color":J=e[r].bgTypeData;G.className+=" btn-color";break;case "image":J="url("+e[r].bgTypeData+") no-repeat 50% 50%";G.className+=" btn-image";break;default:return}G.style.background=
J}a.appendChild(G);var H=document.createElement("input");e[r].checked&&H.setAttribute("checked","");H.type=q.buttonType;H.name=q.name;H.id=e[r].id;H.value=r;H.autocomplete="off";G.appendChild(H);J=document.createTextNode(e[r].title);G.appendChild(J)}break;case "button":for(r=0,X=e.length;r<X;r++){H=document.createElement("button");H.className="btn btn-tool";H.id=e[r].id;H.name=q.name;e[r].height&&(H.style.height=e[r].height+"px");e[r].width&&(H.style.width=e[r].width+"px");if(e[r].bgType&&e[r].bgTypeData){switch(e[r].bgType){case "color":J=
e[r].bgTypeData;G.className+=" btn-color";break;case "image":J="url("+e[r].bgTypeData+") no-repeat 50% 50%";G.className+=" btn-image";break;default:return}H.style.background=J}a.appendChild(H);J=document.createTextNode(e[r].title);H.appendChild(J)}}h.Utils.domCreationDirector(q.children,this.domElement)};h.ButtonGroup.prototype=Object.create(_Container.prototype);h.ButtonGroup.prototype.addButton=function(d,g){g||this.setting.buttons.push(d);var h=document.createElement("label");h.className="btn btn-tool"+
(d.checked?" active":"");d.height&&(h.style.height=d.height+"px");d.width&&(h.style.width=d.width+"px");if(d.bgType&&d.bgTypeData){var a;switch(d.bgType){case "color":a=d.bgTypeData;h.className+=" btn-color";break;case "image":a="url("+d.bgTypeData+") no-repeat 50% 50%";h.className+=" btn-image";break;default:return}h.style.background=a}this.domElement.appendChild(h);a=document.createElement("input");d.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
d.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";h.appendChild(a);a=document.createTextNode(d.title);h.appendChild(a);return h};h.ButtonGroup.prototype.addButtons=function(d,g){for(var h=0,a=d.length;h<a;h++)this.addButton(d[h],g)};h.Utils={};h.Utils.settingMixin=function(d,g){if("object"===typeof d&&"object"===typeof g){var h={},a;for(a in d)h[a]=d[a];for(var e in g)void 0!==g[e]&&(h[e]=g[e]);return h}return d};h.Utils.domCreationDirector=function(d,p){if(d)if(d instanceof Array)for(var q=
0,a=d.length;q<a;q++)h.Utils.domCreationDirector(d[q],p?p:document.body);else d instanceof Object&&d.UIType&&h[g(d.UIType)]&&new (h[g(d.UIType)])(d,p?p:document.body)};window.GoUI=h;"object"===typeof module&&(module.exports=h)})();var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
(function(g,h,d,p,q){var a,e;function r(l){var b=B.textures+(l?-1:1),b=h.getElementById("texture"+b);if(!b&&(b=l?C.length-1:0,b=h.getElementById("texture"+b),!b))return;l=b.parentElement.className.indexOf("btn-color");var c=b.parentElement.className.indexOf("btn-image");-1<l?(a=Number(b.value),h.getElementById("colorTexture").parentElement.click()):-1<c&&(e=Number(b.value),h.getElementById("imageTexture").parentElement.click())}function X(a,b){var c=b.clone(),e;for(e in a)c[e]=a[e];return c}function G(a){if(null==
a.pageX&&null!=a.clientX){var b=h.documentElement,c=h.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}v.set(a.pageX/k.WINDOW_WIDTH*2-1,2*-(a.pageY/k.WINDOW_HEIGHT)+1);za.setFromCamera(v,k.camera);return za.intersectObjects(sa)}function J(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(U.width).floor().multiplyScalar(U.width).addScalar(U.width/
2))}function H(a){0<a.length&&J(T,a[0])}function N(a,c,e,g){a=a||G(event);if(0<a.length){a=a[0];var d=B.toolsType,f=!1,h=sa.length;if(h&&a.object!==b)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===sa[k]){f=!0;break}0===d?!0===f&&!1===c||!1===f&&!0===c||(c=V.draw(0,ua,void 0,a),g?ea.appendObjectToCurrentAction(c):ea.addAction("draw",c)):1===d&&e&&a.object!==b&&(c=V.erase(a.object),g?ea.appendObjectToCurrentAction(c):ea.addAction("erase",c))}}function z(a){0===R&&(E.save(E.storageKeys.camera),E.save(E.storageKeys.sidebar),
E.save())}function F(a){E.save(E.storageKeys.camera);E.save(E.storageKeys.sidebar);E.save();R=1}function ma(a){a.preventDefault();var b;1===ta[0]?(b=G(a),N(b,a.ctrlKey,a.ctrlKey,!0)):(b=B.toolsType,1===b?T.visible&&(T.visible=!1):(!T.visible&&oa&&(T.visible=!0),b=G(a),H(b)))}function la(a){a.preventDefault();switch(a.button){case 0:if(!A.endFlag){A.instantComplete(A.loadBoxAnimation);break}ta[0]=1;a=G(a);N(a,void 0,!0,!1);0===B.toolsType&&H(a);break;case 1:ta[1]=1;break;case 2:ta[2]=1}}function ca(l){if("label"===
this.nodeName.toLowerCase())switch(l=this.getElementsByTagName("input")[0],B[l.name]=Number(l.value),l.name){case "toolsType":1===Number(l.value)?T.visible&&(T.visible=!1):!T.visible&&oa&&(T.visible=!0);break;case "textures":ua=B[l.name];ha=C[ua];na=ha.data;y=ha.helperData=C[B[l.name]].helperData||X(va,na);T.material=y;h.getElementById("cube").parentElement.click();switch(B.texturesType){case 0:e=l.value;break;default:case 1:a=l.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===
l.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":l=l.id,"imageTexture"===l?($(".btn-color").hide(),$(".btn-image").show(),h.getElementById("texture"+e).parentElement.click()):"colorTexture"===l&&($(".btn-color").show(),$(".btn-image").hide(),h.getElementById("texture"+a).parentElement.click())}else if("button"===this.type||"button"===this.nodeName.toLowerCase())B[this.id]()}function Q(a){switch(a.button){case 0:ta[0]=0;break;case 1:ta[1]=
0;break;case 2:ta[2]=0}}function ia(a){switch(a.keyCode){case 67:r();break;case 88:r(!0)}}function ra(a){if(!ta[0])switch(a.keyCode){case 16:0===B.toolsType?h.getElementById("eraser").parentElement.click():1===B.toolsType&&h.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&ea.undo();break;case 89:a.ctrlKey&&ea.redo()}}function w(){requestAnimationFrame(w);k.renderer.render(k.scene,k.camera)}var O=h.createElement("a");O.id="imageCapture";O.style.display="none";O.target="_blank";
h.body.appendChild(O);var n=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};n.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=A.currentMeshes;A.currentIterator<a.length?a[A.currentIterator].meshObject.visible=!0:(A.endFlag=!0,clearInterval(A.currentAnimationIntervalHandler));A.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=
setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=A.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var m=function(a){this.isLoadingBoxEnd=a};m.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return g.localStorage&&g.localStorage.getItem(a||this.storageKeys.meshes)},save:function(b,c){if(g.localStorage){var d=
"";if(c)d=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>ea.currentActionIndex)return;for(var f=0,h=t.length;f<h;f++)d+=t[f].geo.id.replace("geo","")+",",d+=t[f].material.id.replace("texture","")+",",d+=t[f].meshObject.position.x+",",d+=t[f].meshObject.position.y+",",d+=t[f].meshObject.position.z+";";break;case this.storageKeys.camera:d+=k.controls.target.x+","+k.controls.target.y+","+k.controls.target.z+";";d+=k.controls.object.position.x+","+k.controls.object.position.y+
","+k.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=e+","+a+","+B.texturesType+","+B.sidebarResize}g.localStorage.setItem(b||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var d=[];(a=this.load(a))&&(d=a.split(";"));if(0<d.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=d.length;b<a;b++){var e=d[b].split(",");2<e.length&&V.draw(Number(e[0]),Number(e[1]),[Number(e[2]),Number(e[3]),Number(e[4])])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=
0;for(a=d.length;b<a;b++)e=d[b].split(","),2<e.length&&V.draw(Number(e[0]),Number(e[1]),[Number(e[2]),Number(e[3]),Number(e[4])],void 0,void 0,!0);A.begin(c,t)}else A.endFlag=!0},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:k.controls.target.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0);break;case 1:k.controls.object.position.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0)}}k.controls.update()}},
loadSidebarSelectedButtons:function(b){var c=[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var d=c.length;b<d;b++){var f=c[b];if(""!==f&&NaN!==Number(f))switch(b){case 0:e=Number(f)||0;break;case 1:a=Number(f)||0;break;case 2:1===Number(f)?h.getElementById("colorTexture").parentElement.click():h.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(f)?h.getElementById("minSidebar").parentElement.click():h.getElementById("normalSidebar").parentElement.click()}}}else h.getElementById("imageTexture").parentElement.click()}};
var s=function(){this.currentActionIndex=-1;this.actionArray=[]};s.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=V.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":V.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":V.erase(e.meshObject)}}this.currentActionIndex--;
this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":V.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":V.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=
-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,e=a.length;c<e;c++)b.meshes.push(a[c]);else b.meshes.push(a)},updateDom:function(){h.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;h.getElementById("redo").disabled=
this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var Y=function(){};Y.prototype={calculateIntersectResult:G,setMeshPositionToFitTheGrid:J,updateHelperCube:H,draw:function(a,b,c,e,d,f){if(void 0===a||"number"===typeof a)a=ga[a||0];if(void 0===b||"number"===typeof b)b=C[b||0];var g=a.data,h=b.data;d=d||new p.Mesh(g,h);d.castShadow=!0;d.receiveShadow=!0;e?J(d,e):d.position.set(c[0],c[1],c[2]);!f||(d.visible=!1);k.scene.add(d);sa.push(d);t.push({meshObject:d,geo:a,material:b});return t[t.length-
1]},erase:function(a){k.scene.remove(a);a=sa.indexOf(a);if(!(0>a)){sa.splice(a,1);var b=t[a-1];t.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};p.ImageUtils.crossOrigin="Anonymous";var k,U={width:50},P={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4,basePlaneTextureRepeat:256,fogNear:8E3,fogFar:24E3,sphereRadius:25E3},canvas:{ambientLightColor:9474192,directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3,basePlaneTextureRepeat:16,
fogNear:2E3,fogFar:3E3,sphereRadius:3E3}},c,b,aa,R=0;q=m.prototype.LOAD_TYPE.async;var W=new p.MeshLambertMaterial({color:592137}),va={opacity:.5,transparent:!0},C=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:W,helperData:X(va,W)}],ga=[{name:"default",type:"1",id:"geo0",data:new p.BoxGeometry(U.width,U.width,U.width,1,1,1)}];e=30;a=0;var oa=!0,B={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===B.toolsType||(T.visible=!T.visible);wa.visible=!wa.visible;
oa=!oa},capture:function(){var a=k.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)?b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(g.navigator.saveBlob=g.navigator.saveBlob||g.navigator.msSaveBlob,a.msToBlob&&g.navigator.saveBlob?g.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):
(O.href=a.toDataURL(),O.download="capture.png",O.click())},clearAll:function(){A.endFlag||A.instantComplete(A.loadBoxAnimation);if(!(1>t.length)){var a=V.erase(t[0].meshObject);ea.addAction("erase",a);for(var b=0,c=t.length;b<c;b++)a=V.erase(t[0].meshObject),ea.appendObjectToCurrentAction(a)}},undo:function(){ea.undo()},redo:function(){ea.redo()}},ua=0,ha=C[0],na=ha.data,y=ha.helperData,S=ga[0].data,T,wa,sa=[],t=[],f,x,ya,v,ta=[0,0,0],za,ja,A=new n,E=new m(!1),ea=new s,V=new Y;k=new d(h.body);k.init(function(a){if(k.WINDOW_WIDTH!==
g.innerWidth||k.WINDOW_HEIGHT!==g.innerHeight)k.WINDOW_WIDTH=g.innerWidth,k.WINDOW_HEIGHT=g.innerHeight,k.WINDOW_HEIGHT_HALF=k.WINDOW_HEIGHT/2,k.WINDOW_WIDTH_HALF=k.WINDOW_WIDTH/2,k.camera.aspect=k.WINDOW_WIDTH/k.WINDOW_HEIGHT,k.camera.updateProjectionMatrix(),k.renderer.setSize(k.WINDOW_WIDTH,k.WINDOW_HEIGHT),h.body.height=k.WINDOW_HEIGHT},function(){wa=new p.GridHelper(P[k.renderType].basePlaneWidth/2,U.width);c=new p.PlaneBufferGeometry(P[k.renderType].basePlaneWidth,P[k.renderType].basePlaneWidth,
P[k.renderType].basePlaneSegments,P[k.renderType].basePlaneSegments);c.applyMatrix((new p.Matrix4).makeRotationX(-Math.PI/2));var a=p.ImageUtils.loadTexture("texture/grass.png");a.wrapT=a.wrapS=p.RepeatWrapping;a.repeat.set(P[k.renderType].basePlaneTextureRepeat,P[k.renderType].basePlaneTextureRepeat);aa=new p.MeshLambertMaterial({color:3394611,map:a,emissive:13421772});b=new p.Mesh(c,aa);b.receiveShadow=!0;b.material.side=p.DoubleSide;k.scene.add(b);sa.push(b);f=new p.AmbientLight(P[k.renderType].ambientLightColor);
k.scene.add(f);x=new p.DirectionalLight(15658734,P[k.renderType].directionalLightDensity);x.position.set(0,6E3,5E3);x.target.position.set(0,0,0);x.castShadow=!0;x.shadowCameraNear=k.camera.near;x.shadowCameraFar=k.camera.far;x.shadowCameraFov=k.camera.fov;x.shadowBias=1E-7;x.shadowDarkness=.4;x.shadowMapWidth=1024;x.shadowMapHeight=1024;k.scene.add(x);ya=new p.HemisphereLight(16777215,6316128,1);k.scene.add(ya);var a={topColor:{type:"c",value:new p.Color(3373055)},bottomColor:{type:"c",value:new p.Color(16777215)},
offset:{type:"f",value:400},exponent:{type:"f",value:.8}},d=new p.Color;a.topColor.value.copy(d.setHSL(.6,1,.75));d=new p.SphereGeometry(P[k.renderType].sphereRadius,32,15);a=new p.ShaderMaterial({uniforms:a,vertexShader:vertexShader,fragmentShader:fragmentShader,side:p.BackSide});a=new p.Mesh(d,a);k.scene.add(a);T=new p.Mesh(S,y);T.position.set(U.width/2,U.width/2,U.width/2);k.scene.add(T);new p.Mesh(S,na);za=new p.Raycaster;v=new p.Vector2;ja=new p.Fog(15663086,P[k.renderType].fogNear,P[k.renderType].fogFar);
k.scene.fog=ja;k.renderer.setClearColor(15790320);k.renderer.shadowMapEnabled=!0;k.renderer.shadowMapType=p.PCFShadowMap;k.renderer.gammaInput=!0;k.renderer.gammaOutput=!0;g.addEventListener("unload",z,!1);g.addEventListener("reload",F,!1);k.renderer.domElement.addEventListener("mousemove",ma,!1);k.renderer.domElement.addEventListener("mousedown",la,!1);k.renderer.domElement.addEventListener("mouseup",Q,!1);h.addEventListener("keydown",ia,!1);h.addEventListener("keyup",ra,!1);setInterval(z,12E4)});
w();m={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",
id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",
buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",
buttons:[{title:"",id:"texture0",bgType:C[0].type,bgTypeData:C[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>k.WINDOW_WIDTH){s=m.children;n=0;for(d=s.length;n<d;n++)if("sidebarResize"===s[n].id){n=s[n].buttons;s=0;for(d=n.length;s<d;s++)"normalSidebar"===n[s].id&&delete n[s].checked,"minSidebar"===n[s].id&&(n[s].checked=!0);break}B.sidebarResize=1}else B.sidebarResize=0;GoUI.Utils.domCreationDirector(m);ea.updateDom();d=h.querySelectorAll(".btn");if(d instanceof Array||d.length)for(n=
d.length-1;0<=n;n--)d[n].addEventListener("click",ca,!1);else d instanceof object&&d.addEventListener("click",ca,!1);s=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},
{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];n=0;for(d=s.length;n<d;n++)m={name:s[n].color,type:"color",id:"texture"+(n+1),uniqueData:s[n].color,data:new p.MeshLambertMaterial({color:s[n].color})},C.push(m),GoUI.map.buttonGroup2.addButton({title:"",id:m.id,bgType:m.type,bgTypeData:m.uniqueData,width:50,height:50}).addEventListener("click",ca,!1);s="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");
n=0;for(d=s.length;n<d;n++)m={name:s[n].replace("texture/","").replace(".png",""),type:"image",id:"texture"+C.length,uniqueData:s[n],data:new p.MeshLambertMaterial({map:p.ImageUtils.loadTexture(s[n]),transparent:!0})},"glass"===m.data.name&&(m.data.map.opacity=.3),m.data.map.magFilter=p.NearestFilter,m.data.map.minFilter=p.LinearMipMapLinearFilter,C.push(m),GoUI.map.buttonGroup2.addButton({title:"",id:m.id,bgType:m.type,bgTypeData:m.uniqueData,width:50,height:50}).addEventListener("click",ca,!1);
E.loadCamera(E.storageKeys.camera);E.loadSidebarSelectedButtons(E.storageKeys.sidebar);E.loadMeshes(void 0,q,A.loadBoxAnimation)})(window,document,Base,THREE,Detector);
