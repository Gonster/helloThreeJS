THREE.SpriteCanvasMaterial=function(c){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(c,e){};this.setValues(c)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var c=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,c);c.color.copy(this.color);c.program=this.program;return c};
THREE.CanvasRenderer=function(c){function k(a,m,D,d){I(m);w(D);fa(d);M(a.getStyle());b.stroke();ca.expandByScalar(2*m)}function e(a){H(a.getStyle());b.fill()}function E(a){l(a.target)}function l(a){if(!(a instanceof THREE.CompressedTexture)){var m=a.wrapS===THREE.RepeatWrapping,D=a.wrapT===THREE.RepeatWrapping,d=a.image,f=document.createElement("canvas");f.width=d.width;f.height=d.height;var e=f.getContext("2d");e.setTransform(1,0,0,-1,0,d.height);e.drawImage(d,0,0);S[a.id]=b.createPattern(f,!0===
m&&!0===D?"repeat":!0===m&&!1===D?"repeat-x":!1===m&&!0===D?"repeat-y":"no-repeat")}}function a(a,m,D,d,f,e,W,p,h,c,P,G,g){if(!(g instanceof THREE.DataTexture)){!1===g.hasEventListener("update",E)&&(void 0!==g.image&&0<g.image.width&&l(g),g.addEventListener("update",E));var k=S[g.id];if(void 0!==k){H(k);var k=g.offset.x/g.repeat.x,t=g.offset.y/g.repeat.y,n=g.image.width*g.repeat.x;g=g.image.height*g.repeat.y;W=(W+k)*n;p=(p+t)*g;D-=a;d-=m;f-=a;e-=m;h=(h+k)*n-W;c=(c+t)*g-p;P=(P+k)*n-W;G=(G+t)*g-p;g=
h*G-P*c;0!==g&&(k=1/g,g=(G*D-c*f)*k,c=(G*d-c*e)*k,D=(h*f-P*D)*k,d=(h*e-P*d)*k,a=a-g*W-D*p,m=m-c*W-d*p,b.save(),b.transform(g,c,D,d,a,m),b.fill(),b.restore())}else H("rgba(0,0,0,1)"),b.fill()}}function g(a,m,D){var b=m.x-a.x,d=m.y-a.y,f=b*b+d*d;0!==f&&(D/=Math.sqrt(f),b*=D,d*=D,m.x+=b,m.y+=d,a.x-=b,a.y-=d)}function s(a){y!==a&&(y=b.globalAlpha=a)}function T(a){sa!==a&&(a===THREE.NormalBlending?b.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
a===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),sa=a)}function I(a){ra!==a&&(ra=b.lineWidth=a)}function w(a){ta!==a&&(ta=b.lineCap=a)}function fa(a){Y!==a&&(Y=b.lineJoin=a)}function M(a){aa!==a&&(aa=b.strokeStyle=a)}function H(a){ja!==a&&(ja=b.fillStyle=a)}function B(a){ka.length!==a.length&&(b.setLineDash(a),ka=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var la=THREE.Math.smoothstep;c=c||{};var N=this,ea,O,Q,v=new THREE.Projector,x=void 0!==c.canvas?c.canvas:document.createElement("canvas"),
u=x.width,A=x.height,q=Math.floor(u/2),h=Math.floor(A/2),U=0,ba=0,ga=u,ha=A,d=1,b=x.getContext("2d",{alpha:!0===c.alpha}),R=new THREE.Color(0),F=!0===c.alpha?0:1,y=1,sa=0,aa=null,ja=null,ra=null,ta=null,Y=null,ka=[],ia,n,P,V;new THREE.RenderableVertex;new THREE.RenderableVertex;var wa,ua,z,f,t,ma,p=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var m=new THREE.Color,D=new THREE.Color,W=new THREE.Color,S={},G,za,Aa,Ba,Ca,Da,Ea,na=new THREE.Box2,J=new THREE.Box2,ca=
new THREE.Box2,va=new THREE.Color,ya=new THREE.Color,oa=new THREE.Color,pa=new THREE.Vector3,Fa=new THREE.Vector3,qa=new THREE.Vector3,xa=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=x;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return d};this.setPixelRatio=function(a){d=a};this.setSize=function(a,m,D){u=
a*d;A=m*d;x.width=u;x.height=A;q=Math.floor(u/2);h=Math.floor(A/2);!1!==D&&(x.style.width=a+"px",x.style.height=m+"px");na.min.set(-q,-h);na.max.set(q,h);J.min.set(-q,-h);J.max.set(q,h);y=1;sa=0;Y=ta=ra=ja=aa=null;this.setViewport(0,0,a,m)};this.setViewport=function(a,m,D,b){U=a*d;ba=m*d;ga=D*d;ha=b*d};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,m){R.set(a);F=void 0!==m?m:1;J.min.set(-q,-h);J.max.set(q,h)};this.setClearColorHex=function(a,m){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,m)};this.getClearColor=function(){return R};this.getClearAlpha=function(){return F};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===J.empty()&&(J.intersect(na),J.expandByScalar(2),J.min.x+=q,J.min.y=-J.min.y+h,J.max.x+=q,J.max.y=-J.max.y+h,1>F&&b.clearRect(J.min.x|0,J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0),0<F&&(T(THREE.NormalBlending),s(1),H("rgba("+Math.floor(255*R.r)+","+Math.floor(255*R.g)+","+Math.floor(255*R.b)+","+F+")"),b.fillRect(J.min.x|0,
J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0)),J.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(d,c){if(!1===c instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();N.info.render.vertices=0;N.info.render.faces=0;b.setTransform(ga/u,0,0,-ha/A,U,A-ba);b.translate(q,h);ea=v.projectScene(d,c,this.sortObjects,this.sortElements);
O=ea.elements;Q=ea.lights;ia=c;xa.getNormalMatrix(c.matrixWorldInverse);va.setRGB(0,0,0);ya.setRGB(0,0,0);oa.setRGB(0,0,0);for(var x=0,R=Q.length;x<R;x++){var r=Q[x],L=r.color;r instanceof THREE.AmbientLight?va.add(L):r instanceof THREE.DirectionalLight?ya.add(L):r instanceof THREE.PointLight&&oa.add(L)}x=0;for(R=O.length;x<R;x++){var C=O[x],F=C.material;if(void 0!==F&&0!==F.opacity){ca.makeEmpty();if(C instanceof THREE.RenderableSprite){n=C;n.x*=q;n.y*=h;var r=n,K=C,L=F;s(L.opacity);T(L.blending);
var da=K.scale.x*q,K=K.scale.y*h,C=.5*Math.sqrt(da*da+K*K);ca.min.set(r.x-C,r.y-C);ca.max.set(r.x+C,r.y+C);if(L instanceof THREE.SpriteMaterial){var X=L.map;if(null!==X&&void 0!==X.image){!1===X.hasEventListener("update",E)&&(0<X.image.width&&l(X),X.addEventListener("update",E));C=S[X.id];void 0!==C?H(C):H("rgba( 0, 0, 0, 1 )");var Z=X.image,C=Z.width*X.offset.x,F=Z.height*X.offset.y,y=Z.width*X.repeat.x,X=Z.height*X.repeat.y,Z=da/y,Y=K/X;b.save();b.translate(r.x,r.y);0!==L.rotation&&b.rotate(L.rotation);
b.translate(-da/2,-K/2);b.scale(Z,Y);b.translate(-C,-F);b.fillRect(C,F,y,X)}else H(L.color.getStyle()),b.save(),b.translate(r.x,r.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(da,-K),b.fillRect(-.5,-.5,1,1);b.restore()}else L instanceof THREE.SpriteCanvasMaterial&&(M(L.color.getStyle()),H(L.color.getStyle()),b.save(),b.translate(r.x,r.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(da,K),L.program(b),b.restore())}else if(C instanceof THREE.RenderableLine){if(n=C.v1,P=C.v2,n.positionScreen.x*=q,
n.positionScreen.y*=h,P.positionScreen.x*=q,P.positionScreen.y*=h,ca.setFromPoints([n.positionScreen,P.positionScreen]),!0===na.isIntersectionBox(ca))if(r=n,L=P,da=C,K=F,s(K.opacity),T(K.blending),b.beginPath(),b.moveTo(r.positionScreen.x,r.positionScreen.y),b.lineTo(L.positionScreen.x,L.positionScreen.y),K instanceof THREE.LineBasicMaterial){I(K.linewidth);w(K.linecap);fa(K.linejoin);if(K.vertexColors!==THREE.VertexColors)M(K.color.getStyle());else if(C=da.vertexColors[0].getStyle(),da=da.vertexColors[1].getStyle(),
C===da)M(C);else{try{var aa=b.createLinearGradient(r.positionScreen.x,r.positionScreen.y,L.positionScreen.x,L.positionScreen.y);aa.addColorStop(0,C);aa.addColorStop(1,da)}catch(ja){aa=C}M(aa)}b.stroke();ca.expandByScalar(2*K.linewidth)}else K instanceof THREE.LineDashedMaterial&&(I(K.linewidth),w(K.linecap),fa(K.linejoin),M(K.color.getStyle()),B([K.dashSize,K.gapSize]),b.stroke(),ca.expandByScalar(2*K.linewidth),B([]))}else if(C instanceof THREE.RenderableFace){n=C.v1;P=C.v2;V=C.v3;if(-1>n.positionScreen.z||
1<n.positionScreen.z)continue;if(-1>P.positionScreen.z||1<P.positionScreen.z)continue;if(-1>V.positionScreen.z||1<V.positionScreen.z)continue;n.positionScreen.x*=q;n.positionScreen.y*=h;P.positionScreen.x*=q;P.positionScreen.y*=h;V.positionScreen.x*=q;V.positionScreen.y*=h;0<F.overdraw&&(g(n.positionScreen,P.positionScreen,F.overdraw),g(P.positionScreen,V.positionScreen,F.overdraw),g(V.positionScreen,n.positionScreen,F.overdraw));ca.setFromPoints([n.positionScreen,P.positionScreen,V.positionScreen]);
if(!0===na.isIntersectionBox(ca)){L=n;da=P;K=V;r=F;N.info.render.vertices+=3;N.info.render.faces++;s(r.opacity);T(r.blending);wa=L.positionScreen.x;ua=L.positionScreen.y;z=da.positionScreen.x;f=da.positionScreen.y;t=K.positionScreen.x;ma=K.positionScreen.y;var F=wa,y=ua,X=z,Z=f,Y=t,ka=ma;b.beginPath();b.moveTo(F,y);b.lineTo(X,Z);b.lineTo(Y,ka);b.closePath();if((r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&null===r.map){m.copy(r.color);D.copy(r.emissive);r.vertexColors===
THREE.FaceColors&&m.multiply(C.color);p.copy(va);Fa.copy(L.positionWorld).add(da.positionWorld).add(K.positionWorld).divideScalar(3);L=Fa;da=C.normalModel;K=p;C=0;for(F=Q.length;C<F;C++)y=Q[C],W.copy(y.color),y instanceof THREE.DirectionalLight?(X=pa.setFromMatrixPosition(y.matrixWorld).normalize(),Z=da.dot(X),0>=Z||(Z*=y.intensity,K.add(W.multiplyScalar(Z)))):y instanceof THREE.PointLight&&(X=pa.setFromMatrixPosition(y.matrixWorld),Z=da.dot(pa.subVectors(X,L).normalize()),0>=Z||(Z*=0==y.distance?
1:1-Math.min(L.distanceTo(X)/y.distance,1),0!=Z&&(Z*=y.intensity,K.add(W.multiplyScalar(Z)))));p.multiply(m).add(D);!0===r.wireframe?k(p,r.wireframeLinewidth,r.wireframeLinecap,r.wireframeLinejoin):e(p)}else r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial?null!==r.map?r.map.mapping===THREE.UVMapping&&(G=C.uvs,a(wa,ua,z,f,t,ma,G[0].x,G[0].y,G[1].x,G[1].y,G[2].x,G[2].y,r.map)):null!==r.envMap?r.envMap.mapping===THREE.SphericalReflectionMapping&&
(qa.copy(C.vertexNormalsModel[0]).applyMatrix3(xa),za=.5*qa.x+.5,Aa=.5*qa.y+.5,qa.copy(C.vertexNormalsModel[1]).applyMatrix3(xa),Ba=.5*qa.x+.5,Ca=.5*qa.y+.5,qa.copy(C.vertexNormalsModel[2]).applyMatrix3(xa),Da=.5*qa.x+.5,Ea=.5*qa.y+.5,a(wa,ua,z,f,t,ma,za,Aa,Ba,Ca,Da,Ea,r.envMap)):(p.copy(r.color),r.vertexColors===THREE.FaceColors&&p.multiply(C.color),!0===r.wireframe?k(p,r.wireframeLinewidth,r.wireframeLinecap,r.wireframeLinejoin):e(p)):(r instanceof THREE.MeshDepthMaterial?p.r=p.g=p.b=1-la(L.positionScreen.z*
L.positionScreen.w,ia.near,ia.far):r instanceof THREE.MeshNormalMaterial?(qa.copy(C.normalModel).applyMatrix3(xa),p.setRGB(qa.x,qa.y,qa.z).multiplyScalar(.5).addScalar(.5)):p.setRGB(1,1,1),!0===r.wireframe?k(p,r.wireframeLinewidth,r.wireframeLinecap,r.wireframeLinejoin):e(p))}}J.union(ca)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(c){this.positionWorld.copy(c.positionWorld);this.positionScreen.copy(c.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function c(){if(fa===H){var a=new THREE.RenderableVertex;M.push(a);H++;fa++;return a}return M[fa++]}function k(){if(la===ea){var a=new THREE.RenderableFace;N.push(a);ea++;la++;return a}return N[la++]}function e(){if(Q===x){var a=new THREE.RenderableLine;v.push(a);x++;Q++;return a}return v[Q++]}function E(){if(A===h){var a=new THREE.RenderableSprite;q.push(a);h++;A++;return a}return q[A++]}function l(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function a(a,b){var d=
0,e=1,g=a.z+a.w,f=b.z+b.w,c=-a.z+a.w,h=-b.z+b.w;if(0<=g&&0<=f&&0<=c&&0<=h)return!0;if(0>g&&0>f||0>c&&0>h)return!1;0>g?d=Math.max(d,g/(g-f)):0>f&&(e=Math.min(e,g/(g-f)));0>c?d=Math.max(d,c/(c-h)):0>h&&(e=Math.min(e,c/(c-h)));if(e<d)return!1;a.lerp(b,d);b.lerp(a,1-e);return!0}var g,s,T=[],I=0,w,fa,M=[],H=0,B,la,N=[],ea=0,O,Q,v=[],x=0,u,A,q=[],h=0,U={objects:[],lights:[],elements:[]},ba=new THREE.Vector3,ga=new THREE.Vector3,ha=new THREE.Vector3,d=new THREE.Vector3,b=new THREE.Vector4,R=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),F=new THREE.Box3,y=Array(3),sa=new THREE.Matrix4,aa=new THREE.Matrix4,ja,ra=new THREE.Matrix4,ta=new THREE.Matrix3,Y=new THREE.Frustum,ka=new THREE.Vector4,ia=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var n=new function(){var a=[],b=[],d=null,g=null,h=new THREE.Matrix3,f=function(a){var m=a.positionWorld,b=a.positionScreen;m.copy(a.position).applyMatrix4(ja);b.copy(m).applyMatrix4(aa);m=1/b.w;b.x*=m;b.y*=m;b.z*=m;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},l=function(a,m,b){if(!0===a.visible||!0===m.visible||!0===b.visible)return!0;y[0]=a.positionScreen;y[1]=m.positionScreen;y[2]=b.positionScreen;return R.isIntersectionBox(F.setFromPoints(y))},n=function(a,m,b){return 0>(b.positionScreen.x-
a.positionScreen.x)*(m.positionScreen.y-a.positionScreen.y)-(b.positionScreen.y-a.positionScreen.y)*(m.positionScreen.x-a.positionScreen.x)};return{setObject:function(f){d=f;g=d.material;h.getNormalMatrix(d.matrixWorld);a.length=0;b.length=0},projectVertex:f,checkTriangleVisibility:l,checkBackfaceCulling:n,pushVertex:function(a,m,b){w=c();w.position.set(a,m,b);f(w)},pushNormal:function(b,m,d){a.push(b,m,d)},pushUv:function(a,m){b.push(a,m)},pushLine:function(a,m){var b=M[a],f=M[m];O=e();O.id=d.id;
O.v1.copy(b);O.v2.copy(f);O.z=(b.positionScreen.z+f.positionScreen.z)/2;O.material=d.material;U.elements.push(O)},pushTriangle:function(f,m,D){var e=M[f],c=M[m],G=M[D];if(!1!==l(e,c,G)&&(g.side===THREE.DoubleSide||!0===n(e,c,G))){B=k();B.id=d.id;B.v1.copy(e);B.v2.copy(c);B.v3.copy(G);B.z=(e.positionScreen.z+c.positionScreen.z+G.positionScreen.z)/3;for(e=0;3>e;e++)c=3*arguments[e],G=B.vertexNormalsModel[e],G.set(a[c],a[c+1],a[c+2]),G.applyMatrix3(h).normalize(),c=2*arguments[e],B.uvs[e].set(b[c],b[c+
1]);B.vertexNormalsLength=3;B.material=d.material;U.elements.push(B)}}}};this.projectScene=function(h,F,v,x){A=Q=la=0;U.elements.length=0;!0===h.autoUpdate&&h.updateMatrixWorld();void 0===F.parent&&F.updateMatrixWorld();sa.copy(F.matrixWorldInverse.getInverse(F.matrixWorld));aa.multiplyMatrices(F.projectionMatrix,sa);Y.setFromMatrix(aa);s=0;U.objects.length=0;U.lights.length=0;h.traverseVisible(function(a){if(a instanceof THREE.Light)U.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===Y.intersectsObject(a))){if(s===I){var m=new THREE.RenderableObject;T.push(m);I++;s++;g=m}else g=T[s++];g.id=a.id;g.object=a;d.setFromMatrixPosition(a.matrixWorld);d.applyProjection(aa);g.z=d.z;U.objects.push(g)}});!0===v&&U.objects.sort(l);h=0;for(v=U.objects.length;h<v;h++){var z=U.objects[h].object,f=z.geometry;n.setObject(z);ja=z.matrixWorld;fa=0;if(z instanceof THREE.Mesh)if(f instanceof THREE.BufferGeometry){var t=
f.attributes,z=f.offsets;if(void 0!==t.position){for(var q=t.position.array,f=0,p=q.length;f<p;f+=3)n.pushVertex(q[f],q[f+1],q[f+2]);if(void 0!==t.normal)for(var m=t.normal.array,f=0,p=m.length;f<p;f+=3)n.pushNormal(m[f],m[f+1],m[f+2]);if(void 0!==t.uv)for(m=t.uv.array,f=0,p=m.length;f<p;f+=2)n.pushUv(m[f],m[f+1]);if(void 0!==t.index)if(t=t.index.array,0<z.length)for(h=0;h<z.length;h++)for(p=z[h],q=p.index,f=p.start,p=p.start+p.count;f<p;f+=3)n.pushTriangle(t[f]+q,t[f+1]+q,t[f+2]+q);else for(f=0,
p=t.length;f<p;f+=3)n.pushTriangle(t[f],t[f+1],t[f+2]);else for(f=0,p=q.length/3;f<p;f+=3)n.pushTriangle(f,f+1,f+2)}}else{if(f instanceof THREE.Geometry){var D=f.vertices,p=f.faces,t=f.faceVertexUvs[0];ta.getNormalMatrix(ja);for(var q=z.material instanceof THREE.MeshFaceMaterial,m=!0===q?z.material:null,W=0,S=D.length;W<S;W++){var G=D[W];n.pushVertex(G.x,G.y,G.z)}D=0;for(W=p.length;D<W;D++){var S=p[D],w=!0===q?m.materials[S.materialIndex]:z.material;if(void 0!==w){var R=w.side,G=M[S.a],y=M[S.b],H=
M[S.c];if(!0===w.morphTargets){var N=f.morphTargets,ea=z.morphTargetInfluences,na=G.position,J=y.position,ca=H.position;ba.set(0,0,0);ga.set(0,0,0);ha.set(0,0,0);for(var va=0,ya=N.length;va<ya;va++){var oa=ea[va];if(0!==oa){var pa=N[va].vertices;ba.x+=(pa[S.a].x-na.x)*oa;ba.y+=(pa[S.a].y-na.y)*oa;ba.z+=(pa[S.a].z-na.z)*oa;ga.x+=(pa[S.b].x-J.x)*oa;ga.y+=(pa[S.b].y-J.y)*oa;ga.z+=(pa[S.b].z-J.z)*oa;ha.x+=(pa[S.c].x-ca.x)*oa;ha.y+=(pa[S.c].y-ca.y)*oa;ha.z+=(pa[S.c].z-ca.z)*oa}}G.position.add(ba);y.position.add(ga);
H.position.add(ha);n.projectVertex(G);n.projectVertex(y);n.projectVertex(H)}if(!1!==n.checkTriangleVisibility(G,y,H)){N=n.checkBackfaceCulling(G,y,H);if(R!==THREE.DoubleSide){if(R===THREE.FrontSide&&!1===N)continue;if(R===THREE.BackSide&&!0===N)continue}B=k();B.id=z.id;B.v1.copy(G);B.v2.copy(y);B.v3.copy(H);B.normalModel.copy(S.normal);!1!==N||R!==THREE.BackSide&&R!==THREE.DoubleSide||B.normalModel.negate();B.normalModel.applyMatrix3(ta).normalize();ea=S.vertexNormals;na=0;for(J=Math.min(ea.length,
3);na<J;na++)ca=B.vertexNormalsModel[na],ca.copy(ea[na]),!1!==N||R!==THREE.BackSide&&R!==THREE.DoubleSide||ca.negate(),ca.applyMatrix3(ta).normalize();B.vertexNormalsLength=ea.length;R=t[D];if(void 0!==R)for(N=0;3>N;N++)B.uvs[N].copy(R[N]);B.color=S.color;B.material=w;B.z=(G.positionScreen.z+y.positionScreen.z+H.positionScreen.z)/3;U.elements.push(B)}}}}}else if(z instanceof THREE.Line)if(f instanceof THREE.BufferGeometry){if(t=f.attributes,void 0!==t.position){q=t.position.array;f=0;for(p=q.length;f<
p;f+=3)n.pushVertex(q[f],q[f+1],q[f+2]);if(void 0!==t.index)for(t=t.index.array,f=0,p=t.length;f<p;f+=2)n.pushLine(t[f],t[f+1]);else for(t=z.mode===THREE.LinePieces?2:1,f=0,p=q.length/3-1;f<p;f+=t)n.pushLine(f,f+1)}}else{if(f instanceof THREE.Geometry&&(ra.multiplyMatrices(aa,ja),D=z.geometry.vertices,0!==D.length))for(G=c(),G.positionScreen.copy(D[0]).applyMatrix4(ra),t=z.mode===THREE.LinePieces?2:1,W=1,S=D.length;W<S;W++)G=c(),G.positionScreen.copy(D[W]).applyMatrix4(ra),0<(W+1)%t||(y=M[fa-2],ka.copy(G.positionScreen),
ia.copy(y.positionScreen),!0===a(ka,ia)&&(ka.multiplyScalar(1/ka.w),ia.multiplyScalar(1/ia.w),O=e(),O.id=z.id,O.v1.positionScreen.copy(ka),O.v2.positionScreen.copy(ia),O.z=Math.max(ka.z,ia.z),O.material=z.material,z.material.vertexColors===THREE.VertexColors&&(O.vertexColors[0].copy(z.geometry.colors[W]),O.vertexColors[1].copy(z.geometry.colors[W-1])),U.elements.push(O)))}else z instanceof THREE.Sprite&&(b.set(ja.elements[12],ja.elements[13],ja.elements[14],1),b.applyMatrix4(aa),f=1/b.w,b.z*=f,-1<=
b.z&&1>=b.z&&(u=E(),u.id=z.id,u.x=b.x*f,u.y=b.y*f,u.z=b.z,u.object=z,u.rotation=z.rotation,u.scale.x=z.scale.x*Math.abs(u.x-(b.x+F.projectionMatrix.elements[0])/(b.w+F.projectionMatrix.elements[12])),u.scale.y=z.scale.y*Math.abs(u.y-(b.y+F.projectionMatrix.elements[5])/(b.w+F.projectionMatrix.elements[13])),u.material=z.material,U.elements.push(u)))}!0===x&&U.elements.sort(l);return U}};
THREE.OrbitControls=function(c,k){function e(d){if(!1!==a.enabled){d.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(q===A.ROTATE){if(!0===a.noRotate)return;s.set(d.clientX,d.clientY);T.subVectors(s,g);a.rotateLeft(2*Math.PI*T.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*T.y/b.clientHeight*a.rotateSpeed);g.copy(s)}else if(q===A.DOLLY){if(!0===a.noZoom)return;la.set(d.clientX,d.clientY);N.subVectors(la,B);0<N.y?a.dollyIn():a.dollyOut();B.copy(la)}else if(q===
A.PAN){if(!0===a.noPan)return;w.set(d.clientX,d.clientY);fa.subVectors(w,I);a.pan(fa.x,fa.y);I.copy(w)}a.update()}}function E(){!1!==a.enabled&&(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",E,!1),a.dispatchEvent(ha),q=A.NONE)}function l(d){if(!1!==a.enabled&&!0!==a.noZoom){d.preventDefault();d.stopPropagation();var b=0;void 0!==d.wheelDelta?b=d.wheelDelta:void 0!==d.detail&&(b=-d.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(ga);a.dispatchEvent(ha)}}
this.object=c;this.domElement=void 0!==k?k:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,g=new THREE.Vector2,s=new THREE.Vector2,T=new THREE.Vector2,I=new THREE.Vector2,w=new THREE.Vector2,fa=new THREE.Vector2,M=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Vector2,la=new THREE.Vector2,N=new THREE.Vector2,ea=0,O=0,Q=1,v=new THREE.Vector3,x=new THREE.Vector3,u=new THREE.Quaternion,A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},q=A.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var h=(new THREE.Quaternion).setFromUnitVectors(c.up,new THREE.Vector3(0,1,0)),U=h.clone().inverse(),ba={type:"change"},ga={type:"start"},ha={type:"end"};this.rotateLeft=function(d){void 0===d&&(d=2*Math.PI/60/60*a.autoRotateSpeed);O-=d};this.rotateUp=function(d){void 0===d&&(d=2*Math.PI/60/60*a.autoRotateSpeed);ea-=d};this.panLeft=function(a){var b=this.object.matrix.elements;M.set(b[0],b[1],b[2]);M.multiplyScalar(-a);v.add(M)};this.panUp=function(a){var b=this.object.matrix.elements;M.set(b[4],
b[5],b[6]);M.multiplyScalar(a);v.add(M)};this.panForward=function(a){var b=this.object.matrix.elements;M.set(b[8],b[9],b[10]);M.multiplyScalar(a);v.add(M)};this.pan=function(d,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var c=a.object.position.clone().sub(a.target).length(),c=c*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*d*c/e.clientHeight);a.panUp(2*b*c/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(d*(a.object.right-a.object.left)/e.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(d,b){var e=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var c=a.object.position.clone().sub(a.target).length(),c=c*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*d*c/e.clientHeight);a.panForward(2*b*c/e.clientHeight)}else void 0!==a.object.top?(a.panLeft(d*(a.object.right-a.object.left)/e.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(d){void 0===d&&(d=Math.pow(.95,a.zoomSpeed));Q/=d};this.dollyOut=function(d){void 0===d&&(d=Math.pow(.95,a.zoomSpeed));Q*=d};this.update=function(){var d=this.object.position;H.copy(d).sub(this.target);H.applyQuaternion(h);var b=Math.atan2(H.x,H.z),e=Math.atan2(Math.sqrt(H.x*H.x+H.z*H.z),H.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+O,e=e+ea,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(1E-6,Math.min(Math.PI-1E-6,e)),c=H.length()*Q,c=Math.max(this.minDistance,Math.min(this.maxDistance,c));this.target.add(v);H.x=c*Math.sin(e)*Math.sin(b);H.y=c*Math.cos(e);H.z=c*Math.sin(e)*Math.cos(b);H.applyQuaternion(U);d.copy(this.target).add(H);this.object.lookAt(this.target);ea=O=0;Q=1;v.set(0,0,0);if(1E-6<
x.distanceToSquared(this.object.position)||1E-6<8*(1-u.dot(this.object.quaternion)))this.dispatchEvent(ba),x.copy(this.object.position),u.copy(this.object.quaternion)};this.reset=function(){q=A.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(d){if(!1!==a.enabled){d.preventDefault();if(d.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;q=A.ROTATE;g.set(d.clientX,d.clientY)}else if(d.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;q=A.DOLLY;B.set(d.clientX,d.clientY)}else if(d.button===a.mouseButtons.PAN){if(!0===a.noPan)return;q=A.PAN;I.set(d.clientX,d.clientY)}document.addEventListener("mousemove",e,!1);document.addEventListener("mouseup",E,!1);a.dispatchEvent(ga)}},!1);this.domElement.addEventListener("mousewheel",l,!1);this.domElement.addEventListener("DOMMouseScroll",l,!1);this.domElement.addEventListener("touchstart",
function(d){if(!1!==a.enabled){switch(d.touches.length){case 1:if(!0===a.noRotate)return;q=A.TOUCH_ROTATE;g.set(d.touches[0].pageX,d.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;q=A.TOUCH_DOLLY;var b=d.touches[0].pageX-d.touches[1].pageX;d=d.touches[0].pageY-d.touches[1].pageY;b=Math.sqrt(b*b+d*d);B.set(0,b);break;case 3:if(!0===a.noPan)return;q=A.TOUCH_PAN;I.set(d.touches[0].pageX,d.touches[0].pageY);break;default:q=A.NONE}a.dispatchEvent(ga)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(ha),q=A.NONE)},!1);this.domElement.addEventListener("touchmove",function(d){if(!1!==a.enabled){d.preventDefault();d.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(d.touches.length){case 1:if(!0===a.noRotate)break;if(q!==A.TOUCH_ROTATE)break;s.set(d.touches[0].pageX,d.touches[0].pageY);T.subVectors(s,g);a.rotateLeft(2*Math.PI*T.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*T.y/b.clientHeight*a.rotateSpeed);g.copy(s);
a.update();break;case 2:if(!0===a.noZoom)break;if(q!==A.TOUCH_DOLLY)break;b=d.touches[0].pageX-d.touches[1].pageX;d=d.touches[0].pageY-d.touches[1].pageY;d=Math.sqrt(b*b+d*d);la.set(0,d);N.subVectors(la,B);0<N.y?a.dollyOut():a.dollyIn();B.copy(la);a.update();break;case 3:if(!0===a.noPan)break;if(q!==A.TOUCH_PAN)break;w.set(d.touches[0].pageX,d.touches[0].pageY);fa.subVectors(w,I);a.pan(fa.x,fa.y);I.copy(w);a.update();break;default:q=A.NONE}}},!1);window.addEventListener("keydown",function(d){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(d.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var c=document.createElement("canvas");return!(!window.WebGLRenderingContext||!c.getContext("webgl")&&!c.getContext("experimental-webgl"))}catch(k){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var c=document.createElement("div");c.id="webgl-error-message";c.style.fontFamily="monospace";c.style.fontSize="13px";c.style.fontWeight="normal";
c.style.textAlign="center";c.style.background="#fff";c.style.color="#000";c.style.padding="1.5em";c.style.width="400px";c.style.margin="5em auto 0";this.webgl||(c.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return c},addGetWebGLMessage:function(c){var k,e;c=c||{};k=void 0!==c.parent?c.parent:document.body;c=void 0!==c.id?c.id:"oldie";e=Detector.getWebGLErrorMessage();e.id=c;k.appendChild(e)}};"object"===typeof module&&(module.exports=Detector);
(function(c,k,e,E){var l=function(a){this.domParent="object"===typeof a?a:k.body};l.prototype.init=function(a,g,l,T,I,w){c.requestAnimationFrame||(c.requestAnimationFrame=function(){return c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame||c.oRequestAnimationFrame||c.msRequestAnimationFrame||function(a,e){c.setTimeout(a,1E3/60)}}());this.domParent===k.body&&(this.WINDOW_WIDTH=c.innerWidth,this.WINDOW_HEIGHT=c.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,c.addEventListener("resize",a,!1));this.renderType=E.webgl?"webgl":"canvas";this.renderer=l||(E.webgl?new e.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new e.CanvasRenderer({antialias:!0,preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=T||new e.Scene;this.camera=I||new e.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,
500,1E3);this.camera.lookAt(this.scene.position);w?this.controls=w:(this.controls=new e.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT});g()};c.Base=l;"object"===typeof module&&(module.exports=l)})(window,document,THREE,Detector);
(function(){function c(e){return e.charAt(0).toUpperCase()+e.slice(1)}var k={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(e){var c=0;for(e=e.length;c<e;c++);};k.map={};k.Sidebar=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({align:"r",width:320},e),a="sidebar",a=l.align&&"r"!==l.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;l.id&&(this.domElement.id=l.id,k.map[l.id]=this);
this.domElement.style.width=l.width.toString()+"px";l.overflow&&(this.domElement.style.overflow=l.overflow.toString());c.appendChild(this.domElement);k.Utils.domCreationDirector(l.children,this.domElement)};k.Sidebar.prototype=Object.create(_Container.prototype);k.Panel=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({title:""},e);l.id&&(this.domElement.id=l.id,k.map[l.id]=this);var a=this.domElement;a.className="panel panel-tool";c.appendChild(a);var g=document.createElement("div");
g.className="panel-heading";a.appendChild(g);var s=document.createTextNode(l.title);g.appendChild(s);g=document.createElement("div");g.className="panel-body";l.overflow&&(g.style.overflow=l.overflow.toString());a.appendChild(g);k.Utils.domCreationDirector(l.children,g)};k.Panel.prototype=Object.create(_Container.prototype);k.Toolbar=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({title:""},e);l.id&&(this.domElement.id=l.id,k.map[l.id]=this);var a=this.domElement;a.className=
"btn-toolbar";c.appendChild(a);k.Utils.domCreationDirector(l.children,a)};k.Toolbar.prototype=Object.create(_Container.prototype);k.ButtonGroup=function(e,c){_Container.call(this);var l=this.setting=k.Utils.settingMixin({title:"",buttonType:"radio"},e);l.id&&(this.domElement.id=l.id,k.map[l.id]=this);var a=this.domElement;a.className="btn-group"+(l.appendClass?" "+l.appendClass:"");"button"!==l.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=l.title;c.appendChild(a);var g=
l.buttons;switch(l.buttonType.toLowerCase()){default:case "radio":for(var s=0,T=g.length;s<T;s++){var I=document.createElement("label");I.className="btn btn-tool"+(g[s].checked?" active":"");g[s].height&&(I.style.height=g[s].height+"px");g[s].width&&(I.style.width=g[s].width+"px");if(g[s].bgType&&g[s].bgTypeData){var w;switch(g[s].bgType){case "color":w=g[s].bgTypeData;break;case "image":w="url("+g[s].bgTypeData+") no-repeat 50% 50%";break;default:return}I.style.background=w}a.appendChild(I);w=document.createElement("input");
g[s].checked&&w.setAttribute("checked","");w.type=l.buttonType;w.name=l.name;w.id=g[s].id;w.value=s;w.autocomplete="off";I.appendChild(w);w=document.createTextNode(g[s].title);I.appendChild(w)}break;case "button":for(s=0,T=g.length;s<T;s++){I=document.createElement("button");I.className="btn btn-tool";I.id=g[s].id;I.name=l.name;g[s].height&&(I.style.height=g[s].height+"px");g[s].width&&(I.style.width=g[s].width+"px");if(g[s].bgType&&g[s].bgTypeData){switch(g[s].bgType){case "color":w=g[s].bgTypeData;
break;case "image":w="url("+g[s].bgTypeData+") no-repeat 50% 50%";break;default:return}I.style.background=w}a.appendChild(I);w=document.createTextNode(g[s].title);I.appendChild(w)}}k.Utils.domCreationDirector(l.children,this.domElement)};k.ButtonGroup.prototype=Object.create(_Container.prototype);k.ButtonGroup.prototype.addButton=function(c,k){k||this.setting.buttons.push(c);var l=document.createElement("label");l.className="btn btn-tool"+(c.checked?" active":"");c.height&&(l.style.height=c.height+
"px");c.width&&(l.style.width=c.width+"px");if(c.bgType&&c.bgTypeData){var a;switch(c.bgType){case "color":a=c.bgTypeData;break;case "image":a="url("+c.bgTypeData+") no-repeat 50% 50%";break;default:return}l.style.background=a}this.domElement.appendChild(l);a=document.createElement("input");c.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=c.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";l.appendChild(a);a=document.createTextNode(c.title);
l.appendChild(a);return l};k.ButtonGroup.prototype.addButtons=function(c,k){for(var l=0,a=c.length;l<a;l++)this.addButton(c[l],k)};k.Utils={};k.Utils.settingMixin=function(c,k){if("object"===typeof c&&"object"===typeof k){var l={},a;for(a in c)l[a]=c[a];for(var g in k)void 0!==k[g]&&(l[g]=k[g]);return l}return c};k.Utils.domCreationDirector=function(e,E){if(e)if(e instanceof Array)for(var l=0,a=e.length;l<a;l++)k.Utils.domCreationDirector(e[l],E?E:document.body);else e instanceof Object&&e.UIType&&
k[c(e.UIType)]&&new (k[c(e.UIType)])(e,E?E:document.body)};window.GoUI=k;"object"===typeof module&&(module.exports=k)})();
(function(c,k,e,E,l){function a(a,b){var c=b.clone(),d;for(d in a)c[d]=a[d];return c}function g(a){if(null==a.pageX&&null!=a.clientX){var b=k.documentElement,c=k.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}ua.set(a.pageX/h.WINDOW_WIDTH*2-1,2*-(a.pageY/h.WINDOW_HEIGHT)+1);f.setFromCamera(ua,h.camera);return f.intersectObjects(ia)}function s(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),
a.position.divideScalar(A.width).floor().multiplyScalar(A.width).addScalar(A.width/2))}function T(a){0<a.length&&s(Y,a[0])}function I(a,b,c,d){a=a||g(event);if(0<a.length){a=a[0];var f=y.toolsType,e=!1,h=ia.length;if(h&&a.object!==ba)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===ia[k]){e=!0;break}0===f?!0===e&&!1===b||!1===e&&!0===b||(b=p.draw(0,sa,void 0,a),d?ma.appendObjectToCurrentAction(b):ma.addAction("draw",b)):1===f&&c&&a.object!==ba&&(b=p.erase(a.object),d?ma.appendObjectToCurrentAction(b):
ma.addAction("erase",b))}}function w(a){0===ga&&(t.save(t.storageKeys.camera),t.save())}function fa(a){t.save(t.storageKeys.camera);t.save();ga=1}function M(a){a.preventDefault();var b;1===z[0]?(b=g(a),I(b,a.ctrlKey,a.ctrlKey,!0)):(b=y.toolsType,1===b?Y.visible&&(Y.visible=!1):(!Y.visible&&F&&(Y.visible=!0),b=g(a),T(b)))}function H(a){a.preventDefault();switch(a.button){case 0:z[0]=1;a=g(a);I(a,void 0,!0,!1);0===currentToolsType&&T(a);break;case 1:z[1]=1;break;case 2:z[2]=1}}function B(c){if("label"===
this.nodeName.toLowerCase())switch(c=this.getElementsByTagName("input")[0],y[c.name]=Number(c.value),c.name){case "textures":sa=y[c.name];aa=b[sa];ja=aa.data;ra=aa.helperData=b[y[c.name]].helperData||a(d,ja);Y.material=ra;break;case "sidebarResize":var e=GoUI.map.sidebar.domElement;"0"===c.value?$(e).animate({top:"0",height:"100%"}):$(e).animate({top:"60%",height:"40%"})}else if("button"===this.type||"button"===this.nodeName.toLowerCase())y[this.id]()}function la(a){switch(a.button){case 0:z[0]=0;
break;case 1:z[1]=0;break;case 2:z[2]=0}}function N(a){}function ea(a){if(!z[0])switch(a.keyCode){case 16:0===y.toolsType?k.getElementById("eraser").parentElement.click():1===y.toolsType&&k.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&ma.undo();break;case 89:a.ctrlKey&&ma.redo()}}function O(){requestAnimationFrame(O);h.renderer.render(h.scene,h.camera)}var Q=k.createElement("a");Q.id="imageCapture";Q.style.display="none";Q.target="_blank";k.body.appendChild(Q);var v=function(){};
v.prototype={LOAD_TYPE:{async:0,sync:1},asyncLoadDefaultInterval:0,storageKeys:{meshes:"vp_meshs",camera:"vp_camera"},load:function(a){return c.localStorage&&c.localStorage.getItem(a||this.storageKeys.meshes)},save:function(a,b){if(c.localStorage){var d="";if(b)d=b;else switch(a){default:case this.storageKeys.meshes:case void 0:for(var e=0,f=n.length;e<f;e++)d+=n[e].geo.id.replace("geo","")+",",d+=n[e].material.id.replace("texture","")+",",d+=n[e].meshObject.position.x+",",d+=n[e].meshObject.position.y+
",",d+=n[e].meshObject.position.z+";";break;case this.storageKeys.camera:d+=h.controls.target.x+","+h.controls.target.y+","+h.controls.target.z+";",d+=h.controls.object.position.x+","+h.controls.object.position.y+","+h.controls.object.position.z+";"}c.localStorage.setItem(a||this.storageKeys.meshes,d)}},loadMeshes:function(a,b){var c=0,d=[],e,f=this.load(a);f&&(d=f.split(";"));if(0<d.length)switch(b){case this.LOAD_TYPE.sync:for(var f=0,h=d.length;f<h;f++){var g=d[f].split(",");2<g.length&&p.draw(Number(g[0]),
Number(g[1]),[Number(g[2]),Number(g[3]),Number(g[4])])}break;default:case this.LOAD_TYPE.async:e=setInterval(function(){if(c<d.length){var a=d[c].split(",");2<a.length&&p.draw(Number(a[0]),Number(a[1]),[Number(a[2]),Number(a[3]),Number(a[4])]);c++}else clearInterval(e)},this.asyncLoadDefaultInterval)}},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:h.controls.target.set(Number(d[0]),Number(d[1]),
Number(d[2]));break;case 1:h.controls.object.position.set(Number(d[0]),Number(d[1]),Number(d[2]))}}h.controls.update()}}};var x=function(){this.currentActionIndex=-1;this.actionArray=[]};x.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=p.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":p.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,
e.meshObject.position.z],void 0,e.meshObject);break;case "erase":p.erase(e.meshObject)}}this.currentActionIndex--}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":p.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":p.erase(e.meshObject)}}this.currentActionIndex++}},
addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,d=a.length;c<d;c++)b.meshes.push(a[c]);else b.meshes.push(a)}};var u=function(){};u.prototype={calculateIntersectResult:g,
setMeshPositionToFitTheGrid:s,updateHelperCube:T,draw:function(a,c,d,e,f){if(void 0===a||"number"===typeof a)a=R[a||0];if(void 0===c||"number"===typeof c)c=b[c||0];var g=a.data,k=c.data;f=f||new E.Mesh(g,k);f.castShadow=!0;f.receiveShadow=!0;e?s(f,e):f.position.set(d[0],d[1],d[2]);h.scene.add(f);ia.push(f);n.push({meshObject:f,geo:a,material:c});return n[n.length-1]},erase:function(a){h.scene.remove(a);a=ia.indexOf(a);if(!(0>a)){ia.splice(a,1);var b=n[a-1];n.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",
erase:"draw"}};var A={width:50},q={webgl:{ambientLightColor:2105376,directionalLightDensity:.4},canvas:{ambientLightColor:9474192,directionalLightDensity:.9}},h,U,ba,ga=0;l=v.prototype.LOAD_TYPE.async;var ha=new E.MeshLambertMaterial({color:8828748}),d={opacity:.5,transparent:!0},b=[{name:"default",type:"color",uniqueData:"#86b74c",id:"texture0",data:ha,helperData:a(d,ha)}],R=[{name:"default",type:"1",id:"geo0",data:new E.BoxGeometry(A.width,A.width,A.width)}],F=!0,y={toolsType:0,toolsRadius:0,textures:0,
toggleAux:function(){1===y.toolsType||(Y.visible=!Y.visible);ka.visible=!ka.visible;F=!F},capture:function(){Q.href=h.renderer.domElement.toDataURL();Q.download="capture.png";Q.click()},clearAll:function(){var a=p.erase(n[0].meshObject);ma.addAction("erase",a);for(var b=0,c=n.length;b<c;b++)a=p.erase(n[0].meshObject),ma.appendObjectToCurrentAction(a)},undo:function(){ma.undo()},redo:function(){ma.redo()}},sa=0,aa=b[0],ja=aa.data,ra=aa.helperData,ta=R[0].data,Y,ka,ia=[],n=[],P,V,wa,ua,z=[0,0,0],f,
t=new v,ma=new x,p=new u;h=new e(k.body);h.init(function(a){if(h.WINDOW_WIDTH!==c.innerWidth||h.WINDOW_HEIGHT!==c.innerHeight)h.WINDOW_WIDTH=c.innerWidth,h.WINDOW_HEIGHT=c.innerHeight,h.WINDOW_HEIGHT_HALF=h.WINDOW_HEIGHT/2,h.WINDOW_WIDTH_HALF=h.WINDOW_WIDTH/2,h.camera.aspect=h.WINDOW_WIDTH/h.WINDOW_HEIGHT,h.camera.updateProjectionMatrix(),h.renderer.setSize(h.WINDOW_WIDTH,h.WINDOW_HEIGHT),k.body.height=h.WINDOW_HEIGHT},function(){ka=new E.GridHelper(5E3,A.width);h.scene.add(ka);U=new E.PlaneBufferGeometry(1E4,
1E4);U.applyMatrix((new E.Matrix4).makeRotationX(-Math.PI/2));ba=new E.Mesh(U);ba.visible=!1;h.scene.add(ba);ia.push(ba);P=new E.AmbientLight(q[h.renderType].ambientLightColor);h.scene.add(P);V=new E.DirectionalLight(15658734,q[h.renderType].directionalLightDensity);V.position.set(0,6E3,5E3);V.target.position.set(0,0,0);V.castShadow=!0;V.shadowCameraNear=h.camera.near;V.shadowCameraFar=h.camera.far;V.shadowCameraFov=h.camera.fov;V.shadowBias=1E-6;V.shadowDarkness=.5;V.shadowMapWidth=1024;V.shadowMapHeight=
1024;h.scene.add(V);wa=new E.HemisphereLight(15658734,3158064,.95);h.scene.add(wa);Y=new E.Mesh(ta,ra);Y.position.set(A.width/2,A.width/2,A.width/2);h.scene.add(Y);new E.Mesh(ta,ja);f=new E.Raycaster;ua=new E.Vector2;h.renderer.setClearColor(15790320);h.renderer.shadowMapEnabled=!0;h.renderer.shadowMapType=E.PCFShadowMap;c.addEventListener("unload",w,!1);c.addEventListener("reload",fa,!1);h.renderer.domElement.addEventListener("mousemove",M,!1);h.renderer.domElement.addEventListener("mousedown",H,
!1);h.renderer.domElement.addEventListener("mouseup",la,!1);k.addEventListener("keydown",N,!1);k.addEventListener("keyup",ea,!1);setInterval(w,12E4)});O();x={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",
id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",
children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:b[0].type,bgTypeData:b[0].uniqueData,width:57,height:57,
checked:!0}]}]}]};if(600>h.WINDOW_WIDTH)for(u=x.children,v=0,e=u.length;v<e;v++)if("sidebarResize"===u[v].id){v=u[v].buttons;u=0;for(e=v.length;u<e;u++)"normalSidebar"===v[u].id&&delete v[u].checked,"minSidebar"===v[u].id&&(v[u].checked=!0);break}GoUI.Utils.domCreationDirector(x);e=k.querySelectorAll(".btn");if(e instanceof Array||e.length)for(v=e.length-1;0<=v;v--)e[v].addEventListener("click",B,!1);else e instanceof object&&e.addEventListener("click",B,!1);u="#66ccff #ff6600 #cc3333 #ffcc33 #33cc99 #3399cc #b1eb00 #53bbf4 #ff85cb #ff432e #ffac00".split(" ");
v=0;for(e=u.length;v<e;v++)x={name:u[v],type:"color",id:"texture"+(v+1),uniqueData:u[v],data:new E.MeshLambertMaterial({color:u[v]})},b.push(x),GoUI.map.buttonGroup2.addButton({title:"",id:x.id,bgType:x.type,bgTypeData:x.uniqueData,width:57,height:57}).addEventListener("click",B,!1);u=["texture/grass.png","texture/sand.png","texture/glass.png"];v=0;for(e=u.length;v<e;v++)x={name:u[v].replace("texture/","").replace(".png",""),type:"image",id:"texture"+b.length,uniqueData:u[v],data:new E.MeshLambertMaterial({map:E.ImageUtils.loadTexture(u[v]),
transparent:!0})},"glass"===x.data.name&&(x.data.map.opacity=.3),x.data.map.magFilter=E.NearestFilter,x.data.map.minFilter=E.LinearMipMapLinearFilter,b.push(x),GoUI.map.buttonGroup2.addButton({title:"",id:x.id,bgType:x.type,bgTypeData:x.uniqueData,width:57,height:57}).addEventListener("click",B,!1);t.loadMeshes(void 0,l);t.loadCamera(t.storageKeys.camera)})(window,document,Base,THREE,Detector);
