THREE.SpriteCanvasMaterial=function(d){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(d,m){};this.setValues(d)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var d=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,d);d.color.copy(this.color);d.program=this.program;return d};
THREE.CanvasRenderer=function(d){function h(f,a,c,T){E(a);z(c);F(T);W(f.getStyle());b.stroke();A.expandByScalar(2*a)}function m(f){G(f.getStyle());b.fill()}function q(f){c(f.target)}function c(f){if(!(f instanceof THREE.CompressedTexture)){var a=f.wrapS===THREE.RepeatWrapping,A=f.wrapT===THREE.RepeatWrapping,c=f.image,T=document.createElement("canvas");T.width=c.width;T.height=c.height;var g=T.getContext("2d");g.setTransform(1,0,0,-1,0,c.height);g.drawImage(c,0,0);X[f.id]=b.createPattern(T,!0===a&&
!0===A?"repeat":!0===a&&!1===A?"repeat-x":!1===a&&!0===A?"repeat-y":"no-repeat")}}function p(f,a,A,T,g,e,l,m,y,d,h,wa,k){if(!(k instanceof THREE.DataTexture)){!1===k.hasEventListener("update",q)&&(void 0!==k.image&&0<k.image.width&&c(k),k.addEventListener("update",q));var aa=X[k.id];if(void 0!==aa){G(aa);var aa=k.offset.x/k.repeat.x,s=k.offset.y/k.repeat.y,p=k.image.width*k.repeat.x;k=k.image.height*k.repeat.y;l=(l+aa)*p;m=(m+s)*k;A-=f;T-=a;g-=f;e-=a;y=(y+aa)*p-l;d=(d+s)*k-m;h=(h+aa)*p-l;wa=(wa+s)*
k-m;k=y*wa-h*d;0!==k&&(aa=1/k,k=(wa*A-d*g)*aa,d=(wa*T-d*e)*aa,A=(y*g-h*A)*aa,T=(y*e-h*T)*aa,f=f-k*l-A*m,a=a-d*l-T*m,b.save(),b.transform(k,d,A,T,f,a),b.fill(),b.restore())}else G("rgba(0,0,0,1)"),b.fill()}}function a(f,a,b){var A=a.x-f.x,T=a.y-f.y,c=A*A+T*T;0!==c&&(b/=Math.sqrt(c),A*=b,T*=b,a.x+=A,a.y+=T,f.x-=A,f.y-=T)}function r(f){H!==f&&(H=b.globalAlpha=f)}function ba(f){K!==f&&(f===THREE.NormalBlending?b.globalCompositeOperation="source-over":f===THREE.AdditiveBlending?b.globalCompositeOperation=
"lighter":f===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),K=f)}function E(f){sa!==f&&(sa=b.lineWidth=f)}function z(f){ua!==f&&(ua=b.lineCap=f)}function F(f){xa!==f&&(xa=b.lineJoin=f)}function W(f){na!==f&&(na=b.strokeStyle=f)}function G(f){fa!==f&&(fa=b.fillStyle=f)}function u(f){I.length!==f.length&&(b.setLineDash(f),I=f)}console.log("THREE.CanvasRenderer",THREE.REVISION);var la=THREE.Math.smoothstep;d=d||{};var Y=this,ka,Z,ia,oa=new THREE.Projector,U=void 0!==d.canvas?d.canvas:
document.createElement("canvas"),V=U.width,ha=U.height,n=Math.floor(V/2),x=Math.floor(ha/2),R=0,L=0,ja=V,C=ha,g=1,b=U.getContext("2d",{alpha:!0===d.alpha}),k=new THREE.Color(0),v=!0===d.alpha?0:1,H=1,K=0,na=null,fa=null,sa=null,ua=null,xa=null,I=[],pa,w,y,ma;new THREE.RenderableVertex;new THREE.RenderableVertex;var va,ya,D,e,s,ta,l=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var za=new THREE.Color,P=new THREE.Color,Aa=new THREE.Color,X={},N,Ba,Ca,S,O,Q,ea,ga=new THREE.Box2,
f=new THREE.Box2,A=new THREE.Box2,T=new THREE.Color,wa=new THREE.Color,aa=new THREE.Color,qa=new THREE.Vector3,Ea=new THREE.Vector3,ra=new THREE.Vector3,Da=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=U;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return g};this.setPixelRatio=function(f){g=f};this.setSize=
function(a,b,A){V=a*g;ha=b*g;U.width=V;U.height=ha;n=Math.floor(V/2);x=Math.floor(ha/2);!1!==A&&(U.style.width=a+"px",U.style.height=b+"px");ga.min.set(-n,-x);ga.max.set(n,x);f.min.set(-n,-x);f.max.set(n,x);H=1;K=0;xa=ua=sa=fa=na=null;this.setViewport(0,0,a,b)};this.setViewport=function(f,a,b,A){R=f*g;L=a*g;ja=b*g;C=A*g};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,b){k.set(a);v=void 0!==b?b:1;f.min.set(-n,-x);f.max.set(n,x)};this.setClearColorHex=
function(f,a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(f,a)};this.getClearColor=function(){return k};this.getClearAlpha=function(){return v};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===f.empty()&&(f.intersect(ga),f.expandByScalar(2),f.min.x+=n,f.min.y=-f.min.y+x,f.max.x+=n,f.max.y=-f.max.y+x,1>v&&b.clearRect(f.min.x|0,f.max.y|0,f.max.x-f.min.x|0,f.min.y-f.max.y|0),0<v&&(ba(THREE.NormalBlending),
r(1),G("rgba("+Math.floor(255*k.r)+","+Math.floor(255*k.g)+","+Math.floor(255*k.b)+","+v+")"),b.fillRect(f.min.x|0,f.max.y|0,f.max.x-f.min.x|0,f.min.y-f.max.y|0)),f.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(g,k){if(!1===k instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();Y.info.render.vertices=0;Y.info.render.faces=
0;b.setTransform(ja/V,0,0,-C/ha,R,ha-L);b.translate(n,x);ka=oa.projectScene(g,k,this.sortObjects,this.sortElements);Z=ka.elements;ia=ka.lights;pa=k;Da.getNormalMatrix(k.matrixWorldInverse);T.setRGB(0,0,0);wa.setRGB(0,0,0);aa.setRGB(0,0,0);for(var d=0,H=ia.length;d<H;d++){var t=ia[d],M=t.color;t instanceof THREE.AmbientLight?T.add(M):t instanceof THREE.DirectionalLight?wa.add(M):t instanceof THREE.PointLight&&aa.add(M)}d=0;for(H=Z.length;d<H;d++){var B=Z[d],v=B.material;if(void 0!==v&&0!==v.opacity){A.makeEmpty();
if(B instanceof THREE.RenderableSprite){w=B;w.x*=n;w.y*=x;var t=w,J=B,M=v;r(M.opacity);ba(M.blending);var K=J.scale.x*n,J=J.scale.y*x,B=.5*Math.sqrt(K*K+J*J);A.min.set(t.x-B,t.y-B);A.max.set(t.x+B,t.y+B);if(M instanceof THREE.SpriteMaterial){var ca=M.map;if(null!==ca&&void 0!==ca.image){!1===ca.hasEventListener("update",q)&&(0<ca.image.width&&c(ca),ca.addEventListener("update",q));B=X[ca.id];void 0!==B?G(B):G("rgba( 0, 0, 0, 1 )");var da=ca.image,B=da.width*ca.offset.x,v=da.height*ca.offset.y,I=da.width*
ca.repeat.x,ca=da.height*ca.repeat.y,da=K/I,U=J/ca;b.save();b.translate(t.x,t.y);0!==M.rotation&&b.rotate(M.rotation);b.translate(-K/2,-J/2);b.scale(da,U);b.translate(-B,-v);b.fillRect(B,v,I,ca)}else G(M.color.getStyle()),b.save(),b.translate(t.x,t.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(K,-J),b.fillRect(-.5,-.5,1,1);b.restore()}else M instanceof THREE.SpriteCanvasMaterial&&(W(M.color.getStyle()),G(M.color.getStyle()),b.save(),b.translate(t.x,t.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(K,
J),M.program(b),b.restore())}else if(B instanceof THREE.RenderableLine){if(w=B.v1,y=B.v2,w.positionScreen.x*=n,w.positionScreen.y*=x,y.positionScreen.x*=n,y.positionScreen.y*=x,A.setFromPoints([w.positionScreen,y.positionScreen]),!0===ga.isIntersectionBox(A))if(t=w,M=y,K=B,J=v,r(J.opacity),ba(J.blending),b.beginPath(),b.moveTo(t.positionScreen.x,t.positionScreen.y),b.lineTo(M.positionScreen.x,M.positionScreen.y),J instanceof THREE.LineBasicMaterial){E(J.linewidth);z(J.linecap);F(J.linejoin);if(J.vertexColors!==
THREE.VertexColors)W(J.color.getStyle());else if(B=K.vertexColors[0].getStyle(),K=K.vertexColors[1].getStyle(),B===K)W(B);else{try{var fa=b.createLinearGradient(t.positionScreen.x,t.positionScreen.y,M.positionScreen.x,M.positionScreen.y);fa.addColorStop(0,B);fa.addColorStop(1,K)}catch(na){fa=B}W(fa)}b.stroke();A.expandByScalar(2*J.linewidth)}else J instanceof THREE.LineDashedMaterial&&(E(J.linewidth),z(J.linecap),F(J.linejoin),W(J.color.getStyle()),u([J.dashSize,J.gapSize]),b.stroke(),A.expandByScalar(2*
J.linewidth),u([]))}else if(B instanceof THREE.RenderableFace){w=B.v1;y=B.v2;ma=B.v3;if(-1>w.positionScreen.z||1<w.positionScreen.z)continue;if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>ma.positionScreen.z||1<ma.positionScreen.z)continue;w.positionScreen.x*=n;w.positionScreen.y*=x;y.positionScreen.x*=n;y.positionScreen.y*=x;ma.positionScreen.x*=n;ma.positionScreen.y*=x;0<v.overdraw&&(a(w.positionScreen,y.positionScreen,v.overdraw),a(y.positionScreen,ma.positionScreen,v.overdraw),
a(ma.positionScreen,w.positionScreen,v.overdraw));A.setFromPoints([w.positionScreen,y.positionScreen,ma.positionScreen]);if(!0===ga.isIntersectionBox(A)){M=w;K=y;J=ma;t=v;Y.info.render.vertices+=3;Y.info.render.faces++;r(t.opacity);ba(t.blending);va=M.positionScreen.x;ya=M.positionScreen.y;D=K.positionScreen.x;e=K.positionScreen.y;s=J.positionScreen.x;ta=J.positionScreen.y;var v=va,I=ya,ca=D,da=e,U=s,sa=ta;b.beginPath();b.moveTo(v,I);b.lineTo(ca,da);b.lineTo(U,sa);b.closePath();if((t instanceof THREE.MeshLambertMaterial||
t instanceof THREE.MeshPhongMaterial)&&null===t.map){za.copy(t.color);P.copy(t.emissive);t.vertexColors===THREE.FaceColors&&za.multiply(B.color);l.copy(T);Ea.copy(M.positionWorld).add(K.positionWorld).add(J.positionWorld).divideScalar(3);M=Ea;K=B.normalModel;J=l;B=0;for(v=ia.length;B<v;B++)I=ia[B],Aa.copy(I.color),I instanceof THREE.DirectionalLight?(ca=qa.setFromMatrixPosition(I.matrixWorld).normalize(),da=K.dot(ca),0>=da||(da*=I.intensity,J.add(Aa.multiplyScalar(da)))):I instanceof THREE.PointLight&&
(ca=qa.setFromMatrixPosition(I.matrixWorld),da=K.dot(qa.subVectors(ca,M).normalize()),0>=da||(da*=0==I.distance?1:1-Math.min(M.distanceTo(ca)/I.distance,1),0!=da&&(da*=I.intensity,J.add(Aa.multiplyScalar(da)))));l.multiply(za).add(P);!0===t.wireframe?h(l,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):m(l)}else t instanceof THREE.MeshBasicMaterial||t instanceof THREE.MeshLambertMaterial||t instanceof THREE.MeshPhongMaterial?null!==t.map?t.map.mapping===THREE.UVMapping&&(N=B.uvs,p(va,
ya,D,e,s,ta,N[0].x,N[0].y,N[1].x,N[1].y,N[2].x,N[2].y,t.map)):null!==t.envMap?t.envMap.mapping===THREE.SphericalReflectionMapping&&(ra.copy(B.vertexNormalsModel[0]).applyMatrix3(Da),Ba=.5*ra.x+.5,Ca=.5*ra.y+.5,ra.copy(B.vertexNormalsModel[1]).applyMatrix3(Da),S=.5*ra.x+.5,O=.5*ra.y+.5,ra.copy(B.vertexNormalsModel[2]).applyMatrix3(Da),Q=.5*ra.x+.5,ea=.5*ra.y+.5,p(va,ya,D,e,s,ta,Ba,Ca,S,O,Q,ea,t.envMap)):(l.copy(t.color),t.vertexColors===THREE.FaceColors&&l.multiply(B.color),!0===t.wireframe?h(l,t.wireframeLinewidth,
t.wireframeLinecap,t.wireframeLinejoin):m(l)):(t instanceof THREE.MeshDepthMaterial?l.r=l.g=l.b=1-la(M.positionScreen.z*M.positionScreen.w,pa.near,pa.far):t instanceof THREE.MeshNormalMaterial?(ra.copy(B.normalModel).applyMatrix3(Da),l.setRGB(ra.x,ra.y,ra.z).multiplyScalar(.5).addScalar(.5)):l.setRGB(1,1,1),!0===t.wireframe?h(l,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):m(l))}}f.union(A)}}b.setTransform(1,0,0,1,0,0)}}};
THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(d){this.positionWorld.copy(d.positionWorld);this.positionScreen.copy(d.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function d(){if(F===G){var a=new THREE.RenderableVertex;W.push(a);G++;F++;return a}return W[F++]}function h(){if(la===ka){var a=new THREE.RenderableFace;Y.push(a);ka++;la++;return a}return Y[la++]}function m(){if(ia===U){var a=new THREE.RenderableLine;oa.push(a);U++;ia++;return a}return oa[ia++]}function q(){if(ha===x){var a=new THREE.RenderableSprite;n.push(a);x++;ha++;return a}return n[ha++]}function c(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function p(a,
b){var c=0,g=1,d=a.z+a.w,e=b.z+b.w,k=-a.z+a.w,m=-b.z+b.w;if(0<=d&&0<=e&&0<=k&&0<=m)return!0;if(0>d&&0>e||0>k&&0>m)return!1;0>d?c=Math.max(c,d/(d-e)):0>e&&(g=Math.min(g,d/(d-e)));0>k?c=Math.max(c,k/(k-m)):0>m&&(g=Math.min(g,k/(k-m)));if(g<c)return!1;a.lerp(b,c);b.lerp(a,1-g);return!0}var a,r,ba=[],E=0,z,F,W=[],G=0,u,la,Y=[],ka=0,Z,ia,oa=[],U=0,V,ha,n=[],x=0,R={objects:[],lights:[],elements:[]},L=new THREE.Vector3,ja=new THREE.Vector3,C=new THREE.Vector3,g=new THREE.Vector3,b=new THREE.Vector4,k=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),v=new THREE.Box3,H=Array(3),K=new THREE.Matrix4,na=new THREE.Matrix4,fa,sa=new THREE.Matrix4,ua=new THREE.Matrix3,xa=new THREE.Frustum,I=new THREE.Vector4,pa=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var w=new function(){var a=[],b=[],c=null,g=null,q=new THREE.Matrix3,e=function(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(fa);c.copy(b).applyMatrix4(na);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z},p=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;H[0]=a.positionScreen;H[1]=b.positionScreen;H[2]=c.positionScreen;return k.isIntersectionBox(v.setFromPoints(H))},r=function(a,b,c){return 0>(c.positionScreen.x-
a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(d){c=d;g=c.material;q.getNormalMatrix(c.matrixWorld);a.length=0;b.length=0},projectVertex:e,checkTriangleVisibility:p,checkBackfaceCulling:r,pushVertex:function(a,b,c){z=d();z.position.set(a,b,c);e(z)},pushNormal:function(b,c,g){a.push(b,c,g)},pushUv:function(a,c){b.push(a,c)},pushLine:function(a,b){var g=W[a],d=W[b];Z=m();Z.id=c.id;
Z.v1.copy(g);Z.v2.copy(d);Z.z=(g.positionScreen.z+d.positionScreen.z)/2;Z.material=c.material;R.elements.push(Z)},pushTriangle:function(d,k,m){var e=W[d],n=W[k],v=W[m];if(!1!==p(e,n,v)&&(g.side===THREE.DoubleSide||!0===r(e,n,v))){u=h();u.id=c.id;u.v1.copy(e);u.v2.copy(n);u.v3.copy(v);u.z=(e.positionScreen.z+n.positionScreen.z+v.positionScreen.z)/3;for(e=0;3>e;e++)n=3*arguments[e],v=u.vertexNormalsModel[e],v.set(a[n],a[n+1],a[n+2]),v.applyMatrix3(q).normalize(),n=2*arguments[e],u.uvs[e].set(b[n],b[n+
1]);u.vertexNormalsLength=3;u.material=c.material;R.elements.push(u)}}}};this.projectScene=function(k,n,v,x){ha=ia=la=0;R.elements.length=0;!0===k.autoUpdate&&k.updateMatrixWorld();void 0===n.parent&&n.updateMatrixWorld();K.copy(n.matrixWorldInverse.getInverse(n.matrixWorld));na.multiplyMatrices(n.projectionMatrix,K);xa.setFromMatrix(na);r=0;R.objects.length=0;R.lights.length=0;k.traverseVisible(function(f){if(f instanceof THREE.Light)R.lights.push(f);else if((f instanceof THREE.Mesh||f instanceof
THREE.Line||f instanceof THREE.Sprite)&&!1!==f.material.visible&&(!1===f.frustumCulled||!0===xa.intersectsObject(f))){if(r===E){var b=new THREE.RenderableObject;ba.push(b);E++;r++;a=b}else a=ba[r++];a.id=f.id;a.object=f;g.setFromMatrixPosition(f.matrixWorld);g.applyProjection(na);a.z=g.z;R.objects.push(a)}});!0===v&&R.objects.sort(c);k=0;for(v=R.objects.length;k<v;k++){var D=R.objects[k].object,e=D.geometry;w.setObject(D);fa=D.matrixWorld;F=0;if(D instanceof THREE.Mesh)if(e instanceof THREE.BufferGeometry){var s=
e.attributes,D=e.offsets;if(void 0!==s.position){for(var H=s.position.array,e=0,l=H.length;e<l;e+=3)w.pushVertex(H[e],H[e+1],H[e+2]);if(void 0!==s.normal)for(var z=s.normal.array,e=0,l=z.length;e<l;e+=3)w.pushNormal(z[e],z[e+1],z[e+2]);if(void 0!==s.uv)for(z=s.uv.array,e=0,l=z.length;e<l;e+=2)w.pushUv(z[e],z[e+1]);if(void 0!==s.index)if(s=s.index.array,0<D.length)for(k=0;k<D.length;k++)for(l=D[k],H=l.index,e=l.start,l=l.start+l.count;e<l;e+=3)w.pushTriangle(s[e]+H,s[e+1]+H,s[e+2]+H);else for(e=0,
l=s.length;e<l;e+=3)w.pushTriangle(s[e],s[e+1],s[e+2]);else for(e=0,l=H.length/3;e<l;e+=3)w.pushTriangle(e,e+1,e+2)}}else{if(e instanceof THREE.Geometry){var P=e.vertices,l=e.faces,s=e.faceVertexUvs[0];ua.getNormalMatrix(fa);for(var H=D.material instanceof THREE.MeshFaceMaterial,z=!0===H?D.material:null,G=0,X=P.length;G<X;G++){var N=P[G];w.pushVertex(N.x,N.y,N.z)}P=0;for(G=l.length;P<G;P++){var X=l[P],U=!0===H?z.materials[X.materialIndex]:D.material;if(void 0!==U){var Y=U.side,N=W[X.a],S=W[X.b],O=
W[X.c];if(!0===U.morphTargets){var Q=e.morphTargets,ea=D.morphTargetInfluences,ga=N.position,f=S.position,A=O.position;L.set(0,0,0);ja.set(0,0,0);C.set(0,0,0);for(var T=0,wa=Q.length;T<wa;T++){var aa=ea[T];if(0!==aa){var qa=Q[T].vertices;L.x+=(qa[X.a].x-ga.x)*aa;L.y+=(qa[X.a].y-ga.y)*aa;L.z+=(qa[X.a].z-ga.z)*aa;ja.x+=(qa[X.b].x-f.x)*aa;ja.y+=(qa[X.b].y-f.y)*aa;ja.z+=(qa[X.b].z-f.z)*aa;C.x+=(qa[X.c].x-A.x)*aa;C.y+=(qa[X.c].y-A.y)*aa;C.z+=(qa[X.c].z-A.z)*aa}}N.position.add(L);S.position.add(ja);O.position.add(C);
w.projectVertex(N);w.projectVertex(S);w.projectVertex(O)}if(!1!==w.checkTriangleVisibility(N,S,O)){Q=w.checkBackfaceCulling(N,S,O);if(Y!==THREE.DoubleSide){if(Y===THREE.FrontSide&&!1===Q)continue;if(Y===THREE.BackSide&&!0===Q)continue}u=h();u.id=D.id;u.v1.copy(N);u.v2.copy(S);u.v3.copy(O);u.normalModel.copy(X.normal);!1!==Q||Y!==THREE.BackSide&&Y!==THREE.DoubleSide||u.normalModel.negate();u.normalModel.applyMatrix3(ua).normalize();ea=X.vertexNormals;ga=0;for(f=Math.min(ea.length,3);ga<f;ga++)A=u.vertexNormalsModel[ga],
A.copy(ea[ga]),!1!==Q||Y!==THREE.BackSide&&Y!==THREE.DoubleSide||A.negate(),A.applyMatrix3(ua).normalize();u.vertexNormalsLength=ea.length;Y=s[P];if(void 0!==Y)for(Q=0;3>Q;Q++)u.uvs[Q].copy(Y[Q]);u.color=X.color;u.material=U;u.z=(N.positionScreen.z+S.positionScreen.z+O.positionScreen.z)/3;R.elements.push(u)}}}}}else if(D instanceof THREE.Line)if(e instanceof THREE.BufferGeometry){if(s=e.attributes,void 0!==s.position){H=s.position.array;e=0;for(l=H.length;e<l;e+=3)w.pushVertex(H[e],H[e+1],H[e+2]);
if(void 0!==s.index)for(s=s.index.array,e=0,l=s.length;e<l;e+=2)w.pushLine(s[e],s[e+1]);else for(s=D.mode===THREE.LinePieces?2:1,e=0,l=H.length/3-1;e<l;e+=s)w.pushLine(e,e+1)}}else{if(e instanceof THREE.Geometry&&(sa.multiplyMatrices(na,fa),P=D.geometry.vertices,0!==P.length))for(N=d(),N.positionScreen.copy(P[0]).applyMatrix4(sa),s=D.mode===THREE.LinePieces?2:1,G=1,X=P.length;G<X;G++)N=d(),N.positionScreen.copy(P[G]).applyMatrix4(sa),0<(G+1)%s||(S=W[F-2],I.copy(N.positionScreen),pa.copy(S.positionScreen),
!0===p(I,pa)&&(I.multiplyScalar(1/I.w),pa.multiplyScalar(1/pa.w),Z=m(),Z.id=D.id,Z.v1.positionScreen.copy(I),Z.v2.positionScreen.copy(pa),Z.z=Math.max(I.z,pa.z),Z.material=D.material,D.material.vertexColors===THREE.VertexColors&&(Z.vertexColors[0].copy(D.geometry.colors[G]),Z.vertexColors[1].copy(D.geometry.colors[G-1])),R.elements.push(Z)))}else D instanceof THREE.Sprite&&(b.set(fa.elements[12],fa.elements[13],fa.elements[14],1),b.applyMatrix4(na),e=1/b.w,b.z*=e,-1<=b.z&&1>=b.z&&(V=q(),V.id=D.id,
V.x=b.x*e,V.y=b.y*e,V.z=b.z,V.object=D,V.rotation=D.rotation,V.scale.x=D.scale.x*Math.abs(V.x-(b.x+n.projectionMatrix.elements[0])/(b.w+n.projectionMatrix.elements[12])),V.scale.y=D.scale.y*Math.abs(V.y-(b.y+n.projectionMatrix.elements[5])/(b.w+n.projectionMatrix.elements[13])),V.material=D.material,R.elements.push(V)))}!0===x&&R.elements.sort(c);return R}};
THREE.OrbitControls=function(d,h,m){function q(b){if(!1!==a.enabled){b.preventDefault();var c=a.domElement===document?a.domElement.body:a.domElement;if(x===n.ROTATE){if(!0===a.noRotate)return;ba.set(b.clientX,b.clientY);E.subVectors(ba,r);a.rotateLeft(2*Math.PI*E.x/c.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*E.y/c.clientHeight*a.rotateSpeed);r.copy(ba)}else if(x===n.DOLLY){if(!0===a.noZoom)return;Y.set(b.clientX,b.clientY);ka.subVectors(Y,la);0<ka.y?a.dollyIn():a.dollyOut();la.copy(Y)}else if(x===
n.PAN){if(!0===a.noPan)return;F.set(b.clientX,b.clientY);W.subVectors(F,z);a.panXZ(W.x*a.panSpeed,-W.y*a.panSpeed);z.copy(F)}a.update()}}function c(){!1!==a.enabled&&(document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",c,!1),a.dispatchEvent(g),x=n.NONE)}function p(b){if(!1!==a.enabled&&!0!==a.noZoom){b.preventDefault();b.stopPropagation();var c=0;void 0!==b.wheelDelta?c=b.wheelDelta:void 0!==b.detail&&(c=-b.detail);0<c?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(C);
a.dispatchEvent(g)}}this.settings=m;this.object=d;this.domElement=void 0!==h?h:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.panSpeed=.3;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,
BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,r=new THREE.Vector2,ba=new THREE.Vector2,E=new THREE.Vector2,z=new THREE.Vector2,F=new THREE.Vector2,W=new THREE.Vector2,G=new THREE.Vector3,u=new THREE.Vector3,la=new THREE.Vector2,Y=new THREE.Vector2,ka=new THREE.Vector2,Z=0,ia=0,oa=1,U=new THREE.Vector3,V=new THREE.Vector3,ha=new THREE.Quaternion,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},x=n.NONE;this.target0=
this.target.clone();this.position0=this.object.position.clone();var R=(new THREE.Quaternion).setFromUnitVectors(d.up,new THREE.Vector3(0,1,0)),L=R.clone().inverse(),ja={type:"change"},C={type:"start"},g={type:"end"};this.rotateLeft=function(b){void 0===b&&(b=2*Math.PI/60/60*a.autoRotateSpeed);ia-=b};this.rotateUp=function(b){void 0===b&&(b=2*Math.PI/60/60*a.autoRotateSpeed);Z-=b};this.panLeft=function(a){var c=this.object.matrix.elements;G.set(c[0],c[1],c[2]);G.multiplyScalar(-a);U.add(G)};this.panUp=
function(a){var c=this.object.matrix.elements;G.set(c[4],c[5],c[6]);G.multiplyScalar(a);U.add(G)};this.panForward=function(a){var c=this.object.matrix.elements;G.set(c[8],c[9],c[10]);G.multiplyScalar(a);U.add(G)};this.pan=function(b,c){var g=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*b*d/g.clientHeight);a.panUp(2*c*d/g.clientHeight)}else void 0!==a.object.top?
(a.panLeft(b*(a.object.right-a.object.left)/g.clientWidth),a.panUp(c*(a.object.top-a.object.bottom)/g.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(b,c){var g=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var d=a.object.position.clone().sub(a.target).length(),d=d*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*b*d/g.clientHeight);a.panForward(2*c*d/g.clientHeight)}else void 0!==a.object.top?
(a.panLeft(b*(a.object.right-a.object.left)/g.clientWidth),a.panForward(c*(a.object.top-a.object.bottom)/g.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(b){void 0===b&&(b=Math.pow(.95,a.zoomSpeed));oa/=b};this.dollyOut=function(b){void 0===b&&(b=Math.pow(.95,a.zoomSpeed));oa*=b};this.update=function(){var b=this.object.position,c=this.settings&&this.settings.cameraAsOrbitCenter?b:this.target,g=this.settings&&this.settings.cameraAsOrbitCenter?
this.target:b;u.copy(b).sub(this.target);u.applyQuaternion(R);var b=Math.atan2(u.x,u.z),d=Math.atan2(Math.sqrt(u.x*u.x+u.z*u.z),u.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*a.autoRotateSpeed);var b=b+ia,d=d+Z,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),d=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d)),d=Math.max(1E-6,Math.min(Math.PI-1E-6,d)),m=this.settings&&this.settings.cameraAsOrbitCenter?5E3*oa*this.settings.boxScale:u.length()*oa,m=Math.max(this.minDistance,
Math.min(this.maxDistance,m));c.add(U);u.x=m*Math.sin(d)*Math.sin(b);u.y=m*Math.cos(d);u.z=m*Math.sin(d)*Math.cos(b);u.applyQuaternion(L);this.settings&&this.settings.cameraAsOrbitCenter?g.copy(c).sub(u):g.copy(c).add(u);this.object.lookAt(this.target);Z=ia=0;oa=1;U.set(0,0,0);if(1E-6<V.distanceToSquared(c)||1E-6<8*(1-ha.dot(this.object.quaternion)))this.dispatchEvent(ja),V.copy(c),ha.copy(this.object.quaternion)};this.reset=function(){x=n.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);
this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(b){if(!1!==a.enabled){b.preventDefault();if(b.button===a.mouseButtons.ORBIT){if(!0===a.noRotate)return;x=n.ROTATE;r.set(b.clientX,b.clientY)}else if(b.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;x=n.DOLLY;la.set(b.clientX,b.clientY)}else if(b.button===a.mouseButtons.PAN){if(!0===a.noPan)return;x=n.PAN;z.set(b.clientX,b.clientY)}document.addEventListener("mousemove",
q,!1);document.addEventListener("mouseup",c,!1);a.dispatchEvent(C)}},!1);this.domElement.addEventListener("mousewheel",p,!1);this.domElement.addEventListener("DOMMouseScroll",p,!1);this.domElement.addEventListener("touchstart",function(b){if(!1!==a.enabled){switch(b.touches.length){case 1:if(!0===a.noRotate)return;x=n.TOUCH_ROTATE;r.set(b.touches[0].pageX,b.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;x=n.TOUCH_DOLLY;var c=b.touches[0].pageX-b.touches[1].pageX;b=b.touches[0].pageY-b.touches[1].pageY;
c=Math.sqrt(c*c+b*b);la.set(0,c);break;case 3:if(!0===a.noPan)return;x=n.TOUCH_PAN;z.set(b.touches[0].pageX,b.touches[0].pageY);break;default:x=n.NONE}a.dispatchEvent(C)}},!1);this.domElement.addEventListener("touchend",function(){!1!==a.enabled&&(a.dispatchEvent(g),x=n.NONE)},!1);this.domElement.addEventListener("touchmove",function(b){if(!1!==a.enabled){b.preventDefault();b.stopPropagation();var c=a.domElement===document?a.domElement.body:a.domElement;switch(b.touches.length){case 1:if(!0===a.noRotate)break;
if(x!==n.TOUCH_ROTATE)break;ba.set(b.touches[0].pageX,b.touches[0].pageY);E.subVectors(ba,r);a.rotateLeft(2*Math.PI*E.x/c.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*E.y/c.clientHeight*a.rotateSpeed);r.copy(ba);a.update();break;case 2:if(!0===a.noZoom)break;if(x!==n.TOUCH_DOLLY)break;c=b.touches[0].pageX-b.touches[1].pageX;b=b.touches[0].pageY-b.touches[1].pageY;b=Math.sqrt(c*c+b*b);Y.set(0,b);ka.subVectors(Y,la);0<ka.y?a.dollyOut():a.dollyIn();la.copy(Y);a.update();break;case 3:if(!0===a.noPan)break;
if(x!==n.TOUCH_PAN)break;F.set(b.touches[0].pageX,b.touches[0].pageY);W.subVectors(F,z);a.panXZ(W.x*a.panSpeed,-W.y*a.panSpeed);z.copy(F);a.update();break;default:x=n.NONE}}},!1);window.addEventListener("keydown",function(b){if(!1!==a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(b.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,a.keyPanSpeed);
a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var d=document.createElement("canvas");return!(!window.WebGLRenderingContext||!d.getContext("webgl")&&!d.getContext("experimental-webgl"))}catch(h){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var d=document.createElement("div");d.id="webgl-error-message";d.style.fontFamily="monospace";d.style.fontSize="13px";d.style.fontWeight="normal";
d.style.textAlign="center";d.style.background="#fff";d.style.color="#000";d.style.padding="1.5em";d.style.width="400px";d.style.margin="5em auto 0";this.webgl||(d.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return d},addGetWebGLMessage:function(d){var h,m;d=d||{};h=void 0!==d.parent?d.parent:document.body;d=void 0!==d.id?d.id:"oldie";m=Detector.getWebGLErrorMessage();m.id=d;h.appendChild(m)}};"object"===typeof module&&(module.exports=Detector);
(function(d,h,m,q){var c=function(c){this.domParent="object"===typeof c?c:h.body};c.prototype.init=function(c,a,r,ba,E,z){d.requestAnimationFrame||(d.requestAnimationFrame=function(){return d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame||function(a,c){d.setTimeout(a,1E3/60)}}());this.domParent===h.body&&(this.WINDOW_WIDTH=d.innerWidth,this.WINDOW_HEIGHT=d.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,d.addEventListener("resize",c,!1));this.renderType=q.webgl?"webgl":"canvas";this.renderer=r||(q.webgl?new m.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new m.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=ba||new m.Scene;this.camera=E||new m.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
z?this.controls=z:(this.controls=new m.OrbitControls(this.camera,this.renderer.domElement,{cameraAsOrbitCenter:!0}),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.keyPanSpeed=10,this.controls.panSpeed=1,this.controls.noZoom=!0,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:81,BOTTOM:69},this.controls.mouseButtons={ORBIT:m.MOUSE.MIDDLE,PAN:m.MOUSE.RIGHT});this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top=
"0px";this.stats.domElement.style.zIndex="999";h.body.appendChild(this.stats.domElement);a()};d.Base=c;"object"===typeof module&&(module.exports=c)})(window,document,THREE,Detector);
(function(){function d(d){return d.charAt(0).toUpperCase()+d.slice(1)}var h={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(d){var h=0;for(d=d.length;h<d;h++);};h.map={};h.Sidebar=function(d,q){_Container.call(this);var c=this.setting=h.Utils.settingMixin({align:"r",width:320},d),p="sidebar",p=c.align&&"r"!==c.align?p+" sidebar-left":p+" sidebar-right";this.domElement.className=p;c.id&&(this.domElement.id=c.id,h.map[c.id]=this);
this.domElement.style.width=c.width.toString()+"px";c.overflow&&(this.domElement.style.overflow=c.overflow.toString());q.appendChild(this.domElement);h.Utils.domCreationDirector(c.children,this.domElement)};h.Sidebar.prototype=Object.create(_Container.prototype);h.Panel=function(d,q){_Container.call(this);var c=this.setting=h.Utils.settingMixin({title:""},d);c.id&&(this.domElement.id=c.id,h.map[c.id]=this);var p=this.domElement;p.className="panel panel-tool";q.appendChild(p);var a=document.createElement("div");
a.className="panel-heading";p.appendChild(a);var r=document.createTextNode(c.title);a.appendChild(r);a=document.createElement("div");a.className="panel-body";c.overflow&&(a.style.overflow=c.overflow.toString());p.appendChild(a);h.Utils.domCreationDirector(c.children,a)};h.Panel.prototype=Object.create(_Container.prototype);h.Toolbar=function(d,q){_Container.call(this);var c=this.setting=h.Utils.settingMixin({title:""},d);c.id&&(this.domElement.id=c.id,h.map[c.id]=this);var p=this.domElement;p.className=
"btn-toolbar";q.appendChild(p);h.Utils.domCreationDirector(c.children,p)};h.Toolbar.prototype=Object.create(_Container.prototype);h.ButtonGroup=function(d,q){_Container.call(this);var c=this.setting=h.Utils.settingMixin({title:"",buttonType:"radio"},d);c.id&&(this.domElement.id=c.id,h.map[c.id]=this);var p=this.domElement;p.className="btn-group"+(c.appendClass?" "+c.appendClass:"");"button"!==c.buttonType.toLowerCase()&&p.setAttribute("data-toggle","buttons");p.title=c.title;q.appendChild(p);var a=
c.buttons;switch(c.buttonType.toLowerCase()){default:case "radio":for(var r=0,ba=a.length;r<ba;r++){var E=document.createElement("label");E.className="btn btn-tool"+(a[r].checked?" active":"");a[r].height&&(E.style.height=a[r].height+"px");a[r].width&&(E.style.width=a[r].width+"px");if(a[r].bgType&&a[r].bgTypeData){var z;switch(a[r].bgType){case "color":z=a[r].bgTypeData;E.className+=" btn-color";break;case "image":z="url("+a[r].bgTypeData+") no-repeat 50% 50%";E.className+=" btn-image";break;default:return}E.style.background=
z}p.appendChild(E);var F=document.createElement("input");a[r].checked&&F.setAttribute("checked","");F.type=c.buttonType;F.name=c.name;F.id=a[r].id;F.value=r;F.autocomplete="off";E.appendChild(F);z=document.createTextNode(a[r].title);E.appendChild(z)}break;case "button":for(r=0,ba=a.length;r<ba;r++){F=document.createElement("button");F.className="btn btn-tool";F.id=a[r].id;F.name=c.name;a[r].height&&(F.style.height=a[r].height+"px");a[r].width&&(F.style.width=a[r].width+"px");if(a[r].bgType&&a[r].bgTypeData){switch(a[r].bgType){case "color":z=
a[r].bgTypeData;E.className+=" btn-color";break;case "image":z="url("+a[r].bgTypeData+") no-repeat 50% 50%";E.className+=" btn-image";break;default:return}F.style.background=z}p.appendChild(F);z=document.createTextNode(a[r].title);F.appendChild(z)}}h.Utils.domCreationDirector(c.children,this.domElement)};h.ButtonGroup.prototype=Object.create(_Container.prototype);h.ButtonGroup.prototype.addButton=function(d,h){h||this.setting.buttons.push(d);var c=document.createElement("label");c.className="btn btn-tool"+
(d.checked?" active":"");d.height&&(c.style.height=d.height+"px");d.width&&(c.style.width=d.width+"px");if(d.bgType&&d.bgTypeData){var p;switch(d.bgType){case "color":p=d.bgTypeData;c.className+=" btn-color";break;case "image":p="url("+d.bgTypeData+") no-repeat 50% 50%";c.className+=" btn-image";break;default:return}c.style.background=p}this.domElement.appendChild(c);p=document.createElement("input");d.checked&&p.setAttribute("checked","");p.type=this.setting.buttonType;p.name=this.setting.name;p.id=
d.id;p.value=this.setting.buttons.length-1;p.autocomplete="off";c.appendChild(p);p=document.createTextNode(d.title);c.appendChild(p);return c};h.ButtonGroup.prototype.addButtons=function(d,h){for(var c=0,p=d.length;c<p;c++)this.addButton(d[c],h)};h.Utils={};h.Utils.settingMixin=function(d,h){if("object"===typeof d&&"object"===typeof h){var c={},p;for(p in d)c[p]=d[p];for(var a in h)void 0!==h[a]&&(c[a]=h[a]);return c}return d};h.Utils.domCreationDirector=function(m,q){if(m)if(m instanceof Array)for(var c=
0,p=m.length;c<p;c++)h.Utils.domCreationDirector(m[c],q?q:document.body);else m instanceof Object&&m.UIType&&h[d(m.UIType)]&&new (h[d(m.UIType)])(m,q?q:document.body)};window.GoUI=h;"object"===typeof module&&(module.exports=h)})();var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
AV.initialize("i5m1bad33f8bm725g0lan5wd8hhc1c4qhyz3cyq4b0qoyvja","2w44ugxt0z512vitlk5in4c4a95acbyj8qiqlgcuh3p9xm5t");
(function(d,h,m,q,c){var p,a;function r(f){var b=y.textures+(f?-1:1),b=h.getElementById("texture"+b);if(!b&&(b=f?I.length-1:0,b=h.getElementById("texture"+b),!b))return;f=b.parentElement.className.indexOf("btn-color");var c=b.parentElement.className.indexOf("btn-image");-1<f?(p=Number(b.value),h.getElementById("colorTexture").parentElement.click()):-1<c&&(a=Number(b.value),h.getElementById("imageTexture").parentElement.click())}function ba(f,a){var b=a.clone(),c;for(c in f)b[c]=f[c];return b}function E(f){if(null==
f.pageX&&null!=f.clientX){var a=h.documentElement,b=h.body;f.pageX=f.clientX+(a&&a.scrollLeft||b&&b.scrollLeft||0)-(a&&a.clientLeft||b&&b.clientLeft||0);f.pageY=f.clientY+(a&&a.scrollTop||b&&b.scrollTop||0)-(a&&a.clientTop||b&&b.clientTop||0)}X.set(f.pageX/g.WINDOW_WIDTH*2-1,2*-(f.pageY/g.WINDOW_HEIGHT)+1);Ba.setFromCamera(X,g.camera);return Ba.intersectObjects(ta)}function z(f,a){a&&f&&(f.position.copy(a.point).add(a.face.normal),f.position.divideScalar(b.width).floor().multiplyScalar(b.width).addScalar(b.width/
2))}function F(f){0<f.length&&z(s,f[0])}function W(f,a,b,c){f=f||E(event);if(0<f.length){f=f[0];var d=y.toolsType,e=!1,h=ta.length;if(h&&f.object!==K)for(var k=h-1;0<k&&k>h-1-3;k--)if(f.object===ta[k]){e=!0;break}0===d?!0===e&&!1===a||!1===e&&!0===a||(a=ea.draw(0,ma,void 0,f),c?Q.appendObjectToCurrentAction("draw",a):Q.addAction("draw",a),g.renderer.render(g.scene,g.camera)):1===d&&b&&f.object!==K&&(a=ea.erase(f.object),c?Q.appendObjectToCurrentAction("erase",a):Q.addAction("erase",a))}}function G(a){0===
fa&&(O.save(O.storageKeys.camera),O.save(O.storageKeys.sidebar),O.save())}function u(a){O.save(O.storageKeys.camera);O.save(O.storageKeys.sidebar);O.save();fa=1}function la(a){a.preventDefault();var b;if(1===N[0])try{1===ga?ga=0:(ga=1,b=E(a),W(b,a.ctrlKey,a.ctrlKey,!0))}catch(c){console.warn("draw/erase failed")}finally{ga=0}else b=y.toolsType,1===b?s.visible&&(s.visible=!1):(!s.visible&&w&&(s.visible=!0),b=E(a),F(b))}function Y(a){a.preventDefault();switch(a.button){case 0:if(!S.endFlag){S.instantComplete(S.loadBoxAnimation);
break}N[0]=1;a=E(a);W(a,void 0,!0,!1);0===y.toolsType&&F(a);break;case 1:N[1]=1;break;case 2:N[2]=1}}function ka(f){if("label"===this.nodeName.toLowerCase())switch(f=this.getElementsByTagName("input")[0],y[f.name]=Number(f.value),f.name){case "toolsType":1===Number(f.value)?s.visible&&(s.visible=!1):!s.visible&&w&&(s.visible=!0);break;case "textures":ma=y[f.name];va=I[ma];ya=va.data;D=va.helperData=I[y[f.name]].helperData||ba(xa,ya);s.material=D;h.getElementById("cube").parentElement.click();switch(y.texturesType){case 0:a=
f.value;break;default:case 1:p=f.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===f.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":f=f.id,"imageTexture"===f?($(".btn-color").hide(),$(".btn-image").show(),h.getElementById("texture"+a).parentElement.click()):"colorTexture"===f&&($(".btn-color").show(),$(".btn-image").hide(),h.getElementById("texture"+p).parentElement.click())}else if(("button"===this.type||"button"===
this.nodeName.toLowerCase())&&y[this.id])y[this.id]()}function Z(a){switch(a.button){case 0:N[0]=0;Q.isCurrentActionAlive=!1;break;case 1:N[1]=0;break;case 2:N[2]=0}}function ia(a){switch(a.keyCode){case 67:r();break;case 88:r(!0)}}function oa(a){if(!N[0])switch(a.keyCode){case 16:0===y.toolsType?h.getElementById("eraser").parentElement.click():1===y.toolsType&&h.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&Q.undo();break;case 89:a.ctrlKey&&Q.redo()}}function U(){requestAnimationFrame(U);
g.renderer.render(g.scene,g.camera);g.stats.update()}function V(a){a?($("#loginOpener").hide(),$("#logout").show(),$("#signInOpener").hide(),$("#loginMessage").html("\u4f60\u597d "+AV.User.current().escape("username")),$("#loginMessage").show(),$("#open").removeAttr("disabled")):($("#loginOpener").show(),$("#logout").hide(),$("#signInOpener").show(),$("#loginMessage").hide(),$("#open").attr("disabled","disabled"))}var ha=!1,n=h.createElement("a");n.id="imageCapture";n.style.display="none";n.target=
"_blank";h.body.appendChild(n);var x=AV.Object.extend("Box"),R=new x;c=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};c.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=S.currentMeshes;S.currentIterator<a.length?a[S.currentIterator].meshObject.visible=!0:(S.endFlag=!0,clearInterval(S.currentAnimationIntervalHandler));S.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=
0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=S.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var L=function(a){this.isLoadingBoxEnd=a};L.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return d.localStorage&&d.localStorage.getItem(a||this.storageKeys.meshes)},
save:function(f,c){if(d.localStorage){var e="";if(c)e=c;else switch(f){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>Q.currentActionIndex)return;for(var e=e+(b.width+":"),h=0,k=l.length;h<k;h++)e+=l[h].geo.id.replace("geo","")+",",e+=l[h].material.id.replace("texture","")+",",e+=l[h].meshObject.position.x+",",e+=l[h].meshObject.position.y+",",e+=l[h].meshObject.position.z+";";break;case this.storageKeys.camera:e+=g.controls.target.x+","+g.controls.target.y+","+g.controls.target.z+
";";e+=g.controls.object.position.x+","+g.controls.object.position.y+","+g.controls.object.position.z+";";break;case this.storageKeys.sidebar:e+=a+","+p+","+y.texturesType+","+y.sidebarResize}d.localStorage.setItem(f||this.storageKeys.meshes,e)}},loadMeshes:function(a,c,d,e){this.isLoadingBoxEnd=!1;var g=[],h=b.width;if(a=e?a:this.load(a))if(a=a.split(":"))2===a.length?(h=(Number(a[0])||50)/b.width,g=a[1].split(";")):(h=50/b.width,g=a[0].split(";"));if(0<g.length)switch(c){case this.LOAD_TYPE.sync:c=
0;for(a=g.length;c<a;c++)e=g[c].split(","),2<e.length&&ea.draw(Number(e[0]),Number(e[1]),[Number(e[2])/h,Number(e[3])/h,Number(e[4])/h]);this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:c=0;for(a=g.length;c<a;c++)e=g[c].split(","),2<e.length&&ea.draw(Number(e[0]),Number(e[1]),[Number(e[2])/h,Number(e[3])/h,Number(e[4])/h],void 0,void 0,!0);S.begin(d,l)}else S.endFlag=!0},loadCamera:function(a,b){var c=[],d=b?a:this.load(a);d&&(c=d.split(";"));if(0<c.length){for(var d=0,e=c.length;d<
e;d++){var h=c[d].split(",");switch(d){case 0:g.controls.target.set(Number(h[0])||0,Number(h[1])||0,Number(h[2])||0);break;case 1:g.controls.object.position.set(Number(h[0])||0,Number(h[1])||0,Number(h[2])||0)}}g.controls.update()}},loadSidebarSelectedButtons:function(b,c){var d=[],e=c?b:this.load(b);e&&(d=e.split(","));if(0<d.length)for(var e=0,g=d.length;e<g;e++){var k=d[e];if(""!==k&&!isNaN(Number(k)))switch(e){case 0:a=Number(k)||0;break;case 1:p=Number(k)||0;break;case 2:1===Number(k)?h.getElementById("colorTexture").parentElement.click():
h.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(k)?h.getElementById("minSidebar").parentElement.click():h.getElementById("normalSidebar").parentElement.click()}}else h.getElementById("imageTexture").parentElement.click()}};var ja=function(){this.currentActionIndex=-1;this.actionArray=[];this.isCurrentActionAlive=void 0};ja.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=ea.reverseOperationMap[a.type];
a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ea.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ea.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=
0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ea.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ea.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.isCurrentActionAlive=!0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a,
b){var c=this.actionArray[this.currentActionIndex];if(!0!==this.isCurrentActionAlive)this.addAction(a,b);else if(void 0===c.meshes)c.meshes=b;else if(c.meshes instanceof Array||(c.meshes=[c.meshes]),b instanceof Array)for(var d=0,e=b.length;d<e;d++)c.meshes.push(b[d]);else c.meshes.push(b)},updateDom:function(){h.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;h.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var C=function(){this.drawFlag=
!1};C.prototype={calculateIntersectResult:E,setMeshPositionToFitTheGrid:z,updateHelperCube:F,draw:function(a,b,c,d,e,h){if(void 0===a||"number"===typeof a)a=pa[a||0];if(void 0===b||"number"===typeof b)b=I[b||0];var k=a.data,m=b.data;e=e||new q.Mesh(k,m);e.castShadow=!0;e.receiveShadow=!0;d?z(e,d):e.position.set(c[0],c[1],c[2]);!h||(e.visible=!1);g.scene.add(e);ta.push(e);l.push({meshObject:e,geo:a,material:b});return l[l.length-1]},erase:function(a){g.scene.remove(a);a=ta.indexOf(a);if(!(0>a)){ta.splice(a,
1);var b=l[a-1];l.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};q.ImageUtils.crossOrigin="Anonymous";var g,b={width:50},k=b.width/50,v={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*k,basePlaneTextureRepeat:200,fogNear:8E3*k,fogFar:25E3*k,sphereRadius:25E3*k},canvas:{ambientLightColor:9474192,directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*k,basePlaneTextureRepeat:16,fogNear:2E3*k,fogFar:3E3*k,sphereRadius:3E3*
k}},H,K,na,fa=0,sa=L.prototype.LOAD_TYPE.async,ua=new q.MeshLambertMaterial({color:592137}),xa={opacity:.5,transparent:!0},I=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:ua,helperData:ba(xa,ua)}],pa=[{name:"default",type:"1",id:"geo0",data:new q.BoxGeometry(b.width,b.width,b.width,1,1,1)}];a=30;p=0;var w=!0,y={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===y.toolsType||(s.visible=!s.visible);w=!w},capture:function(){var a=g.renderer.domElement,
b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,e=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=e.exec(c)?b=parseFloat(RegExp.$1):(e=/rv:([0-9]{1,}[.0-9]{0,})/,null!=e.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(d.navigator.saveBlob=d.navigator.saveBlob||d.navigator.msSaveBlob,a.msToBlob&&d.navigator.saveBlob?d.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):
(n.href=a.toDataURL(),n.download="capture.png",n.click())},clearAll:function(){S.endFlag||S.instantComplete(S.loadBoxAnimation);if(!(1>l.length)){var a=ea.erase(l[0].meshObject);Q.addAction("erase",a);for(var b=0,c=l.length;b<c;b++)a=ea.erase(l[0].meshObject),Q.appendObjectToCurrentAction("erase",a)}},undo:function(){Q.undo()},redo:function(){Q.redo()},signInOpener:function(){$("#signInError").parent().hide();$("#signInModal").modal("show")},loginOpener:function(){$("#loginError").parent().hide();
$("#loginModal").modal("show")},logout:function(){AV.User.current()&&(AV.User.logOut(),V(!1))},open:function(){var a=new AV.Query(x);a.select("name");a.equalTo("user",AV.User.current());a.find().then(function(a){$("#openModal .modal-body .button-group-vertical").html("");for(var b=0,c=a.length;b<c;b++)$("#openModal .modal-body .button-group-vertical").append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="boxData'+b+'" value="'+a[b].id+'" autocomplete="off">  <label id="boxDataLabel'+
b+'"></label></label>'),$("#openModal .modal-body .button-group-vertical #boxDataLabel"+b).text(a[b].get("name"));$("#openModal").modal("show")})},save:function(){if(AV.User.current()){var a;a=""+(b.width+":");for(var c=0,d=l.length;c<d;c++)a+=l[c].geo.id.replace("geo","")+",",a+=l[c].material.id.replace("texture","")+",",a+=l[c].meshObject.position.x+",",a+=l[c].meshObject.position.y+",",a+=l[c].meshObject.position.z+";";c=""+(g.controls.target.x+","+g.controls.target.y+","+g.controls.target.z+";");
c+=g.controls.object.position.x+","+g.controls.object.position.y+","+g.controls.object.position.z+";";R.set("camera",c||"0,0,0;1000,500,1000");R.set("meshes",a||"");R.id||(a=prompt("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d","\u672a\u547d\u540d"),R.set("name",a||"\u672a\u547d\u540d"),R.set("user",AV.User.current()),R.set("ACL",new AV.ACL(AV.User.current())));R.save()}else O.save(O.storageKeys.camera),O.save(O.storageKeys.sidebar),O.save(),ha||(alert("\u672a\u767b\u5f55\u72b6\u6001\u5c06\u53ea\u80fd\u4fdd\u5b58\u5728\u672c\u5730"),
ha=!0)}},ma=0,va=I[0],ya=va.data,D=va.helperData,e=pa[0].data,s,ta=[],l=[],za,P,Aa,X,N=[0,0,0],Ba,Ca,S=new c,O=new L(!1),Q=new ja,ea=new C,ga=0;g=new m(h.body);g.init(function(a){if(g.WINDOW_WIDTH!==d.innerWidth||g.WINDOW_HEIGHT!==d.innerHeight)g.WINDOW_WIDTH=d.innerWidth,g.WINDOW_HEIGHT=d.innerHeight,g.WINDOW_HEIGHT_HALF=g.WINDOW_HEIGHT/2,g.WINDOW_WIDTH_HALF=g.WINDOW_WIDTH/2,g.camera.aspect=g.WINDOW_WIDTH/g.WINDOW_HEIGHT,g.camera.updateProjectionMatrix(),g.renderer.setSize(g.WINDOW_WIDTH,g.WINDOW_HEIGHT),
h.body.height=g.WINDOW_HEIGHT},function(){H=new q.PlaneBufferGeometry(v[g.renderType].basePlaneWidth,v[g.renderType].basePlaneWidth,v[g.renderType].basePlaneSegments,v[g.renderType].basePlaneSegments);H.applyMatrix((new q.Matrix4).makeRotationX(-Math.PI/2));var a=q.ImageUtils.loadTexture("texture/grasslight-big.jpg");a.wrapT=a.wrapS=q.RepeatWrapping;a.repeat.set(v[g.renderType].basePlaneTextureRepeat,v[g.renderType].basePlaneTextureRepeat);na=new q.MeshLambertMaterial({color:3394611,map:a,bumpMap:a,
emissive:16777215});K=new q.Mesh(H,na);K.receiveShadow=!0;K.material.side=q.DoubleSide;g.scene.add(K);ta.push(K);za=new q.AmbientLight(v[g.renderType].ambientLightColor);g.scene.add(za);P=new q.DirectionalLight(15658734,v[g.renderType].directionalLightDensity);P.position.set(0,6E3,5E3);P.target.position.set(0,0,0);P.castShadow=!0;P.shadowCameraNear=g.camera.near;P.shadowCameraFar=g.camera.far;P.shadowCameraFov=g.cam;P.shadowCameraTop=-1024*k;P.shadowCameraLeft=-1024*k;P.shadowCameraBottom=1024*k;
P.shadowCameraRight=1024*k;P.shadowBias=2E-5;P.shadowDarkness=.4;P.shadowMapWidth=2048*k;P.shadowMapHeight=2048*k;g.scene.add(P);Aa=new q.HemisphereLight(16777215,6316128,1);g.scene.add(Aa);var a={topColor:{type:"c",value:new q.Color(3368703)},bottomColor:{type:"c",value:new q.Color(16777215)},offset:{type:"f",value:200},exponent:{type:"f",value:.85}},c=new q.Color;a.topColor.value.copy(c.setHSL(.6,2,.5));c=new q.SphereGeometry(v[g.renderType].sphereRadius,32,15);a=new q.ShaderMaterial({uniforms:a,
vertexShader:vertexShader,fragmentShader:fragmentShader,side:q.BackSide});a=new q.Mesh(c,a);g.scene.add(a);s=new q.Mesh(e,D);s.position.set(b.width/2,b.width/2,b.width/2);g.scene.add(s);new q.Mesh(e,ya);Ba=new q.Raycaster;X=new q.Vector2;Ca=new q.FogExp2(16777215,5.5E-5);g.scene.fog=Ca;g.controls.settings.boxScale=k;g.renderer.setClearColor(15790320);g.renderer.shadowMapEnabled=!0;g.renderer.shadowMapType=q.PCFSoftShadowMap;g.renderer.shadowMapCullFace=q.CullFaceBack;g.renderer.gammaInput=!0;g.renderer.gammaOutput=
!0;d.addEventListener("unload",G,!1);d.addEventListener("reload",u,!1);g.renderer.domElement.addEventListener("mousemove",la,!1);g.renderer.domElement.addEventListener("mousedown",Y,!1);g.renderer.domElement.addEventListener("mouseup",Z,!1);h.addEventListener("keydown",ia,!1);h.addEventListener("keyup",oa,!1);setInterval(G,12E4)});U();L={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",
id:"minSidebar"}]},{UIType:"buttonGroup",id:"accountControl",name:"accountControl",buttonType:"button",appendClass:"btn-group-accountbtn",buttons:[{title:"\u6ce8\u518c",id:"signInOpener"},{title:"\u767b\u5f55",id:"loginOpener"},{title:"\u6ce8\u9500",id:"logout"},{title:"\u767b\u5f55\u540e\u65b9\u53ef\u4fdd\u5b58\u6570\u636e\u5230\u670d\u52a1\u5668\u4e0a",id:"loginMessage"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",
title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",
id:"toggleAux"},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo"},{title:"\u91cd\u505a",id:"redo"}]},{UIType:"buttonGroup",id:"buttonGroupADM",name:"adm",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u6253\u5f00",id:"open"},{title:"\u4fdd\u5b58",id:"save"}]}]}]},
{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:I[0].type,bgTypeData:I[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>
g.WINDOW_WIDTH){C=L.children;c=0;for(m=C.length;c<m;c++)if("sidebarResize"===C[c].id){c=C[c].buttons;C=0;for(m=c.length;C<m;C++)"normalSidebar"===c[C].id&&delete c[C].checked,"minSidebar"===c[C].id&&(c[C].checked=!0);break}y.sidebarResize=1}else y.sidebarResize=0;GoUI.Utils.domCreationDirector(L);Q.updateDom();m=h.querySelectorAll(".btn");if(m instanceof Array||m.length)for(c=m.length-1;0<=c;c--)m[c].addEventListener("click",ka,!1);else m instanceof object&&m.addEventListener("click",ka,!1);C=[{color:"#333333"},
{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];
c=0;for(m=C.length;c<m;c++)L={name:C[c].color,type:"color",id:"texture"+(c+1),uniqueData:C[c].color,data:new q.MeshLambertMaterial({color:C[c].color})},I.push(L),GoUI.map.buttonGroup2.addButton({title:"",id:L.id,bgType:L.type,bgTypeData:L.uniqueData,width:50,height:50}).addEventListener("click",ka,!1);C="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");c=0;for(m=C.length;c<m;c++)L={name:C[c].replace("texture/",
"").replace(".png",""),type:"image",id:"texture"+I.length,uniqueData:C[c],data:new q.MeshLambertMaterial({map:q.ImageUtils.loadTexture(C[c]),transparent:!0})},"glass"===L.data.name&&(L.data.map.opacity=.3),L.data.map.magFilter=q.NearestFilter,L.data.map.minFilter=q.LinearMipMapLinearFilter,I.push(L),GoUI.map.buttonGroup2.addButton({title:"",id:L.id,bgType:L.type,bgTypeData:L.uniqueData,width:50,height:50}).addEventListener("click",ka,!1);h.getElementById("login").addEventListener("click",function(){var a=
$("#loginUsername").val(),b=$("#loginPassword").val(),c=$("#login");c.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.logIn(a,b,{success:function(a){V(!0);c.removeAttr("disabled");$("#loginModal").modal("hide")},error:function(a,b){$("#loginError").html("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef");$("#loginError").parent().show();c.removeAttr("disabled")}})},!1);h.getElementById("signIn").addEventListener("click",function(){var a=$("#signInEmail").val(),b=$("#signInUsername").val(),
c=$("#signInPassword").val(),d=$("#signIn");d.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.signUp(b,c,{ACL:new AV.ACL,email:a},{success:function(a){V(!0);d.removeAttr("disabled");$("#signInModal").modal("hide")},error:function(a,b){$("#signInError").html(b.message);$("#signInError").parent().show();d.removeAttr("disabled")}})},!1);h.getElementById("openIt").addEventListener("click",function(){confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&y.save();var a=
$("#openModal input[type=radio]:checked").val();a&&(new AV.Query(x)).get(a,{success:function(a){y.clearAll();Q=new ja;Q.updateDom();R=a;O.loadCamera(a.get("camera"),!0);O.loadMeshes(a.get("meshes"),sa,S.loadBoxAnimation,!0)}});$("#openModal").modal("hide")},!1);O.loadCamera(O.storageKeys.camera);O.loadSidebarSelectedButtons(O.storageKeys.sidebar);AV.User.current()?V(!0):(V(!1),O.loadMeshes(void 0,sa,S.loadBoxAnimation))})(window,document,Base,THREE,Detector);
