THREE.SpriteCanvasMaterial=function(g){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,f){};this.setValues(g)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var g=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,g);g.color.copy(this.color);g.program=this.program;return g};
THREE.CanvasRenderer=function(g){function h(a,v,I,c){C(v);K(I);D(c);P(a.getStyle());b.stroke();fa.expandByScalar(2*v)}function f(a){u(a.getStyle());b.fill()}function t(a){n(a.target)}function n(a){if(!(a instanceof THREE.CompressedTexture)){var v=a.wrapS===THREE.RepeatWrapping,I=a.wrapT===THREE.RepeatWrapping,c=a.image,e=document.createElement("canvas");e.width=c.width;e.height=c.height;var f=e.getContext("2d");f.setTransform(1,0,0,-1,0,c.height);f.drawImage(c,0,0);E[a.id]=b.createPattern(e,!0===
v&&!0===I?"repeat":!0===v&&!1===I?"repeat-x":!1===v&&!0===I?"repeat-y":"no-repeat")}}function a(a,v,I,c,e,f,y,g,r,ea,h,l,d){if(!(d instanceof THREE.DataTexture)){!1===d.hasEventListener("update",t)&&(void 0!==d.image&&0<d.image.width&&n(d),d.addEventListener("update",t));var T=E[d.id];if(void 0!==T){u(T);var T=d.offset.x/d.repeat.x,m=d.offset.y/d.repeat.y,G=d.image.width*d.repeat.x;d=d.image.height*d.repeat.y;y=(y+T)*G;g=(g+m)*d;I-=a;c-=v;e-=a;f-=v;r=(r+T)*G-y;ea=(ea+m)*d-g;h=(h+T)*G-y;l=(l+m)*d-
g;d=r*l-h*ea;0!==d&&(T=1/d,d=(l*I-ea*e)*T,ea=(l*c-ea*f)*T,I=(r*e-h*I)*T,c=(r*f-h*c)*T,a=a-d*y-I*g,v=v-ea*y-c*g,b.save(),b.transform(d,ea,I,c,a,v),b.fill(),b.restore())}else u("rgba(0,0,0,1)"),b.fill()}}function d(a,v,I){var c=v.x-a.x,b=v.y-a.y,e=c*c+b*b;0!==e&&(I/=Math.sqrt(e),c*=I,b*=I,v.x+=c,v.y+=b,a.x-=c,a.y-=b)}function p(a){wa!==a&&(wa=b.globalAlpha=a)}function W(a){N!==a&&(a===THREE.NormalBlending?b.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?b.globalCompositeOperation=
"lighter":a===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),N=a)}function C(a){x!==a&&(x=b.lineWidth=a)}function K(a){xa!==a&&(xa=b.lineCap=a)}function D(a){ta!==a&&(ta=b.lineJoin=a)}function P(a){na!==a&&(na=b.strokeStyle=a)}function u(a){ba!==a&&(ba=b.fillStyle=a)}function B(a){la.length!==a.length&&(b.setLineDash(a),la=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ma=THREE.Math.smoothstep;g=g||{};var ja=this,ca,R,ha,ua=new THREE.Projector,S=void 0!==g.canvas?g.canvas:
document.createElement("canvas"),Q=S.width,m=S.height,k=Math.floor(Q/2),q=Math.floor(m/2),X=0,V=0,ia=Q,l=m,c=1,b=S.getContext("2d",{alpha:!0===g.alpha}),Z=new THREE.Color(0),U=!0===g.alpha?0:1,wa=1,N=0,na=null,ba=null,x=null,xa=null,ta=null,la=[],oa,w,y,ka;new THREE.RenderableVertex;new THREE.RenderableVertex;var va,da,F,e,A,za,r=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var Aa=new THREE.Color,G=new THREE.Color,O=new THREE.Color,E={},H,v,I,ea,ya,T,Da,pa=new THREE.Box2,
J=new THREE.Box2,fa=new THREE.Box2,Ca=new THREE.Color,Ea=new THREE.Color,qa=new THREE.Color,ra=new THREE.Vector3,Fa=new THREE.Vector3,sa=new THREE.Vector3,Ba=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=S;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return c};this.setPixelRatio=function(a){c=a};this.setSize=
function(a,v,I){Q=a*c;m=v*c;S.width=Q;S.height=m;k=Math.floor(Q/2);q=Math.floor(m/2);!1!==I&&(S.style.width=a+"px",S.style.height=v+"px");pa.min.set(-k,-q);pa.max.set(k,q);J.min.set(-k,-q);J.max.set(k,q);wa=1;N=0;ta=xa=x=ba=na=null;this.setViewport(0,0,a,v)};this.setViewport=function(a,v,I,b){X=a*c;V=v*c;ia=I*c;l=b*c};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,v){Z.set(a);U=void 0!==v?v:1;J.min.set(-k,-q);J.max.set(k,q)};this.setClearColorHex=function(a,
v){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,v)};this.getClearColor=function(){return Z};this.getClearAlpha=function(){return U};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===J.empty()&&(J.intersect(pa),J.expandByScalar(2),J.min.x+=k,J.min.y=-J.min.y+q,J.max.x+=k,J.max.y=-J.max.y+q,1>U&&b.clearRect(J.min.x|0,J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0),0<U&&(W(THREE.NormalBlending),p(1),
u("rgba("+Math.floor(255*Z.r)+","+Math.floor(255*Z.g)+","+Math.floor(255*Z.b)+","+U+")"),b.fillRect(J.min.x|0,J.max.y|0,J.max.x-J.min.x|0,J.min.y-J.max.y|0)),J.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,g){if(!1===g instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();ja.info.render.vertices=0;ja.info.render.faces=0;b.setTransform(ia/
Q,0,0,-l/m,X,m-V);b.translate(k,q);ca=ua.projectScene(c,g,this.sortObjects,this.sortElements);R=ca.elements;ha=ca.lights;oa=g;Ba.getNormalMatrix(g.matrixWorldInverse);Ca.setRGB(0,0,0);Ea.setRGB(0,0,0);qa.setRGB(0,0,0);for(var Z=0,U=ha.length;Z<U;Z++){var s=ha[Z],M=s.color;s instanceof THREE.AmbientLight?Ca.add(M):s instanceof THREE.DirectionalLight?Ea.add(M):s instanceof THREE.PointLight&&qa.add(M)}Z=0;for(U=R.length;Z<U;Z++){var z=R[Z],x=z.material;if(void 0!==x&&0!==x.opacity){fa.makeEmpty();if(z instanceof
THREE.RenderableSprite){w=z;w.x*=k;w.y*=q;var s=w,L=z,M=x;p(M.opacity);W(M.blending);var ga=L.scale.x*k,L=L.scale.y*q,z=.5*Math.sqrt(ga*ga+L*L);fa.min.set(s.x-z,s.y-z);fa.max.set(s.x+z,s.y+z);if(M instanceof THREE.SpriteMaterial){var Y=M.map;if(null!==Y&&void 0!==Y.image){!1===Y.hasEventListener("update",t)&&(0<Y.image.width&&n(Y),Y.addEventListener("update",t));z=E[Y.id];void 0!==z?u(z):u("rgba( 0, 0, 0, 1 )");var aa=Y.image,z=aa.width*Y.offset.x,x=aa.height*Y.offset.y,N=aa.width*Y.repeat.x,Y=aa.height*
Y.repeat.y,aa=ga/N,S=L/Y;b.save();b.translate(s.x,s.y);0!==M.rotation&&b.rotate(M.rotation);b.translate(-ga/2,-L/2);b.scale(aa,S);b.translate(-z,-x);b.fillRect(z,x,N,Y)}else u(M.color.getStyle()),b.save(),b.translate(s.x,s.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(ga,-L),b.fillRect(-.5,-.5,1,1);b.restore()}else M instanceof THREE.SpriteCanvasMaterial&&(P(M.color.getStyle()),u(M.color.getStyle()),b.save(),b.translate(s.x,s.y),0!==M.rotation&&b.rotate(M.rotation),b.scale(ga,L),M.program(b),b.restore())}else if(z instanceof
THREE.RenderableLine){if(w=z.v1,y=z.v2,w.positionScreen.x*=k,w.positionScreen.y*=q,y.positionScreen.x*=k,y.positionScreen.y*=q,fa.setFromPoints([w.positionScreen,y.positionScreen]),!0===pa.isIntersectionBox(fa))if(s=w,M=y,ga=z,L=x,p(L.opacity),W(L.blending),b.beginPath(),b.moveTo(s.positionScreen.x,s.positionScreen.y),b.lineTo(M.positionScreen.x,M.positionScreen.y),L instanceof THREE.LineBasicMaterial){C(L.linewidth);K(L.linecap);D(L.linejoin);if(L.vertexColors!==THREE.VertexColors)P(L.color.getStyle());
else if(z=ga.vertexColors[0].getStyle(),ga=ga.vertexColors[1].getStyle(),z===ga)P(z);else{try{var ba=b.createLinearGradient(s.positionScreen.x,s.positionScreen.y,M.positionScreen.x,M.positionScreen.y);ba.addColorStop(0,z);ba.addColorStop(1,ga)}catch(na){ba=z}P(ba)}b.stroke();fa.expandByScalar(2*L.linewidth)}else L instanceof THREE.LineDashedMaterial&&(C(L.linewidth),K(L.linecap),D(L.linejoin),P(L.color.getStyle()),B([L.dashSize,L.gapSize]),b.stroke(),fa.expandByScalar(2*L.linewidth),B([]))}else if(z instanceof
THREE.RenderableFace){w=z.v1;y=z.v2;ka=z.v3;if(-1>w.positionScreen.z||1<w.positionScreen.z)continue;if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>ka.positionScreen.z||1<ka.positionScreen.z)continue;w.positionScreen.x*=k;w.positionScreen.y*=q;y.positionScreen.x*=k;y.positionScreen.y*=q;ka.positionScreen.x*=k;ka.positionScreen.y*=q;0<x.overdraw&&(d(w.positionScreen,y.positionScreen,x.overdraw),d(y.positionScreen,ka.positionScreen,x.overdraw),d(ka.positionScreen,w.positionScreen,x.overdraw));
fa.setFromPoints([w.positionScreen,y.positionScreen,ka.positionScreen]);if(!0===pa.isIntersectionBox(fa)){M=w;ga=y;L=ka;s=x;ja.info.render.vertices+=3;ja.info.render.faces++;p(s.opacity);W(s.blending);va=M.positionScreen.x;da=M.positionScreen.y;F=ga.positionScreen.x;e=ga.positionScreen.y;A=L.positionScreen.x;za=L.positionScreen.y;var x=va,N=da,Y=F,aa=e,S=A,la=za;b.beginPath();b.moveTo(x,N);b.lineTo(Y,aa);b.lineTo(S,la);b.closePath();if((s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial)&&
null===s.map){Aa.copy(s.color);G.copy(s.emissive);s.vertexColors===THREE.FaceColors&&Aa.multiply(z.color);r.copy(Ca);Fa.copy(M.positionWorld).add(ga.positionWorld).add(L.positionWorld).divideScalar(3);M=Fa;ga=z.normalModel;L=r;z=0;for(x=ha.length;z<x;z++)N=ha[z],O.copy(N.color),N instanceof THREE.DirectionalLight?(Y=ra.setFromMatrixPosition(N.matrixWorld).normalize(),aa=ga.dot(Y),0>=aa||(aa*=N.intensity,L.add(O.multiplyScalar(aa)))):N instanceof THREE.PointLight&&(Y=ra.setFromMatrixPosition(N.matrixWorld),
aa=ga.dot(ra.subVectors(Y,M).normalize()),0>=aa||(aa*=0==N.distance?1:1-Math.min(M.distanceTo(Y)/N.distance,1),0!=aa&&(aa*=N.intensity,L.add(O.multiplyScalar(aa)))));r.multiply(Aa).add(G);!0===s.wireframe?h(r,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):f(r)}else s instanceof THREE.MeshBasicMaterial||s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial?null!==s.map?s.map.mapping===THREE.UVMapping&&(H=z.uvs,a(va,da,F,e,A,za,H[0].x,H[0].y,H[1].x,H[1].y,H[2].x,
H[2].y,s.map)):null!==s.envMap?s.envMap.mapping===THREE.SphericalReflectionMapping&&(sa.copy(z.vertexNormalsModel[0]).applyMatrix3(Ba),v=.5*sa.x+.5,I=.5*sa.y+.5,sa.copy(z.vertexNormalsModel[1]).applyMatrix3(Ba),ea=.5*sa.x+.5,ya=.5*sa.y+.5,sa.copy(z.vertexNormalsModel[2]).applyMatrix3(Ba),T=.5*sa.x+.5,Da=.5*sa.y+.5,a(va,da,F,e,A,za,v,I,ea,ya,T,Da,s.envMap)):(r.copy(s.color),s.vertexColors===THREE.FaceColors&&r.multiply(z.color),!0===s.wireframe?h(r,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):
f(r)):(s instanceof THREE.MeshDepthMaterial?r.r=r.g=r.b=1-ma(M.positionScreen.z*M.positionScreen.w,oa.near,oa.far):s instanceof THREE.MeshNormalMaterial?(sa.copy(z.normalModel).applyMatrix3(Ba),r.setRGB(sa.x,sa.y,sa.z).multiplyScalar(.5).addScalar(.5)):r.setRGB(1,1,1),!0===s.wireframe?h(r,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):f(r))}}J.union(fa)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(g){this.positionWorld.copy(g.positionWorld);this.positionScreen.copy(g.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function g(){if(D===u){var a=new THREE.RenderableVertex;P.push(a);u++;D++;return a}return P[D++]}function h(){if(ma===ca){var a=new THREE.RenderableFace;ja.push(a);ca++;ma++;return a}return ja[ma++]}function f(){if(ha===S){var a=new THREE.RenderableLine;ua.push(a);S++;ha++;return a}return ua[ha++]}function t(){if(m===q){var a=new THREE.RenderableSprite;k.push(a);q++;m++;return a}return k[m++]}function n(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function a(a,
c){var b=0,f=1,g=a.z+a.w,e=c.z+c.w,d=-a.z+a.w,h=-c.z+c.w;if(0<=g&&0<=e&&0<=d&&0<=h)return!0;if(0>g&&0>e||0>d&&0>h)return!1;0>g?b=Math.max(b,g/(g-e)):0>e&&(f=Math.min(f,g/(g-e)));0>d?b=Math.max(b,d/(d-h)):0>h&&(f=Math.min(f,d/(d-h)));if(f<b)return!1;a.lerp(c,b);c.lerp(a,1-f);return!0}var d,p,W=[],C=0,K,D,P=[],u=0,B,ma,ja=[],ca=0,R,ha,ua=[],S=0,Q,m,k=[],q=0,X={objects:[],lights:[],elements:[]},V=new THREE.Vector3,ia=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,b=new THREE.Vector4,Z=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),U=new THREE.Box3,wa=Array(3),N=new THREE.Matrix4,na=new THREE.Matrix4,ba,x=new THREE.Matrix4,xa=new THREE.Matrix3,ta=new THREE.Frustum,la=new THREE.Vector4,oa=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var w=new function(){var a=[],c=[],b=null,d=null,n=new THREE.Matrix3,e=function(a){var c=a.positionWorld,b=a.positionScreen;c.copy(a.position).applyMatrix4(ba);b.copy(c).applyMatrix4(na);c=1/b.w;b.x*=c;b.y*=c;b.z*=c;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},l=function(a,c,b){if(!0===a.visible||!0===c.visible||!0===b.visible)return!0;wa[0]=a.positionScreen;wa[1]=c.positionScreen;wa[2]=b.positionScreen;return Z.isIntersectionBox(U.setFromPoints(wa))},m=function(a,c,b){return 0>(b.positionScreen.x-
a.positionScreen.x)*(c.positionScreen.y-a.positionScreen.y)-(b.positionScreen.y-a.positionScreen.y)*(c.positionScreen.x-a.positionScreen.x)};return{setObject:function(e){b=e;d=b.material;n.getNormalMatrix(b.matrixWorld);a.length=0;c.length=0},projectVertex:e,checkTriangleVisibility:l,checkBackfaceCulling:m,pushVertex:function(a,c,b){K=g();K.position.set(a,c,b);e(K)},pushNormal:function(c,b,e){a.push(c,b,e)},pushUv:function(a,b){c.push(a,b)},pushLine:function(a,c){var e=P[a],d=P[c];R=f();R.id=b.id;
R.v1.copy(e);R.v2.copy(d);R.z=(e.positionScreen.z+d.positionScreen.z)/2;R.material=b.material;X.elements.push(R)},pushTriangle:function(e,f,g){var t=P[e],k=P[f],p=P[g];if(!1!==l(t,k,p)&&(d.side===THREE.DoubleSide||!0===m(t,k,p))){B=h();B.id=b.id;B.v1.copy(t);B.v2.copy(k);B.v3.copy(p);B.z=(t.positionScreen.z+k.positionScreen.z+p.positionScreen.z)/3;for(t=0;3>t;t++)k=3*arguments[t],p=B.vertexNormalsModel[t],p.set(a[k],a[k+1],a[k+2]),p.applyMatrix3(n).normalize(),k=2*arguments[t],B.uvs[t].set(c[k],c[k+
1]);B.vertexNormalsLength=3;B.material=b.material;X.elements.push(B)}}}};this.projectScene=function(k,q,Z,K){m=ha=ma=0;X.elements.length=0;!0===k.autoUpdate&&k.updateMatrixWorld();void 0===q.parent&&q.updateMatrixWorld();N.copy(q.matrixWorldInverse.getInverse(q.matrixWorld));na.multiplyMatrices(q.projectionMatrix,N);ta.setFromMatrix(na);p=0;X.objects.length=0;X.lights.length=0;k.traverseVisible(function(a){if(a instanceof THREE.Light)X.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===ta.intersectsObject(a))){if(p===C){var v=new THREE.RenderableObject;W.push(v);C++;p++;d=v}else d=W[p++];d.id=a.id;d.object=a;c.setFromMatrixPosition(a.matrixWorld);c.applyProjection(na);d.z=c.z;X.objects.push(d)}});!0===Z&&X.objects.sort(n);k=0;for(Z=X.objects.length;k<Z;k++){var F=X.objects[k].object,e=F.geometry;w.setObject(F);ba=F.matrixWorld;D=0;if(F instanceof THREE.Mesh)if(e instanceof THREE.BufferGeometry){var A=
e.attributes,F=e.offsets;if(void 0!==A.position){for(var u=A.position.array,e=0,r=u.length;e<r;e+=3)w.pushVertex(u[e],u[e+1],u[e+2]);if(void 0!==A.normal)for(var U=A.normal.array,e=0,r=U.length;e<r;e+=3)w.pushNormal(U[e],U[e+1],U[e+2]);if(void 0!==A.uv)for(U=A.uv.array,e=0,r=U.length;e<r;e+=2)w.pushUv(U[e],U[e+1]);if(void 0!==A.index)if(A=A.index.array,0<F.length)for(k=0;k<F.length;k++)for(r=F[k],u=r.index,e=r.start,r=r.start+r.count;e<r;e+=3)w.pushTriangle(A[e]+u,A[e+1]+u,A[e+2]+u);else for(e=0,
r=A.length;e<r;e+=3)w.pushTriangle(A[e],A[e+1],A[e+2]);else for(e=0,r=u.length/3;e<r;e+=3)w.pushTriangle(e,e+1,e+2)}}else{if(e instanceof THREE.Geometry){var G=e.vertices,r=e.faces,A=e.faceVertexUvs[0];xa.getNormalMatrix(ba);for(var u=F.material instanceof THREE.MeshFaceMaterial,U=!0===u?F.material:null,O=0,E=G.length;O<E;O++){var H=G[O];w.pushVertex(H.x,H.y,H.z)}G=0;for(O=r.length;G<O;G++){var E=r[G],v=!0===u?U.materials[E.materialIndex]:F.material;if(void 0!==v){var I=v.side,H=P[E.a],ea=P[E.b],
ya=P[E.c];if(!0===v.morphTargets){var T=e.morphTargets,S=F.morphTargetInfluences,pa=H.position,J=ea.position,fa=ya.position;V.set(0,0,0);ia.set(0,0,0);l.set(0,0,0);for(var ca=0,ja=T.length;ca<ja;ca++){var qa=S[ca];if(0!==qa){var ra=T[ca].vertices;V.x+=(ra[E.a].x-pa.x)*qa;V.y+=(ra[E.a].y-pa.y)*qa;V.z+=(ra[E.a].z-pa.z)*qa;ia.x+=(ra[E.b].x-J.x)*qa;ia.y+=(ra[E.b].y-J.y)*qa;ia.z+=(ra[E.b].z-J.z)*qa;l.x+=(ra[E.c].x-fa.x)*qa;l.y+=(ra[E.c].y-fa.y)*qa;l.z+=(ra[E.c].z-fa.z)*qa}}H.position.add(V);ea.position.add(ia);
ya.position.add(l);w.projectVertex(H);w.projectVertex(ea);w.projectVertex(ya)}if(!1!==w.checkTriangleVisibility(H,ea,ya)){T=w.checkBackfaceCulling(H,ea,ya);if(I!==THREE.DoubleSide){if(I===THREE.FrontSide&&!1===T)continue;if(I===THREE.BackSide&&!0===T)continue}B=h();B.id=F.id;B.v1.copy(H);B.v2.copy(ea);B.v3.copy(ya);B.normalModel.copy(E.normal);!1!==T||I!==THREE.BackSide&&I!==THREE.DoubleSide||B.normalModel.negate();B.normalModel.applyMatrix3(xa).normalize();S=E.vertexNormals;pa=0;for(J=Math.min(S.length,
3);pa<J;pa++)fa=B.vertexNormalsModel[pa],fa.copy(S[pa]),!1!==T||I!==THREE.BackSide&&I!==THREE.DoubleSide||fa.negate(),fa.applyMatrix3(xa).normalize();B.vertexNormalsLength=S.length;I=A[G];if(void 0!==I)for(T=0;3>T;T++)B.uvs[T].copy(I[T]);B.color=E.color;B.material=v;B.z=(H.positionScreen.z+ea.positionScreen.z+ya.positionScreen.z)/3;X.elements.push(B)}}}}}else if(F instanceof THREE.Line)if(e instanceof THREE.BufferGeometry){if(A=e.attributes,void 0!==A.position){u=A.position.array;e=0;for(r=u.length;e<
r;e+=3)w.pushVertex(u[e],u[e+1],u[e+2]);if(void 0!==A.index)for(A=A.index.array,e=0,r=A.length;e<r;e+=2)w.pushLine(A[e],A[e+1]);else for(A=F.mode===THREE.LinePieces?2:1,e=0,r=u.length/3-1;e<r;e+=A)w.pushLine(e,e+1)}}else{if(e instanceof THREE.Geometry&&(x.multiplyMatrices(na,ba),G=F.geometry.vertices,0!==G.length))for(H=g(),H.positionScreen.copy(G[0]).applyMatrix4(x),A=F.mode===THREE.LinePieces?2:1,O=1,E=G.length;O<E;O++)H=g(),H.positionScreen.copy(G[O]).applyMatrix4(x),0<(O+1)%A||(ea=P[D-2],la.copy(H.positionScreen),
oa.copy(ea.positionScreen),!0===a(la,oa)&&(la.multiplyScalar(1/la.w),oa.multiplyScalar(1/oa.w),R=f(),R.id=F.id,R.v1.positionScreen.copy(la),R.v2.positionScreen.copy(oa),R.z=Math.max(la.z,oa.z),R.material=F.material,F.material.vertexColors===THREE.VertexColors&&(R.vertexColors[0].copy(F.geometry.colors[O]),R.vertexColors[1].copy(F.geometry.colors[O-1])),X.elements.push(R)))}else F instanceof THREE.Sprite&&(b.set(ba.elements[12],ba.elements[13],ba.elements[14],1),b.applyMatrix4(na),e=1/b.w,b.z*=e,-1<=
b.z&&1>=b.z&&(Q=t(),Q.id=F.id,Q.x=b.x*e,Q.y=b.y*e,Q.z=b.z,Q.object=F,Q.rotation=F.rotation,Q.scale.x=F.scale.x*Math.abs(Q.x-(b.x+q.projectionMatrix.elements[0])/(b.w+q.projectionMatrix.elements[12])),Q.scale.y=F.scale.y*Math.abs(Q.y-(b.y+q.projectionMatrix.elements[5])/(b.w+q.projectionMatrix.elements[13])),Q.material=F.material,X.elements.push(Q)))}!0===K&&X.elements.sort(n);return X}};
THREE.OrbitControls=function(g,h){function f(c){if(!1!==a.enabled){c.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(k===m.ROTATE){if(!0===a.noRotate)return;p.set(c.clientX,c.clientY);W.subVectors(p,d);a.rotateLeft(2*Math.PI*W.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*W.y/b.clientHeight*a.rotateSpeed);d.copy(p)}else if(k===m.DOLLY){if(!0===a.noZoom)return;ma.set(c.clientX,c.clientY);ja.subVectors(ma,B);0<ja.y?a.dollyIn():a.dollyOut();B.copy(ma)}else if(k===
m.PAN){if(!0===a.noPan)return;K.set(c.clientX,c.clientY);D.subVectors(K,C);a.pan(D.x,D.y);C.copy(K)}a.update()}}function t(){!1!==a.enabled&&(document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",t,!1),a.dispatchEvent(l),k=m.NONE)}function n(c){if(!1!==a.enabled&&!0!==a.noZoom){c.preventDefault();c.stopPropagation();var b=0;void 0!==c.wheelDelta?b=c.wheelDelta:void 0!==c.detail&&(b=-c.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(ia);a.dispatchEvent(l)}}
this.object=g;this.domElement=void 0!==h?h:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,d=new THREE.Vector2,p=new THREE.Vector2,W=new THREE.Vector2,C=new THREE.Vector2,K=new THREE.Vector2,D=new THREE.Vector2,P=new THREE.Vector3,u=new THREE.Vector3,B=new THREE.Vector2,ma=new THREE.Vector2,ja=new THREE.Vector2,ca=0,R=0,ha=1,ua=new THREE.Vector3,S=new THREE.Vector3,Q=new THREE.Quaternion,m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=m.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var q=(new THREE.Quaternion).setFromUnitVectors(g.up,new THREE.Vector3(0,1,0)),X=q.clone().inverse(),V={type:"change"},ia={type:"start"},l={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);R-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);ca-=c};this.panLeft=function(a){var b=this.object.matrix.elements;P.set(b[0],b[1],b[2]);P.multiplyScalar(-a);ua.add(P)};this.panUp=function(a){var b=this.object.matrix.elements;P.set(b[4],b[5],
b[6]);P.multiplyScalar(a);ua.add(P)};this.panForward=function(a){var b=this.object.matrix.elements;P.set(b[8],b[9],b[10]);P.multiplyScalar(a);ua.add(P)};this.pan=function(c,b){var d=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var f=a.object.position.clone().sub(a.target).length(),f=f*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*f/d.clientHeight);a.panUp(2*b*f/d.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/d.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,b){var d=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var f=a.object.position.clone().sub(a.target).length(),f=f*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*f/d.clientHeight);a.panForward(2*b*f/d.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/d.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ha/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ha*=c};this.update=function(){var c=this.object.position;u.copy(c).sub(this.target);u.applyQuaternion(q);var b=Math.atan2(u.x,u.z),d=Math.atan2(Math.sqrt(u.x*u.x+u.z*u.z),u.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+R,d=d+ca,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),d=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d)),d=Math.max(1E-6,Math.min(Math.PI-1E-6,d)),f=u.length()*ha,f=Math.max(this.minDistance,Math.min(this.maxDistance,f));this.target.add(ua);u.x=f*Math.sin(d)*Math.sin(b);u.y=f*Math.cos(d);u.z=f*Math.sin(d)*Math.cos(b);u.applyQuaternion(X);c.copy(this.target).add(u);this.object.lookAt(this.target);ca=R=0;ha=1;ua.set(0,0,0);if(1E-6<
S.distanceToSquared(this.object.position)||1E-6<8*(1-Q.dot(this.object.quaternion)))this.dispatchEvent(V),S.copy(this.object.position),Q.copy(this.object.quaternion)};this.reset=function(){k=m.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;k=m.ROTATE;d.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;k=m.DOLLY;B.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.PAN){if(!0===a.noPan)return;k=m.PAN;C.set(c.clientX,c.clientY)}document.addEventListener("mousemove",f,!1);document.addEventListener("mouseup",t,!1);a.dispatchEvent(ia)}},!1);this.domElement.addEventListener("mousewheel",n,!1);this.domElement.addEventListener("DOMMouseScroll",n,!1);this.domElement.addEventListener("touchstart",
function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;k=m.TOUCH_ROTATE;d.set(c.touches[0].pageX,c.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;k=m.TOUCH_DOLLY;var b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;b=Math.sqrt(b*b+c*c);B.set(0,b);break;case 3:if(!0===a.noPan)return;k=m.TOUCH_PAN;C.set(c.touches[0].pageX,c.touches[0].pageY);break;default:k=m.NONE}a.dispatchEvent(ia)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(l),k=m.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();c.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(k!==m.TOUCH_ROTATE)break;p.set(c.touches[0].pageX,c.touches[0].pageY);W.subVectors(p,d);a.rotateLeft(2*Math.PI*W.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*W.y/b.clientHeight*a.rotateSpeed);d.copy(p);
a.update();break;case 2:if(!0===a.noZoom)break;if(k!==m.TOUCH_DOLLY)break;b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;c=Math.sqrt(b*b+c*c);ma.set(0,c);ja.subVectors(ma,B);0<ja.y?a.dollyOut():a.dollyIn();B.copy(ma);a.update();break;case 3:if(!0===a.noPan)break;if(k!==m.TOUCH_PAN)break;K.set(c.touches[0].pageX,c.touches[0].pageY);D.subVectors(K,C);a.pan(D.x,D.y);C.copy(K);a.update();break;default:k=m.NONE}}},!1);window.addEventListener("keydown",function(c){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var g=document.createElement("canvas");return!(!window.WebGLRenderingContext||!g.getContext("webgl")&&!g.getContext("experimental-webgl"))}catch(h){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";
g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){var h,f;g=g||{};h=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";f=Detector.getWebGLErrorMessage();f.id=g;h.appendChild(f)}};"object"===typeof module&&(module.exports=Detector);
(function(g,h,f,t){var n=function(a){this.domParent="object"===typeof a?a:h.body};n.prototype.init=function(a,d,n,W,C,K){g.requestAnimationFrame||(g.requestAnimationFrame=function(){return g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a,d){g.setTimeout(a,1E3/60)}}());this.domParent===h.body&&(this.WINDOW_WIDTH=g.innerWidth,this.WINDOW_HEIGHT=g.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,g.addEventListener("resize",a,!1));this.renderType=t.webgl?"webgl":"canvas";this.renderer=n||(t.webgl?new f.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new f.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=W||new f.Scene;this.camera=C||new f.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
K?this.controls=K:(this.controls=new f.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:f.MOUSE.MIDDLE,PAN:f.MOUSE.RIGHT});d()};g.Base=n;"object"===typeof module&&(module.exports=n)})(window,document,THREE,Detector);
(function(){function g(f){return f.charAt(0).toUpperCase()+f.slice(1)}var h={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(f){var g=0;for(f=f.length;g<f;g++);};h.map={};h.Sidebar=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({align:"r",width:320},f),a="sidebar",a=n.align&&"r"!==n.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;n.id&&(this.domElement.id=n.id,h.map[n.id]=this);
this.domElement.style.width=n.width.toString()+"px";n.overflow&&(this.domElement.style.overflow=n.overflow.toString());g.appendChild(this.domElement);h.Utils.domCreationDirector(n.children,this.domElement)};h.Sidebar.prototype=Object.create(_Container.prototype);h.Panel=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({title:""},f);n.id&&(this.domElement.id=n.id,h.map[n.id]=this);var a=this.domElement;a.className="panel panel-tool";g.appendChild(a);var d=document.createElement("div");
d.className="panel-heading";a.appendChild(d);var p=document.createTextNode(n.title);d.appendChild(p);d=document.createElement("div");d.className="panel-body";n.overflow&&(d.style.overflow=n.overflow.toString());a.appendChild(d);h.Utils.domCreationDirector(n.children,d)};h.Panel.prototype=Object.create(_Container.prototype);h.Toolbar=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({title:""},f);n.id&&(this.domElement.id=n.id,h.map[n.id]=this);var a=this.domElement;a.className=
"btn-toolbar";g.appendChild(a);h.Utils.domCreationDirector(n.children,a)};h.Toolbar.prototype=Object.create(_Container.prototype);h.ButtonGroup=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({title:"",buttonType:"radio"},f);n.id&&(this.domElement.id=n.id,h.map[n.id]=this);var a=this.domElement;a.className="btn-group"+(n.appendClass?" "+n.appendClass:"");"button"!==n.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=n.title;g.appendChild(a);var d=
n.buttons;switch(n.buttonType.toLowerCase()){default:case "radio":for(var p=0,W=d.length;p<W;p++){var C=document.createElement("label");C.className="btn btn-tool"+(d[p].checked?" active":"");d[p].height&&(C.style.height=d[p].height+"px");d[p].width&&(C.style.width=d[p].width+"px");if(d[p].bgType&&d[p].bgTypeData){var K;switch(d[p].bgType){case "color":K=d[p].bgTypeData;C.className+=" btn-color";break;case "image":K="url("+d[p].bgTypeData+") no-repeat 50% 50%";C.className+=" btn-image";break;default:return}C.style.background=
K}a.appendChild(C);var D=document.createElement("input");d[p].checked&&D.setAttribute("checked","");D.type=n.buttonType;D.name=n.name;D.id=d[p].id;D.value=p;D.autocomplete="off";C.appendChild(D);K=document.createTextNode(d[p].title);C.appendChild(K)}break;case "button":for(p=0,W=d.length;p<W;p++){D=document.createElement("button");D.className="btn btn-tool";D.id=d[p].id;D.name=n.name;d[p].height&&(D.style.height=d[p].height+"px");d[p].width&&(D.style.width=d[p].width+"px");if(d[p].bgType&&d[p].bgTypeData){switch(d[p].bgType){case "color":K=
d[p].bgTypeData;C.className+=" btn-color";break;case "image":K="url("+d[p].bgTypeData+") no-repeat 50% 50%";C.className+=" btn-image";break;default:return}D.style.background=K}a.appendChild(D);K=document.createTextNode(d[p].title);D.appendChild(K)}}h.Utils.domCreationDirector(n.children,this.domElement)};h.ButtonGroup.prototype=Object.create(_Container.prototype);h.ButtonGroup.prototype.addButton=function(f,g){g||this.setting.buttons.push(f);var h=document.createElement("label");h.className="btn btn-tool"+
(f.checked?" active":"");f.height&&(h.style.height=f.height+"px");f.width&&(h.style.width=f.width+"px");if(f.bgType&&f.bgTypeData){var a;switch(f.bgType){case "color":a=f.bgTypeData;h.className+=" btn-color";break;case "image":a="url("+f.bgTypeData+") no-repeat 50% 50%";h.className+=" btn-image";break;default:return}h.style.background=a}this.domElement.appendChild(h);a=document.createElement("input");f.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
f.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";h.appendChild(a);a=document.createTextNode(f.title);h.appendChild(a);return h};h.ButtonGroup.prototype.addButtons=function(f,g){for(var h=0,a=f.length;h<a;h++)this.addButton(f[h],g)};h.Utils={};h.Utils.settingMixin=function(f,g){if("object"===typeof f&&"object"===typeof g){var h={},a;for(a in f)h[a]=f[a];for(var d in g)void 0!==g[d]&&(h[d]=g[d]);return h}return f};h.Utils.domCreationDirector=function(f,t){if(f)if(f instanceof Array)for(var n=
0,a=f.length;n<a;n++)h.Utils.domCreationDirector(f[n],t?t:document.body);else f instanceof Object&&f.UIType&&h[g(f.UIType)]&&new (h[g(f.UIType)])(f,t?t:document.body)};window.GoUI=h;"object"===typeof module&&(module.exports=h)})();
(function(g,h,f,t,n){var a,d;function p(v){var b=x.textures+(v?-1:1),b=h.getElementById("texture"+b);if(!b&&(b=v?N.length-1:0,b=h.getElementById("texture"+b),!b))return;v=b.parentElement.className.indexOf("btn-color");var c=b.parentElement.className.indexOf("btn-image");-1<v?(a=Number(b.value),h.getElementById("colorTexture").parentElement.click()):-1<c&&(d=Number(b.value),h.getElementById("imageTexture").parentElement.click())}function W(a,b){var c=b.clone(),d;for(d in a)c[d]=a[d];return c}function C(a){if(null==
a.pageX&&null!=a.clientX){var b=h.documentElement,c=h.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}za.set(a.pageX/l.WINDOW_WIDTH*2-1,2*-(a.pageY/l.WINDOW_HEIGHT)+1);Aa.setFromCamera(za,l.camera);return Aa.intersectObjects(va)}function K(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(V.width).floor().multiplyScalar(V.width).addScalar(V.width/
2))}function D(a){0<a.length&&K(y,a[0])}function P(a,c,d,e){a=a||C(event);if(0<a.length){a=a[0];var g=x.toolsType,f=!1,h=va.length;if(h&&a.object!==b)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===va[k]){f=!0;break}0===g?!0===f&&!1===c||!1===f&&!0===c||(c=H.draw(0,xa,void 0,a),e?E.appendObjectToCurrentAction(c):E.addAction("draw",c)):1===g&&d&&a.object!==b&&(c=H.erase(a.object),e?E.appendObjectToCurrentAction(c):E.addAction("erase",c))}}function u(a){0===Z&&(O.save(O.storageKeys.camera),O.save(O.storageKeys.sidebar),
O.save())}function B(a){O.save(O.storageKeys.camera);O.save(O.storageKeys.sidebar);O.save();Z=1}function ma(a){a.preventDefault();var b;1===r[0]?(b=C(a),P(b,a.ctrlKey,a.ctrlKey,!0)):(b=x.toolsType,1===b?y.visible&&(y.visible=!1):(!y.visible&&ba&&(y.visible=!0),b=C(a),D(b)))}function ja(a){a.preventDefault();switch(a.button){case 0:if(!G.endFlag){G.instantComplete(G.loadBoxAnimation);break}r[0]=1;a=C(a);P(a,void 0,!0,!1);0===x.toolsType&&D(a);break;case 1:r[1]=1;break;case 2:r[2]=1}}function ca(b){if("label"===
this.nodeName.toLowerCase())switch(b=this.getElementsByTagName("input")[0],x[b.name]=Number(b.value),b.name){case "toolsType":1===Number(b.value)?y.visible&&(y.visible=!1):!y.visible&&ba&&(y.visible=!0);break;case "textures":xa=x[b.name];ta=N[xa];la=ta.data;oa=ta.helperData=N[x[b.name]].helperData||W(wa,la);y.material=oa;h.getElementById("cube").parentElement.click();switch(x.texturesType){case 0:d=b.value;break;default:case 1:a=b.value}break;case "sidebarResize":var c=GoUI.map.sidebar.domElement;
"0"===b.value?$(c).animate({top:"0",height:"100%"}):$(c).animate({top:"60%",height:"40%"});break;case "texturesType":b=b.id,"imageTexture"===b?($(".btn-color").hide(),$(".btn-image").show(),h.getElementById("texture"+d).parentElement.click()):"colorTexture"===b&&($(".btn-color").show(),$(".btn-image").hide(),h.getElementById("texture"+a).parentElement.click())}else if("button"===this.type||"button"===this.nodeName.toLowerCase())x[this.id]()}function R(a){switch(a.button){case 0:r[0]=0;break;case 1:r[1]=
0;break;case 2:r[2]=0}}function ha(a){switch(a.keyCode){case 67:p();break;case 88:p(!0)}}function ua(a){if(!r[0])switch(a.keyCode){case 16:0===x.toolsType?h.getElementById("eraser").parentElement.click():1===x.toolsType&&h.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&E.undo();break;case 89:a.ctrlKey&&E.redo()}}function S(){requestAnimationFrame(S);l.renderer.render(l.scene,l.camera)}var Q=h.createElement("a");Q.id="imageCapture";Q.style.display="none";Q.target="_blank";h.body.appendChild(Q);
var m=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};m.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=G.currentMeshes;G.currentIterator<a.length?a[G.currentIterator].meshObject.visible=!0:(G.endFlag=!0,clearInterval(G.currentAnimationIntervalHandler));G.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},
instantComplete:function(a){if(!0!==this.endFlag){var b=G.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var k=function(a){this.isLoadingBoxEnd=a};k.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return g.localStorage&&g.localStorage.getItem(a||this.storageKeys.meshes)},save:function(b,c){if(g.localStorage){var e="";if(c)e=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&
0>E.currentActionIndex)return;for(var f=0,h=da.length;f<h;f++)e+=da[f].geo.id.replace("geo","")+",",e+=da[f].material.id.replace("texture","")+",",e+=da[f].meshObject.position.x+",",e+=da[f].meshObject.position.y+",",e+=da[f].meshObject.position.z+";";break;case this.storageKeys.camera:e+=l.controls.target.x+","+l.controls.target.y+","+l.controls.target.z+";";e+=l.controls.object.position.x+","+l.controls.object.position.y+","+l.controls.object.position.z+";";break;case this.storageKeys.sidebar:e+=
d+","+a+","+x.texturesType+","+x.sidebarResize}g.localStorage.setItem(b||this.storageKeys.meshes,e)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var e=[];(a=this.load(a))&&(e=a.split(";"));if(0<e.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=e.length;b<a;b++){var d=e[b].split(",");2<d.length&&H.draw(Number(d[0]),Number(d[1]),[Number(d[2]),Number(d[3]),Number(d[4])])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=e.length;b<a;b++)d=e[b].split(","),2<d.length&&
H.draw(Number(d[0]),Number(d[1]),[Number(d[2]),Number(d[3]),Number(d[4])],void 0,void 0,!0);G.begin(c,da)}else G.endFlag=!0},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var e=b[a].split(",");switch(a){case 0:l.controls.target.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0);break;case 1:l.controls.object.position.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0)}}l.controls.update()}},loadSidebarSelectedButtons:function(b){var c=
[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var e=c.length;b<e;b++){var f=c[b];if(""!==f&&NaN!==Number(f))switch(b){case 0:d=Number(f)||0;break;case 1:a=Number(f)||0;break;case 2:1===Number(f)?h.getElementById("colorTexture").parentElement.click():h.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(f)?h.getElementById("minSidebar").parentElement.click():h.getElementById("normalSidebar").parentElement.click()}}}else h.getElementById("imageTexture").parentElement.click()}};
var q=function(){this.currentActionIndex=-1;this.actionArray=[]};q.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=H.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d)switch(b){case "draw":H.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":H.erase(d.meshObject)}}this.currentActionIndex--;
this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d)switch(b){case "draw":H.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":H.erase(d.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=
-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,e=a.length;c<e;c++)b.meshes.push(a[c]);else b.meshes.push(a)},updateDom:function(){h.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;h.getElementById("redo").disabled=
this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var X=function(){};X.prototype={calculateIntersectResult:C,setMeshPositionToFitTheGrid:K,updateHelperCube:D,draw:function(a,b,c,e,d,f){if(void 0===a||"number"===typeof a)a=na[a||0];if(void 0===b||"number"===typeof b)b=N[b||0];var g=a.data,h=b.data;d=d||new t.Mesh(g,h);d.castShadow=!0;d.receiveShadow=!0;e?K(d,e):d.position.set(c[0],c[1],c[2]);!f||(d.visible=!1);l.scene.add(d);va.push(d);da.push({meshObject:d,geo:a,material:b});return da[da.length-
1]},erase:function(a){l.scene.remove(a);a=va.indexOf(a);if(!(0>a)){va.splice(a,1);var b=da[a-1];da.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};var V={width:50},ia={webgl:{ambientLightColor:2105376,directionalLightDensity:.4},canvas:{ambientLightColor:9474192,directionalLightDensity:.9}},l,c,b,Z=0;n=k.prototype.LOAD_TYPE.async;var U=new t.MeshLambertMaterial({color:592137}),wa={opacity:.5,transparent:!0},N=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",
data:U,helperData:W(wa,U)}],na=[{name:"default",type:"1",id:"geo0",data:new t.BoxGeometry(V.width,V.width,V.width)}];d=30;a=0;var ba=!0,x={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===x.toolsType||(y.visible=!y.visible);ka.visible=!ka.visible;ba=!ba},capture:function(){var a=l.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;
null!=d.exec(c)?b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(g.navigator.saveBlob=g.navigator.saveBlob||g.navigator.msSaveBlob,a.msToBlob&&g.navigator.saveBlob?g.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(Q.href=a.toDataURL(),Q.download="capture.png",Q.click())},clearAll:function(){G.endFlag||G.instantComplete(G.loadBoxAnimation);if(!(1>da.length)){var a=H.erase(da[0].meshObject);
E.addAction("erase",a);for(var b=0,c=da.length;b<c;b++)a=H.erase(da[0].meshObject),E.appendObjectToCurrentAction(a)}},undo:function(){E.undo()},redo:function(){E.redo()}},xa=0,ta=N[0],la=ta.data,oa=ta.helperData,w=na[0].data,y,ka,va=[],da=[],F,e,A,za,r=[0,0,0],Aa,G=new m,O=new k(!1),E=new q,H=new X;l=new f(h.body);l.init(function(a){if(l.WINDOW_WIDTH!==g.innerWidth||l.WINDOW_HEIGHT!==g.innerHeight)l.WINDOW_WIDTH=g.innerWidth,l.WINDOW_HEIGHT=g.innerHeight,l.WINDOW_HEIGHT_HALF=l.WINDOW_HEIGHT/2,l.WINDOW_WIDTH_HALF=
l.WINDOW_WIDTH/2,l.camera.aspect=l.WINDOW_WIDTH/l.WINDOW_HEIGHT,l.camera.updateProjectionMatrix(),l.renderer.setSize(l.WINDOW_WIDTH,l.WINDOW_HEIGHT),h.body.height=l.WINDOW_HEIGHT},function(){ka=new t.GridHelper(5E3,V.width);l.scene.add(ka);c=new t.PlaneBufferGeometry(1E4,1E4);c.applyMatrix((new t.Matrix4).makeRotationX(-Math.PI/2));b=new t.Mesh(c);b.visible=!1;l.scene.add(b);va.push(b);F=new t.AmbientLight(ia[l.renderType].ambientLightColor);l.scene.add(F);e=new t.DirectionalLight(15658734,ia[l.renderType].directionalLightDensity);
e.position.set(0,6E3,5E3);e.target.position.set(0,0,0);e.castShadow=!0;e.shadowCameraNear=l.camera.near;e.shadowCameraFar=l.camera.far;e.shadowCameraFov=l.camera.fov;e.shadowBias=1E-6;e.shadowDarkness=.5;e.shadowMapWidth=1024;e.shadowMapHeight=1024;l.scene.add(e);A=new t.HemisphereLight(15658734,3158064,.95);l.scene.add(A);y=new t.Mesh(w,oa);y.position.set(V.width/2,V.width/2,V.width/2);l.scene.add(y);new t.Mesh(w,la);Aa=new t.Raycaster;za=new t.Vector2;l.renderer.setClearColor(15790320);l.renderer.shadowMapEnabled=
!0;l.renderer.shadowMapType=t.PCFShadowMap;g.addEventListener("unload",u,!1);g.addEventListener("reload",B,!1);l.renderer.domElement.addEventListener("mousemove",ma,!1);l.renderer.domElement.addEventListener("mousedown",ja,!1);l.renderer.domElement.addEventListener("mouseup",R,!1);h.addEventListener("keydown",ha,!1);h.addEventListener("keyup",ua,!1);setInterval(u,12E4)});S();k={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",
id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",
id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",
id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:N[0].type,bgTypeData:N[0].uniqueData,width:50,height:50,checked:!0}]}]}]};
if(600>l.WINDOW_WIDTH){q=k.children;m=0;for(f=q.length;m<f;m++)if("sidebarResize"===q[m].id){m=q[m].buttons;q=0;for(f=m.length;q<f;q++)"normalSidebar"===m[q].id&&delete m[q].checked,"minSidebar"===m[q].id&&(m[q].checked=!0);break}x.sidebarResize=1}else x.sidebarResize=0;GoUI.Utils.domCreationDirector(k);E.updateDom();f=h.querySelectorAll(".btn");if(f instanceof Array||f.length)for(m=f.length-1;0<=m;m--)f[m].addEventListener("click",ca,!1);else f instanceof object&&f.addEventListener("click",ca,!1);
q=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},
{color:"#ff432e"}];m=0;for(f=q.length;m<f;m++)k={name:q[m].color,type:"color",id:"texture"+(m+1),uniqueData:q[m].color,data:new t.MeshLambertMaterial({color:q[m].color})},N.push(k),GoUI.map.buttonGroup2.addButton({title:"",id:k.id,bgType:k.type,bgTypeData:k.uniqueData,width:50,height:50}).addEventListener("click",ca,!1);q="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");t.ImageUtils.crossOrigin=
"Anonymous";m=0;for(f=q.length;m<f;m++)k={name:q[m].replace("texture/","").replace(".png",""),type:"image",id:"texture"+N.length,uniqueData:q[m],data:new t.MeshLambertMaterial({map:t.ImageUtils.loadTexture(q[m]),transparent:!0})},"glass"===k.data.name&&(k.data.map.opacity=.3),k.data.map.magFilter=t.NearestFilter,k.data.map.minFilter=t.LinearMipMapLinearFilter,N.push(k),GoUI.map.buttonGroup2.addButton({title:"",id:k.id,bgType:k.type,bgTypeData:k.uniqueData,width:50,height:50}).addEventListener("click",
ca,!1);O.loadCamera(O.storageKeys.camera);O.loadSidebarSelectedButtons(O.storageKeys.sidebar);O.loadMeshes(void 0,n,G.loadBoxAnimation)})(window,document,Base,THREE,Detector);
