THREE.SpriteCanvasMaterial=function(g){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,f){};this.setValues(g)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var g=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,g);g.color.copy(this.color);g.program=this.program;return g};
THREE.CanvasRenderer=function(g){function h(a,v,J,c){D(v);L(J);E(c);P(a.getStyle());b.stroke();ea.expandByScalar(2*v)}function f(a){x(a.getStyle());b.fill()}function p(a){n(a.target)}function n(a){if(!(a instanceof THREE.CompressedTexture)){var v=a.wrapS===THREE.RepeatWrapping,J=a.wrapT===THREE.RepeatWrapping,c=a.image,e=document.createElement("canvas");e.width=c.width;e.height=c.height;var f=e.getContext("2d");f.setTransform(1,0,0,-1,0,c.height);f.drawImage(c,0,0);F[a.id]=b.createPattern(e,!0===
v&&!0===J?"repeat":!0===v&&!1===J?"repeat-x":!1===v&&!0===J?"repeat-y":"no-repeat")}}function a(a,v,J,c,e,f,g,r,ka,h,l,S,d){if(!(d instanceof THREE.DataTexture)){!1===d.hasEventListener("update",p)&&(void 0!==d.image&&0<d.image.width&&n(d),d.addEventListener("update",p));var m=F[d.id];if(void 0!==m){x(m);var m=d.offset.x/d.repeat.x,H=d.offset.y/d.repeat.y,ia=d.image.width*d.repeat.x;d=d.image.height*d.repeat.y;g=(g+m)*ia;r=(r+H)*d;J-=a;c-=v;e-=a;f-=v;ka=(ka+m)*ia-g;h=(h+H)*d-r;l=(l+m)*ia-g;S=(S+H)*
d-r;d=ka*S-l*h;0!==d&&(m=1/d,d=(S*J-h*e)*m,h=(S*c-h*f)*m,J=(ka*e-l*J)*m,c=(ka*f-l*c)*m,a=a-d*g-J*r,v=v-h*g-c*r,b.save(),b.transform(d,h,J,c,a,v),b.fill(),b.restore())}else x("rgba(0,0,0,1)"),b.fill()}}function d(a,v,J){var c=v.x-a.x,b=v.y-a.y,e=c*c+b*b;0!==e&&(J/=Math.sqrt(e),c*=J,b*=J,v.x+=c,v.y+=b,a.x-=c,a.y-=b)}function q(a){U!==a&&(U=b.globalAlpha=a)}function V(a){wa!==a&&(a===THREE.NormalBlending?b.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
a===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),wa=a)}function D(a){pa!==a&&(pa=b.lineWidth=a)}function L(a){y!==a&&(y=b.lineCap=a)}function E(a){ua!==a&&(ua=b.lineJoin=a)}function P(a){z!==a&&(z=b.strokeStyle=a)}function x(a){fa!==a&&(fa=b.fillStyle=a)}function C(a){ga.length!==a.length&&(b.setLineDash(a),ga=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ma=THREE.Math.smoothstep;g=g||{};var la=this,ba,R,ha,sa=new THREE.Projector,u=void 0!==g.canvas?g.canvas:document.createElement("canvas"),
Q=u.width,m=u.height,k=Math.floor(Q/2),s=Math.floor(m/2),W=0,X=0,ja=Q,l=m,c=1,b=u.getContext("2d",{alpha:!0===g.alpha}),Z=new THREE.Color(0),da=!0===g.alpha?0:1,U=1,wa=0,z=null,fa=null,pa=null,y=null,ua=null,ga=[],na,w,S,T;new THREE.RenderableVertex;new THREE.RenderableVertex;var ta,ca,G,e,B,xa,r=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var ya=new THREE.Color,H=new THREE.Color,O=new THREE.Color,F={},I,v,J,ka,va,ia,Ba,oa=new THREE.Box2,K=new THREE.Box2,ea=new THREE.Box2,
Aa=new THREE.Color,Ca=new THREE.Color,Da=new THREE.Color,qa=new THREE.Vector3,Ea=new THREE.Vector3,ra=new THREE.Vector3,za=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=u;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return c};this.setPixelRatio=function(a){c=a};this.setSize=function(a,v,J){Q=a*c;m=v*c;u.width=
Q;u.height=m;k=Math.floor(Q/2);s=Math.floor(m/2);!1!==J&&(u.style.width=a+"px",u.style.height=v+"px");oa.min.set(-k,-s);oa.max.set(k,s);K.min.set(-k,-s);K.max.set(k,s);U=1;wa=0;ua=y=pa=fa=z=null;this.setViewport(0,0,a,v)};this.setViewport=function(a,v,J,b){W=a*c;X=v*c;ja=J*c;l=b*c};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,v){Z.set(a);da=void 0!==v?v:1;K.min.set(-k,-s);K.max.set(k,s)};this.setClearColorHex=function(a,v){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,v)};this.getClearColor=function(){return Z};this.getClearAlpha=function(){return da};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===K.empty()&&(K.intersect(oa),K.expandByScalar(2),K.min.x+=k,K.min.y=-K.min.y+s,K.max.x+=k,K.max.y=-K.max.y+s,1>da&&b.clearRect(K.min.x|0,K.max.y|0,K.max.x-K.min.x|0,K.min.y-K.max.y|0),0<da&&(V(THREE.NormalBlending),q(1),x("rgba("+Math.floor(255*Z.r)+","+Math.floor(255*Z.g)+","+Math.floor(255*Z.b)+","+da+")"),b.fillRect(K.min.x|
0,K.max.y|0,K.max.x-K.min.x|0,K.min.y-K.max.y|0)),K.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,g){if(!1===g instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();la.info.render.vertices=0;la.info.render.faces=0;b.setTransform(ja/Q,0,0,-l/m,W,m-X);b.translate(k,s);ba=sa.projectScene(c,g,this.sortObjects,this.sortElements);
R=ba.elements;ha=ba.lights;na=g;za.getNormalMatrix(g.matrixWorldInverse);Aa.setRGB(0,0,0);Ca.setRGB(0,0,0);Da.setRGB(0,0,0);for(var Z=0,da=ha.length;Z<da;Z++){var t=ha[Z],N=t.color;t instanceof THREE.AmbientLight?Aa.add(N):t instanceof THREE.DirectionalLight?Ca.add(N):t instanceof THREE.PointLight&&Da.add(N)}Z=0;for(da=R.length;Z<da;Z++){var A=R[Z],y=A.material;if(void 0!==y&&0!==y.opacity){ea.makeEmpty();if(A instanceof THREE.RenderableSprite){w=A;w.x*=k;w.y*=s;var t=w,M=A,N=y;q(N.opacity);V(N.blending);
var z=M.scale.x*k,M=M.scale.y*s,A=.5*Math.sqrt(z*z+M*M);ea.min.set(t.x-A,t.y-A);ea.max.set(t.x+A,t.y+A);if(N instanceof THREE.SpriteMaterial){var Y=N.map;if(null!==Y&&void 0!==Y.image){!1===Y.hasEventListener("update",p)&&(0<Y.image.width&&n(Y),Y.addEventListener("update",p));A=F[Y.id];void 0!==A?x(A):x("rgba( 0, 0, 0, 1 )");var aa=Y.image,A=aa.width*Y.offset.x,y=aa.height*Y.offset.y,u=aa.width*Y.repeat.x,Y=aa.height*Y.repeat.y,aa=z/u,ga=M/Y;b.save();b.translate(t.x,t.y);0!==N.rotation&&b.rotate(N.rotation);
b.translate(-z/2,-M/2);b.scale(aa,ga);b.translate(-A,-y);b.fillRect(A,y,u,Y)}else x(N.color.getStyle()),b.save(),b.translate(t.x,t.y),0!==N.rotation&&b.rotate(N.rotation),b.scale(z,-M),b.fillRect(-.5,-.5,1,1);b.restore()}else N instanceof THREE.SpriteCanvasMaterial&&(P(N.color.getStyle()),x(N.color.getStyle()),b.save(),b.translate(t.x,t.y),0!==N.rotation&&b.rotate(N.rotation),b.scale(z,M),N.program(b),b.restore())}else if(A instanceof THREE.RenderableLine){if(w=A.v1,S=A.v2,w.positionScreen.x*=k,w.positionScreen.y*=
s,S.positionScreen.x*=k,S.positionScreen.y*=s,ea.setFromPoints([w.positionScreen,S.positionScreen]),!0===oa.isIntersectionBox(ea))if(t=w,N=S,z=A,M=y,q(M.opacity),V(M.blending),b.beginPath(),b.moveTo(t.positionScreen.x,t.positionScreen.y),b.lineTo(N.positionScreen.x,N.positionScreen.y),M instanceof THREE.LineBasicMaterial){D(M.linewidth);L(M.linecap);E(M.linejoin);if(M.vertexColors!==THREE.VertexColors)P(M.color.getStyle());else if(A=z.vertexColors[0].getStyle(),z=z.vertexColors[1].getStyle(),A===
z)P(A);else{try{var fa=b.createLinearGradient(t.positionScreen.x,t.positionScreen.y,N.positionScreen.x,N.positionScreen.y);fa.addColorStop(0,A);fa.addColorStop(1,z)}catch(pa){fa=A}P(fa)}b.stroke();ea.expandByScalar(2*M.linewidth)}else M instanceof THREE.LineDashedMaterial&&(D(M.linewidth),L(M.linecap),E(M.linejoin),P(M.color.getStyle()),C([M.dashSize,M.gapSize]),b.stroke(),ea.expandByScalar(2*M.linewidth),C([]))}else if(A instanceof THREE.RenderableFace){w=A.v1;S=A.v2;T=A.v3;if(-1>w.positionScreen.z||
1<w.positionScreen.z)continue;if(-1>S.positionScreen.z||1<S.positionScreen.z)continue;if(-1>T.positionScreen.z||1<T.positionScreen.z)continue;w.positionScreen.x*=k;w.positionScreen.y*=s;S.positionScreen.x*=k;S.positionScreen.y*=s;T.positionScreen.x*=k;T.positionScreen.y*=s;0<y.overdraw&&(d(w.positionScreen,S.positionScreen,y.overdraw),d(S.positionScreen,T.positionScreen,y.overdraw),d(T.positionScreen,w.positionScreen,y.overdraw));ea.setFromPoints([w.positionScreen,S.positionScreen,T.positionScreen]);
if(!0===oa.isIntersectionBox(ea)){N=w;z=S;M=T;t=y;la.info.render.vertices+=3;la.info.render.faces++;q(t.opacity);V(t.blending);ta=N.positionScreen.x;ca=N.positionScreen.y;G=z.positionScreen.x;e=z.positionScreen.y;B=M.positionScreen.x;xa=M.positionScreen.y;var y=ta,u=ca,Y=G,aa=e,ga=B,U=xa;b.beginPath();b.moveTo(y,u);b.lineTo(Y,aa);b.lineTo(ga,U);b.closePath();if((t instanceof THREE.MeshLambertMaterial||t instanceof THREE.MeshPhongMaterial)&&null===t.map){ya.copy(t.color);H.copy(t.emissive);t.vertexColors===
THREE.FaceColors&&ya.multiply(A.color);r.copy(Aa);Ea.copy(N.positionWorld).add(z.positionWorld).add(M.positionWorld).divideScalar(3);N=Ea;z=A.normalModel;M=r;A=0;for(y=ha.length;A<y;A++)u=ha[A],O.copy(u.color),u instanceof THREE.DirectionalLight?(Y=qa.setFromMatrixPosition(u.matrixWorld).normalize(),aa=z.dot(Y),0>=aa||(aa*=u.intensity,M.add(O.multiplyScalar(aa)))):u instanceof THREE.PointLight&&(Y=qa.setFromMatrixPosition(u.matrixWorld),aa=z.dot(qa.subVectors(Y,N).normalize()),0>=aa||(aa*=0==u.distance?
1:1-Math.min(N.distanceTo(Y)/u.distance,1),0!=aa&&(aa*=u.intensity,M.add(O.multiplyScalar(aa)))));r.multiply(ya).add(H);!0===t.wireframe?h(r,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):f(r)}else t instanceof THREE.MeshBasicMaterial||t instanceof THREE.MeshLambertMaterial||t instanceof THREE.MeshPhongMaterial?null!==t.map?t.map.mapping===THREE.UVMapping&&(I=A.uvs,a(ta,ca,G,e,B,xa,I[0].x,I[0].y,I[1].x,I[1].y,I[2].x,I[2].y,t.map)):null!==t.envMap?t.envMap.mapping===THREE.SphericalReflectionMapping&&
(ra.copy(A.vertexNormalsModel[0]).applyMatrix3(za),v=.5*ra.x+.5,J=.5*ra.y+.5,ra.copy(A.vertexNormalsModel[1]).applyMatrix3(za),ka=.5*ra.x+.5,va=.5*ra.y+.5,ra.copy(A.vertexNormalsModel[2]).applyMatrix3(za),ia=.5*ra.x+.5,Ba=.5*ra.y+.5,a(ta,ca,G,e,B,xa,v,J,ka,va,ia,Ba,t.envMap)):(r.copy(t.color),t.vertexColors===THREE.FaceColors&&r.multiply(A.color),!0===t.wireframe?h(r,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):f(r)):(t instanceof THREE.MeshDepthMaterial?r.r=r.g=r.b=1-ma(N.positionScreen.z*
N.positionScreen.w,na.near,na.far):t instanceof THREE.MeshNormalMaterial?(ra.copy(A.normalModel).applyMatrix3(za),r.setRGB(ra.x,ra.y,ra.z).multiplyScalar(.5).addScalar(.5)):r.setRGB(1,1,1),!0===t.wireframe?h(r,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):f(r))}}K.union(ea)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(g){this.positionWorld.copy(g.positionWorld);this.positionScreen.copy(g.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function g(){if(E===x){var a=new THREE.RenderableVertex;P.push(a);x++;E++;return a}return P[E++]}function h(){if(ma===ba){var a=new THREE.RenderableFace;la.push(a);ba++;ma++;return a}return la[ma++]}function f(){if(ha===u){var a=new THREE.RenderableLine;sa.push(a);u++;ha++;return a}return sa[ha++]}function p(){if(m===s){var a=new THREE.RenderableSprite;k.push(a);s++;m++;return a}return k[m++]}function n(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function a(a,
c){var b=0,f=1,g=a.z+a.w,e=c.z+c.w,d=-a.z+a.w,h=-c.z+c.w;if(0<=g&&0<=e&&0<=d&&0<=h)return!0;if(0>g&&0>e||0>d&&0>h)return!1;0>g?b=Math.max(b,g/(g-e)):0>e&&(f=Math.min(f,g/(g-e)));0>d?b=Math.max(b,d/(d-h)):0>h&&(f=Math.min(f,d/(d-h)));if(f<b)return!1;a.lerp(c,b);c.lerp(a,1-f);return!0}var d,q,V=[],D=0,L,E,P=[],x=0,C,ma,la=[],ba=0,R,ha,sa=[],u=0,Q,m,k=[],s=0,W={objects:[],lights:[],elements:[]},X=new THREE.Vector3,ja=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,b=new THREE.Vector4,Z=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),da=new THREE.Box3,U=Array(3),wa=new THREE.Matrix4,z=new THREE.Matrix4,fa,pa=new THREE.Matrix4,y=new THREE.Matrix3,ua=new THREE.Frustum,ga=new THREE.Vector4,na=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var w=new function(){var a=[],c=[],b=null,d=null,n=new THREE.Matrix3,e=function(a){var c=a.positionWorld,b=a.positionScreen;c.copy(a.position).applyMatrix4(fa);b.copy(c).applyMatrix4(z);c=1/b.w;b.x*=c;b.y*=c;b.z*=c;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},l=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;U[0]=a.positionScreen;U[1]=b.positionScreen;U[2]=c.positionScreen;return Z.isIntersectionBox(da.setFromPoints(U))},m=function(a,b,c){return 0>(c.positionScreen.x-
a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(e){b=e;d=b.material;n.getNormalMatrix(b.matrixWorld);a.length=0;c.length=0},projectVertex:e,checkTriangleVisibility:l,checkBackfaceCulling:m,pushVertex:function(a,b,c){L=g();L.position.set(a,b,c);e(L)},pushNormal:function(b,c,e){a.push(b,c,e)},pushUv:function(a,b){c.push(a,b)},pushLine:function(a,c){var e=P[a],d=P[c];R=f();R.id=b.id;
R.v1.copy(e);R.v2.copy(d);R.z=(e.positionScreen.z+d.positionScreen.z)/2;R.material=b.material;W.elements.push(R)},pushTriangle:function(e,f,g){var p=P[e],k=P[f],q=P[g];if(!1!==l(p,k,q)&&(d.side===THREE.DoubleSide||!0===m(p,k,q))){C=h();C.id=b.id;C.v1.copy(p);C.v2.copy(k);C.v3.copy(q);C.z=(p.positionScreen.z+k.positionScreen.z+q.positionScreen.z)/3;for(p=0;3>p;p++)k=3*arguments[p],q=C.vertexNormalsModel[p],q.set(a[k],a[k+1],a[k+2]),q.applyMatrix3(n).normalize(),k=2*arguments[p],C.uvs[p].set(c[k],c[k+
1]);C.vertexNormalsLength=3;C.material=b.material;W.elements.push(C)}}}};this.projectScene=function(k,s,Z,L){m=ha=ma=0;W.elements.length=0;!0===k.autoUpdate&&k.updateMatrixWorld();void 0===s.parent&&s.updateMatrixWorld();wa.copy(s.matrixWorldInverse.getInverse(s.matrixWorld));z.multiplyMatrices(s.projectionMatrix,wa);ua.setFromMatrix(z);q=0;W.objects.length=0;W.lights.length=0;k.traverseVisible(function(a){if(a instanceof THREE.Light)W.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===ua.intersectsObject(a))){if(q===D){var v=new THREE.RenderableObject;V.push(v);D++;q++;d=v}else d=V[q++];d.id=a.id;d.object=a;c.setFromMatrixPosition(a.matrixWorld);c.applyProjection(z);d.z=c.z;W.objects.push(d)}});!0===Z&&W.objects.sort(n);k=0;for(Z=W.objects.length;k<Z;k++){var G=W.objects[k].object,e=G.geometry;w.setObject(G);fa=G.matrixWorld;E=0;if(G instanceof THREE.Mesh)if(e instanceof THREE.BufferGeometry){var B=
e.attributes,G=e.offsets;if(void 0!==B.position){for(var u=B.position.array,e=0,r=u.length;e<r;e+=3)w.pushVertex(u[e],u[e+1],u[e+2]);if(void 0!==B.normal)for(var x=B.normal.array,e=0,r=x.length;e<r;e+=3)w.pushNormal(x[e],x[e+1],x[e+2]);if(void 0!==B.uv)for(x=B.uv.array,e=0,r=x.length;e<r;e+=2)w.pushUv(x[e],x[e+1]);if(void 0!==B.index)if(B=B.index.array,0<G.length)for(k=0;k<G.length;k++)for(r=G[k],u=r.index,e=r.start,r=r.start+r.count;e<r;e+=3)w.pushTriangle(B[e]+u,B[e+1]+u,B[e+2]+u);else for(e=0,
r=B.length;e<r;e+=3)w.pushTriangle(B[e],B[e+1],B[e+2]);else for(e=0,r=u.length/3;e<r;e+=3)w.pushTriangle(e,e+1,e+2)}}else{if(e instanceof THREE.Geometry){var H=e.vertices,r=e.faces,B=e.faceVertexUvs[0];y.getNormalMatrix(fa);for(var u=G.material instanceof THREE.MeshFaceMaterial,x=!0===u?G.material:null,O=0,F=H.length;O<F;O++){var I=H[O];w.pushVertex(I.x,I.y,I.z)}H=0;for(O=r.length;H<O;H++){var F=r[H],v=!0===u?x.materials[F.materialIndex]:G.material;if(void 0!==v){var J=v.side,I=P[F.a],ka=P[F.b],va=
P[F.c];if(!0===v.morphTargets){var ia=e.morphTargets,da=G.morphTargetInfluences,oa=I.position,K=ka.position,ea=va.position;X.set(0,0,0);ja.set(0,0,0);l.set(0,0,0);for(var ba=0,la=ia.length;ba<la;ba++){var U=da[ba];if(0!==U){var qa=ia[ba].vertices;X.x+=(qa[F.a].x-oa.x)*U;X.y+=(qa[F.a].y-oa.y)*U;X.z+=(qa[F.a].z-oa.z)*U;ja.x+=(qa[F.b].x-K.x)*U;ja.y+=(qa[F.b].y-K.y)*U;ja.z+=(qa[F.b].z-K.z)*U;l.x+=(qa[F.c].x-ea.x)*U;l.y+=(qa[F.c].y-ea.y)*U;l.z+=(qa[F.c].z-ea.z)*U}}I.position.add(X);ka.position.add(ja);
va.position.add(l);w.projectVertex(I);w.projectVertex(ka);w.projectVertex(va)}if(!1!==w.checkTriangleVisibility(I,ka,va)){ia=w.checkBackfaceCulling(I,ka,va);if(J!==THREE.DoubleSide){if(J===THREE.FrontSide&&!1===ia)continue;if(J===THREE.BackSide&&!0===ia)continue}C=h();C.id=G.id;C.v1.copy(I);C.v2.copy(ka);C.v3.copy(va);C.normalModel.copy(F.normal);!1!==ia||J!==THREE.BackSide&&J!==THREE.DoubleSide||C.normalModel.negate();C.normalModel.applyMatrix3(y).normalize();da=F.vertexNormals;oa=0;for(K=Math.min(da.length,
3);oa<K;oa++)ea=C.vertexNormalsModel[oa],ea.copy(da[oa]),!1!==ia||J!==THREE.BackSide&&J!==THREE.DoubleSide||ea.negate(),ea.applyMatrix3(y).normalize();C.vertexNormalsLength=da.length;J=B[H];if(void 0!==J)for(ia=0;3>ia;ia++)C.uvs[ia].copy(J[ia]);C.color=F.color;C.material=v;C.z=(I.positionScreen.z+ka.positionScreen.z+va.positionScreen.z)/3;W.elements.push(C)}}}}}else if(G instanceof THREE.Line)if(e instanceof THREE.BufferGeometry){if(B=e.attributes,void 0!==B.position){u=B.position.array;e=0;for(r=
u.length;e<r;e+=3)w.pushVertex(u[e],u[e+1],u[e+2]);if(void 0!==B.index)for(B=B.index.array,e=0,r=B.length;e<r;e+=2)w.pushLine(B[e],B[e+1]);else for(B=G.mode===THREE.LinePieces?2:1,e=0,r=u.length/3-1;e<r;e+=B)w.pushLine(e,e+1)}}else{if(e instanceof THREE.Geometry&&(pa.multiplyMatrices(z,fa),H=G.geometry.vertices,0!==H.length))for(I=g(),I.positionScreen.copy(H[0]).applyMatrix4(pa),B=G.mode===THREE.LinePieces?2:1,O=1,F=H.length;O<F;O++)I=g(),I.positionScreen.copy(H[O]).applyMatrix4(pa),0<(O+1)%B||(ka=
P[E-2],ga.copy(I.positionScreen),na.copy(ka.positionScreen),!0===a(ga,na)&&(ga.multiplyScalar(1/ga.w),na.multiplyScalar(1/na.w),R=f(),R.id=G.id,R.v1.positionScreen.copy(ga),R.v2.positionScreen.copy(na),R.z=Math.max(ga.z,na.z),R.material=G.material,G.material.vertexColors===THREE.VertexColors&&(R.vertexColors[0].copy(G.geometry.colors[O]),R.vertexColors[1].copy(G.geometry.colors[O-1])),W.elements.push(R)))}else G instanceof THREE.Sprite&&(b.set(fa.elements[12],fa.elements[13],fa.elements[14],1),b.applyMatrix4(z),
e=1/b.w,b.z*=e,-1<=b.z&&1>=b.z&&(Q=p(),Q.id=G.id,Q.x=b.x*e,Q.y=b.y*e,Q.z=b.z,Q.object=G,Q.rotation=G.rotation,Q.scale.x=G.scale.x*Math.abs(Q.x-(b.x+s.projectionMatrix.elements[0])/(b.w+s.projectionMatrix.elements[12])),Q.scale.y=G.scale.y*Math.abs(Q.y-(b.y+s.projectionMatrix.elements[5])/(b.w+s.projectionMatrix.elements[13])),Q.material=G.material,W.elements.push(Q)))}!0===L&&W.elements.sort(n);return W}};
THREE.OrbitControls=function(g,h){function f(c){if(!1!==a.enabled){c.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(k===m.ROTATE){if(!0===a.noRotate)return;q.set(c.clientX,c.clientY);V.subVectors(q,d);a.rotateLeft(2*Math.PI*V.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*V.y/b.clientHeight*a.rotateSpeed);d.copy(q)}else if(k===m.DOLLY){if(!0===a.noZoom)return;ma.set(c.clientX,c.clientY);la.subVectors(ma,C);0<la.y?a.dollyIn():a.dollyOut();C.copy(ma)}else if(k===
m.PAN){if(!0===a.noPan)return;L.set(c.clientX,c.clientY);E.subVectors(L,D);a.pan(E.x,E.y);D.copy(L)}a.update()}}function p(){!1!==a.enabled&&(document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",p,!1),a.dispatchEvent(l),k=m.NONE)}function n(c){if(!1!==a.enabled&&!0!==a.noZoom){c.preventDefault();c.stopPropagation();var b=0;void 0!==c.wheelDelta?b=c.wheelDelta:void 0!==c.detail&&(b=-c.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(ja);a.dispatchEvent(l)}}
this.object=g;this.domElement=void 0!==h?h:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,d=new THREE.Vector2,q=new THREE.Vector2,V=new THREE.Vector2,D=new THREE.Vector2,L=new THREE.Vector2,E=new THREE.Vector2,P=new THREE.Vector3,x=new THREE.Vector3,C=new THREE.Vector2,ma=new THREE.Vector2,la=new THREE.Vector2,ba=0,R=0,ha=1,sa=new THREE.Vector3,u=new THREE.Vector3,Q=new THREE.Quaternion,m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=m.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var s=(new THREE.Quaternion).setFromUnitVectors(g.up,new THREE.Vector3(0,1,0)),W=s.clone().inverse(),X={type:"change"},ja={type:"start"},l={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);R-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);ba-=c};this.panLeft=function(a){var b=this.object.matrix.elements;P.set(b[0],b[1],b[2]);P.multiplyScalar(-a);sa.add(P)};this.panUp=function(a){var b=this.object.matrix.elements;P.set(b[4],b[5],
b[6]);P.multiplyScalar(a);sa.add(P)};this.panForward=function(a){var b=this.object.matrix.elements;P.set(b[8],b[9],b[10]);P.multiplyScalar(a);sa.add(P)};this.pan=function(c,b){var d=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var f=a.object.position.clone().sub(a.target).length(),f=f*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*f/d.clientHeight);a.panUp(2*b*f/d.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/d.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,b){var d=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var f=a.object.position.clone().sub(a.target).length(),f=f*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*f/d.clientHeight);a.panForward(2*b*f/d.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/d.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ha/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ha*=c};this.update=function(){var c=this.object.position;x.copy(c).sub(this.target);x.applyQuaternion(s);var b=Math.atan2(x.x,x.z),d=Math.atan2(Math.sqrt(x.x*x.x+x.z*x.z),x.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+R,d=d+ba,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),d=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d)),d=Math.max(1E-6,Math.min(Math.PI-1E-6,d)),f=x.length()*ha,f=Math.max(this.minDistance,Math.min(this.maxDistance,f));this.target.add(sa);x.x=f*Math.sin(d)*Math.sin(b);x.y=f*Math.cos(d);x.z=f*Math.sin(d)*Math.cos(b);x.applyQuaternion(W);c.copy(this.target).add(x);this.object.lookAt(this.target);ba=R=0;ha=1;sa.set(0,0,0);if(1E-6<
u.distanceToSquared(this.object.position)||1E-6<8*(1-Q.dot(this.object.quaternion)))this.dispatchEvent(X),u.copy(this.object.position),Q.copy(this.object.quaternion)};this.reset=function(){k=m.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;k=m.ROTATE;d.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;k=m.DOLLY;C.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.PAN){if(!0===a.noPan)return;k=m.PAN;D.set(c.clientX,c.clientY)}document.addEventListener("mousemove",f,!1);document.addEventListener("mouseup",p,!1);a.dispatchEvent(ja)}},!1);this.domElement.addEventListener("mousewheel",n,!1);this.domElement.addEventListener("DOMMouseScroll",n,!1);this.domElement.addEventListener("touchstart",
function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;k=m.TOUCH_ROTATE;d.set(c.touches[0].pageX,c.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;k=m.TOUCH_DOLLY;var b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;b=Math.sqrt(b*b+c*c);C.set(0,b);break;case 3:if(!0===a.noPan)return;k=m.TOUCH_PAN;D.set(c.touches[0].pageX,c.touches[0].pageY);break;default:k=m.NONE}a.dispatchEvent(ja)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(l),k=m.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();c.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(k!==m.TOUCH_ROTATE)break;q.set(c.touches[0].pageX,c.touches[0].pageY);V.subVectors(q,d);a.rotateLeft(2*Math.PI*V.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*V.y/b.clientHeight*a.rotateSpeed);d.copy(q);
a.update();break;case 2:if(!0===a.noZoom)break;if(k!==m.TOUCH_DOLLY)break;b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;c=Math.sqrt(b*b+c*c);ma.set(0,c);la.subVectors(ma,C);0<la.y?a.dollyOut():a.dollyIn();C.copy(ma);a.update();break;case 3:if(!0===a.noPan)break;if(k!==m.TOUCH_PAN)break;L.set(c.touches[0].pageX,c.touches[0].pageY);E.subVectors(L,D);a.pan(E.x,E.y);D.copy(L);a.update();break;default:k=m.NONE}}},!1);window.addEventListener("keydown",function(c){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var g=document.createElement("canvas");return!(!window.WebGLRenderingContext||!g.getContext("webgl")&&!g.getContext("experimental-webgl"))}catch(h){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";
g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){var h,f;g=g||{};h=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";f=Detector.getWebGLErrorMessage();f.id=g;h.appendChild(f)}};"object"===typeof module&&(module.exports=Detector);
(function(g,h,f,p){var n=function(a){this.domParent="object"===typeof a?a:h.body};n.prototype.init=function(a,d,n,V,D,L){g.requestAnimationFrame||(g.requestAnimationFrame=function(){return g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a,d){g.setTimeout(a,1E3/60)}}());this.domParent===h.body&&(this.WINDOW_WIDTH=g.innerWidth,this.WINDOW_HEIGHT=g.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,g.addEventListener("resize",a,!1));this.renderType=p.webgl?"webgl":"canvas";this.renderer=n||(p.webgl?new f.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new f.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=V||new f.Scene;this.camera=D||new f.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E4);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
L?this.controls=L:(this.controls=new f.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:f.MOUSE.MIDDLE,PAN:f.MOUSE.RIGHT});d()};g.Base=n;"object"===typeof module&&(module.exports=n)})(window,document,THREE,Detector);
(function(){function g(f){return f.charAt(0).toUpperCase()+f.slice(1)}var h={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(f){var g=0;for(f=f.length;g<f;g++);};h.map={};h.Sidebar=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({align:"r",width:320},f),a="sidebar",a=n.align&&"r"!==n.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;n.id&&(this.domElement.id=n.id,h.map[n.id]=this);
this.domElement.style.width=n.width.toString()+"px";n.overflow&&(this.domElement.style.overflow=n.overflow.toString());g.appendChild(this.domElement);h.Utils.domCreationDirector(n.children,this.domElement)};h.Sidebar.prototype=Object.create(_Container.prototype);h.Panel=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({title:""},f);n.id&&(this.domElement.id=n.id,h.map[n.id]=this);var a=this.domElement;a.className="panel panel-tool";g.appendChild(a);var d=document.createElement("div");
d.className="panel-heading";a.appendChild(d);var q=document.createTextNode(n.title);d.appendChild(q);d=document.createElement("div");d.className="panel-body";n.overflow&&(d.style.overflow=n.overflow.toString());a.appendChild(d);h.Utils.domCreationDirector(n.children,d)};h.Panel.prototype=Object.create(_Container.prototype);h.Toolbar=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({title:""},f);n.id&&(this.domElement.id=n.id,h.map[n.id]=this);var a=this.domElement;a.className=
"btn-toolbar";g.appendChild(a);h.Utils.domCreationDirector(n.children,a)};h.Toolbar.prototype=Object.create(_Container.prototype);h.ButtonGroup=function(f,g){_Container.call(this);var n=this.setting=h.Utils.settingMixin({title:"",buttonType:"radio"},f);n.id&&(this.domElement.id=n.id,h.map[n.id]=this);var a=this.domElement;a.className="btn-group"+(n.appendClass?" "+n.appendClass:"");"button"!==n.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=n.title;g.appendChild(a);var d=
n.buttons;switch(n.buttonType.toLowerCase()){default:case "radio":for(var q=0,V=d.length;q<V;q++){var D=document.createElement("label");D.className="btn btn-tool"+(d[q].checked?" active":"");d[q].height&&(D.style.height=d[q].height+"px");d[q].width&&(D.style.width=d[q].width+"px");if(d[q].bgType&&d[q].bgTypeData){var L;switch(d[q].bgType){case "color":L=d[q].bgTypeData;D.className+=" btn-color";break;case "image":L="url("+d[q].bgTypeData+") no-repeat 50% 50%";D.className+=" btn-image";break;default:return}D.style.background=
L}a.appendChild(D);var E=document.createElement("input");d[q].checked&&E.setAttribute("checked","");E.type=n.buttonType;E.name=n.name;E.id=d[q].id;E.value=q;E.autocomplete="off";D.appendChild(E);L=document.createTextNode(d[q].title);D.appendChild(L)}break;case "button":for(q=0,V=d.length;q<V;q++){E=document.createElement("button");E.className="btn btn-tool";E.id=d[q].id;E.name=n.name;d[q].height&&(E.style.height=d[q].height+"px");d[q].width&&(E.style.width=d[q].width+"px");if(d[q].bgType&&d[q].bgTypeData){switch(d[q].bgType){case "color":L=
d[q].bgTypeData;D.className+=" btn-color";break;case "image":L="url("+d[q].bgTypeData+") no-repeat 50% 50%";D.className+=" btn-image";break;default:return}E.style.background=L}a.appendChild(E);L=document.createTextNode(d[q].title);E.appendChild(L)}}h.Utils.domCreationDirector(n.children,this.domElement)};h.ButtonGroup.prototype=Object.create(_Container.prototype);h.ButtonGroup.prototype.addButton=function(f,g){g||this.setting.buttons.push(f);var h=document.createElement("label");h.className="btn btn-tool"+
(f.checked?" active":"");f.height&&(h.style.height=f.height+"px");f.width&&(h.style.width=f.width+"px");if(f.bgType&&f.bgTypeData){var a;switch(f.bgType){case "color":a=f.bgTypeData;h.className+=" btn-color";break;case "image":a="url("+f.bgTypeData+") no-repeat 50% 50%";h.className+=" btn-image";break;default:return}h.style.background=a}this.domElement.appendChild(h);a=document.createElement("input");f.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
f.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";h.appendChild(a);a=document.createTextNode(f.title);h.appendChild(a);return h};h.ButtonGroup.prototype.addButtons=function(f,g){for(var h=0,a=f.length;h<a;h++)this.addButton(f[h],g)};h.Utils={};h.Utils.settingMixin=function(f,g){if("object"===typeof f&&"object"===typeof g){var h={},a;for(a in f)h[a]=f[a];for(var d in g)void 0!==g[d]&&(h[d]=g[d]);return h}return f};h.Utils.domCreationDirector=function(f,p){if(f)if(f instanceof Array)for(var n=
0,a=f.length;n<a;n++)h.Utils.domCreationDirector(f[n],p?p:document.body);else f instanceof Object&&f.UIType&&h[g(f.UIType)]&&new (h[g(f.UIType)])(f,p?p:document.body)};window.GoUI=h;"object"===typeof module&&(module.exports=h)})();var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
(function(g,h,f,p,n){var a,d;function q(v){var b=y.textures+(v?-1:1),b=h.getElementById("texture"+b);if(!b&&(b=v?z.length-1:0,b=h.getElementById("texture"+b),!b))return;v=b.parentElement.className.indexOf("btn-color");var c=b.parentElement.className.indexOf("btn-image");-1<v?(a=Number(b.value),h.getElementById("colorTexture").parentElement.click()):-1<c&&(d=Number(b.value),h.getElementById("imageTexture").parentElement.click())}function V(a,b){var c=b.clone(),d;for(d in a)c[d]=a[d];return c}function D(a){if(null==
a.pageX&&null!=a.clientX){var b=h.documentElement,c=h.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}xa.set(a.pageX/l.WINDOW_WIDTH*2-1,2*-(a.pageY/l.WINDOW_HEIGHT)+1);ya.setFromCamera(xa,l.camera);return ya.intersectObjects(ta)}function L(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(X.width).floor().multiplyScalar(X.width).addScalar(X.width/
2))}function E(a){0<a.length&&L(T,a[0])}function P(a,c,d,e){a=a||D(event);if(0<a.length){a=a[0];var g=y.toolsType,f=!1,h=ta.length;if(h&&a.object!==b)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===ta[k]){f=!0;break}0===g?!0===f&&!1===c||!1===f&&!0===c||(c=I.draw(0,ua,void 0,a),e?F.appendObjectToCurrentAction(c):F.addAction("draw",c)):1===g&&d&&a.object!==b&&(c=I.erase(a.object),e?F.appendObjectToCurrentAction(c):F.addAction("erase",c))}}function x(a){0===da&&(O.save(O.storageKeys.camera),O.save(O.storageKeys.sidebar),
O.save())}function C(a){O.save(O.storageKeys.camera);O.save(O.storageKeys.sidebar);O.save();da=1}function ma(a){a.preventDefault();var b;1===r[0]?(b=D(a),P(b,a.ctrlKey,a.ctrlKey,!0)):(b=y.toolsType,1===b?T.visible&&(T.visible=!1):(!T.visible&&pa&&(T.visible=!0),b=D(a),E(b)))}function la(a){a.preventDefault();switch(a.button){case 0:if(!H.endFlag){H.instantComplete(H.loadBoxAnimation);break}r[0]=1;a=D(a);P(a,void 0,!0,!1);0===y.toolsType&&E(a);break;case 1:r[1]=1;break;case 2:r[2]=1}}function ba(b){if("label"===
this.nodeName.toLowerCase())switch(b=this.getElementsByTagName("input")[0],y[b.name]=Number(b.value),b.name){case "toolsType":1===Number(b.value)?T.visible&&(T.visible=!1):!T.visible&&pa&&(T.visible=!0);break;case "textures":ua=y[b.name];ga=z[ua];na=ga.data;w=ga.helperData=z[y[b.name]].helperData||V(wa,na);T.material=w;h.getElementById("cube").parentElement.click();switch(y.texturesType){case 0:d=b.value;break;default:case 1:a=b.value}break;case "sidebarResize":var c=GoUI.map.sidebar.domElement;"0"===
b.value?$(c).animate({top:"0",height:"100%"}):$(c).animate({top:"60%",height:"40%"});break;case "texturesType":b=b.id,"imageTexture"===b?($(".btn-color").hide(),$(".btn-image").show(),h.getElementById("texture"+d).parentElement.click()):"colorTexture"===b&&($(".btn-color").show(),$(".btn-image").hide(),h.getElementById("texture"+a).parentElement.click())}else if("button"===this.type||"button"===this.nodeName.toLowerCase())y[this.id]()}function R(a){switch(a.button){case 0:r[0]=0;break;case 1:r[1]=
0;break;case 2:r[2]=0}}function ha(a){switch(a.keyCode){case 67:q();break;case 88:q(!0)}}function sa(a){if(!r[0])switch(a.keyCode){case 16:0===y.toolsType?h.getElementById("eraser").parentElement.click():1===y.toolsType&&h.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&F.undo();break;case 89:a.ctrlKey&&F.redo()}}function u(){requestAnimationFrame(u);l.renderer.render(l.scene,l.camera)}var Q=h.createElement("a");Q.id="imageCapture";Q.style.display="none";Q.target="_blank";h.body.appendChild(Q);
var m=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};m.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=H.currentMeshes;H.currentIterator<a.length?a[H.currentIterator].meshObject.visible=!0:(H.endFlag=!0,clearInterval(H.currentAnimationIntervalHandler));H.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},
instantComplete:function(a){if(!0!==this.endFlag){var b=H.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var k=function(a){this.isLoadingBoxEnd=a};k.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return g.localStorage&&g.localStorage.getItem(a||this.storageKeys.meshes)},save:function(b,c){if(g.localStorage){var e="";if(c)e=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&
0>F.currentActionIndex)return;for(var f=0,h=ca.length;f<h;f++)e+=ca[f].geo.id.replace("geo","")+",",e+=ca[f].material.id.replace("texture","")+",",e+=ca[f].meshObject.position.x+",",e+=ca[f].meshObject.position.y+",",e+=ca[f].meshObject.position.z+";";break;case this.storageKeys.camera:e+=l.controls.target.x+","+l.controls.target.y+","+l.controls.target.z+";";e+=l.controls.object.position.x+","+l.controls.object.position.y+","+l.controls.object.position.z+";";break;case this.storageKeys.sidebar:e+=
d+","+a+","+y.texturesType+","+y.sidebarResize}g.localStorage.setItem(b||this.storageKeys.meshes,e)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var e=[];(a=this.load(a))&&(e=a.split(";"));if(0<e.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=e.length;b<a;b++){var d=e[b].split(",");2<d.length&&I.draw(Number(d[0]),Number(d[1]),[Number(d[2]),Number(d[3]),Number(d[4])])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=e.length;b<a;b++)d=e[b].split(","),2<d.length&&
I.draw(Number(d[0]),Number(d[1]),[Number(d[2]),Number(d[3]),Number(d[4])],void 0,void 0,!0);H.begin(c,ca)}else H.endFlag=!0},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var e=b[a].split(",");switch(a){case 0:l.controls.target.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0);break;case 1:l.controls.object.position.set(Number(e[0])||0,Number(e[1])||0,Number(e[2])||0)}}l.controls.update()}},loadSidebarSelectedButtons:function(b){var c=
[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var e=c.length;b<e;b++){var f=c[b];if(""!==f&&NaN!==Number(f))switch(b){case 0:d=Number(f)||0;break;case 1:a=Number(f)||0;break;case 2:1===Number(f)?h.getElementById("colorTexture").parentElement.click():h.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(f)?h.getElementById("minSidebar").parentElement.click():h.getElementById("normalSidebar").parentElement.click()}}}else h.getElementById("imageTexture").parentElement.click()}};
var s=function(){this.currentActionIndex=-1;this.actionArray=[]};s.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=I.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d)switch(b){case "draw":I.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":I.erase(d.meshObject)}}this.currentActionIndex--;
this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d)switch(b){case "draw":I.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":I.erase(d.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=
-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,e=a.length;c<e;c++)b.meshes.push(a[c]);else b.meshes.push(a)},updateDom:function(){h.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;h.getElementById("redo").disabled=
this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var W=function(){};W.prototype={calculateIntersectResult:D,setMeshPositionToFitTheGrid:L,updateHelperCube:E,draw:function(a,b,c,e,d,f){if(void 0===a||"number"===typeof a)a=fa[a||0];if(void 0===b||"number"===typeof b)b=z[b||0];var g=a.data,h=b.data;d=d||new p.Mesh(g,h);d.castShadow=!0;e?L(d,e):d.position.set(c[0],c[1],c[2]);!f||(d.visible=!1);l.scene.add(d);ta.push(d);ca.push({meshObject:d,geo:a,material:b});return ca[ca.length-1]},erase:function(a){l.scene.remove(a);
a=ta.indexOf(a);if(!(0>a)){ta.splice(a,1);var b=ca[a-1];ca.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};var X={width:50},ja={webgl:{ambientLightColor:2105376,directionalLightDensity:.4},canvas:{ambientLightColor:9474192,directionalLightDensity:.9}};p.ImageUtils.crossOrigin="Anonymous";var l,c,b,Z,da=0;n=k.prototype.LOAD_TYPE.async;var U=new p.MeshLambertMaterial({color:592137}),wa={opacity:.5,transparent:!0},z=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",
data:U,helperData:V(wa,U)}],fa=[{name:"default",type:"1",id:"geo0",data:new p.BoxGeometry(X.width,X.width,X.width,1,1,1)}];d=30;a=0;var pa=!0,y={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===y.toolsType||(T.visible=!T.visible);pa=!pa},capture:function(){var a=l.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)?
b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(g.navigator.saveBlob=g.navigator.saveBlob||g.navigator.msSaveBlob,a.msToBlob&&g.navigator.saveBlob?g.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(Q.href=a.toDataURL(),Q.download="capture.png",Q.click())},clearAll:function(){H.endFlag||H.instantComplete(H.loadBoxAnimation);if(!(1>ca.length)){var a=I.erase(ca[0].meshObject);
F.addAction("erase",a);for(var b=0,c=ca.length;b<c;b++)a=I.erase(ca[0].meshObject),F.appendObjectToCurrentAction(a)}},undo:function(){F.undo()},redo:function(){F.redo()}},ua=0,ga=z[0],na=ga.data,w=ga.helperData,S=fa[0].data,T,ta=[],ca=[],G,e,B,xa,r=[0,0,0],ya,H=new m,O=new k(!1),F=new s,I=new W;l=new f(h.body);l.init(function(a){if(l.WINDOW_WIDTH!==g.innerWidth||l.WINDOW_HEIGHT!==g.innerHeight)l.WINDOW_WIDTH=g.innerWidth,l.WINDOW_HEIGHT=g.innerHeight,l.WINDOW_HEIGHT_HALF=l.WINDOW_HEIGHT/2,l.WINDOW_WIDTH_HALF=
l.WINDOW_WIDTH/2,l.camera.aspect=l.WINDOW_WIDTH/l.WINDOW_HEIGHT,l.camera.updateProjectionMatrix(),l.renderer.setSize(l.WINDOW_WIDTH,l.WINDOW_HEIGHT),h.body.height=l.WINDOW_HEIGHT},function(){c=new p.PlaneBufferGeometry(1E4,1E4,32,32);c.applyMatrix((new p.Matrix4).makeRotationX(-Math.PI/2));var a=p.ImageUtils.loadTexture("texture/grass.png");a.wrapT=a.wrapS=p.RepeatWrapping;a.repeat.set(24,24);Z=new p.MeshLambertMaterial({color:3394611,map:a});b=new p.Mesh(c,Z);b.receiveShadow=!0;b.material.side=p.DoubleSide;
l.scene.add(b);ta.push(b);G=new p.AmbientLight(ja[l.renderType].ambientLightColor);l.scene.add(G);e=new p.DirectionalLight(15658734,ja[l.renderType].directionalLightDensity);e.position.set(0,6E3,5E3);e.target.position.set(0,0,0);e.castShadow=!0;e.shadowCameraNear=l.camera.near;e.shadowCameraFar=l.camera.far;e.shadowCameraFov=l.camera.fov;e.shadowBias=1E-6;e.shadowDarkness=.5;e.shadowMapWidth=1024;e.shadowMapHeight=1024;l.scene.add(e);B=new p.HemisphereLight(15658734,3158064,.95);l.scene.add(B);var a=
{topColor:{type:"c",value:new p.Color(30719)},bottomColor:{type:"c",value:new p.Color(16777215)},offset:{type:"f",value:400},exponent:{type:"f",value:.6}},d=new p.Color;a.topColor.value.copy(d.setHSL(.6,1,.75));d=new p.SphereGeometry(4500,32,15);a=new p.ShaderMaterial({uniforms:a,vertexShader:vertexShader,fragmentShader:fragmentShader,side:p.BackSide});a=new p.Mesh(d,a);l.scene.add(a);T=new p.Mesh(S,w);T.position.set(X.width/2,X.width/2,X.width/2);l.scene.add(T);new p.Mesh(S,na);ya=new p.Raycaster;
xa=new p.Vector2;l.renderer.setClearColor(15790320);l.renderer.shadowMapEnabled=!0;l.renderer.shadowMapType=p.PCFShadowMap;g.addEventListener("unload",x,!1);g.addEventListener("reload",C,!1);l.renderer.domElement.addEventListener("mousemove",ma,!1);l.renderer.domElement.addEventListener("mousedown",la,!1);l.renderer.domElement.addEventListener("mouseup",R,!1);h.addEventListener("keydown",ha,!1);h.addEventListener("keyup",sa,!1);setInterval(x,12E4)});u();k={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",
id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},
{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",
buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",
bgType:z[0].type,bgTypeData:z[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>l.WINDOW_WIDTH){s=k.children;m=0;for(f=s.length;m<f;m++)if("sidebarResize"===s[m].id){m=s[m].buttons;s=0;for(f=m.length;s<f;s++)"normalSidebar"===m[s].id&&delete m[s].checked,"minSidebar"===m[s].id&&(m[s].checked=!0);break}y.sidebarResize=1}else y.sidebarResize=0;GoUI.Utils.domCreationDirector(k);F.updateDom();f=h.querySelectorAll(".btn");if(f instanceof Array||f.length)for(m=f.length-1;0<=m;m--)f[m].addEventListener("click",
ba,!1);else f instanceof object&&f.addEventListener("click",ba,!1);s=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},
{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];m=0;for(f=s.length;m<f;m++)k={name:s[m].color,type:"color",id:"texture"+(m+1),uniqueData:s[m].color,data:new p.MeshLambertMaterial({color:s[m].color})},z.push(k),GoUI.map.buttonGroup2.addButton({title:"",id:k.id,bgType:k.type,bgTypeData:k.uniqueData,width:50,height:50}).addEventListener("click",ba,!1);s="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");
m=0;for(f=s.length;m<f;m++)k={name:s[m].replace("texture/","").replace(".png",""),type:"image",id:"texture"+z.length,uniqueData:s[m],data:new p.MeshLambertMaterial({map:p.ImageUtils.loadTexture(s[m]),transparent:!0})},"glass"===k.data.name&&(k.data.map.opacity=.3),k.data.map.magFilter=p.NearestFilter,k.data.map.minFilter=p.LinearMipMapLinearFilter,z.push(k),GoUI.map.buttonGroup2.addButton({title:"",id:k.id,bgType:k.type,bgTypeData:k.uniqueData,width:50,height:50}).addEventListener("click",ba,!1);
O.loadCamera(O.storageKeys.camera);O.loadSidebarSelectedButtons(O.storageKeys.sidebar);O.loadMeshes(void 0,n,H.loadBoxAnimation)})(window,document,Base,THREE,Detector);
