THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(f,k){};this.setValues(e)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.program=this.program;return e};
THREE.CanvasRenderer=function(e){function f(l,b,N,d){J(b);v(N);K(d);W(l.getStyle());a.stroke();z.expandByScalar(2*b)}function k(l){O(l.getStyle());a.fill()}function s(l){c(l.target)}function c(l){if(!(l instanceof THREE.CompressedTexture)){var b=l.wrapS===THREE.RepeatWrapping,N=l.wrapT===THREE.RepeatWrapping,d=l.image,c=document.createElement("canvas");c.width=d.width;c.height=d.height;var pa=c.getContext("2d");pa.setTransform(1,0,0,-1,0,d.height);pa.drawImage(d,0,0);E[l.id]=a.createPattern(c,!0===
b&&!0===N?"repeat":!0===b&&!1===N?"repeat-x":!1===b&&!0===N?"repeat-y":"no-repeat")}}function q(l,b,N,d,pa,k,g,f,h,e,L,u,m){if(!(m instanceof THREE.DataTexture)){!1===m.hasEventListener("update",s)&&(void 0!==m.image&&0<m.image.width&&c(m),m.addEventListener("update",s));var A=E[m.id];if(void 0!==A){O(A);var A=m.offset.x/m.repeat.x,q=m.offset.y/m.repeat.y,r=m.image.width*m.repeat.x;m=m.image.height*m.repeat.y;g=(g+A)*r;f=(f+q)*m;N-=l;d-=b;pa-=l;k-=b;h=(h+A)*r-g;e=(e+q)*m-f;L=(L+A)*r-g;u=(u+q)*m-f;
m=h*u-L*e;0!==m&&(A=1/m,m=(u*N-e*pa)*A,e=(u*d-e*k)*A,N=(h*pa-L*N)*A,d=(h*k-L*d)*A,l=l-m*g-N*f,b=b-e*g-d*f,a.save(),a.transform(m,e,N,d,l,b),a.fill(),a.restore())}else O("rgba(0,0,0,1)"),a.fill()}}function b(l,a,b){var N=a.x-l.x,d=a.y-l.y,pa=N*N+d*d;0!==pa&&(b/=Math.sqrt(pa),N*=b,d*=b,a.x+=N,a.y+=d,l.x-=N,l.y-=d)}function r(l){p!==l&&(p=a.globalAlpha=l)}function ca(l){D!==l&&(l===THREE.NormalBlending?a.globalCompositeOperation="source-over":l===THREE.AdditiveBlending?a.globalCompositeOperation="lighter":
l===THREE.SubtractiveBlending&&(a.globalCompositeOperation="darker"),D=l)}function J(l){H!==l&&(H=a.lineWidth=l)}function v(l){ea!==l&&(ea=a.lineCap=l)}function K(l){ua!==l&&(ua=a.lineJoin=l)}function W(l){h!==l&&(h=a.strokeStyle=l)}function O(l){w!==l&&(w=a.fillStyle=l)}function y(l){ja.length!==l.length&&(a.setLineDash(l),ja=l)}console.log("THREE.CanvasRenderer",THREE.REVISION);var qa=THREE.Math.smoothstep;e=e||{};var X=this,sa,Y,ga,fa=new THREE.Projector,M=void 0!==e.canvas?e.canvas:document.createElement("canvas"),
aa=M.width,ka=M.height,B=Math.floor(aa/2),n=Math.floor(ka/2),Z=0,Q=0,oa=aa,da=ka,x=1,a=M.getContext("2d",{alpha:!0===e.alpha}),T=new THREE.Color(0),G=!0===e.alpha?0:1,p=1,D=0,h=null,w=null,H=null,ea=null,ua=null,ja=[],ta,C,L,A;new THREE.RenderableVertex;new THREE.RenderableVertex;var wa,ra,xa,g,m,va,u=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var ya=new THREE.Color,za=new THREE.Color,ha=new THREE.Color,E={},U,R,Aa,V,Ba,ia,na,la=new THREE.Box2,I=new THREE.Box2,
z=new THREE.Box2,d=new THREE.Color,S=new THREE.Color,ba=new THREE.Color,ma=new THREE.Vector3,l=new THREE.Vector3,N=new THREE.Vector3,pa=new THREE.Matrix3;void 0===a.setLineDash&&(a.setLineDash=function(){});this.domElement=M;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return x};this.setPixelRatio=function(l){x=l};this.setSize=function(l,a,b){aa=l*
x;ka=a*x;M.width=aa;M.height=ka;B=Math.floor(aa/2);n=Math.floor(ka/2);!1!==b&&(M.style.width=l+"px",M.style.height=a+"px");la.min.set(-B,-n);la.max.set(B,n);I.min.set(-B,-n);I.max.set(B,n);p=1;D=0;ua=ea=H=w=h=null;this.setViewport(0,0,l,a)};this.setViewport=function(l,a,b,N){Z=l*x;Q=a*x;oa=b*x;da=N*x};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(l,a){T.set(l);G=void 0!==a?a:1;I.min.set(-B,-n);I.max.set(B,n)};this.setClearColorHex=function(l,a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(l,a)};this.getClearColor=function(){return T};this.getClearAlpha=function(){return G};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===I.empty()&&(I.intersect(la),I.expandByScalar(2),I.min.x+=B,I.min.y=-I.min.y+n,I.max.x+=B,I.max.y=-I.max.y+n,1>G&&a.clearRect(I.min.x|0,I.max.y|0,I.max.x-I.min.x|0,I.min.y-I.max.y|0),0<G&&(ca(THREE.NormalBlending),r(1),O("rgba("+Math.floor(255*T.r)+","+Math.floor(255*T.g)+","+Math.floor(255*T.b)+","+G+")"),a.fillRect(I.min.x|
0,I.max.y|0,I.max.x-I.min.x|0,I.min.y-I.max.y|0)),I.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(Ca,e){if(!1===e instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();X.info.render.vertices=0;X.info.render.faces=0;a.setTransform(oa/aa,0,0,-da/ka,Z,ka-Q);a.translate(B,n);sa=fa.projectScene(Ca,e,this.sortObjects,this.sortElements);
Y=sa.elements;ga=sa.lights;ta=e;pa.getNormalMatrix(e.matrixWorldInverse);d.setRGB(0,0,0);S.setRGB(0,0,0);ba.setRGB(0,0,0);for(var h=0,T=ga.length;h<T;h++){var t=ga[h],p=t.color;t instanceof THREE.AmbientLight?d.add(p):t instanceof THREE.DirectionalLight?S.add(p):t instanceof THREE.PointLight&&ba.add(p)}h=0;for(T=Y.length;h<T;h++){var F=Y[h],D=F.material;if(void 0!==D&&0!==D.opacity){z.makeEmpty();if(F instanceof THREE.RenderableSprite){C=F;C.x*=B;C.y*=n;var t=C,P=F,p=D;r(p.opacity);ca(p.blending);
var x=P.scale.x*B,P=P.scale.y*n,F=.5*Math.sqrt(x*x+P*P);z.min.set(t.x-F,t.y-F);z.max.set(t.x+F,t.y+F);if(p instanceof THREE.SpriteMaterial){var w=p.map;if(null!==w&&void 0!==w.image){!1===w.hasEventListener("update",s)&&(0<w.image.width&&c(w),w.addEventListener("update",s));F=E[w.id];void 0!==F?O(F):O("rgba( 0, 0, 0, 1 )");var G=w.image,F=G.width*w.offset.x,D=G.height*w.offset.y,H=G.width*w.repeat.x,w=G.height*w.repeat.y,G=x/H,M=P/w;a.save();a.translate(t.x,t.y);0!==p.rotation&&a.rotate(p.rotation);
a.translate(-x/2,-P/2);a.scale(G,M);a.translate(-F,-D);a.fillRect(F,D,H,w)}else O(p.color.getStyle()),a.save(),a.translate(t.x,t.y),0!==p.rotation&&a.rotate(p.rotation),a.scale(x,-P),a.fillRect(-.5,-.5,1,1);a.restore()}else p instanceof THREE.SpriteCanvasMaterial&&(W(p.color.getStyle()),O(p.color.getStyle()),a.save(),a.translate(t.x,t.y),0!==p.rotation&&a.rotate(p.rotation),a.scale(x,P),p.program(a),a.restore())}else if(F instanceof THREE.RenderableLine){if(C=F.v1,L=F.v2,C.positionScreen.x*=B,C.positionScreen.y*=
n,L.positionScreen.x*=B,L.positionScreen.y*=n,z.setFromPoints([C.positionScreen,L.positionScreen]),!0===la.isIntersectionBox(z))if(t=C,p=L,x=F,P=D,r(P.opacity),ca(P.blending),a.beginPath(),a.moveTo(t.positionScreen.x,t.positionScreen.y),a.lineTo(p.positionScreen.x,p.positionScreen.y),P instanceof THREE.LineBasicMaterial){J(P.linewidth);v(P.linecap);K(P.linejoin);if(P.vertexColors!==THREE.VertexColors)W(P.color.getStyle());else if(F=x.vertexColors[0].getStyle(),x=x.vertexColors[1].getStyle(),F===x)W(F);
else{try{var ea=a.createLinearGradient(t.positionScreen.x,t.positionScreen.y,p.positionScreen.x,p.positionScreen.y);ea.addColorStop(0,F);ea.addColorStop(1,x)}catch(ja){ea=F}W(ea)}a.stroke();z.expandByScalar(2*P.linewidth)}else P instanceof THREE.LineDashedMaterial&&(J(P.linewidth),v(P.linecap),K(P.linejoin),W(P.color.getStyle()),y([P.dashSize,P.gapSize]),a.stroke(),z.expandByScalar(2*P.linewidth),y([]))}else if(F instanceof THREE.RenderableFace){C=F.v1;L=F.v2;A=F.v3;if(-1>C.positionScreen.z||1<C.positionScreen.z)continue;
if(-1>L.positionScreen.z||1<L.positionScreen.z)continue;if(-1>A.positionScreen.z||1<A.positionScreen.z)continue;C.positionScreen.x*=B;C.positionScreen.y*=n;L.positionScreen.x*=B;L.positionScreen.y*=n;A.positionScreen.x*=B;A.positionScreen.y*=n;0<D.overdraw&&(b(C.positionScreen,L.positionScreen,D.overdraw),b(L.positionScreen,A.positionScreen,D.overdraw),b(A.positionScreen,C.positionScreen,D.overdraw));z.setFromPoints([C.positionScreen,L.positionScreen,A.positionScreen]);if(!0===la.isIntersectionBox(z)){p=
C;x=L;P=A;t=D;X.info.render.vertices+=3;X.info.render.faces++;r(t.opacity);ca(t.blending);wa=p.positionScreen.x;ra=p.positionScreen.y;xa=x.positionScreen.x;g=x.positionScreen.y;m=P.positionScreen.x;va=P.positionScreen.y;var D=wa,H=ra,w=xa,G=g,M=m,ua=va;a.beginPath();a.moveTo(D,H);a.lineTo(w,G);a.lineTo(M,ua);a.closePath();if((t instanceof THREE.MeshLambertMaterial||t instanceof THREE.MeshPhongMaterial)&&null===t.map){ya.copy(t.color);za.copy(t.emissive);t.vertexColors===THREE.FaceColors&&ya.multiply(F.color);
u.copy(d);l.copy(p.positionWorld).add(x.positionWorld).add(P.positionWorld).divideScalar(3);p=l;x=F.normalModel;P=u;F=0;for(D=ga.length;F<D;F++)H=ga[F],ha.copy(H.color),H instanceof THREE.DirectionalLight?(w=ma.setFromMatrixPosition(H.matrixWorld).normalize(),G=x.dot(w),0>=G||(G*=H.intensity,P.add(ha.multiplyScalar(G)))):H instanceof THREE.PointLight&&(w=ma.setFromMatrixPosition(H.matrixWorld),G=x.dot(ma.subVectors(w,p).normalize()),0>=G||(G*=0==H.distance?1:1-Math.min(p.distanceTo(w)/H.distance,
1),0!=G&&(G*=H.intensity,P.add(ha.multiplyScalar(G)))));u.multiply(ya).add(za);!0===t.wireframe?f(u,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):k(u)}else t instanceof THREE.MeshBasicMaterial||t instanceof THREE.MeshLambertMaterial||t instanceof THREE.MeshPhongMaterial?null!==t.map?t.map.mapping===THREE.UVMapping&&(U=F.uvs,q(wa,ra,xa,g,m,va,U[0].x,U[0].y,U[1].x,U[1].y,U[2].x,U[2].y,t.map)):null!==t.envMap?t.envMap.mapping===THREE.SphericalReflectionMapping&&(N.copy(F.vertexNormalsModel[0]).applyMatrix3(pa),
R=.5*N.x+.5,Aa=.5*N.y+.5,N.copy(F.vertexNormalsModel[1]).applyMatrix3(pa),V=.5*N.x+.5,Ba=.5*N.y+.5,N.copy(F.vertexNormalsModel[2]).applyMatrix3(pa),ia=.5*N.x+.5,na=.5*N.y+.5,q(wa,ra,xa,g,m,va,R,Aa,V,Ba,ia,na,t.envMap)):(u.copy(t.color),t.vertexColors===THREE.FaceColors&&u.multiply(F.color),!0===t.wireframe?f(u,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):k(u)):(t instanceof THREE.MeshDepthMaterial?u.r=u.g=u.b=1-qa(p.positionScreen.z*p.positionScreen.w,ta.near,ta.far):t instanceof THREE.MeshNormalMaterial?
(N.copy(F.normalModel).applyMatrix3(pa),u.setRGB(N.x,N.y,N.z).multiplyScalar(.5).addScalar(.5)):u.setRGB(1,1,1),!0===t.wireframe?f(u,t.wireframeLinewidth,t.wireframeLinecap,t.wireframeLinejoin):k(u))}}I.union(z)}}a.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld);this.positionScreen.copy(e.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function e(){if(K===O){var a=new THREE.RenderableVertex;W.push(a);O++;K++;return a}return W[K++]}function f(){if(qa===sa){var a=new THREE.RenderableFace;X.push(a);sa++;qa++;return a}return X[qa++]}function k(){if(ga===M){var a=new THREE.RenderableLine;fa.push(a);M++;ga++;return a}return fa[ga++]}function s(){if(ka===n){var a=new THREE.RenderableSprite;B.push(a);n++;ka++;return a}return B[ka++]}function c(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function q(a,
b){var c=0,k=1,h=a.z+a.w,g=b.z+b.w,e=-a.z+a.w,f=-b.z+b.w;if(0<=h&&0<=g&&0<=e&&0<=f)return!0;if(0>h&&0>g||0>e&&0>f)return!1;0>h?c=Math.max(c,h/(h-g)):0>g&&(k=Math.min(k,h/(h-g)));0>e?c=Math.max(c,e/(e-f)):0>f&&(k=Math.min(k,e/(e-f)));if(k<c)return!1;a.lerp(b,c);b.lerp(a,1-k);return!0}var b,r,ca=[],J=0,v,K,W=[],O=0,y,qa,X=[],sa=0,Y,ga,fa=[],M=0,aa,ka,B=[],n=0,Z={objects:[],lights:[],elements:[]},Q=new THREE.Vector3,oa=new THREE.Vector3,da=new THREE.Vector3,x=new THREE.Vector3,a=new THREE.Vector4,T=
new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),G=new THREE.Box3,p=Array(3),D=new THREE.Matrix4,h=new THREE.Matrix4,w,H=new THREE.Matrix4,ea=new THREE.Matrix3,ua=new THREE.Frustum,ja=new THREE.Vector4,ta=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=
function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var C=new function(){var a=[],b=[],c=null,s=null,q=new THREE.Matrix3,g=function(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(w);c.copy(b).applyMatrix4(h);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z},m=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;p[0]=a.positionScreen;p[1]=b.positionScreen;p[2]=c.positionScreen;
return T.isIntersectionBox(G.setFromPoints(p))},r=function(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(h){c=h;s=c.material;q.getNormalMatrix(c.matrixWorld);a.length=0;b.length=0},projectVertex:g,checkTriangleVisibility:m,checkBackfaceCulling:r,pushVertex:function(a,b,c){v=e();v.position.set(a,b,c);g(v)},pushNormal:function(b,c,h){a.push(b,c,
h)},pushUv:function(a,c){b.push(a,c)},pushLine:function(a,b){var h=W[a],e=W[b];Y=k();Y.id=c.id;Y.v1.copy(h);Y.v2.copy(e);Y.z=(h.positionScreen.z+e.positionScreen.z)/2;Y.material=c.material;Z.elements.push(Y)},pushTriangle:function(h,e,k){var g=W[h],p=W[e],T=W[k];if(!1!==m(g,p,T)&&(s.side===THREE.DoubleSide||!0===r(g,p,T))){y=f();y.id=c.id;y.v1.copy(g);y.v2.copy(p);y.v3.copy(T);y.z=(g.positionScreen.z+p.positionScreen.z+T.positionScreen.z)/3;for(g=0;3>g;g++)p=3*arguments[g],T=y.vertexNormalsModel[g],
T.set(a[p],a[p+1],a[p+2]),T.applyMatrix3(q).normalize(),p=2*arguments[g],y.uvs[g].set(b[p],b[p+1]);y.vertexNormalsLength=3;y.material=c.material;Z.elements.push(y)}}}};this.projectScene=function(p,T,G,B){ka=ga=qa=0;Z.elements.length=0;!0===p.autoUpdate&&p.updateMatrixWorld();void 0===T.parent&&T.updateMatrixWorld();D.copy(T.matrixWorldInverse.getInverse(T.matrixWorld));h.multiplyMatrices(T.projectionMatrix,D);ua.setFromMatrix(h);r=0;Z.objects.length=0;Z.lights.length=0;p.traverseVisible(function(l){if(l instanceof
THREE.Light)Z.lights.push(l);else if((l instanceof THREE.Mesh||l instanceof THREE.Line||l instanceof THREE.Sprite)&&!1!==l.material.visible&&(!1===l.frustumCulled||!0===ua.intersectsObject(l))){if(r===J){var a=new THREE.RenderableObject;ca.push(a);J++;r++;b=a}else b=ca[r++];b.id=l.id;b.object=l;x.setFromMatrixPosition(l.matrixWorld);x.applyProjection(h);b.z=x.z;Z.objects.push(b)}});!0===G&&Z.objects.sort(c);p=0;for(G=Z.objects.length;p<G;p++){var n=Z.objects[p].object,g=n.geometry;C.setObject(n);
w=n.matrixWorld;K=0;if(n instanceof THREE.Mesh)if(g instanceof THREE.BufferGeometry){var m=g.attributes,n=g.offsets;if(void 0!==m.position){for(var v=m.position.array,g=0,u=v.length;g<u;g+=3)C.pushVertex(v[g],v[g+1],v[g+2]);if(void 0!==m.normal)for(var O=m.normal.array,g=0,u=O.length;g<u;g+=3)C.pushNormal(O[g],O[g+1],O[g+2]);if(void 0!==m.uv)for(O=m.uv.array,g=0,u=O.length;g<u;g+=2)C.pushUv(O[g],O[g+1]);if(void 0!==m.index)if(m=m.index.array,0<n.length)for(p=0;p<n.length;p++)for(u=n[p],v=u.index,
g=u.start,u=u.start+u.count;g<u;g+=3)C.pushTriangle(m[g]+v,m[g+1]+v,m[g+2]+v);else for(g=0,u=m.length;g<u;g+=3)C.pushTriangle(m[g],m[g+1],m[g+2]);else for(g=0,u=v.length/3;g<u;g+=3)C.pushTriangle(g,g+1,g+2)}}else{if(g instanceof THREE.Geometry){var M=g.vertices,u=g.faces,m=g.faceVertexUvs[0];ea.getNormalMatrix(w);for(var v=n.material instanceof THREE.MeshFaceMaterial,O=!0===v?n.material:null,ha=0,E=M.length;ha<E;ha++){var U=M[ha];C.pushVertex(U.x,U.y,U.z)}M=0;for(ha=u.length;M<ha;M++){var E=u[M],
R=!0===v?O.materials[E.materialIndex]:n.material;if(void 0!==R){var X=R.side,U=W[E.a],V=W[E.b],fa=W[E.c];if(!0===R.morphTargets){var ia=g.morphTargets,na=n.morphTargetInfluences,la=U.position,I=V.position,z=fa.position;Q.set(0,0,0);oa.set(0,0,0);da.set(0,0,0);for(var d=0,S=ia.length;d<S;d++){var ba=na[d];if(0!==ba){var ma=ia[d].vertices;Q.x+=(ma[E.a].x-la.x)*ba;Q.y+=(ma[E.a].y-la.y)*ba;Q.z+=(ma[E.a].z-la.z)*ba;oa.x+=(ma[E.b].x-I.x)*ba;oa.y+=(ma[E.b].y-I.y)*ba;oa.z+=(ma[E.b].z-I.z)*ba;da.x+=(ma[E.c].x-
z.x)*ba;da.y+=(ma[E.c].y-z.y)*ba;da.z+=(ma[E.c].z-z.z)*ba}}U.position.add(Q);V.position.add(oa);fa.position.add(da);C.projectVertex(U);C.projectVertex(V);C.projectVertex(fa)}if(!1!==C.checkTriangleVisibility(U,V,fa)){ia=C.checkBackfaceCulling(U,V,fa);if(X!==THREE.DoubleSide){if(X===THREE.FrontSide&&!1===ia)continue;if(X===THREE.BackSide&&!0===ia)continue}y=f();y.id=n.id;y.v1.copy(U);y.v2.copy(V);y.v3.copy(fa);y.normalModel.copy(E.normal);!1!==ia||X!==THREE.BackSide&&X!==THREE.DoubleSide||y.normalModel.negate();
y.normalModel.applyMatrix3(ea).normalize();na=E.vertexNormals;la=0;for(I=Math.min(na.length,3);la<I;la++)z=y.vertexNormalsModel[la],z.copy(na[la]),!1!==ia||X!==THREE.BackSide&&X!==THREE.DoubleSide||z.negate(),z.applyMatrix3(ea).normalize();y.vertexNormalsLength=na.length;X=m[M];if(void 0!==X)for(ia=0;3>ia;ia++)y.uvs[ia].copy(X[ia]);y.color=E.color;y.material=R;y.z=(U.positionScreen.z+V.positionScreen.z+fa.positionScreen.z)/3;Z.elements.push(y)}}}}}else if(n instanceof THREE.Line)if(g instanceof THREE.BufferGeometry){if(m=
g.attributes,void 0!==m.position){v=m.position.array;g=0;for(u=v.length;g<u;g+=3)C.pushVertex(v[g],v[g+1],v[g+2]);if(void 0!==m.index)for(m=m.index.array,g=0,u=m.length;g<u;g+=2)C.pushLine(m[g],m[g+1]);else for(m=n.mode===THREE.LinePieces?2:1,g=0,u=v.length/3-1;g<u;g+=m)C.pushLine(g,g+1)}}else{if(g instanceof THREE.Geometry&&(H.multiplyMatrices(h,w),M=n.geometry.vertices,0!==M.length))for(U=e(),U.positionScreen.copy(M[0]).applyMatrix4(H),m=n.mode===THREE.LinePieces?2:1,ha=1,E=M.length;ha<E;ha++)U=
e(),U.positionScreen.copy(M[ha]).applyMatrix4(H),0<(ha+1)%m||(V=W[K-2],ja.copy(U.positionScreen),ta.copy(V.positionScreen),!0===q(ja,ta)&&(ja.multiplyScalar(1/ja.w),ta.multiplyScalar(1/ta.w),Y=k(),Y.id=n.id,Y.v1.positionScreen.copy(ja),Y.v2.positionScreen.copy(ta),Y.z=Math.max(ja.z,ta.z),Y.material=n.material,n.material.vertexColors===THREE.VertexColors&&(Y.vertexColors[0].copy(n.geometry.colors[ha]),Y.vertexColors[1].copy(n.geometry.colors[ha-1])),Z.elements.push(Y)))}else n instanceof THREE.Sprite&&
(a.set(w.elements[12],w.elements[13],w.elements[14],1),a.applyMatrix4(h),g=1/a.w,a.z*=g,-1<=a.z&&1>=a.z&&(aa=s(),aa.id=n.id,aa.x=a.x*g,aa.y=a.y*g,aa.z=a.z,aa.object=n,aa.rotation=n.rotation,aa.scale.x=n.scale.x*Math.abs(aa.x-(a.x+T.projectionMatrix.elements[0])/(a.w+T.projectionMatrix.elements[12])),aa.scale.y=n.scale.y*Math.abs(aa.y-(a.y+T.projectionMatrix.elements[5])/(a.w+T.projectionMatrix.elements[13])),aa.material=n.material,Z.elements.push(aa)))}!0===B&&Z.elements.sort(c);return Z}};
THREE.OrbitControls=function(e,f,k){function s(a){if(!1!==b.enabled){a.preventDefault();var c=b.domElement===document?b.domElement.body:b.domElement;if(n===B.ROTATE){if(!0===b.noRotate)return;ca.set(a.clientX,a.clientY);J.subVectors(ca,r);b.rotateLeft(2*Math.PI*J.x/c.clientWidth*b.rotateSpeed);b.rotateUp(2*Math.PI*J.y/c.clientHeight*b.rotateSpeed);r.copy(ca)}else if(n===B.DOLLY){if(!0===b.noZoom)return;X.set(a.clientX,a.clientY);sa.subVectors(X,qa);0<sa.y?b.dollyIn():b.dollyOut();qa.copy(X)}else if(n===
B.PAN){if(!0===b.noPan)return;K.set(a.clientX,a.clientY);W.subVectors(K,v);b.panXZ(W.x*b.panSpeed,-W.y*b.panSpeed);v.copy(K)}b.update()}}function c(){!1!==b.enabled&&(document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",c,!1),b.dispatchEvent(x),n=B.NONE)}function q(a){if(!1!==b.enabled&&!0!==b.noZoom){a.preventDefault();a.stopPropagation();var c=0;void 0!==a.wheelDelta?c=a.wheelDelta:void 0!==a.detail&&(c=-a.detail);0<c?b.dollyOut():b.dollyIn();b.update();b.dispatchEvent(da);
b.dispatchEvent(x)}}this.settings=k;this.object=e;this.domElement=void 0!==f?f:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.panSpeed=.3;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,
BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var b=this,r=new THREE.Vector2,ca=new THREE.Vector2,J=new THREE.Vector2,v=new THREE.Vector2,K=new THREE.Vector2,W=new THREE.Vector2,O=new THREE.Vector3,y=new THREE.Vector3,qa=new THREE.Vector2,X=new THREE.Vector2,sa=new THREE.Vector2,Y=0,ga=0,fa=1,M=new THREE.Vector3,aa=new THREE.Vector3,ka=new THREE.Quaternion,B={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},n=B.NONE;this.target0=
this.target.clone();this.position0=this.object.position.clone();var Z=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),Q=Z.clone().inverse(),oa={type:"change"},da={type:"start"},x={type:"end"};this.rotateLeft=function(a){void 0===a&&(a=2*Math.PI/60/60*b.autoRotateSpeed);ga-=a};this.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*b.autoRotateSpeed);Y-=a};this.panLeft=function(a){var b=this.object.matrix.elements;O.set(b[0],b[1],b[2]);O.multiplyScalar(-a);M.add(O)};this.panUp=
function(a){var b=this.object.matrix.elements;O.set(b[4],b[5],b[6]);O.multiplyScalar(a);M.add(O)};this.panForward=function(a){var b=this.object.matrix.elements;O.set(b[8],b[9],b[10]);O.multiplyScalar(a);M.add(O)};this.pan=function(a,c){var e=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var k=b.object.position.clone().sub(b.target).length(),k=k*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*k/e.clientHeight);b.panUp(2*c*k/e.clientHeight)}else void 0!==b.object.top?
(b.panLeft(a*(b.object.right-b.object.left)/e.clientWidth),b.panUp(c*(b.object.top-b.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(a,c){var e=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var k=b.object.position.clone().sub(b.target).length(),k=k*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*k/e.clientHeight);b.panForward(2*c*k/e.clientHeight)}else void 0!==b.object.top?
(b.panLeft(a*(b.object.right-b.object.left)/e.clientWidth),b.panForward(c*(b.object.top-b.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));fa/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));fa*=a};this.update=function(){var a=this.object.position,c=this.settings&&this.settings.cameraAsOrbitCenter?a:this.target,e=this.settings&&this.settings.cameraAsOrbitCenter?
this.target:a;y.copy(a).sub(this.target);y.applyQuaternion(Z);var a=Math.atan2(y.x,y.z),k=Math.atan2(Math.sqrt(y.x*y.x+y.z*y.z),y.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*b.autoRotateSpeed);var a=a+ga,k=k+Y,a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,a)),k=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,k)),k=Math.max(1E-6,Math.min(Math.PI-1E-6,k)),f=this.settings&&this.settings.cameraAsOrbitCenter?5E3*fa*this.settings.boxScale:y.length()*fa,f=Math.max(this.minDistance,
Math.min(this.maxDistance,f));c.add(M);y.x=f*Math.sin(k)*Math.sin(a);y.y=f*Math.cos(k);y.z=f*Math.sin(k)*Math.cos(a);y.applyQuaternion(Q);this.settings&&this.settings.cameraAsOrbitCenter?e.copy(c).sub(y):e.copy(c).add(y);this.object.lookAt(this.target);Y=ga=0;fa=1;M.set(0,0,0);if(1E-6<aa.distanceToSquared(c)||1E-6<8*(1-ka.dot(this.object.quaternion)))this.dispatchEvent(oa),aa.copy(c),ka.copy(this.object.quaternion)};this.reset=function(){n=B.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);
this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){if(!1!==b.enabled){a.preventDefault();if(a.button===b.mouseButtons.ORBIT){if(!0===b.noRotate)return;n=B.ROTATE;r.set(a.clientX,a.clientY)}else if(a.button===b.mouseButtons.ZOOM){if(!0===b.noZoom)return;n=B.DOLLY;qa.set(a.clientX,a.clientY)}else if(a.button===b.mouseButtons.PAN){if(!0===b.noPan)return;n=B.PAN;v.set(a.clientX,a.clientY)}document.addEventListener("mousemove",
s,!1);document.addEventListener("mouseup",c,!1);b.dispatchEvent(da)}},!1);this.domElement.addEventListener("mousewheel",q,!1);this.domElement.addEventListener("DOMMouseScroll",q,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==b.enabled){switch(a.touches.length){case 1:if(!0===b.noRotate)return;n=B.TOUCH_ROTATE;r.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(!0===b.noZoom)return;n=B.TOUCH_DOLLY;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;
c=Math.sqrt(c*c+a*a);qa.set(0,c);break;case 3:if(!0===b.noPan)return;n=B.TOUCH_PAN;v.set(a.touches[0].pageX,a.touches[0].pageY);break;default:n=B.NONE}b.dispatchEvent(da)}},!1);this.domElement.addEventListener("touchend",function(){!1!==b.enabled&&(b.dispatchEvent(x),n=B.NONE)},!1);this.domElement.addEventListener("touchmove",function(a){if(!1!==b.enabled){a.preventDefault();a.stopPropagation();var c=b.domElement===document?b.domElement.body:b.domElement;switch(a.touches.length){case 1:if(!0===b.noRotate)break;
if(n!==B.TOUCH_ROTATE)break;ca.set(a.touches[0].pageX,a.touches[0].pageY);J.subVectors(ca,r);b.rotateLeft(2*Math.PI*J.x/c.clientWidth*b.rotateSpeed);b.rotateUp(2*Math.PI*J.y/c.clientHeight*b.rotateSpeed);r.copy(ca);b.update();break;case 2:if(!0===b.noZoom)break;if(n!==B.TOUCH_DOLLY)break;c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;a=Math.sqrt(c*c+a*a);X.set(0,a);sa.subVectors(X,qa);0<sa.y?b.dollyOut():b.dollyIn();qa.copy(X);b.update();break;case 3:if(!0===b.noPan)break;
if(n!==B.TOUCH_PAN)break;K.set(a.touches[0].pageX,a.touches[0].pageY);W.subVectors(K,v);b.panXZ(W.x*b.panSpeed,-W.y*b.panSpeed);v.copy(K);b.update();break;default:n=B.NONE}}},!1);window.addEventListener("keydown",function(a){if(!1!==b.enabled&&!0!==b.noKeys&&!0!==b.noPan)switch(a.keyCode){case b.keys.UP:b.pan(0,b.keyPanSpeed);b.update();break;case b.keys.FORWARD:b.panXZ(0,-b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:b.pan(0,-b.keyPanSpeed);b.update();break;case b.keys.BACKWARD:b.panXZ(0,b.keyPanSpeed);
b.update();break;case b.keys.LEFT:b.pan(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:b.pan(-b.keyPanSpeed,0);b.update();break;case b.keys.DOLLY_IN:if(!0===b.noZoom)break;b.dollyIn();b.update();break;case b.keys.DOLLY_OUT:if(!0===b.noZoom)break;b.dollyOut();b.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(f){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");e.id="webgl-error-message";e.style.fontFamily="monospace";e.style.fontSize="13px";e.style.fontWeight="normal";
e.style.textAlign="center";e.style.background="#fff";e.style.color="#000";e.style.padding="1.5em";e.style.width="400px";e.style.margin="5em auto 0";this.webgl||(e.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return e},addGetWebGLMessage:function(e){var f,k;e=e||{};f=void 0!==e.parent?e.parent:document.body;e=void 0!==e.id?e.id:"oldie";k=Detector.getWebGLErrorMessage();k.id=e;f.appendChild(k)}};"object"===typeof module&&(module.exports=Detector);
(function(e,f,k,s){var c=function(c){this.domParent="object"===typeof c?c:f.body};c.prototype.init=function(c,b,r,ca,J,v){e.requestAnimationFrame||(e.requestAnimationFrame=function(){return e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(b,c){e.setTimeout(b,1E3/60)}}());this.domParent===f.body&&(this.WINDOW_WIDTH=e.innerWidth,this.WINDOW_HEIGHT=e.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,e.addEventListener("resize",c,!1));this.renderType=s.webgl?"webgl":"canvas";this.renderer=r||(s.webgl?new k.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new k.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=ca||new k.Scene;this.camera=J||new k.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
v?this.controls=v:(this.controls=new k.OrbitControls(this.camera,this.renderer.domElement,{cameraAsOrbitCenter:!0}),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.keyPanSpeed=10,this.controls.panSpeed=1,this.controls.noZoom=!0,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:81,BOTTOM:69},this.controls.mouseButtons={ORBIT:k.MOUSE.MIDDLE,PAN:k.MOUSE.RIGHT});this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top=
"0px";this.stats.domElement.style.zIndex="999";f.body.appendChild(this.stats.domElement);b()};e.Base=c;"object"===typeof module&&(module.exports=c)})(window,document,THREE,Detector);
(function(){function e(k){return k.charAt(0).toUpperCase()+k.slice(1)}var f={Animation:{bubble:function(k,e){var c=$('<div class="alert alert-info alert-vp fade"></div>').appendTo(k);c.text(e);c.finish().fadeTo(200,1).delay(2500).fadeTo(100,0,function(){$(this).remove()})}}};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(k){var e=0;for(k=k.length;e<k;e++);};f.map={};f.Sidebar=function(k,e){_Container.call(this);var c=this.setting=
f.Utils.settingMixin({align:"r",width:320},k),q="sidebar",q=c.align&&"r"!==c.align?q+" sidebar-left":q+" sidebar-right";this.domElement.className=q;c.id&&(this.domElement.id=c.id,f.map[c.id]=this);this.domElement.style.width=c.width.toString()+"px";c.overflow&&(this.domElement.style.overflow=c.overflow.toString());e.appendChild(this.domElement);f.Utils.domCreationDirector(c.children,this.domElement)};f.Sidebar.prototype=Object.create(_Container.prototype);f.Panel=function(e,s){_Container.call(this);
var c=this.setting=f.Utils.settingMixin({title:""},e);c.id&&(this.domElement.id=c.id,f.map[c.id]=this);var q=this.domElement;q.className="panel panel-tool";s.appendChild(q);var b=document.createElement("div");b.className="panel-heading";q.appendChild(b);var r=document.createTextNode(c.title);b.appendChild(r);b=document.createElement("div");b.className="panel-body";c.overflow&&(b.style.overflow=c.overflow.toString());q.appendChild(b);f.Utils.domCreationDirector(c.children,b)};f.Panel.prototype=Object.create(_Container.prototype);
f.Toolbar=function(e,s){_Container.call(this);var c=this.setting=f.Utils.settingMixin({title:""},e);c.id&&(this.domElement.id=c.id,f.map[c.id]=this);var q=this.domElement;q.className="btn-toolbar";s.appendChild(q);f.Utils.domCreationDirector(c.children,q)};f.Toolbar.prototype=Object.create(_Container.prototype);f.ButtonGroup=function(e,s){_Container.call(this);var c=this.setting=f.Utils.settingMixin({title:"",buttonType:"radio"},e);c.id&&(this.domElement.id=c.id,f.map[c.id]=this);var q=this.domElement;
q.className="btn-group"+(c.appendClass?" "+c.appendClass:"");"button"!==c.buttonType.toLowerCase()&&q.setAttribute("data-toggle","buttons");q.title=c.title;s.appendChild(q);var b=c.buttons;switch(c.buttonType.toLowerCase()){default:case "radio":for(var r=0,ca=b.length;r<ca;r++){var J=document.createElement("label");J.className="btn btn-tool"+(b[r].checked?" active":"");b[r].height&&(J.style.height=b[r].height+"px");b[r].width&&(J.style.width=b[r].width+"px");if(b[r].bgType&&b[r].bgTypeData){var v;
switch(b[r].bgType){case "color":v=b[r].bgTypeData;J.className+=" btn-color";break;case "image":v="url("+b[r].bgTypeData+") no-repeat 50% 50%";J.className+=" btn-image";break;default:return}J.style.background=v}q.appendChild(J);var K=document.createElement("input");b[r].checked&&K.setAttribute("checked","");K.type=c.buttonType;K.name=c.name;K.id=b[r].id;K.value=r;K.autocomplete="off";J.appendChild(K);v=document.createTextNode(b[r].title);J.appendChild(v)}break;case "button":for(r=0,ca=b.length;r<
ca;r++){K=document.createElement("button");K.className="btn btn-tool";K.id=b[r].id;K.name=c.name;b[r].height&&(K.style.height=b[r].height+"px");b[r].width&&(K.style.width=b[r].width+"px");if(b[r].bgType&&b[r].bgTypeData){switch(b[r].bgType){case "color":v=b[r].bgTypeData;J.className+=" btn-color";break;case "image":v="url("+b[r].bgTypeData+") no-repeat 50% 50%";J.className+=" btn-image";break;default:return}K.style.background=v}q.appendChild(K);v=document.createTextNode(b[r].title);K.appendChild(v)}}f.Utils.domCreationDirector(c.children,
this.domElement)};f.ButtonGroup.prototype=Object.create(_Container.prototype);f.ButtonGroup.prototype.addButton=function(e,f){f||this.setting.buttons.push(e);var c=document.createElement("label");c.className="btn btn-tool"+(e.checked?" active":"");e.height&&(c.style.height=e.height+"px");e.width&&(c.style.width=e.width+"px");if(e.bgType&&e.bgTypeData){var q;switch(e.bgType){case "color":q=e.bgTypeData;c.className+=" btn-color";break;case "image":q="url("+e.bgTypeData+") no-repeat 50% 50%";c.className+=
" btn-image";break;default:return}c.style.background=q}this.domElement.appendChild(c);q=document.createElement("input");e.checked&&q.setAttribute("checked","");q.type=this.setting.buttonType;q.name=this.setting.name;q.id=e.id;q.value=this.setting.buttons.length-1;q.autocomplete="off";c.appendChild(q);q=document.createTextNode(e.title);c.appendChild(q);return c};f.ButtonGroup.prototype.addButtons=function(e,f){for(var c=0,q=e.length;c<q;c++)this.addButton(e[c],f)};f.Utils={};f.Utils.settingMixin=function(e,
f){if("object"===typeof e&&"object"===typeof f){var c={},q;for(q in e)c[q]=e[q];for(var b in f)void 0!==f[b]&&(c[b]=f[b]);return c}return e};f.Utils.domCreationDirector=function(k,s){if(k)if(k instanceof Array)for(var c=0,q=k.length;c<q;c++)f.Utils.domCreationDirector(k[c],s?s:document.body);else k instanceof Object&&k.UIType&&f[e(k.UIType)]&&new (f[e(k.UIType)])(k,s?s:document.body)};window.GoUI=f;"object"===typeof module&&(module.exports=f)})();
var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
AV.initialize("i5m1bad33f8bm725g0lan5wd8hhc1c4qhyz3cyq4b0qoyvja","2w44ugxt0z512vitlk5in4c4a95acbyj8qiqlgcuh3p9xm5t");
(function(e,f,k,s,c){var q,b;function r(l){var a=m.textures+(l?-1:1),a=f.getElementById("texture"+a);if(!a&&(a=l?ra.length-1:0,a=f.getElementById("texture"+a),!a))return;l=a.parentElement.className.indexOf("btn-color");var c=a.parentElement.className.indexOf("btn-image");-1<l?(q=Number(a.value),f.getElementById("colorTexture").parentElement.click()):-1<c&&(b=Number(a.value),f.getElementById("imageTexture").parentElement.click())}function ca(a,b){var c=b.clone(),d;for(d in a)c[d]=a[d];return c}function J(a){if(null==
a.pageX&&null!=a.clientX){var b=f.documentElement,c=f.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}ia.set(a.pageX/h.WINDOW_WIDTH*2-1,2*-(a.pageY/h.WINDOW_HEIGHT)+1);la.setFromCamera(ia,h.camera);return la.intersectObjects(U)}function v(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(w.width).floor().multiplyScalar(w.width).addScalar(w.width/
2))}function K(a){0<a.length&&v(E,a[0])}function W(a,b){a&&a.then(function(a){$("#openModal .modal-body #myBox").html("");for(var b=0,l=a.length;b<l;b++)$("#openModal .modal-body #myBox").append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="boxData'+b+'" value="'+a[b].id+'" autocomplete="off">  <label id="boxDataLabel'+b+'"></label></label>'),$("#openModal .modal-body #boxDataLabel"+b).text(a[b].get("name"));$("#openModal").modal("show")});b&&b.then(function(a){$("#openModal .modal-body #myKeep").html("");
for(var b=0,l=a.length;b<l;b++)$("#openModal .modal-body #myKeep").append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="boxData'+b+'" value="'+a[b].get("box").id+'" autocomplete="off">  <label id="boxDataLabel'+b+'"></label></label>'),$("#openModal .modal-body #boxDataLabel"+b).text(a[b].get("box").get("name"));$("#openModal").modal("show")})}function O(a,b,c,d){a=a||J(event);if(0<a.length){a=a[0];var e=m.toolsType,f=!1,g=U.length;if(g&&a.object!==ja)for(var k=g-1;0<k&&
k>g-1-3;k--)if(a.object===U[k]){f=!0;break}0===e?!0===f&&!1===b||!1===f&&!0===b||(b=ba.draw(0,va,void 0,a),d?S.appendObjectToCurrentAction("draw",b):S.addAction("draw",b),h.renderer.render(h.scene,h.camera)):1===e&&c&&a.object!==ja&&(b=ba.erase(a.object),d?S.appendObjectToCurrentAction("erase",b):S.addAction("erase",b))}}function y(){AV.User.current()&&a&&a.get("user")&&AV.User.current().id!==a.get("user").id||(d.save(d.storageKeys.localChanges,S.changed),d.save(d.storageKeys.camera),d.save(d.storageKeys.sidebar),
d.save())}function qa(b){0!==C||AV.User.current()&&a&&a.get("user")&&AV.User.current().id!==a.get("user").id||("0"===S.changed||1>R.length&&(!a||a&&!a.id)||!AV.User.current?(d.save(d.storageKeys.camera),d.save(d.storageKeys.sidebar),d.save()):confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&m.save())}function X(b){C=1;AV.User.current()&&a&&a.get("user")&&AV.User.current().id!==a.get("user").id||("0"===S.changed||1>R.length&&(!a||a&&!a.id)?(d.save(d.storageKeys.localChanges,S.changed),
d.save(d.storageKeys.camera),d.save(d.storageKeys.sidebar),d.save()):confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&m.save())}function sa(a){a.preventDefault();var b;if(1===na[0])try{1===ma?ma=0:(ma=1,b=J(a),O(b,a.ctrlKey,a.ctrlKey,!0))}catch(c){console.warn("draw/erase failed")}finally{ma=0}else b=m.toolsType,1===b?E.visible&&(E.visible=!1):(!E.visible&&g&&(E.visible=!0),b=J(a),K(b))}function Y(a){a.preventDefault();switch(a.button){case 0:if(!z.endFlag){z.instantComplete(z.loadBoxAnimation);
break}na[0]=1;a=J(a);O(a,void 0,!0,!1);0===m.toolsType&&K(a);break;case 1:na[1]=1;break;case 2:na[2]=1}}function ga(a){if("label"===this.nodeName.toLowerCase())switch(a=this.getElementsByTagName("input")[0],m[a.name]=Number(a.value),a.name){case "toolsType":1===Number(a.value)?E.visible&&(E.visible=!1):!E.visible&&g&&(E.visible=!0);break;case "textures":va=m[a.name];u=ra[va];ya=u.data;za=u.helperData=ra[m[a.name]].helperData||ca(wa,ya);E.material=za;f.getElementById("cube").parentElement.click();
switch(m.texturesType){case 0:b=a.value;break;default:case 1:q=a.value}break;case "sidebarResize":var c=GoUI.map.sidebar.domElement;"0"===a.value?$(c).animate({top:"0",height:"100%"}):$(c).animate({top:"60%",height:"40%"});break;case "texturesType":a=a.id,"imageTexture"===a?($(".btn-color").hide(),$(".btn-image").show(),f.getElementById("texture"+b).parentElement.click()):"colorTexture"===a&&($(".btn-color").show(),$(".btn-image").hide(),f.getElementById("texture"+q).parentElement.click())}else if(("button"===
this.type||"button"===this.nodeName.toLowerCase())&&m[this.id])m[this.id]()}function fa(a){switch(a.button){case 0:na[0]=0;S.isCurrentActionAlive=!1;break;case 1:na[1]=0;break;case 2:na[2]=0}}function M(a){switch(a.keyCode){case 67:r();break;case 88:r(!0)}}function aa(a){if(!na[0])switch(a.keyCode){case 16:0===m.toolsType?f.getElementById("eraser").parentElement.click():1===m.toolsType&&f.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&S.undo();break;case 89:a.ctrlKey&&S.redo()}}
function ka(){requestAnimationFrame(ka);h.renderer.render(h.scene,h.camera);h.stats.update()}function B(){f.getElementById("openIt").removeEventListener("click",B,!1);"0"===S.changed||1>R.length&&(!a||a&&!a.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&m.save();var b=$("#openModal input[type=radio]:checked").val();b&&(new AV.Query(x)).get(b,{success:function(b){m.clearAll();S=new p;S.updateDom();a=b;d.loadCamera(b.get("camera"),!0);d.loadMeshes(b.get("meshes"),L,z.loadBoxAnimation,
!0);b.get("user").id===AV.User.current().id&&(d.save(d.storageKeys.localChanges,"0"),d.save(d.storageKeys.boxName,a.get("name")),d.save(d.storageKeys.boxId,a.id),d.save(d.storageKeys.updatedAt,a.updatedAt),d.save(d.storageKeys.camera),d.save(d.storageKeys.sidebar),d.save())}});$("#openModal").modal("hide")}function n(){f.getElementById("openIt").removeEventListener("click",n,!1);var a=$("#openModal input[type=radio]:checked").val();if(a){var b=new AV.Query(x);b.equalTo("objectId",a);b.select("shared");
b.first().then(function(b){if(!b.get("shared")){var c=new AV.ACL(AV.User.current());c.setPublicReadAccess(!0);b.setACL(c);b.set("shared",!0);b.save().then(function(){},function(){Q("\u5206\u4eab\u5931\u8d25")})}$("#shareLink").val("http://gonster.github.io/helloThreeJS/voxel-paint#"+a);Q("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")})}}function Z(a){a?($("#loginOpener").hide(),$("#logout").show(),$("#signInOpener").hide(),$("#loginMessage").html("\u4f60\u597d "+
AV.User.current().escape("username")),$("#loginMessage").show(),$("#open").removeAttr("disabled"),$("#newFile").removeAttr("disabled"),$("#share").removeAttr("disabled"),$("#delete").removeAttr("disabled"),$("#insert").removeAttr("disabled")):($("#loginOpener").show(),$("#logout").hide(),$("#signInOpener").show(),$("#loginMessage").hide(),$("#open").attr("disabled","disabled"),$("#newFile").attr("disabled","disabled"),$("#share").attr("disabled","disabled"),$("#delete").attr("disabled","disabled"),
$("#insert").attr("disabled","disabled"))}function Q(b){GoUI.Animation.bubble($("#bubble"),b);b=a.name||"\u672a\u547d\u540d";var c=("0"===S.changed?"\u672a\u4fee\u6539":"\u5df2\u4fee\u6539")+(a.id?" - \u4e91\u7aef\u5b58\u50a8":" - \u672c\u5730\u5b58\u50a8");$("#currentFileName").text("\u6587\u4ef6\u540d\uff1a"+b);$("#currentFileState").text("\u6587\u4ef6\u72b6\u6001\uff1a"+c)}var oa=!1,da=f.createElement("a");da.id="imageCapture";da.style.display="none";da.target="_blank";f.body.appendChild(da);var x=
AV.Object.extend("Box"),a=new x,T=AV.Object.extend("Keep");new T;c=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};c.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=z.currentMeshes;z.currentIterator<a.length?a[z.currentIterator].meshObject.visible=!0:(z.endFlag=!0,clearInterval(z.currentAnimationIntervalHandler));z.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=
0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=z.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var G=function(a){this.isLoadingBoxEnd=a};G.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar",boxId:"vp_box_id",updatedAt:"vp_updatedAt",boxName:"vp_box_name",localChanges:"vp_local_changes"},
load:function(a){return e.localStorage&&e.localStorage.getItem(a||this.storageKeys.meshes)},save:function(a,c){if(e.localStorage){var d="";if(c)d=c;else switch(a){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>S.currentActionIndex)return;for(var d=d+(w.width+":"),f=0,g=R.length;f<g;f++)d+=R[f].geo.id.replace("geo","")+",",d+=R[f].material.id.replace("texture","")+",",d+=R[f].meshObject.position.x+",",d+=R[f].meshObject.position.y+",",d+=R[f].meshObject.position.z+";";
break;case this.storageKeys.camera:d+=h.controls.target.x+","+h.controls.target.y+","+h.controls.target.z+";";d+=h.controls.object.position.x+","+h.controls.object.position.y+","+h.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=b+","+q+","+m.texturesType+","+m.sidebarResize}e.localStorage.setItem(a||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c,d){this.isLoadingBoxEnd=!1;var e=[],f=w.width;if(a=d?a:this.load(a))if(a=a.split(":"))2===a.length?(f=(Number(a[0])||50)/w.width,
e=a[1].split(";")):(f=50/w.width,e=a[0].split(";"));if(0<e.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=e.length;b<a;b++){var g=e[b].split(",");2<g.length&&ba.draw(Number(g[0]),Number(g[1]),[Number(g[2])/f,Number(g[3])/f,Number(g[4])/f])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=e.length;b<a;b++)g=e[b].split(","),2<g.length&&ba.draw(Number(g[0]),Number(g[1]),[Number(g[2])/f,Number(g[3])/f,Number(g[4])/f],void 0,void 0,!0);z.begin(c,R);d?Q("\u8f7d\u5165\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b"):
Q("\u8f7d\u5165\u672c\u5730\u6570\u636e\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b")}else Q("\u65e0\u672c\u5730\u6570\u636e\uff0c\u65b0\u5efa\u6587\u4ef6"),z.endFlag=!0},loadRemote:function(){if(e.localStorage){var b=this.load(this.storageKeys.boxId),c=this.load(this.storageKeys.updatedAt);if(b){Q("\u8f7d\u5165\u4e91\u7aef\u6587\u4ef6...");var f=new AV.Query(x);f.select("name","user");f.equalTo("objectId",b);f.first({success:function(b){if(b.updatedAt===c)a=
b,b.set("meshes",d.load(d.storageKeys.meshes)),b.set("camera",d.load(G.storageKeys.camera)),d.loadCamera(a.get("camera"),!0),d.loadMeshes(a.get("meshes"),L,z.loadBoxAnimation,!0),d.save(d.storageKeys.boxName,a.get("name")),S.changed=d.load(d.storageKeys.localChanges);else if(a=b,b.get("user").id===AV.User.current().id)if("0"===(S.changed=d.load(d.storageKeys.localChanges))){var l=new AV.Query(x);l.get(b.id,{success:function(b){a=b;d.loadCamera(a.get("camera"),!0);d.loadMeshes(a.get("meshes"),L,z.loadBoxAnimation,
!0);d.save(d.storageKeys.boxName,a.get("name"));d.save(d.storageKeys.updatedAt,a.updatedAt);d.save(d.storageKeys.camera);d.save()},error:function(a,c){b.set("meshes",d.load(d.storageKeys.meshes));b.set("camera",d.load(G.storageKeys.camera));d.loadMeshes(void 0,L,z.loadBoxAnimation)}})}else Q("\u7531\u4e8e\u672c\u5730\u6b64\u6587\u4ef6\u4e0e\u4e91\u7aef\u6587\u4ef6\u5728\u540c\u4e00\u6587\u4ef6\u7684\u57fa\u7840\u4e0a\u505a\u4e86\u4e0d\u540c\u7684\u6539\u52a8\uff0c\u5c06\u672c\u5730\u7248\u672c\u4e0e\u4e91\u7aef\u6b64\u6587\u4ef6\u89c6\u4e3a\u4e0d\u540c\u7684\u6587\u4ef6"),
a=new x,d.save(d.storageKeys.boxId,""),d.save(d.storageKeys.updatedAt,""),d.save(d.storageKeys.boxName,""),d.save(d.storageKeys.localChanges,"1"),this.changed=1,d.loadMeshes(void 0,L,z.loadBoxAnimation);else l=new AV.Query(x),l.get(b.id,{success:function(b){a=b;d.loadCamera(a.get("camera"),!0);d.loadMeshes(a.get("meshes"),L,z.loadBoxAnimation,!0)},error:function(a,b){d.loadMeshes(void 0,L,z.loadBoxAnimation)}})},error:function(a,b){Q("\u8f7d\u5165\u5931\u8d25\uff0c"+b.message);d.loadMeshes(void 0,
L,z.loadBoxAnimation)}})}else d.loadMeshes(void 0,L,z.loadBoxAnimation)}},loadShared:function(b,c){(new AV.Query(x)).get(b,{success:function(b){a=b;d.loadCamera(a.get("camera"),!0);d.loadMeshes(a.get("meshes"),L,z.loadBoxAnimation,!0);Q("\u5df2\u8f7d\u5165\u5206\u4eab\u6587\u4ef6")},error:function(a,b){c()}})},loadCamera:function(a,b){var c=[],d=b?a:this.load(a);d&&(c=d.split(";"));if(0<c.length){for(var d=0,e=c.length;d<e;d++){var f=c[d].split(",");switch(d){case 0:h.controls.target.set(Number(f[0])||
0,Number(f[1])||0,Number(f[2])||0);break;case 1:h.controls.object.position.set(Number(f[0])||0,Number(f[1])||0,Number(f[2])||0)}}h.controls.update()}},loadSidebarSelectedButtons:function(a,c){var d=[],e=c?a:this.load(a);e&&(d=e.split(","));if(0<d.length)for(var e=0,g=d.length;e<g;e++){var h=d[e];if(""!==h&&!isNaN(Number(h)))switch(e){case 0:b=Number(h)||0;break;case 1:q=Number(h)||0;break;case 2:1===Number(h)?f.getElementById("colorTexture").parentElement.click():f.getElementById("imageTexture").parentElement.click();
break;case 3:1===Number(h)?f.getElementById("minSidebar").parentElement.click():f.getElementById("normalSidebar").parentElement.click()}}else f.getElementById("imageTexture").parentElement.click()}};var p=function(){this.currentActionIndex=-1;this.actionArray=[];this.isCurrentActionAlive=void 0;this.changed="0"};p.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=ba.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);
for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ba.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ba.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ba.draw(e.geo,
e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ba.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(b,c){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.isCurrentActionAlive=!0;this.actionArray.push({type:b,meshes:c});this.currentActionIndex++;this.updateDom();if(AV.User.current()&&a&&a.get("user")&&AV.User.current().id!==a.get("user").id)if(confirm("\u786e\u5b9a\u8981\u4fee\u6539\u5417\uff1f\uff08\u5c06\u4f1a\u4f5c\u4e3a\u65b0\u5efa\u7684\u6587\u4ef6\u8986\u76d6\u672c\u5730\u4fdd\u5b58\u7684\u6570\u636e\uff09"))a=
new x,d.save(d.storageKeys.boxId,""),d.save(d.storageKeys.updatedAt,""),d.save(d.storageKeys.boxName,""),d.save(d.storageKeys.localChanges,"1");else{this.undo();return}this.changed=1},appendObjectToCurrentAction:function(a,b){var c=this.actionArray[this.currentActionIndex];if(!0!==this.isCurrentActionAlive)this.addAction(a,b);else if(void 0===c.meshes)c.meshes=b;else if(c.meshes instanceof Array||(c.meshes=[c.meshes]),b instanceof Array)for(var d=0,e=b.length;d<e;d++)c.meshes.push(b[d]);else c.meshes.push(b)},
updateDom:function(){f.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;f.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var D=function(){this.drawFlag=!1};D.prototype={calculateIntersectResult:J,setMeshPositionToFitTheGrid:v,updateHelperCube:K,draw:function(a,b,c,d,e,f){if(void 0===a||"number"===typeof a)a=xa[a||0];if(void 0===b||"number"===typeof b)b=ra[b||0];var g=a.data,k=b.data;e=e||new s.Mesh(g,k);e.castShadow=!0;e.receiveShadow=!0;
d?v(e,d):e.position.set(c[0],c[1],c[2]);!f||(e.visible=!1);h.scene.add(e);U.push(e);R.push({meshObject:e,geo:a,material:b});return R[R.length-1]},erase:function(a){h.scene.remove(a);a=U.indexOf(a);if(!(0>a)){U.splice(a,1);var b=R[a-1];R.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};s.ImageUtils.crossOrigin="Anonymous";var h,w={width:50},H=w.width/50,ea={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*H,basePlaneTextureRepeat:80,
fogNear:8E3*H,fogFar:25E3*H,sphereRadius:25E3*H},canvas:{ambientLightColor:9474192,directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*H,basePlaneTextureRepeat:16,fogNear:2E3*H,fogFar:3E3*H,sphereRadius:3E3*H}},ua,ja,ta,C=0,L=G.prototype.LOAD_TYPE.async,A=new s.MeshLambertMaterial({color:592137}),wa={opacity:.5,transparent:!0},ra=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:A,helperData:ca(wa,A)}],xa=[{name:"default",type:"1",id:"geo0",data:new s.BoxGeometry(w.width,
w.width,w.width,1,1,1)}];b=30;q=0;var g=!0,m={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===m.toolsType||(E.visible=!E.visible);g=!g},capture:function(){var a=h.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)?b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==
b?(e.navigator.saveBlob=e.navigator.saveBlob||e.navigator.msSaveBlob,a.msToBlob&&e.navigator.saveBlob?e.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(da.href=a.toDataURL(),da.download="capture.png",da.click())},clearAll:function(){z.endFlag||z.instantComplete(z.loadBoxAnimation);if(!(1>R.length)){var a=ba.erase(R[0].meshObject);S.addAction("erase",a);for(var b=0,c=R.length;b<c;b++)a=ba.erase(R[0].meshObject),S.appendObjectToCurrentAction("erase",
a)}},undo:function(){S.undo()},redo:function(){S.redo()},signInOpener:function(){$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");$("#signInError").parent().hide();$("#signInModal").modal("show");$("#signInEmail").focus()},loginOpener:function(){$("#loginUsername").val("");$("#loginPassword").val("");$("#loginError").parent().hide();$("#loginModal").modal("show");$("#loginUsername").focus()},logout:function(){AV.User.current()&&AV.User.logOut();Z(!1);Q("\u5df2\u767b\u51fa")},
save:function(){if(AV.User.current()){if("0"!==S.changed||a.id){var b;b=""+(w.width+":");for(var c=0,e=R.length;c<e;c++)b+=R[c].geo.id.replace("geo","")+",",b+=R[c].material.id.replace("texture","")+",",b+=R[c].meshObject.position.x+",",b+=R[c].meshObject.position.y+",",b+=R[c].meshObject.position.z+";";c=""+(h.controls.target.x+","+h.controls.target.y+","+h.controls.target.z+";");c+=h.controls.object.position.x+","+h.controls.object.position.y+","+h.controls.object.position.z+";";a.set("camera",
c||"0,0,0;1000,500,1000");a.set("meshes",b||"");a.id||(b=prompt("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d",a.get("name")||d.load(d.storageKeys.boxName)||"\u672a\u547d\u540d"),a.set("name",b||"\u672a\u547d\u540d"),a.set("user",AV.User.current()),a.set("ACL",new AV.ACL(AV.User.current())));a.save({success:function(a){Q("\u5df2\u4fdd\u5b58\u81f3\u4e91\u7aef");d.save(d.storageKeys.updatedAt,a.updatedAt);d.save(d.storageKeys.boxId,a.id);d.save(d.storageKeys.boxName,a.get("name"))},error:function(a,b){Q("\u4e91\u7aef\u4fdd\u5b58\u5931\u8d25\uff0c\u5c06\u4f1a\u4fdd\u5b58\u5728\u672c\u5730"+
b.message);d.save(d.storageKeys.boxName,a.get("name"));S.changed="1";d.save(d.storageKeys.localChanges,"1")}})}else Q("\u6587\u4ef6\u672a\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u5c06\u672c\u5730\u4fdd\u5b58");S.changed="0";d.save(d.storageKeys.localChanges,"0");d.save(d.storageKeys.camera);d.save(d.storageKeys.sidebar);d.save()}else d.save(d.storageKeys.camera),d.save(d.storageKeys.sidebar),d.save(),b="\u5df2\u4fdd\u5b58\u5728\u672c\u5730",oa||(b+="\uff0c\u767b\u5f55\u540e\u53ef\u5411\u4e91\u7aef\u4fdd\u5b58\u591a\u4e2a\u6587\u4ef6",
oa=!0),Q(b)},newFile:function(){"0"===S.changed||1>R.length&&(!a||a&&!a.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&m.save();m.clearAll();S=new p;S.updateDom();a=new x;d.save(d.storageKeys.localChanges,"0");d.save(d.storageKeys.camera);d.save(d.storageKeys.sidebar);d.save(d.storageKeys.updatedAt,"");d.save(d.storageKeys.boxName,"");d.save();Q("\u65b0\u5efa")},open:function(){f.getElementById("openIt").removeEventListener("click",B,!1);f.getElementById("openIt").removeEventListener("click",
n,!1);f.getElementById("openIt").addEventListener("click",B,!1);var a=new AV.Query(x);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(T);b.select("name","box");b.equalTo("user",AV.User.current());W(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},share:function(){f.getElementById("openIt").removeEventListener("click",B,!1);f.getElementById("openIt").removeEventListener("click",
n,!1);f.getElementById("openIt").addEventListener("click",n,!1);var a=new AV.Query(x);a.select("name");a.equalTo("user",AV.User.current());W(a.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").html('<div>\u5206\u4eab\u94fe\u63a5\uff1a</div><input type="text" id="shareLink">')}},va=0,u=ra[0],ya=u.data,za=u.helperData,ha=xa[0].data,E,U=[],R=[],Aa,V,Ba,ia,na=[0,0,0],la,I,z=new c,d=new G(!1),S=new p,ba=new D,ma=0;h=new k(f.body);h.init(function(a){if(h.WINDOW_WIDTH!==
e.innerWidth||h.WINDOW_HEIGHT!==e.innerHeight)h.WINDOW_WIDTH=e.innerWidth,h.WINDOW_HEIGHT=e.innerHeight,h.WINDOW_HEIGHT_HALF=h.WINDOW_HEIGHT/2,h.WINDOW_WIDTH_HALF=h.WINDOW_WIDTH/2,h.camera.aspect=h.WINDOW_WIDTH/h.WINDOW_HEIGHT,h.camera.updateProjectionMatrix(),h.renderer.setSize(h.WINDOW_WIDTH,h.WINDOW_HEIGHT),f.body.height=h.WINDOW_HEIGHT},function(){ua=new s.PlaneBufferGeometry(ea[h.renderType].basePlaneWidth,ea[h.renderType].basePlaneWidth,ea[h.renderType].basePlaneSegments,ea[h.renderType].basePlaneSegments);
ua.applyMatrix((new s.Matrix4).makeRotationX(-Math.PI/2));var a=s.ImageUtils.loadTexture("texture/grasslight-big.jpg"),b=s.ImageUtils.loadTexture("texture/sky.jpg");a.wrapT=a.wrapS=s.RepeatWrapping;a.repeat.set(ea[h.renderType].basePlaneTextureRepeat,ea[h.renderType].basePlaneTextureRepeat);ta=new s.MeshPhongMaterial({ambient:16777215,color:14535731,map:a,bumpMap:a,bumpScale:3,specular:3364147,shininess:15,emissive:16777215});ja=new s.Mesh(ua,ta);ja.receiveShadow=!0;ja.material.side=s.DoubleSide;
h.scene.add(ja);U.push(ja);Aa=new s.AmbientLight(ea[h.renderType].ambientLightColor);h.scene.add(Aa);V=new s.DirectionalLight(15658734,ea[h.renderType].directionalLightDensity);V.position.set(0,6E3,5E3);V.target.position.set(0,0,0);V.castShadow=!0;V.shadowCameraNear=h.camera.near;V.shadowCameraFar=h.camera.far;V.shadowCameraFov=h.cam;V.shadowCameraTop=-1024*H;V.shadowCameraLeft=-1024*H;V.shadowCameraBottom=1024*H;V.shadowCameraRight=1024*H;V.shadowBias=2E-5;V.shadowDarkness=.4;V.shadowMapWidth=2048*
H;V.shadowMapHeight=2048*H;h.scene.add(V);Ba=new s.HemisphereLight(16777215,6316128,1);h.scene.add(Ba);a=new s.SphereGeometry(ea[h.renderType].sphereRadius,32,15,0,2*Math.PI,0,Math.PI/2);b=new s.MeshLambertMaterial({color:3368703,map:b,side:s.BackSide,emissive:16777215});b=new s.Mesh(a,b);h.scene.add(b);E=new s.Mesh(ha,za);E.position.set(w.width/2,w.width/2,w.width/2);h.scene.add(E);new s.Mesh(ha,ya);la=new s.Raycaster;ia=new s.Vector2;I=new s.FogExp2(16777215,5.3E-5);h.scene.fog=I;h.controls.settings.boxScale=
H;h.renderer.setClearColor(15790320);h.renderer.shadowMapEnabled=!0;h.renderer.shadowMapType=s.PCFSoftShadowMap;h.renderer.shadowMapCullFace=s.CullFaceBack;h.renderer.gammaInput=!0;h.renderer.gammaOutput=!0;e.addEventListener("unload",qa,!1);e.addEventListener("reload",X,!1);h.renderer.domElement.addEventListener("mousemove",sa,!1);h.renderer.domElement.addEventListener("mousedown",Y,!1);h.renderer.domElement.addEventListener("mouseup",fa,!1);f.addEventListener("keydown",M,!1);f.addEventListener("keyup",
aa,!1);setInterval(y,12E4)});ka();D={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"buttonGroup",id:"accountControl",name:"accountControl",buttonType:"button",appendClass:"btn-group-accountbtn",buttons:[{title:"\u6ce8\u518c",id:"signInOpener"},{title:"\u767b\u5f55",id:"loginOpener"},{title:"\u767b\u51fa",id:"logout"},{title:"\u767b\u5f55\u540e\u65b9\u53ef\u4fdd\u5b58\u6570\u636e\u5230\u4e91\u7aef",
id:"loginMessage"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u6587\u4ef6",name:"files",id:"panelFiles",children:[{UIType:"buttonGroup",
id:"currentFileNameGroup",name:"cfn",buttonType:"button",appendClass:"btn-group-cfnbtn",buttons:[{title:"",id:"currentFileName"}]},{UIType:"buttonGroup",id:"currentFileStateGroup",name:"cfs",buttonType:"button",appendClass:"btn-group-cfsbtn",buttons:[{title:"",id:"currentFileState"}]},{UIType:"buttonGroup",id:"buttonGroupADM",name:"adm",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u65b0\u5efa",id:"newFile"},{title:"\u4fdd\u5b58",id:"save"},{title:"\u6536\u85cf",id:"keep"},
{title:"\u6253\u5f00...",id:"open"},{title:"\u63d2\u5165...",id:"insert"},{title:"\u5220\u9664...",id:"delete"},{title:"\u5171\u4eab...",id:"share"}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux"},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",
id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo"},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",
title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:ra[0].type,bgTypeData:ra[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>h.WINDOW_WIDTH){A=D.children;c=0;for(k=A.length;c<k;c++)if("sidebarResize"===A[c].id){c=A[c].buttons;A=0;for(k=c.length;A<k;A++)"normalSidebar"===c[A].id&&delete c[A].checked,"minSidebar"===c[A].id&&(c[A].checked=!0);break}m.sidebarResize=1}else m.sidebarResize=0;GoUI.Utils.domCreationDirector(D);
S.updateDom();k=f.querySelectorAll(".btn");if(k instanceof Array||k.length)for(c=k.length-1;0<=c;c--)k[c].addEventListener("click",ga,!1);else k instanceof object&&k.addEventListener("click",ga,!1);A=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},
{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];c=0;for(k=A.length;c<k;c++)D={name:A[c].color,type:"color",id:"texture"+(c+1),uniqueData:A[c].color,data:new s.MeshLambertMaterial({color:A[c].color})},ra.push(D),GoUI.map.buttonGroup2.addButton({title:"",id:D.id,bgType:D.type,bgTypeData:D.uniqueData,width:50,height:50}).addEventListener("click",
ga,!1);A="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");c=0;for(k=A.length;c<k;c++)D={name:A[c].replace("texture/","").replace(".png",""),type:"image",id:"texture"+ra.length,uniqueData:A[c],data:new s.MeshLambertMaterial({map:s.ImageUtils.loadTexture(A[c]),transparent:!0})},"glass"===D.data.name&&(D.data.map.opacity=.3),D.data.map.magFilter=s.NearestFilter,D.data.map.minFilter=s.LinearMipMapLinearFilter,
ra.push(D),GoUI.map.buttonGroup2.addButton({title:"",id:D.id,bgType:D.type,bgTypeData:D.uniqueData,width:50,height:50}).addEventListener("click",ga,!1);$("#loginUsername").on("keyup",function(a){13===a.which&&f.getElementById("login").click()});$("#loginPassword").on("keyup",function(a){13===a.which&&f.getElementById("login").click()});f.getElementById("login").addEventListener("click",function(){var a=$("#loginUsername").val(),b=$("#loginPassword").val(),c=$("#login");c.attr("disabled","disabled");
AV.User.current()&&AV.User.logOut();AV.User.logIn(a,b,{success:function(a){Z(!0);c.removeAttr("disabled");$("#loginModal").modal("hide");Q("\u4f60\u597d"+AV.User.current().escape("username"));$("#loginUsername").val("");$("#loginPassword").val("");d.loadRemote()},error:function(a,b){$("#loginError").html(b.message);$("#loginError").parent().show();c.removeAttr("disabled")}})},!1);f.getElementById("signIn").addEventListener("click",function(){var a=$("#signInEmail").val(),b=$("#signInUsername").val(),
c=$("#signInPassword").val(),e=$("#signIn");e.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.signUp(b,c,{ACL:new AV.ACL,email:a},{success:function(a){Z(!0);e.removeAttr("disabled");$("#signInModal").modal("hide");Q("\u4f60\u597d"+AV.User.current().escape("username"));$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");d.loadRemote()},error:function(a,b){$("#signInError").html(b.message);$("#signInError").parent().show();e.removeAttr("disabled")}})},
!1);d.loadCamera(d.storageKeys.camera);d.loadSidebarSelectedButtons(d.storageKeys.sidebar);AV.User.current()?(Z(!0),(k=e.location.hash)?(k=k.substring(1),d.loadShared(k,function(){Q("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25");d.loadRemote()})):d.loadRemote()):(Z(!1),(k=e.location.hash)?(k=k.substring(1),d.loadShared(k,function(){Q("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25");d.loadMeshes(void 0,L,z.loadBoxAnimation)})):d.loadMeshes(void 0,L,z.loadBoxAnimation));e.addEventListener("hashchange",
function(){var a=e.location.hash;a&&(a=a.substring(1),d.loadShared(a,function(){Q("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25")}))},!1)})(window,document,Base,THREE,Detector);
