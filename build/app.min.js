THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(f,k){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a};
THREE.CanvasRenderer=function(a){function f(q,Q,b,c){O(Q);x(b);J(c);T(q.getStyle());l.stroke();W.expandByScalar(2*Q)}function k(q){M(q.getStyle());l.fill()}function s(q){d(q.target)}function d(q){if(!(q instanceof THREE.CompressedTexture)){var Q=q.wrapS===THREE.RepeatWrapping,b=q.wrapT===THREE.RepeatWrapping,c=q.image,p=document.createElement("canvas");p.width=c.width;p.height=c.height;var u=p.getContext("2d");u.setTransform(1,0,0,-1,0,c.height);u.drawImage(c,0,0);X[q.id]=l.createPattern(p,!0===Q&&
!0===b?"repeat":!0===Q&&!1===b?"repeat-x":!1===Q&&!0===b?"repeat-y":"no-repeat")}}function v(q,Q,b,c,p,u,f,k,h,e,a,g,y){if(!(y instanceof THREE.DataTexture)){!1===y.hasEventListener("update",s)&&(void 0!==y.image&&0<y.image.width&&d(y),y.addEventListener("update",s));var t=X[y.id];if(void 0!==t){M(t);var t=y.offset.x/y.repeat.x,m=y.offset.y/y.repeat.y,r=y.image.width*y.repeat.x;y=y.image.height*y.repeat.y;f=(f+t)*r;k=(k+m)*y;b-=q;c-=Q;p-=q;u-=Q;h=(h+t)*r-f;e=(e+m)*y-k;a=(a+t)*r-f;g=(g+m)*y-k;y=h*
g-a*e;0!==y&&(t=1/y,y=(g*b-e*p)*t,e=(g*c-e*u)*t,b=(h*p-a*b)*t,c=(h*u-a*c)*t,q=q-y*f-b*k,Q=Q-e*f-c*k,l.save(),l.transform(y,e,b,c,q,Q),l.fill(),l.restore())}else M("rgba(0,0,0,1)"),l.fill()}}function r(q,Q,b){var c=Q.x-q.x,p=Q.y-q.y,u=c*c+p*p;0!==u&&(b/=Math.sqrt(u),c*=b,p*=b,Q.x+=c,Q.y+=p,q.x-=c,q.y-=p)}function b(q){g!==q&&(g=l.globalAlpha=q)}function fa(q){N!==q&&(q===THREE.NormalBlending?l.globalCompositeOperation="source-over":q===THREE.AdditiveBlending?l.globalCompositeOperation="lighter":q===
THREE.SubtractiveBlending&&(l.globalCompositeOperation="darker"),N=q)}function O(q){B!==q&&(B=l.lineWidth=q)}function x(q){e!==q&&(e=l.lineCap=q)}function J(q){U!==q&&(U=l.lineJoin=q)}function T(q){w!==q&&(w=l.strokeStyle=q)}function M(q){ma!==q&&(ma=l.fillStyle=q)}function D(q){R.length!==q.length&&(l.setLineDash(q),R=q)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ca=THREE.Math.smoothstep;a=a||{};var ba=this,ga,Z,oa,qa=new THREE.Projector,aa=void 0!==a.canvas?a.canvas:document.createElement("canvas"),
S=aa.width,ja=aa.height,G=Math.floor(S/2),A=Math.floor(ja/2),E=0,ka=0,la=S,ra=ja,n=1,l=aa.getContext("2d",{alpha:!0===a.alpha}),u=new THREE.Color(0),m=!0===a.alpha?0:1,g=1,N=0,w=null,ma=null,B=null,e=null,U=null,R=[],ha,C,y,sa;new THREE.RenderableVertex;new THREE.RenderableVertex;var ya,pa,K,h,z,va,t=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var I=new THREE.Color,Aa=new THREE.Color,ua=new THREE.Color,X={},Y,Ba,V,ia,L,na,da,wa=new THREE.Box2,H=new THREE.Box2,W=
new THREE.Box2,za=new THREE.Color,Ca=new THREE.Color,F=new THREE.Color,c=new THREE.Vector3,P=new THREE.Vector3,ea=new THREE.Vector3,ta=new THREE.Matrix3;void 0===l.setLineDash&&(l.setLineDash=function(){});this.domElement=aa;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return n};this.setPixelRatio=function(q){n=q};this.setSize=function(q,Q,b){S=q*
n;ja=Q*n;aa.width=S;aa.height=ja;G=Math.floor(S/2);A=Math.floor(ja/2);!1!==b&&(aa.style.width=q+"px",aa.style.height=Q+"px");wa.min.set(-G,-A);wa.max.set(G,A);H.min.set(-G,-A);H.max.set(G,A);g=1;N=0;U=e=B=ma=w=null;this.setViewport(0,0,q,Q)};this.setViewport=function(q,Q,b,c){E=q*n;ka=Q*n;la=b*n;ra=c*n};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(q,b){u.set(q);m=void 0!==b?b:1;H.min.set(-G,-A);H.max.set(G,A)};this.setClearColorHex=function(q,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(q,b)};this.getClearColor=function(){return u};this.getClearAlpha=function(){return m};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===H.empty()&&(H.intersect(wa),H.expandByScalar(2),H.min.x+=G,H.min.y=-H.min.y+A,H.max.x+=G,H.max.y=-H.max.y+A,1>m&&l.clearRect(H.min.x|0,H.max.y|0,H.max.x-H.min.x|0,H.min.y-H.max.y|0),0<m&&(fa(THREE.NormalBlending),b(1),M("rgba("+Math.floor(255*u.r)+","+Math.floor(255*u.g)+","+Math.floor(255*u.b)+","+m+")"),l.fillRect(H.min.x|
0,H.max.y|0,H.max.x-H.min.x|0,H.min.y-H.max.y|0)),H.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(q,Q){if(!1===Q instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();ba.info.render.vertices=0;ba.info.render.faces=0;l.setTransform(la/S,0,0,-ra/ja,E,ja-ka);l.translate(G,A);ga=qa.projectScene(q,Q,this.sortObjects,this.sortElements);
Z=ga.elements;oa=ga.lights;ha=Q;ta.getNormalMatrix(Q.matrixWorldInverse);za.setRGB(0,0,0);Ca.setRGB(0,0,0);F.setRGB(0,0,0);for(var xa=0,u=oa.length;xa<u;xa++){var p=oa[xa],e=p.color;p instanceof THREE.AmbientLight?za.add(e):p instanceof THREE.DirectionalLight?Ca.add(e):p instanceof THREE.PointLight&&F.add(e)}xa=0;for(u=Z.length;xa<u;xa++){var a=Z[xa],g=a.material;if(void 0!==g&&0!==g.opacity){W.makeEmpty();if(a instanceof THREE.RenderableSprite){C=a;C.x*=G;C.y*=A;var p=C,m=a,e=g;b(e.opacity);fa(e.blending);
var n=m.scale.x*G,m=m.scale.y*A,a=.5*Math.sqrt(n*n+m*m);W.min.set(p.x-a,p.y-a);W.max.set(p.x+a,p.y+a);if(e instanceof THREE.SpriteMaterial){var w=e.map;if(null!==w&&void 0!==w.image){!1===w.hasEventListener("update",s)&&(0<w.image.width&&d(w),w.addEventListener("update",s));a=X[w.id];void 0!==a?M(a):M("rgba( 0, 0, 0, 1 )");var N=w.image,a=N.width*w.offset.x,g=N.height*w.offset.y,B=N.width*w.repeat.x,w=N.height*w.repeat.y,N=n/B,U=m/w;l.save();l.translate(p.x,p.y);0!==e.rotation&&l.rotate(e.rotation);
l.translate(-n/2,-m/2);l.scale(N,U);l.translate(-a,-g);l.fillRect(a,g,B,w)}else M(e.color.getStyle()),l.save(),l.translate(p.x,p.y),0!==e.rotation&&l.rotate(e.rotation),l.scale(n,-m),l.fillRect(-.5,-.5,1,1);l.restore()}else e instanceof THREE.SpriteCanvasMaterial&&(T(e.color.getStyle()),M(e.color.getStyle()),l.save(),l.translate(p.x,p.y),0!==e.rotation&&l.rotate(e.rotation),l.scale(n,m),e.program(l),l.restore())}else if(a instanceof THREE.RenderableLine){if(C=a.v1,y=a.v2,C.positionScreen.x*=G,C.positionScreen.y*=
A,y.positionScreen.x*=G,y.positionScreen.y*=A,W.setFromPoints([C.positionScreen,y.positionScreen]),!0===wa.isIntersectionBox(W))if(p=C,e=y,n=a,m=g,b(m.opacity),fa(m.blending),l.beginPath(),l.moveTo(p.positionScreen.x,p.positionScreen.y),l.lineTo(e.positionScreen.x,e.positionScreen.y),m instanceof THREE.LineBasicMaterial){O(m.linewidth);x(m.linecap);J(m.linejoin);if(m.vertexColors!==THREE.VertexColors)T(m.color.getStyle());else if(a=n.vertexColors[0].getStyle(),n=n.vertexColors[1].getStyle(),a===n)T(a);
else{try{var R=l.createLinearGradient(p.positionScreen.x,p.positionScreen.y,e.positionScreen.x,e.positionScreen.y);R.addColorStop(0,a);R.addColorStop(1,n)}catch(aa){R=a}T(R)}l.stroke();W.expandByScalar(2*m.linewidth)}else m instanceof THREE.LineDashedMaterial&&(O(m.linewidth),x(m.linecap),J(m.linejoin),T(m.color.getStyle()),D([m.dashSize,m.gapSize]),l.stroke(),W.expandByScalar(2*m.linewidth),D([]))}else if(a instanceof THREE.RenderableFace){C=a.v1;y=a.v2;sa=a.v3;if(-1>C.positionScreen.z||1<C.positionScreen.z)continue;
if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>sa.positionScreen.z||1<sa.positionScreen.z)continue;C.positionScreen.x*=G;C.positionScreen.y*=A;y.positionScreen.x*=G;y.positionScreen.y*=A;sa.positionScreen.x*=G;sa.positionScreen.y*=A;0<g.overdraw&&(r(C.positionScreen,y.positionScreen,g.overdraw),r(y.positionScreen,sa.positionScreen,g.overdraw),r(sa.positionScreen,C.positionScreen,g.overdraw));W.setFromPoints([C.positionScreen,y.positionScreen,sa.positionScreen]);if(!0===wa.isIntersectionBox(W)){e=
C;n=y;m=sa;p=g;ba.info.render.vertices+=3;ba.info.render.faces++;b(p.opacity);fa(p.blending);ya=e.positionScreen.x;pa=e.positionScreen.y;K=n.positionScreen.x;h=n.positionScreen.y;z=m.positionScreen.x;va=m.positionScreen.y;var g=ya,B=pa,w=K,N=h,U=z,ma=va;l.beginPath();l.moveTo(g,B);l.lineTo(w,N);l.lineTo(U,ma);l.closePath();if((p instanceof THREE.MeshLambertMaterial||p instanceof THREE.MeshPhongMaterial)&&null===p.map){I.copy(p.color);Aa.copy(p.emissive);p.vertexColors===THREE.FaceColors&&I.multiply(a.color);
t.copy(za);P.copy(e.positionWorld).add(n.positionWorld).add(m.positionWorld).divideScalar(3);e=P;n=a.normalModel;m=t;a=0;for(g=oa.length;a<g;a++)B=oa[a],ua.copy(B.color),B instanceof THREE.DirectionalLight?(w=c.setFromMatrixPosition(B.matrixWorld).normalize(),N=n.dot(w),0>=N||(N*=B.intensity,m.add(ua.multiplyScalar(N)))):B instanceof THREE.PointLight&&(w=c.setFromMatrixPosition(B.matrixWorld),N=n.dot(c.subVectors(w,e).normalize()),0>=N||(N*=0==B.distance?1:1-Math.min(e.distanceTo(w)/B.distance,1),
0!=N&&(N*=B.intensity,m.add(ua.multiplyScalar(N)))));t.multiply(I).add(Aa);!0===p.wireframe?f(t,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):k(t)}else p instanceof THREE.MeshBasicMaterial||p instanceof THREE.MeshLambertMaterial||p instanceof THREE.MeshPhongMaterial?null!==p.map?p.map.mapping===THREE.UVMapping&&(Y=a.uvs,v(ya,pa,K,h,z,va,Y[0].x,Y[0].y,Y[1].x,Y[1].y,Y[2].x,Y[2].y,p.map)):null!==p.envMap?p.envMap.mapping===THREE.SphericalReflectionMapping&&(ea.copy(a.vertexNormalsModel[0]).applyMatrix3(ta),
Ba=.5*ea.x+.5,V=.5*ea.y+.5,ea.copy(a.vertexNormalsModel[1]).applyMatrix3(ta),ia=.5*ea.x+.5,L=.5*ea.y+.5,ea.copy(a.vertexNormalsModel[2]).applyMatrix3(ta),na=.5*ea.x+.5,da=.5*ea.y+.5,v(ya,pa,K,h,z,va,Ba,V,ia,L,na,da,p.envMap)):(t.copy(p.color),p.vertexColors===THREE.FaceColors&&t.multiply(a.color),!0===p.wireframe?f(t,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):k(t)):(p instanceof THREE.MeshDepthMaterial?t.r=t.g=t.b=1-ca(e.positionScreen.z*e.positionScreen.w,ha.near,ha.far):p instanceof
THREE.MeshNormalMaterial?(ea.copy(a.normalModel).applyMatrix3(ta),t.setRGB(ea.x,ea.y,ea.z).multiplyScalar(.5).addScalar(.5)):t.setRGB(1,1,1),!0===p.wireframe?f(t,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):k(t))}}H.union(W)}}l.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function a(){if(J===M){var b=new THREE.RenderableVertex;T.push(b);M++;J++;return b}return T[J++]}function f(){if(ca===ga){var b=new THREE.RenderableFace;ba.push(b);ga++;ca++;return b}return ba[ca++]}function k(){if(oa===aa){var b=new THREE.RenderableLine;qa.push(b);aa++;oa++;return b}return qa[oa++]}function s(){if(ja===A){var b=new THREE.RenderableSprite;G.push(b);A++;ja++;return b}return G[ja++]}function d(b,a){return b.z!==a.z?a.z-b.z:b.id!==a.id?b.id-a.id:0}function v(b,
a){var e=0,u=1,d=b.z+b.w,f=a.z+a.w,m=-b.z+b.w,k=-a.z+a.w;if(0<=d&&0<=f&&0<=m&&0<=k)return!0;if(0>d&&0>f||0>m&&0>k)return!1;0>d?e=Math.max(e,d/(d-f)):0>f&&(u=Math.min(u,d/(d-f)));0>m?e=Math.max(e,m/(m-k)):0>k&&(u=Math.min(u,m/(m-k)));if(u<e)return!1;b.lerp(a,e);a.lerp(b,1-u);return!0}var r,b,fa=[],O=0,x,J,T=[],M=0,D,ca,ba=[],ga=0,Z,oa,qa=[],aa=0,S,ja,G=[],A=0,E={objects:[],lights:[],elements:[]},ka=new THREE.Vector3,la=new THREE.Vector3,ra=new THREE.Vector3,n=new THREE.Vector3,l=new THREE.Vector4,
u=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),m=new THREE.Box3,g=Array(3),N=new THREE.Matrix4,w=new THREE.Matrix4,ma,B=new THREE.Matrix4,e=new THREE.Matrix3,U=new THREE.Frustum,R=new THREE.Vector4,ha=new THREE.Vector4;this.projectVector=function(b,a){console.warn("THREE.Projector: .projectVector() is now vector.project().");b.project(a)};this.unprojectVector=function(b,a){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");b.unproject(a)};this.pickingRay=
function(b,a){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var C=new function(){var b=[],e=[],d=null,l=null,s=new THREE.Matrix3,h=function(b){var a=b.positionWorld,e=b.positionScreen;a.copy(b.position).applyMatrix4(ma);e.copy(a).applyMatrix4(w);a=1/e.w;e.x*=a;e.y*=a;e.z*=a;b.visible=-1<=e.x&&1>=e.x&&-1<=e.y&&1>=e.y&&-1<=e.z&&1>=e.z},n=function(b,e,a){if(!0===b.visible||!0===e.visible||!0===a.visible)return!0;g[0]=b.positionScreen;g[1]=e.positionScreen;g[2]=a.positionScreen;
return u.isIntersectionBox(m.setFromPoints(g))},r=function(b,e,a){return 0>(a.positionScreen.x-b.positionScreen.x)*(e.positionScreen.y-b.positionScreen.y)-(a.positionScreen.y-b.positionScreen.y)*(e.positionScreen.x-b.positionScreen.x)};return{setObject:function(a){d=a;l=d.material;s.getNormalMatrix(d.matrixWorld);b.length=0;e.length=0},projectVertex:h,checkTriangleVisibility:n,checkBackfaceCulling:r,pushVertex:function(b,e,u){x=a();x.position.set(b,e,u);h(x)},pushNormal:function(e,a,u){b.push(e,a,
u)},pushUv:function(b,a){e.push(b,a)},pushLine:function(b,a){var e=T[b],u=T[a];Z=k();Z.id=d.id;Z.v1.copy(e);Z.v2.copy(u);Z.z=(e.positionScreen.z+u.positionScreen.z)/2;Z.material=d.material;E.elements.push(Z)},pushTriangle:function(a,u,m){var k=T[a],g=T[u],h=T[m];if(!1!==n(k,g,h)&&(l.side===THREE.DoubleSide||!0===r(k,g,h))){D=f();D.id=d.id;D.v1.copy(k);D.v2.copy(g);D.v3.copy(h);D.z=(k.positionScreen.z+g.positionScreen.z+h.positionScreen.z)/3;for(k=0;3>k;k++)g=3*arguments[k],h=D.vertexNormalsModel[k],
h.set(b[g],b[g+1],b[g+2]),h.applyMatrix3(s).normalize(),g=2*arguments[k],D.uvs[k].set(e[g],e[g+1]);D.vertexNormalsLength=3;D.material=d.material;E.elements.push(D)}}}};this.projectScene=function(u,m,g,A){ja=oa=ca=0;E.elements.length=0;!0===u.autoUpdate&&u.updateMatrixWorld();void 0===m.parent&&m.updateMatrixWorld();N.copy(m.matrixWorldInverse.getInverse(m.matrixWorld));w.multiplyMatrices(m.projectionMatrix,N);U.setFromMatrix(w);b=0;E.objects.length=0;E.lights.length=0;u.traverseVisible(function(a){if(a instanceof
THREE.Light)E.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===U.intersectsObject(a))){if(b===O){var c=new THREE.RenderableObject;fa.push(c);O++;b++;r=c}else r=fa[b++];r.id=a.id;r.object=a;n.setFromMatrixPosition(a.matrixWorld);n.applyProjection(w);r.z=n.z;E.objects.push(r)}});!0===g&&E.objects.sort(d);u=0;for(g=E.objects.length;u<g;u++){var K=E.objects[u].object,h=K.geometry;C.setObject(K);ma=
K.matrixWorld;J=0;if(K instanceof THREE.Mesh)if(h instanceof THREE.BufferGeometry){var z=h.attributes,K=h.offsets;if(void 0!==z.position){for(var x=z.position.array,h=0,t=x.length;h<t;h+=3)C.pushVertex(x[h],x[h+1],x[h+2]);if(void 0!==z.normal)for(var I=z.normal.array,h=0,t=I.length;h<t;h+=3)C.pushNormal(I[h],I[h+1],I[h+2]);if(void 0!==z.uv)for(I=z.uv.array,h=0,t=I.length;h<t;h+=2)C.pushUv(I[h],I[h+1]);if(void 0!==z.index)if(z=z.index.array,0<K.length)for(u=0;u<K.length;u++)for(t=K[u],x=t.index,h=
t.start,t=t.start+t.count;h<t;h+=3)C.pushTriangle(z[h]+x,z[h+1]+x,z[h+2]+x);else for(h=0,t=z.length;h<t;h+=3)C.pushTriangle(z[h],z[h+1],z[h+2]);else for(h=0,t=x.length/3;h<t;h+=3)C.pushTriangle(h,h+1,h+2)}}else{if(h instanceof THREE.Geometry){var G=h.vertices,t=h.faces,z=h.faceVertexUvs[0];e.getNormalMatrix(ma);for(var x=K.material instanceof THREE.MeshFaceMaterial,I=!0===x?K.material:null,M=0,X=G.length;M<X;M++){var Y=G[M];C.pushVertex(Y.x,Y.y,Y.z)}G=0;for(M=t.length;G<M;G++){var X=t[G],aa=!0===
x?I.materials[X.materialIndex]:K.material;if(void 0!==aa){var V=aa.side,Y=T[X.a],ia=T[X.b],L=T[X.c];if(!0===aa.morphTargets){var na=h.morphTargets,da=K.morphTargetInfluences,ba=Y.position,H=ia.position,W=L.position;ka.set(0,0,0);la.set(0,0,0);ra.set(0,0,0);for(var ga=0,qa=na.length;ga<qa;ga++){var F=da[ga];if(0!==F){var c=na[ga].vertices;ka.x+=(c[X.a].x-ba.x)*F;ka.y+=(c[X.a].y-ba.y)*F;ka.z+=(c[X.a].z-ba.z)*F;la.x+=(c[X.b].x-H.x)*F;la.y+=(c[X.b].y-H.y)*F;la.z+=(c[X.b].z-H.z)*F;ra.x+=(c[X.c].x-W.x)*
F;ra.y+=(c[X.c].y-W.y)*F;ra.z+=(c[X.c].z-W.z)*F}}Y.position.add(ka);ia.position.add(la);L.position.add(ra);C.projectVertex(Y);C.projectVertex(ia);C.projectVertex(L)}if(!1!==C.checkTriangleVisibility(Y,ia,L)){na=C.checkBackfaceCulling(Y,ia,L);if(V!==THREE.DoubleSide){if(V===THREE.FrontSide&&!1===na)continue;if(V===THREE.BackSide&&!0===na)continue}D=f();D.id=K.id;D.v1.copy(Y);D.v2.copy(ia);D.v3.copy(L);D.normalModel.copy(X.normal);!1!==na||V!==THREE.BackSide&&V!==THREE.DoubleSide||D.normalModel.negate();
D.normalModel.applyMatrix3(e).normalize();da=X.vertexNormals;ba=0;for(H=Math.min(da.length,3);ba<H;ba++)W=D.vertexNormalsModel[ba],W.copy(da[ba]),!1!==na||V!==THREE.BackSide&&V!==THREE.DoubleSide||W.negate(),W.applyMatrix3(e).normalize();D.vertexNormalsLength=da.length;V=z[G];if(void 0!==V)for(na=0;3>na;na++)D.uvs[na].copy(V[na]);D.color=X.color;D.material=aa;D.z=(Y.positionScreen.z+ia.positionScreen.z+L.positionScreen.z)/3;E.elements.push(D)}}}}}else if(K instanceof THREE.Line)if(h instanceof THREE.BufferGeometry){if(z=
h.attributes,void 0!==z.position){x=z.position.array;h=0;for(t=x.length;h<t;h+=3)C.pushVertex(x[h],x[h+1],x[h+2]);if(void 0!==z.index)for(z=z.index.array,h=0,t=z.length;h<t;h+=2)C.pushLine(z[h],z[h+1]);else for(z=K.mode===THREE.LinePieces?2:1,h=0,t=x.length/3-1;h<t;h+=z)C.pushLine(h,h+1)}}else{if(h instanceof THREE.Geometry&&(B.multiplyMatrices(w,ma),G=K.geometry.vertices,0!==G.length))for(Y=a(),Y.positionScreen.copy(G[0]).applyMatrix4(B),z=K.mode===THREE.LinePieces?2:1,M=1,X=G.length;M<X;M++)Y=a(),
Y.positionScreen.copy(G[M]).applyMatrix4(B),0<(M+1)%z||(ia=T[J-2],R.copy(Y.positionScreen),ha.copy(ia.positionScreen),!0===v(R,ha)&&(R.multiplyScalar(1/R.w),ha.multiplyScalar(1/ha.w),Z=k(),Z.id=K.id,Z.v1.positionScreen.copy(R),Z.v2.positionScreen.copy(ha),Z.z=Math.max(R.z,ha.z),Z.material=K.material,K.material.vertexColors===THREE.VertexColors&&(Z.vertexColors[0].copy(K.geometry.colors[M]),Z.vertexColors[1].copy(K.geometry.colors[M-1])),E.elements.push(Z)))}else K instanceof THREE.Sprite&&(l.set(ma.elements[12],
ma.elements[13],ma.elements[14],1),l.applyMatrix4(w),h=1/l.w,l.z*=h,-1<=l.z&&1>=l.z&&(S=s(),S.id=K.id,S.x=l.x*h,S.y=l.y*h,S.z=l.z,S.object=K,S.rotation=K.rotation,S.scale.x=K.scale.x*Math.abs(S.x-(l.x+m.projectionMatrix.elements[0])/(l.w+m.projectionMatrix.elements[12])),S.scale.y=K.scale.y*Math.abs(S.y-(l.y+m.projectionMatrix.elements[5])/(l.w+m.projectionMatrix.elements[13])),S.material=K.material,E.elements.push(S)))}!0===A&&E.elements.sort(d);return E}};
THREE.OrbitControls=function(a,f,k){function s(a){if(!1!==b.enabled){a.preventDefault();var d=b.domElement===document?b.domElement.body:b.domElement;if(E===A.ROTATE){if(!0===b.noRotate)return;O.set(a.clientX,a.clientY);x.subVectors(O,fa);b.rotateLeft(2*Math.PI*x.x/d.clientWidth*b.rotateSpeed);b.rotateUp(2*Math.PI*x.y/d.clientHeight*b.rotateSpeed);fa.copy(O)}else if(E===A.DOLLY){if(!0===b.noZoom)return;ga.set(a.clientX,a.clientY);Z.subVectors(ga,ba);0<Z.y?b.dollyIn():b.dollyOut();ba.copy(ga)}else if(E===
A.PAN){if(!0===b.noPan)return;T.set(a.clientX,a.clientY);M.subVectors(T,J);b.panXZ(M.x*b.panSpeed,-M.y*b.panSpeed);J.copy(T)}b.update()}}function d(){!1!==b.enabled&&(document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",d,!1),b.dispatchEvent(l),E=A.NONE)}function v(a){if(!1!==b.enabled&&!0!==b.noZoom){a.preventDefault();a.stopPropagation();var d=0;void 0!==a.wheelDelta?d=a.wheelDelta:void 0!==a.detail&&(d=-a.detail);0<d?b.dollyOut():b.dollyIn();b.update();b.dispatchEvent(n);
b.dispatchEvent(l)}}function r(a){if(!1!==b.enabled&&!0!==b.noKeys&&!0!==b.noPan)switch(a.keyCode){case b.keys.UP:b.pan(0,b.keyPanSpeed);b.update();break;case b.keys.FORWARD:b.panXZ(0,-b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:b.pan(0,-b.keyPanSpeed);b.update();break;case b.keys.BACKWARD:b.panXZ(0,b.keyPanSpeed);b.update();break;case b.keys.LEFT:b.pan(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:b.pan(-b.keyPanSpeed,0);b.update();break;case b.keys.DOLLY_IN:if(!0===b.noZoom)break;b.dollyIn();
b.update();break;case b.keys.DOLLY_OUT:if(!0===b.noZoom)break;b.dollyOut();b.update()}}this.settings=k;this.object=a;this.domElement=void 0!==f?f:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.panSpeed=.3;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=
Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var b=this,fa=new THREE.Vector2,O=new THREE.Vector2,x=new THREE.Vector2,J=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,D=new THREE.Vector3,ca=new THREE.Vector3,ba=new THREE.Vector2,ga=new THREE.Vector2,Z=new THREE.Vector2,oa=0,qa=0,aa=1,S=new THREE.Vector3,ja=new THREE.Vector3,G=new THREE.Quaternion,A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,
TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},E=A.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var ka=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),la=ka.clone().inverse(),ra={type:"change"},n={type:"start"},l={type:"end"};this.rotateLeft=function(a){void 0===a&&(a=2*Math.PI/60/60*b.autoRotateSpeed);qa-=a};this.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*b.autoRotateSpeed);oa-=a};this.panLeft=function(b){var a=this.object.matrix.elements;
D.set(a[0],a[1],a[2]);D.multiplyScalar(-b);S.add(D)};this.panUp=function(b){var a=this.object.matrix.elements;D.set(a[4],a[5],a[6]);D.multiplyScalar(b);S.add(D)};this.panForward=function(b){var a=this.object.matrix.elements;D.set(a[8],a[9],a[10]);D.multiplyScalar(b);S.add(D)};this.pan=function(a,d){var k=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var f=b.object.position.clone().sub(b.target).length(),f=f*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*f/k.clientHeight);
b.panUp(2*d*f/k.clientHeight)}else void 0!==b.object.top?(b.panLeft(a*(b.object.right-b.object.left)/k.clientWidth),b.panUp(d*(b.object.top-b.object.bottom)/k.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(a,d){var k=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var f=b.object.position.clone().sub(b.target).length(),f=f*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*f/k.clientHeight);
b.panForward(2*d*f/k.clientHeight)}else void 0!==b.object.top?(b.panLeft(a*(b.object.right-b.object.left)/k.clientWidth),b.panForward(d*(b.object.top-b.object.bottom)/k.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));aa/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));aa*=a};this.update=function(){var a=this.object.position,d=this.settings&&this.settings.cameraAsOrbitCenter?
a:this.target,k=this.settings&&this.settings.cameraAsOrbitCenter?this.target:a;ca.copy(a).sub(this.target);ca.applyQuaternion(ka);var a=Math.atan2(ca.x,ca.z),f=Math.atan2(Math.sqrt(ca.x*ca.x+ca.z*ca.z),ca.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*b.autoRotateSpeed);var a=a+qa,f=f+oa,a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,a)),f=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,f)),f=Math.max(1E-6,Math.min(Math.PI-1E-6,f)),l=this.settings&&this.settings.cameraAsOrbitCenter?
5E3*aa*this.settings.boxScale:ca.length()*aa,l=Math.max(this.minDistance,Math.min(this.maxDistance,l));d.add(S);ca.x=l*Math.sin(f)*Math.sin(a);ca.y=l*Math.cos(f);ca.z=l*Math.sin(f)*Math.cos(a);ca.applyQuaternion(la);this.settings&&this.settings.cameraAsOrbitCenter?k.copy(d).sub(ca):k.copy(d).add(ca);this.object.lookAt(this.target);oa=qa=0;aa=1;S.set(0,0,0);if(1E-6<ja.distanceToSquared(d)||1E-6<8*(1-G.dot(this.object.quaternion)))this.dispatchEvent(ra),ja.copy(d),G.copy(this.object.quaternion)};this.reset=
function(){E=A.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){if(!1!==b.enabled){a.preventDefault();if(a.button===b.mouseButtons.ORBIT){if(!0===b.noRotate)return;E=A.ROTATE;fa.set(a.clientX,a.clientY)}else if(a.button===b.mouseButtons.ZOOM){if(!0===b.noZoom)return;E=A.DOLLY;ba.set(a.clientX,a.clientY)}else if(a.button===
b.mouseButtons.PAN){if(!0===b.noPan)return;E=A.PAN;J.set(a.clientX,a.clientY)}document.addEventListener("mousemove",s,!1);document.addEventListener("mouseup",d,!1);b.dispatchEvent(n)}},!1);this.domElement.addEventListener("mousewheel",v,!1);this.domElement.addEventListener("DOMMouseScroll",v,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==b.enabled){switch(a.touches.length){case 1:if(!0===b.noRotate)return;E=A.TOUCH_ROTATE;fa.set(a.touches[0].pageX,a.touches[0].pageY);break;
case 2:if(!0===b.noZoom)return;E=A.TOUCH_DOLLY;var d=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;d=Math.sqrt(d*d+a*a);ba.set(0,d);break;case 3:if(!0===b.noPan)return;E=A.TOUCH_PAN;J.set(a.touches[0].pageX,a.touches[0].pageY);break;default:E=A.NONE}b.dispatchEvent(n)}},!1);this.domElement.addEventListener("touchend",function(){!1!==b.enabled&&(b.dispatchEvent(l),E=A.NONE)},!1);this.domElement.addEventListener("touchmove",function(a){if(!1!==b.enabled){a.preventDefault();
a.stopPropagation();var d=b.domElement===document?b.domElement.body:b.domElement;switch(a.touches.length){case 1:if(!0===b.noRotate)break;if(E!==A.TOUCH_ROTATE)break;O.set(a.touches[0].pageX,a.touches[0].pageY);x.subVectors(O,fa);b.rotateLeft(2*Math.PI*x.x/d.clientWidth*b.rotateSpeed);b.rotateUp(2*Math.PI*x.y/d.clientHeight*b.rotateSpeed);fa.copy(O);b.update();break;case 2:if(!0===b.noZoom)break;if(E!==A.TOUCH_DOLLY)break;d=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;
a=Math.sqrt(d*d+a*a);ga.set(0,a);Z.subVectors(ga,ba);0<Z.y?b.dollyOut():b.dollyIn();ba.copy(ga);b.update();break;case 3:if(!0===b.noPan)break;if(E!==A.TOUCH_PAN)break;T.set(a.touches[0].pageX,a.touches[0].pageY);M.subVectors(T,J);b.panXZ(M.x*b.panSpeed,-M.y*b.panSpeed);J.copy(T);b.update();break;default:E=A.NONE}}},!1);window.addEventListener("keydown",r,!1);this.update();this.removeKeyEventListener=function(){window.removeEventListener("keydown",r,!1)};this.addKeyEventListener=function(){window.addEventListener("keydown",
r,!1)}};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(f){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";
a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return a},addGetWebGLMessage:function(a){var f,k;a=a||{};f=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";k=Detector.getWebGLErrorMessage();k.id=a;f.appendChild(k)}};"object"===typeof module&&(module.exports=Detector);
(function(a,f,k,s){var d=function(a){this.domParent="object"===typeof a?a:f.body};d.prototype.init=function(d,r,b,fa,O,x){a.requestAnimationFrame||(a.requestAnimationFrame=function(){return a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b,d){a.setTimeout(b,1E3/60)}}());this.domParent===f.body&&(this.WINDOW_WIDTH=a.innerWidth,this.WINDOW_HEIGHT=a.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,a.addEventListener("resize",d,!1));this.renderType=s.webgl?"webgl":"canvas";this.renderer=b||(s.webgl?new k.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new k.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=fa||new k.Scene;this.camera=O||new k.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
x?this.controls=x:(this.controls=new k.OrbitControls(this.camera,this.renderer.domElement,{cameraAsOrbitCenter:!0}),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.keyPanSpeed=10,this.controls.panSpeed=1,this.controls.noZoom=!0,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:81,BOTTOM:69},this.controls.mouseButtons={ORBIT:k.MOUSE.MIDDLE,PAN:k.MOUSE.RIGHT});this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top=
"0px";this.stats.domElement.style.zIndex="999";f.body.appendChild(this.stats.domElement);r()};a.Base=d;"object"===typeof module&&(module.exports=d)})(window,document,THREE,Detector);
(function(){function a(a){return a.charAt(0).toUpperCase()+a.slice(1)}var f={Animation:{bubble:function(a,f){var d=$('<div class="alert alert-info alert-vp fade"></div>').appendTo(a);d.text(f);d.finish().fadeTo(200,1).delay(2500).fadeTo(100,0,function(){$(this).remove()})}}};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(a){var f=0;for(a=a.length;f<a;f++);};f.map={};f.Sidebar=function(a,s){_Container.call(this);var d=this.setting=
f.Utils.settingMixin({align:"r",width:320},a),v="sidebar",v=d.align&&"r"!==d.align?v+" sidebar-left":v+" sidebar-right";this.domElement.className=v;d.id&&(this.domElement.id=d.id,f.map[d.id]=this);this.domElement.style.width=d.width.toString()+"px";d.overflow&&(this.domElement.style.overflow=d.overflow.toString());s.appendChild(this.domElement);f.Utils.domCreationDirector(d.children,this.domElement)};f.Sidebar.prototype=Object.create(_Container.prototype);f.Panel=function(a,s){_Container.call(this);
var d=this.setting=f.Utils.settingMixin({title:""},a);d.id&&(this.domElement.id=d.id,f.map[d.id]=this);var v=this.domElement;v.className="panel panel-tool";s.appendChild(v);var r=document.createElement("div");r.className="panel-heading";v.appendChild(r);var b=document.createTextNode(d.title);r.appendChild(b);r=document.createElement("div");r.className="panel-body";d.overflow&&(r.style.overflow=d.overflow.toString());v.appendChild(r);f.Utils.domCreationDirector(d.children,r)};f.Panel.prototype=Object.create(_Container.prototype);
f.Toolbar=function(a,s){_Container.call(this);var d=this.setting=f.Utils.settingMixin({title:""},a);d.id&&(this.domElement.id=d.id,f.map[d.id]=this);var v=this.domElement;v.className="btn-toolbar";s.appendChild(v);f.Utils.domCreationDirector(d.children,v)};f.Toolbar.prototype=Object.create(_Container.prototype);f.ButtonGroup=function(a,s){_Container.call(this);var d=this.setting=f.Utils.settingMixin({title:"",buttonType:"radio"},a);d.id&&(this.domElement.id=d.id,f.map[d.id]=this);var v=this.domElement;
v.className="btn-group"+(d.appendClass?" "+d.appendClass:"");"button"!==d.buttonType.toLowerCase()&&v.setAttribute("data-toggle","buttons");v.title=d.title;s.appendChild(v);var r=d.buttons;switch(d.buttonType.toLowerCase()){default:case "radio":for(var b=0,fa=r.length;b<fa;b++){var O=document.createElement("label");O.className="btn btn-tool"+(r[b].checked?" active":"");r[b].height&&(O.style.height=r[b].height+"px");r[b].width&&(O.style.width=r[b].width+"px");if(r[b].bgType&&r[b].bgTypeData){var x;
switch(r[b].bgType){case "color":x=r[b].bgTypeData;O.className+=" btn-color";break;case "image":x="url("+r[b].bgTypeData+") no-repeat 50% 50%";O.className+=" btn-image";break;default:return}O.style.background=x}v.appendChild(O);var J=document.createElement("input");r[b].checked&&J.setAttribute("checked","");J.type=d.buttonType;J.name=d.name;J.id=r[b].id;J.value=b;J.autocomplete="off";O.appendChild(J);x=document.createTextNode(r[b].title);O.appendChild(x)}break;case "button":for(b=0,fa=r.length;b<
fa;b++){J=document.createElement("button");J.className="btn btn-tool";J.id=r[b].id;J.name=d.name;r[b].height&&(J.style.height=r[b].height+"px");r[b].width&&(J.style.width=r[b].width+"px");if(r[b].bgType&&r[b].bgTypeData){switch(r[b].bgType){case "color":x=r[b].bgTypeData;O.className+=" btn-color";break;case "image":x="url("+r[b].bgTypeData+") no-repeat 50% 50%";O.className+=" btn-image";break;default:return}J.style.background=x}v.appendChild(J);x=document.createTextNode(r[b].title);J.appendChild(x)}}f.Utils.domCreationDirector(d.children,
this.domElement)};f.ButtonGroup.prototype=Object.create(_Container.prototype);f.ButtonGroup.prototype.addButton=function(a,f){f||this.setting.buttons.push(a);var d=document.createElement("label");d.className="btn btn-tool"+(a.checked?" active":"");a.height&&(d.style.height=a.height+"px");a.width&&(d.style.width=a.width+"px");if(a.bgType&&a.bgTypeData){var v;switch(a.bgType){case "color":v=a.bgTypeData;d.className+=" btn-color";break;case "image":v="url("+a.bgTypeData+") no-repeat 50% 50%";d.className+=
" btn-image";break;default:return}d.style.background=v}this.domElement.appendChild(d);v=document.createElement("input");a.checked&&v.setAttribute("checked","");v.type=this.setting.buttonType;v.name=this.setting.name;v.id=a.id;v.value=this.setting.buttons.length-1;v.autocomplete="off";d.appendChild(v);v=document.createTextNode(a.title);d.appendChild(v);return d};f.ButtonGroup.prototype.addButtons=function(a,f){for(var d=0,v=a.length;d<v;d++)this.addButton(a[d],f)};f.Utils={};f.Utils.settingMixin=function(a,
f){if("object"===typeof a&&"object"===typeof f){var d={},v;for(v in a)d[v]=a[v];for(var r in f)void 0!==f[r]&&(d[r]=f[r]);return d}return a};f.Utils.domCreationDirector=function(k,s){if(k)if(k instanceof Array)for(var d=0,v=k.length;d<v;d++)f.Utils.domCreationDirector(k[d],s?s:document.body);else k instanceof Object&&k.UIType&&f[a(k.UIType)]&&new (f[a(k.UIType)])(k,s?s:document.body)};window.GoUI=f;"object"===typeof module&&(module.exports=f)})();
var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
AV.initialize("i5m1bad33f8bm725g0lan5wd8hhc1c4qhyz3cyq4b0qoyvja","2w44ugxt0z512vitlk5in4c4a95acbyj8qiqlgcuh3p9xm5t");
(function(a,f,k,s,d){var v,r;function b(){return AV.User.current()&&g&&g.get("user")&&AV.User.current().id!==g.get("user").id}function fa(a){var b=I.textures+(a?-1:1),b=f.getElementById("texture"+b);if(!b&&(b=a?z.length-1:0,b=f.getElementById("texture"+b),!b))return;a=b.parentElement.className.indexOf("btn-color");var c=b.parentElement.className.indexOf("btn-image");-1<a?(v=Number(b.value),f.getElementById("colorTexture").parentElement.click()):-1<c&&(r=Number(b.value),f.getElementById("imageTexture").parentElement.click())}
function O(a,b){var c=b.clone(),e;for(e in a)c[e]=a[e];return c}function x(a){if(null==a.pageX&&null!=a.clientX){var b=f.documentElement,c=f.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}H.set(a.pageX/e.WINDOW_WIDTH*2-1,2*-(a.pageY/e.WINDOW_HEIGHT)+1);za.setFromCamera(H,e.camera);return za.intersectObjects(ia)}function J(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),
a.position.divideScalar(U.width).floor().multiplyScalar(U.width).addScalar(U.width/2))}function T(a){0<a.length&&J(V,a[0])}function M(a,b,c,e,d){var f=c||"openModal",g=e||["myBox","myKeep"];a&&a.then(function(a){$("#"+f+" .modal-body #"+g[0]).html("");for(var b=0,q=a.length;b<q;b++)$("#"+f+" .modal-body #"+g[0]).append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="myBoxData'+b+'" value="'+a[b].id+'" autocomplete="off">  <label id="myBoxDataLabel'+b+'"></label></label>'),
$("#"+f+" .modal-body #myBoxDataLabel"+b).text(a[b].get("name"));1>a.length?$("#openModal .modal-body #boxTitle").hide():$("#openModal .modal-body #boxTitle").show()});b&&b.then(function(a){$("#"+f+" .modal-body #"+g[1]).html("");for(var b=0,q=a.length;b<q;b++)$("#"+f+" .modal-body #"+g[1]).append('<label class="btn btn-primary">  <input type="radio" name="boxData" id="keepBoxData'+b+'" value="'+(d?a[b].id:a[b].get("box")?a[b].get("box").id:"-1")+'" autocomplete="off">  <label id="keepBoxDataLabel'+
b+'"></label></label>'),$("#"+f+" .modal-body #keepBoxDataLabel"+b).text(a[b].get("name")+(a[b].get("box")?"("+a[b].get("box").get("user").get("username")+"/"+a[b].get("box").get("name")+")":""));1>a.length?$("#openModal .modal-body #keepTitle").hide():$("#openModal .modal-body #keepTitle").show()});$("#"+f+"").modal("show")}function D(a,b,c,d){a=a||x(event);if(0<a.length){a=a[0];var f=I.toolsType,g=!1,h=ia.length;if(h&&a.object!==y)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===ia[k]){g=!0;break}0===
f?!0===g&&!1===b||!1===g&&!0===b||(b=ea.draw(0,Aa,void 0,a),d?P.appendObjectToCurrentAction("draw",b):P.addAction("draw",b),e.renderer.render(e.scene,e.camera)):1===f&&c&&a.object!==y&&(b=ea.erase(a.object),d?P.appendObjectToCurrentAction("erase",b):P.addAction("erase",b))}}function ca(){b()||(c.save(c.storageKeys.localChanges,P.changed),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save())}function ba(a){0!==ya||b()||("0"===P.changed||1>L.length&&(!g||g&&!g.id)||!AV.User.current?(c.save(c.storageKeys.camera),
c.save(c.storageKeys.sidebar),c.save()):I.save())}function ga(a){ya=1;b()||("0"===P.changed||1>L.length&&(!g||g&&!g.id)?(c.save(c.storageKeys.localChanges,P.changed),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save()):confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&I.save())}function Z(a){a.preventDefault();var b;if(1===W[0])try{1===ta?ta=0:(ta=1,b=x(a),D(b,a.ctrlKey,a.ctrlKey,!0))}catch(c){console.warn("draw/erase failed")}finally{ta=0}else b=I.toolsType,1===b?
V.visible&&(V.visible=!1):(!V.visible&&t&&(V.visible=!0),b=x(a),T(b))}function oa(a){a.preventDefault();switch(a.button){case 0:if(!F.endFlag){F.instantComplete(F.loadBoxAnimation);break}W[0]=1;a=x(a);D(a,void 0,!0,!1);0===I.toolsType&&T(a);break;case 1:W[1]=1;break;case 2:W[2]=1}}function qa(a){if("label"===this.nodeName.toLowerCase())switch(a=this.getElementsByTagName("input")[0],I[a.name]=Number(a.value),a.name){case "toolsType":1===Number(a.value)?V.visible&&(V.visible=!1):!V.visible&&t&&(V.visible=
!0);break;case "textures":Aa=I[a.name];ua=z[Aa];X=ua.data;Y=ua.helperData=z[I[a.name]].helperData||O(h,X);V.material=Y;f.getElementById("cube").parentElement.click();switch(I.texturesType){case 0:r=a.value;break;default:case 1:v=a.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===a.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":a=a.id,"imageTexture"===a?($(".btn-color").hide(),$(".btn-image").show(),f.getElementById("texture"+
r).parentElement.click()):"colorTexture"===a&&($(".btn-color").show(),$(".btn-image").hide(),f.getElementById("texture"+v).parentElement.click())}else if(("button"===this.type||"button"===this.nodeName.toLowerCase())&&I[this.id])I[this.id]()}function aa(a){switch(a.button){case 0:W[0]=0;P.isCurrentActionAlive=!1;break;case 1:W[1]=0;break;case 2:W[2]=0}}function S(a){switch(a.keyCode){case 67:fa();break;case 88:fa(!0)}}function ja(a){if(!W[0])switch(a.keyCode){case 16:0===I.toolsType?f.getElementById("eraser").parentElement.click():
1===I.toolsType&&f.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&P.undo();break;case 89:a.ctrlKey&&P.redo()}}function G(){requestAnimationFrame(G);e.renderer.render(e.scene,e.camera);e.stats.update()}function A(){var a=$("#openModal input[type=radio]:checked").val();"-1"===a?($("#openModal").modal("hide"),n("\u6536\u85cf\u7684\u6587\u4ef6\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u80fd\u88ab\u4f5c\u8005\u5220\u9664\u6216\u9690\u85cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5220\u9664\u529f\u80fd\u5220\u9664\u6b64\u6536\u85cf\u6216\u8054\u7cfb\u4f5c\u8005")):
(f.getElementById("openIt").removeEventListener("click",A,!1),"0"===P.changed||1>L.length&&(!g||g&&!g.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&I.save(),a&&(new AV.Query(m)).get(a,{success:function(a){I.clearAll();P=new ma;P.updateDom();g=a;c.loadCamera(a.get("camera"),!0);c.loadMeshes(a.get("meshes"),pa,F.loadBoxAnimation,!0);a.get("user").id===AV.User.current().id&&(c.save(c.storageKeys.localChanges,"0"),c.save(c.storageKeys.boxName,g.get("name")),c.save(c.storageKeys.boxId,
g.id),c.save(c.storageKeys.updatedAt,g.updatedAt),c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save())}}),$("#openModal").modal("hide"))}function E(){var a;a="myBox"===$("#openModal input[type=radio]:checked").parent().parent()[0].id?"Box":"Keep";var b=$("#openModal input[type=radio]:checked").val();b&&confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&AV.Object.createWithoutData(a,b).destroy().then(function(a){n("\u5df2\u5220\u9664")},function(a){n("\u5220\u9664\u5931\u8d25")});
$("#openModal").modal("hide")}function ka(){f.getElementById("openIt").removeEventListener("click",onIsertItClick,!1);var a=$("#openModal input[type=radio]:checked").val();"-1"===a?($("#openModal").modal("hide"),n("\u6536\u85cf\u7684\u6587\u4ef6\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u80fd\u88ab\u4f5c\u8005\u5220\u9664\u6216\u9690\u85cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5220\u9664\u529f\u80fd\u5220\u9664\u6b64\u6536\u85cf\u6216\u8054\u7cfb\u4f5c\u8005")):(a&&(new AV.Query(m)).get(a,{success:function(a){n("\u6309\u4f4fctrl\u952e\u53ef\u63d2\u5165\u591a\u4e2a\uff0c\u6309shift\u5207\u6362\u63d2\u5165\u65b9\u5757\u7684\u6750\u8d28")}}),
$("#openModal").modal("hide"))}function la(a){a?($("#loginOpener").hide(),$("#logout").show(),$("#signInOpener").hide(),$("#loginMessage").html("\u4f60\u597d "+AV.User.current().escape("username")),$("#loginMessage").show(),$("#open").removeAttr("disabled"),$("#newFile").removeAttr("disabled"),$("#share").removeAttr("disabled"),$("#delete").removeAttr("disabled"),$("#insert").removeAttr("disabled"),$("#keep").removeAttr("disabled"),$("#currentFileState").show(),$("#currentFileName").show()):($("#loginOpener").show(),
$("#logout").hide(),$("#signInOpener").show(),$("#loginMessage").hide(),$("#open").attr("disabled","disabled"),$("#newFile").attr("disabled","disabled"),$("#share").attr("disabled","disabled"),$("#delete").attr("disabled","disabled"),$("#insert").attr("disabled","disabled"),$("#keep").attr("disabled","disabled"),$("#currentFileState").hide(),$("#currentFileName").hide())}function ra(){var a=g.escape("name")||"\u672a\u547d\u540d",b=("0"===P.changed?"\u672a\u4fee\u6539":"\u5df2\u4fee\u6539")+(g.id?
" - \u4e91\u7aef\u5b58\u50a8":" - \u672c\u5730\u5b58\u50a8");$("#currentFileName").text("\u6587\u4ef6\u540d\uff1a"+a);$("#currentFileState").text("\u6587\u4ef6\u72b6\u6001\uff1a"+b)}function n(a){GoUI.Animation.bubble($("#bubble"),a);ra()}var l=!1,u=f.createElement("a");u.id="imageCapture";u.style.display="none";u.target="_blank";f.body.appendChild(u);var m=AV.Object.extend("Box"),g=new m,N=AV.Object.extend("Keep");new N;d=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=
[];this.currentIterator=0};d.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=F.currentMeshes;F.currentIterator<a.length?a[F.currentIterator].meshObject.visible=!0:(F.endFlag=!0,clearInterval(F.currentAnimationIntervalHandler));F.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=F.currentMeshes;
for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var w=function(a){this.isLoadingBoxEnd=a};w.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar",boxId:"vp_box_id",updatedAt:"vp_updatedAt",boxName:"vp_box_name",localChanges:"vp_local_changes"},load:function(b){return a.localStorage&&a.localStorage.getItem(b||this.storageKeys.meshes)},save:function(b,c){if(a.localStorage){var d="";if(c)d=
c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>P.currentActionIndex)return;for(var d=d+(U.width+":"),f=0,p=L.length;f<p;f++)d+=L[f].geo.id.replace("geo","")+",",d+=L[f].material.id.replace("texture","")+",",d+=L[f].meshObject.position.x+",",d+=L[f].meshObject.position.y+",",d+=L[f].meshObject.position.z+";";break;case this.storageKeys.camera:d+=e.controls.target.x+","+e.controls.target.y+","+e.controls.target.z+";";d+=e.controls.object.position.x+","+
e.controls.object.position.y+","+e.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=r+","+v+","+I.texturesType+","+I.sidebarResize}a.localStorage.setItem(b||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c,d){this.isLoadingBoxEnd=!1;var e=[],f=U.width;if(a=d?a:this.load(a))if(a=a.split(":"))2===a.length?(f=(Number(a[0])||50)/U.width,e=a[1].split(";")):(f=50/U.width,e=a[0].split(";"));if(0<e.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=e.length;b<a;b++){var g=e[b].split(",");
2<g.length&&ea.draw(Number(g[0]),Number(g[1]),[Number(g[2])/f,Number(g[3])/f,Number(g[4])/f])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=e.length;b<a;b++)g=e[b].split(","),2<g.length&&ea.draw(Number(g[0]),Number(g[1]),[Number(g[2])/f,Number(g[3])/f,Number(g[4])/f],void 0,void 0,!0);F.begin(c,L);d?n("\u8f7d\u5165\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b"):n("\u8f7d\u5165\u672c\u5730\u6570\u636e\u5b8c\u6210\uff0c\u5de6\u952e\u5355\u51fb\u53ef\u7acb\u5373\u5b8c\u6210\u52a8\u753b")}else n("\u65e0\u672c\u5730\u6570\u636e\uff0c\u65b0\u5efa\u6587\u4ef6"),
F.endFlag=!0},loadMeshesTo:function(a,b){var c=[],d=U.width;if(a){var e=a.split(":");e&&(2===e.length?(d=(Number(e[0])||50)/U.width,c=e[1].split(";")):(d=50/U.width,c=e[0].split(";")))}if(0<c.length)for(var e=0,f=c.length;e<f;e++){var g=c[e].split(",");if(2<g.length){var h=new s.Mesh(va[Number(g[0])||0].data,z[Number(g[1])||0].data);h.position.set(Number(g[2])/d,Number(g[3])/d,Number(g[4])/d);b.push(h)}}return b},loadRemote:function(){if(a.localStorage){var b=this.load(this.storageKeys.boxId),d=this.load(this.storageKeys.updatedAt);
if(b){n("\u8f7d\u5165\u4e91\u7aef\u6587\u4ef6...");var e=new AV.Query(m);e.select("name","user");e.equalTo("objectId",b);e.first({success:function(a){if(a.updatedAt.toString()===d)g=a,a.set("meshes",c.load(c.storageKeys.meshes)),a.set("camera",c.load(c.storageKeys.camera)),c.save(c.storageKeys.boxName,g.get("name")),P.changed=c.load(c.storageKeys.localChanges),c.loadCamera(g.get("camera"),!0),c.loadMeshes(g.get("meshes"),pa,F.loadBoxAnimation,!0);else if(g=a,a.get("user").id===AV.User.current().id){var b=
P.changed=c.load(c.storageKeys.localChanges);"0"===b||"0"!==b&&confirm("\u4e0a\u6b21\u5173\u95ed\u524d\u53ef\u80fd\u672a\u5b8c\u6210\u4fdd\u5b58\uff0c\u662f\u5426\u8f7d\u5165\uff1f")?(b=new AV.Query(m),b.get(a.id,{success:function(a){g=a;c.loadCamera(g.get("camera"),!0);c.loadMeshes(g.get("meshes"),pa,F.loadBoxAnimation,!0);c.save(c.storageKeys.boxName,g.get("name"));c.save(c.storageKeys.updatedAt,g.updatedAt);c.save(c.storageKeys.camera);c.save()},error:function(b,e){a.set("meshes",c.load(c.storageKeys.meshes));
a.set("camera",c.load(c.storageKeys.camera));c.loadMeshes(void 0,pa,F.loadBoxAnimation)}})):(g=new m,c.save(c.storageKeys.boxId,""),c.save(c.storageKeys.updatedAt,""),c.save(c.storageKeys.boxName,""),c.save(c.storageKeys.localChanges,"1"),this.changed=1,c.loadMeshes(void 0,pa,F.loadBoxAnimation),n("\u7531\u4e8e\u672c\u5730\u6b64\u6587\u4ef6\u4e0e\u4e91\u7aef\u6587\u4ef6\u5728\u540c\u4e00\u6587\u4ef6\u7684\u57fa\u7840\u4e0a\u505a\u4e86\u4e0d\u540c\u7684\u6539\u52a8\uff0c\u5c06\u672c\u5730\u7248\u672c\u4e0e\u4e91\u7aef\u6b64\u6587\u4ef6\u89c6\u4e3a\u4e0d\u540c\u7684\u6587\u4ef6"))}else b=
new AV.Query(m),b.get(a.id,{success:function(a){g=a;c.loadCamera(g.get("camera"),!0);c.loadMeshes(g.get("meshes"),pa,F.loadBoxAnimation,!0)},error:function(a,b){c.loadMeshes(void 0,pa,F.loadBoxAnimation)}})},error:function(a,b){n("\u8f7d\u5165\u5931\u8d25\uff0c"+b.message);c.loadMeshes(void 0,pa,F.loadBoxAnimation)}})}else c.loadMeshes(void 0,pa,F.loadBoxAnimation)}},loadShared:function(a,b){(new AV.Query(m)).get(a,{success:function(a){g=a;c.loadCamera(g.get("camera"),!0);c.loadMeshes(g.get("meshes"),
pa,F.loadBoxAnimation,!0);n("\u5df2\u8f7d\u5165\u5206\u4eab\u6587\u4ef6")},error:function(a,c){b()}})},loadCamera:function(a,b){var c=[],d=b?a:this.load(a);d&&(c=d.split(";"));if(0<c.length){for(var d=0,f=c.length;d<f;d++){var g=c[d].split(",");switch(d){case 0:e.controls.target.set(Number(g[0])||0,Number(g[1])||0,Number(g[2])||0);break;case 1:e.controls.object.position.set(Number(g[0])||0,Number(g[1])||0,Number(g[2])||0)}}e.controls.update()}},loadSidebarSelectedButtons:function(a,b){var c=[],d=
b?a:this.load(a);d&&(c=d.split(","));if(0<c.length)for(var d=0,e=c.length;d<e;d++){var g=c[d];if(""!==g&&!isNaN(Number(g)))switch(d){case 0:r=Number(g)||0;break;case 1:v=Number(g)||0;break;case 2:1===Number(g)?f.getElementById("colorTexture").parentElement.click():f.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(g)?f.getElementById("minSidebar").parentElement.click():f.getElementById("normalSidebar").parentElement.click()}}else f.getElementById("imageTexture").parentElement.click()}};
var ma=function(){this.currentActionIndex=-1;this.actionArray=[];this.isCurrentActionAlive=void 0;this.changed="0"};ma.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=ea.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ea.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;
case "erase":ea.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ea.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ea.erase(e.meshObject)}}this.currentActionIndex++;
this.updateDom()}},addAction:function(a,e){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.isCurrentActionAlive=!0;this.actionArray.push({type:a,meshes:e});this.currentActionIndex++;this.updateDom();if(b())if(confirm("\u786e\u5b9a\u8981\u4fee\u6539\u5417\uff1f\uff08\u5c06\u4f1a\u4f5c\u4e3a\u65b0\u5efa\u7684\u6587\u4ef6\u8986\u76d6\u672c\u5730\u4fdd\u5b58\u7684\u6570\u636e\uff09"))g=new m,c.save(c.storageKeys.boxId,""),c.save(c.storageKeys.updatedAt,""),c.save(c.storageKeys.boxName,
""),c.save(c.storageKeys.localChanges,"1"),n("\u5df2\u6839\u636e\u5f53\u524d\u5185\u5bb9\u65b0\u5efa\u6587\u4ef6");else{this.undo();return}this.changed=1;ra()},appendObjectToCurrentAction:function(a,b){var c=this.actionArray[this.currentActionIndex];if(!0!==this.isCurrentActionAlive)this.addAction(a,b);else if(void 0===c.meshes)c.meshes=b;else if(c.meshes instanceof Array||(c.meshes=[c.meshes]),b instanceof Array)for(var e=0,d=b.length;e<d;e++)c.meshes.push(b[e]);else c.meshes.push(b)},updateDom:function(){f.getElementById("undo").disabled=
0>this.currentActionIndex?!0:!1;f.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var B=function(){this.drawFlag=!1};B.prototype={calculateIntersectResult:x,setMeshPositionToFitTheGrid:J,updateHelperCube:T,draw:function(a,b,c,d,f,g){if(void 0===a||"number"===typeof a)a=va[a||0];if(void 0===b||"number"===typeof b)b=z[b||0];var h=a.data,k=b.data;f=f||new s.Mesh(h,k);f.castShadow=!0;f.receiveShadow=!0;d?J(f,d):f.position.set(c[0],c[1],c[2]);!g||(f.visible=!1);
e.scene.add(f);ia.push(f);L.push({meshObject:f,geo:a,material:b});return L[L.length-1]},erase:function(a){e.scene.remove(a);a=ia.indexOf(a);if(!(0>a)){ia.splice(a,1);var b=L[a-1];L.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};s.ImageUtils.crossOrigin="Anonymous";var e,U={width:50},R=U.width/50,ha={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*R,basePlaneTextureRepeat:80,fogNear:8E3*R,fogFar:25E3*R,sphereRadius:25E3*
R},canvas:{ambientLightColor:9474192,directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*R,basePlaneTextureRepeat:16,fogNear:2E3*R,fogFar:3E3*R,sphereRadius:3E3*R}},C,y,sa,ya=0,pa=w.prototype.LOAD_TYPE.async,K=new s.MeshLambertMaterial({color:592137}),h={opacity:.5,transparent:!0},z=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:K,helperData:O(h,K)}],va=[{name:"default",type:"1",id:"geo0",data:new s.BoxGeometry(U.width,U.width,U.width,1,1,1)}];r=30;v=0;var t=!0,
I={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===I.toolsType||(V.visible=!V.visible);t=!t},capture:function(){var b=e.renderer.domElement,c=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var d=navigator.userAgent,f=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=f.exec(d)?c=parseFloat(RegExp.$1):(f=/rv:([0-9]{1,}[.0-9]{0,})/,null!=f.exec(d)&&(c=parseFloat(RegExp.$1)))}-1!==c?(a.navigator.saveBlob=a.navigator.saveBlob||
a.navigator.msSaveBlob,b.msToBlob&&a.navigator.saveBlob?a.navigator.saveBlob(b.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(u.href=b.toDataURL(),u.download="capture.png",u.click())},clearAll:function(){F.endFlag||F.instantComplete(F.loadBoxAnimation);if(!(1>L.length)){var a=ea.erase(L[0].meshObject);P.addAction("erase",a);for(var b=0,c=L.length;b<c;b++)a=ea.erase(L[0].meshObject),P.appendObjectToCurrentAction("erase",a)}},undo:function(){P.undo()},
redo:function(){P.redo()},signInOpener:function(){$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");$("#signInError").parent().hide();$("#signInModal").modal("show");$("#signInEmail").focus()},loginOpener:function(){$("#loginUsername").val("");$("#loginPassword").val("");$("#loginError").parent().hide();$("#loginModal").modal("show");$("#loginUsername").focus()},logout:function(){AV.User.current()&&AV.User.logOut();la(!1);n("\u5df2\u767b\u51fa")},save:function(){if(AV.User.current()){if("0"!==
P.changed||g.id){var a;a=""+(U.width+":");for(var b=0,d=L.length;b<d;b++)a+=L[b].geo.id.replace("geo","")+",",a+=L[b].material.id.replace("texture","")+",",a+=L[b].meshObject.position.x+",",a+=L[b].meshObject.position.y+",",a+=L[b].meshObject.position.z+";";b=""+(e.controls.target.x+","+e.controls.target.y+","+e.controls.target.z+";");b+=e.controls.object.position.x+","+e.controls.object.position.y+","+e.controls.object.position.z+";";g.set("camera",b||"0,0,0;1000,500,1000");g.set("meshes",a||"");
g.id||(a=prompt("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d",g.get("name")||c.load(c.storageKeys.boxName)||"\u672a\u547d\u540d"),g.set("name",a||"\u672a\u547d\u540d"),g.set("user",AV.User.current()),g.setACL(new AV.ACL(AV.User.current())));g.save({success:function(a){n("\u5df2\u4fdd\u5b58\u81f3\u4e91\u7aef");c.save(c.storageKeys.updatedAt,a.updatedAt);c.save(c.storageKeys.boxId,a.id);c.save(c.storageKeys.boxName,a.get("name"))},error:function(a,b){n("\u4e91\u7aef\u4fdd\u5b58\u5931\u8d25\uff0c\u5c06\u4f1a\u4fdd\u5b58\u5728\u672c\u5730"+
b.message);c.save(c.storageKeys.boxName,a.get("name"));P.changed="1";c.save(c.storageKeys.localChanges,"1")}})}else n("\u6587\u4ef6\u672a\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u5c06\u672c\u5730\u4fdd\u5b58");P.changed="0";c.save(c.storageKeys.localChanges,"0");c.save(c.storageKeys.camera);c.save(c.storageKeys.sidebar);c.save()}else c.save(c.storageKeys.camera),c.save(c.storageKeys.sidebar),c.save(),a="\u5df2\u4fdd\u5b58\u5728\u672c\u5730",l||(a+="\uff0c\u767b\u5f55\u540e\u53ef\u5411\u4e91\u7aef\u4fdd\u5b58\u591a\u4e2a\u6587\u4ef6",
l=!0),n(a)},newFile:function(){"0"===P.changed||1>L.length&&(!g||g&&!g.id)||confirm("\u662f\u5426\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\uff1f")&&I.save();I.clearAll();P=new ma;P.updateDom();g=new m;c.save(c.storageKeys.localChanges,"0");c.save(c.storageKeys.camera);c.save(c.storageKeys.sidebar);c.save(c.storageKeys.updatedAt,"");c.save(c.storageKeys.boxName,"");c.save();n("\u65b0\u5efa")},open:function(){f.getElementById("openIt").removeEventListener("click",A,!1);f.getElementById("openIt").removeEventListener("click",
E,!1);f.getElementById("openIt").removeEventListener("click",ka,!1);f.getElementById("openIt").addEventListener("click",A,!1);var a=new AV.Query(m);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(N);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());M(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},
share:function(){var a=new AV.Query(m);a.select("name");a.equalTo("user",AV.User.current());M(a.find(),void 0,"shareModal",["boxToShare"])},"delete":function(){f.getElementById("openIt").removeEventListener("click",A,!1);f.getElementById("openIt").removeEventListener("click",E,!1);f.getElementById("openIt").removeEventListener("click",ka,!1);f.getElementById("openIt").addEventListener("click",E,!1);var a=new AV.Query(m);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(N);b.select("name");
b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());M(a.find(),b.find(),void 0,void 0,!0);$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")},keep:function(){if(g&&g.id){var a=AV.Object.createWithoutData("Box",g.id),b=new AV.Query(N);b.equalTo("user",AV.User.current());b.equalTo("box",a);b.count().then(function(b){0<b?n("\u60a8\u5df2\u6536\u85cf\u8fc7\u6b64\u6587\u4ef6"):
(b=new N,b.set("box",a),b.set("name",prompt("\u6536\u85cf\u540d\u79f0")),b.set("user",AV.User.current()),b.setACL(new AV.ACL(AV.User.current())),b.save().then(function(){n("\u5df2\u6536\u85cf")},function(){n("\u6536\u85cf\u5931\u8d25")}))},function(a){n("\u6536\u85cf\u5931\u8d25")})}else n("\u53ea\u80fd\u6536\u85cf\u5df2\u4fdd\u5b58\u7684\u6587\u4ef6")},insert:function(){f.getElementById("openIt").removeEventListener("click",A,!1);f.getElementById("openIt").removeEventListener("click",E,!1);f.getElementById("openIt").removeEventListener("click",
ka,!1);f.getElementById("openIt").addEventListener("click",ka,!1);var a=new AV.Query(m);a.select("name");a.equalTo("user",AV.User.current());var b=new AV.Query(N);b.select("name");b.select("box.name","box.user.username");b.include("box.name","box.user.username");b.equalTo("user",AV.User.current());M(a.find(),b.find());$("#openModal .modal-body #boxTitle").text("\u6211\u7684\u6587\u4ef6");$("#openModal .modal-body #keepTitle").text("\u6211\u7684\u6536\u85cf")}},Aa=0,ua=z[0],X=ua.data,Y=ua.helperData,
Ba=va[0].data,V,ia=[],L=[],na,da,wa,H,W=[0,0,0],za,Ca,F=new d,c=new w(!1),P=new ma,ea=new B,ta=0;e=new k(f.body);e.init(function(b){if(e.WINDOW_WIDTH!==a.innerWidth||e.WINDOW_HEIGHT!==a.innerHeight)e.WINDOW_WIDTH=a.innerWidth,e.WINDOW_HEIGHT=a.innerHeight,e.WINDOW_HEIGHT_HALF=e.WINDOW_HEIGHT/2,e.WINDOW_WIDTH_HALF=e.WINDOW_WIDTH/2,e.camera.aspect=e.WINDOW_WIDTH/e.WINDOW_HEIGHT,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.WINDOW_WIDTH,e.WINDOW_HEIGHT),f.body.height=e.WINDOW_HEIGHT},function(){C=
new s.PlaneBufferGeometry(ha[e.renderType].basePlaneWidth,ha[e.renderType].basePlaneWidth,ha[e.renderType].basePlaneSegments,ha[e.renderType].basePlaneSegments);C.applyMatrix((new s.Matrix4).makeRotationX(-Math.PI/2));var b=s.ImageUtils.loadTexture("texture/grasslight-big.jpg"),c=s.ImageUtils.loadTexture("texture/sky.jpg");b.wrapT=b.wrapS=s.RepeatWrapping;b.repeat.set(ha[e.renderType].basePlaneTextureRepeat,ha[e.renderType].basePlaneTextureRepeat);sa=new s.MeshPhongMaterial({ambient:16777215,color:14535731,
map:b,bumpMap:b,bumpScale:3,specular:3364147,shininess:15,emissive:16777215});y=new s.Mesh(C,sa);y.receiveShadow=!0;y.material.side=s.DoubleSide;e.scene.add(y);ia.push(y);na=new s.AmbientLight(ha[e.renderType].ambientLightColor);e.scene.add(na);da=new s.DirectionalLight(15658734,ha[e.renderType].directionalLightDensity);da.position.set(0,6E3,5E3);da.target.position.set(0,0,0);da.castShadow=!0;da.shadowCameraNear=e.camera.near;da.shadowCameraFar=e.camera.far;da.shadowCameraFov=e.cam;da.shadowCameraTop=
-1024*R;da.shadowCameraLeft=-1024*R;da.shadowCameraBottom=1024*R;da.shadowCameraRight=1024*R;da.shadowBias=2E-5;da.shadowDarkness=.4;da.shadowMapWidth=2048*R;da.shadowMapHeight=2048*R;e.scene.add(da);wa=new s.HemisphereLight(16777215,6316128,1);e.scene.add(wa);b=new s.SphereGeometry(ha[e.renderType].sphereRadius,32,15,0,2*Math.PI,0,Math.PI/2);c=new s.MeshLambertMaterial({color:3368703,map:c,side:s.BackSide,emissive:16777215});c=new s.Mesh(b,c);e.scene.add(c);V=new s.Mesh(Ba,Y);V.position.set(U.width/
2,U.width/2,U.width/2);e.scene.add(V);new s.Mesh(Ba,X);za=new s.Raycaster;H=new s.Vector2;Ca=new s.FogExp2(16777215,5.3E-5);e.scene.fog=Ca;e.controls.settings.boxScale=R;e.renderer.setClearColor(15790320);e.renderer.shadowMapEnabled=!0;e.renderer.shadowMapType=s.PCFSoftShadowMap;e.renderer.shadowMapCullFace=s.CullFaceBack;e.renderer.gammaInput=!0;e.renderer.gammaOutput=!0;a.addEventListener("unload",ba,!1);a.addEventListener("reload",ga,!1);e.renderer.domElement.addEventListener("mousemove",Z,!1);
e.renderer.domElement.addEventListener("mousedown",oa,!1);e.renderer.domElement.addEventListener("mouseup",aa,!1);f.addEventListener("keydown",S,!1);f.addEventListener("keyup",ja,!1);setInterval(ca,12E4)});G();w={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"buttonGroup",id:"accountControl",name:"accountControl",buttonType:"button",appendClass:"btn-group-accountbtn",
buttons:[{title:"\u6ce8\u518c",id:"signInOpener"},{title:"\u767b\u5f55",id:"loginOpener"},{title:"\u767b\u51fa",id:"logout"},{title:"\u767b\u5f55\u540e\u65b9\u53ef\u4fdd\u5b58\u6570\u636e\u5230\u4e91\u7aef",id:"loginMessage"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",
name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u6587\u4ef6",name:"files",id:"panelFiles",children:[{UIType:"buttonGroup",id:"currentFileNameGroup",name:"cfn",buttonType:"button",appendClass:"btn-group-cfnbtn",buttons:[{title:"",id:"currentFileName"}]},{UIType:"buttonGroup",id:"currentFileStateGroup",name:"cfs",buttonType:"button",appendClass:"btn-group-cfsbtn",buttons:[{title:"",id:"currentFileState"}]},{UIType:"buttonGroup",
id:"buttonGroupADM",name:"adm",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u65b0\u5efa",id:"newFile"},{title:"\u4fdd\u5b58",id:"save"},{title:"\u6536\u85cf",id:"keep"},{title:"\u6253\u5f00...",id:"open"},{title:"\u63d2\u5165...",id:"insert"},{title:"\u5220\u9664...",id:"delete"},{title:"\u5171\u4eab...",id:"share"}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",
appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux"},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo"},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",
title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:z[0].type,bgTypeData:z[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>e.WINDOW_WIDTH){B=w.children;d=0;for(k=B.length;d<k;d++)if("sidebarResize"===B[d].id){d=B[d].buttons;B=0;for(k=d.length;B<
k;B++)"normalSidebar"===d[B].id&&delete d[B].checked,"minSidebar"===d[B].id&&(d[B].checked=!0);break}I.sidebarResize=1}else I.sidebarResize=0;GoUI.Utils.domCreationDirector(w);P.updateDom();k=f.querySelectorAll(".btn");if(k instanceof Array||k.length)for(d=k.length-1;0<=d;d--)k[d].addEventListener("click",qa,!1);else k instanceof object&&k.addEventListener("click",qa,!1);B=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},
{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];d=0;for(k=B.length;d<k;d++)w={name:B[d].color,type:"color",id:"texture"+(d+1),uniqueData:B[d].color,data:new s.MeshLambertMaterial({color:B[d].color})},
z.push(w),GoUI.map.buttonGroup2.addButton({title:"",id:w.id,bgType:w.type,bgTypeData:w.uniqueData,width:50,height:50}).addEventListener("click",qa,!1);B="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");d=0;for(k=B.length;d<k;d++)w={name:B[d].replace("texture/","").replace(".png",""),type:"image",id:"texture"+z.length,uniqueData:B[d],data:new s.MeshLambertMaterial({map:s.ImageUtils.loadTexture(B[d]),
transparent:!0})},"glass"===w.data.name&&(w.data.map.opacity=.3),w.data.map.magFilter=s.NearestFilter,w.data.map.minFilter=s.LinearMipMapLinearFilter,z.push(w),GoUI.map.buttonGroup2.addButton({title:"",id:w.id,bgType:w.type,bgTypeData:w.uniqueData,width:50,height:50}).addEventListener("click",qa,!1);$("#loginUsername").on("keyup",function(a){13===a.which&&f.getElementById("login").click()});$("#loginPassword").on("keyup",function(a){13===a.which&&f.getElementById("login").click()});f.getElementById("login").addEventListener("click",
function(){var a=$("#loginUsername").val(),b=$("#loginPassword").val(),d=$("#login");d.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.logIn(a,b,{success:function(a){la(!0);d.removeAttr("disabled");$("#loginModal").modal("hide");n("\u4f60\u597d"+AV.User.current().escape("username"));$("#loginUsername").val("");$("#loginPassword").val("");c.loadRemote()},error:function(a,b){$("#loginError").html(b.message);$("#loginError").parent().show();d.removeAttr("disabled")}})},!1);f.getElementById("signIn").addEventListener("click",
function(){var a=$("#signInEmail").val(),b=$("#signInUsername").val(),d=$("#signInPassword").val(),e=$("#signIn");e.attr("disabled","disabled");AV.User.current()&&AV.User.logOut();AV.User.signUp(b,d,{ACL:new AV.ACL,email:a},{success:function(a){la(!0);e.removeAttr("disabled");$("#signInModal").modal("hide");n("\u4f60\u597d"+AV.User.current().escape("username"));$("#signInEmail").val("");$("#signInUsername").val("");$("#signInPassword").val("");c.loadRemote()},error:function(a,b){$("#signInError").html(b.message);
$("#signInError").parent().show();e.removeAttr("disabled")}})},!1);f.getElementById("shareIt").addEventListener("click",function(){var a=$("#shareModal input[type=radio]:checked").val();if(a){var b=new AV.Query(m);b.equalTo("objectId",a);b.select("shared");b.first().then(function(b){if(!b.get("shared")){var c=new AV.ACL(AV.User.current());c.setPublicReadAccess(!0);b.setACL(c);b.set("shared",!0);b.save().then(function(){n("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")},
function(){n("\u5206\u4eab\u5931\u8d25")})}$("#shareLink").val("http://gonster.github.io/helloThreeJS/voxel-paint#"+a);n("\u5206\u4eab\u6210\u529f\uff0c\u53ef\u901a\u8fc7\u663e\u793a\u7684\u94fe\u63a5\u6253\u5f00\u5206\u4eab\u5185\u5bb9")})}},!1);f.getElementById("setItPrivate").addEventListener("click",function(){var a=$("#shareModal input[type=radio]:checked").val();if(a){var b=new AV.Query(m);b.equalTo("objectId",a);b.select("shared");b.first().then(function(a){if(a.get("shared")){var b=new AV.ACL(AV.User.current());
a.setACL(b);a.set("shared",!1);a.save().then(function(){n("\u53d6\u6d88\u5206\u4eab\u6210\u529f")},function(){n("\u53d6\u6d88\u5206\u4eab\u5931\u8d25")})}})}},!1);c.loadCamera(c.storageKeys.camera);c.loadSidebarSelectedButtons(c.storageKeys.sidebar);AV.User.current()?(la(!0),(k=a.location.hash)?(k=k.substring(1),c.loadShared(k,function(){n("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25");c.loadRemote()})):c.loadRemote()):(la(!1),(k=a.location.hash)?(k=k.substring(1),c.loadShared(k,function(){n("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25");
c.loadMeshes(void 0,pa,F.loadBoxAnimation)})):c.loadMeshes(void 0,pa,F.loadBoxAnimation));a.addEventListener("hashchange",function(){var b=a.location.hash;b&&(b=b.substring(1),c.loadShared(b,function(){n("\u8f7d\u5165\u5206\u4eab\u6587\u4ef6\u5931\u8d25")}))},!1);$(".modal").on("hidden.bs.modal",function(){f.addEventListener("keydown",S,!1);f.addEventListener("keyup",ja,!1);e.controls.addKeyEventListener()});$(".modal").on("shown.bs.modal",function(){f.removeEventListener("keydown",S,!1);f.removeEventListener("keyup",
ja,!1);e.controls.removeKeyEventListener()})})(window,document,Base,THREE,Detector);
