THREE.SpriteCanvasMaterial=function(g){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(g,e){};this.setValues(g)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var g=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,g);g.color.copy(this.color);g.program=this.program;return g};
THREE.CanvasRenderer=function(g){function n(l,a,N,c){E(a);J(N);F(c);O(l.getStyle());b.stroke();fa.expandByScalar(2*a)}function e(l){x(l.getStyle());b.fill()}function q(l){h(l.target)}function h(l){if(!(l instanceof THREE.CompressedTexture)){var a=l.wrapS===THREE.RepeatWrapping,N=l.wrapT===THREE.RepeatWrapping,c=l.image,d=document.createElement("canvas");d.width=c.width;d.height=c.height;var e=d.getContext("2d");e.setTransform(1,0,0,-1,0,c.height);e.drawImage(c,0,0);A[l.id]=b.createPattern(d,!0===
a&&!0===N?"repeat":!0===a&&!1===N?"repeat-x":!1===a&&!0===N?"repeat-y":"no-repeat")}}function a(l,a,N,c,d,e,k,ba,g,s,n,V,f){if(!(f instanceof THREE.DataTexture)){!1===f.hasEventListener("update",q)&&(void 0!==f.image&&0<f.image.width&&h(f),f.addEventListener("update",q));var p=A[f.id];if(void 0!==p){x(p);var p=f.offset.x/f.repeat.x,m=f.offset.y/f.repeat.y,Q=f.image.width*f.repeat.x;f=f.image.height*f.repeat.y;k=(k+p)*Q;ba=(ba+m)*f;N-=l;c-=a;d-=l;e-=a;g=(g+p)*Q-k;s=(s+m)*f-ba;n=(n+p)*Q-k;V=(V+m)*f-
ba;f=g*V-n*s;0!==f&&(p=1/f,f=(V*N-s*d)*p,s=(V*c-s*e)*p,N=(g*d-n*N)*p,c=(g*e-n*c)*p,l=l-f*k-N*ba,a=a-s*k-c*ba,b.save(),b.transform(f,s,N,c,l,a),b.fill(),b.restore())}else x("rgba(0,0,0,1)"),b.fill()}}function f(l,a,N){var c=a.x-l.x,b=a.y-l.y,d=c*c+b*b;0!==d&&(N/=Math.sqrt(d),c*=N,b*=N,a.x+=c,a.y+=b,l.x-=c,l.y-=b)}function r(l){W!==l&&(W=b.globalAlpha=l)}function X(l){va!==l&&(l===THREE.NormalBlending?b.globalCompositeOperation="source-over":l===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
l===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),va=l)}function E(l){pa!==l&&(pa=b.lineWidth=l)}function J(l){y!==l&&(y=b.lineCap=l)}function F(l){ua!==l&&(ua=b.lineJoin=l)}function O(l){z!==l&&(z=b.strokeStyle=l)}function x(l){ga!==l&&(ga=b.fillStyle=l)}function D(l){ha.length!==l.length&&(b.setLineDash(l),ha=l)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ma=THREE.Math.smoothstep;g=g||{};var la=this,da,S,ia,sa=new THREE.Projector,v=void 0!==g.canvas?g.canvas:document.createElement("canvas"),
P=v.width,p=v.height,m=Math.floor(P/2),t=Math.floor(p/2),Y=0,k=0,R=P,T=p,c=1,b=v.getContext("2d",{alpha:!0===g.alpha}),aa=new THREE.Color(0),U=!0===g.alpha?0:1,W=1,va=0,z=null,ga=null,pa=null,y=null,ua=null,ha=[],na,w,V,Q;new THREE.RenderableVertex;new THREE.RenderableVertex;var ta,ea,G,d,C,wa,s=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var ya=new THREE.Color,za=new THREE.Color,M=new THREE.Color,A={},H,ja,ka,l,N,ba,xa,oa=new THREE.Box2,I=new THREE.Box2,fa=new THREE.Box2,
Ba=new THREE.Color,Ca=new THREE.Color,Da=new THREE.Color,qa=new THREE.Vector3,Ea=new THREE.Vector3,ra=new THREE.Vector3,Aa=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=v;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return c};this.setPixelRatio=function(l){c=l};this.setSize=function(l,a,N){P=l*c;p=a*c;v.width=
P;v.height=p;m=Math.floor(P/2);t=Math.floor(p/2);!1!==N&&(v.style.width=l+"px",v.style.height=a+"px");oa.min.set(-m,-t);oa.max.set(m,t);I.min.set(-m,-t);I.max.set(m,t);W=1;va=0;ua=y=pa=ga=z=null;this.setViewport(0,0,l,a)};this.setViewport=function(l,a,N,b){Y=l*c;k=a*c;R=N*c;T=b*c};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(l,a){aa.set(l);U=void 0!==a?a:1;I.min.set(-m,-t);I.max.set(m,t)};this.setClearColorHex=function(l,a){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(l,a)};this.getClearColor=function(){return aa};this.getClearAlpha=function(){return U};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===I.empty()&&(I.intersect(oa),I.expandByScalar(2),I.min.x+=m,I.min.y=-I.min.y+t,I.max.x+=m,I.max.y=-I.max.y+t,1>U&&b.clearRect(I.min.x|0,I.max.y|0,I.max.x-I.min.x|0,I.min.y-I.max.y|0),0<U&&(X(THREE.NormalBlending),r(1),x("rgba("+Math.floor(255*aa.r)+","+Math.floor(255*aa.g)+","+Math.floor(255*aa.b)+","+U+")"),b.fillRect(I.min.x|
0,I.max.y|0,I.max.x-I.min.x|0,I.min.y-I.max.y|0)),I.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(c,g){if(!1===g instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();la.info.render.vertices=0;la.info.render.faces=0;b.setTransform(R/P,0,0,-T/p,Y,p-k);b.translate(m,t);da=sa.projectScene(c,g,this.sortObjects,this.sortElements);
S=da.elements;ia=da.lights;na=g;Aa.getNormalMatrix(g.matrixWorldInverse);Ba.setRGB(0,0,0);Ca.setRGB(0,0,0);Da.setRGB(0,0,0);for(var aa=0,U=ia.length;aa<U;aa++){var u=ia[aa],L=u.color;u instanceof THREE.AmbientLight?Ba.add(L):u instanceof THREE.DirectionalLight?Ca.add(L):u instanceof THREE.PointLight&&Da.add(L)}aa=0;for(U=S.length;aa<U;aa++){var B=S[aa],y=B.material;if(void 0!==y&&0!==y.opacity){fa.makeEmpty();if(B instanceof THREE.RenderableSprite){w=B;w.x*=m;w.y*=t;var u=w,K=B,L=y;r(L.opacity);X(L.blending);
var z=K.scale.x*m,K=K.scale.y*t,B=.5*Math.sqrt(z*z+K*K);fa.min.set(u.x-B,u.y-B);fa.max.set(u.x+B,u.y+B);if(L instanceof THREE.SpriteMaterial){var Z=L.map;if(null!==Z&&void 0!==Z.image){!1===Z.hasEventListener("update",q)&&(0<Z.image.width&&h(Z),Z.addEventListener("update",q));B=A[Z.id];void 0!==B?x(B):x("rgba( 0, 0, 0, 1 )");var ca=Z.image,B=ca.width*Z.offset.x,y=ca.height*Z.offset.y,v=ca.width*Z.repeat.x,Z=ca.height*Z.repeat.y,ca=z/v,ha=K/Z;b.save();b.translate(u.x,u.y);0!==L.rotation&&b.rotate(L.rotation);
b.translate(-z/2,-K/2);b.scale(ca,ha);b.translate(-B,-y);b.fillRect(B,y,v,Z)}else x(L.color.getStyle()),b.save(),b.translate(u.x,u.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(z,-K),b.fillRect(-.5,-.5,1,1);b.restore()}else L instanceof THREE.SpriteCanvasMaterial&&(O(L.color.getStyle()),x(L.color.getStyle()),b.save(),b.translate(u.x,u.y),0!==L.rotation&&b.rotate(L.rotation),b.scale(z,K),L.program(b),b.restore())}else if(B instanceof THREE.RenderableLine){if(w=B.v1,V=B.v2,w.positionScreen.x*=m,w.positionScreen.y*=
t,V.positionScreen.x*=m,V.positionScreen.y*=t,fa.setFromPoints([w.positionScreen,V.positionScreen]),!0===oa.isIntersectionBox(fa))if(u=w,L=V,z=B,K=y,r(K.opacity),X(K.blending),b.beginPath(),b.moveTo(u.positionScreen.x,u.positionScreen.y),b.lineTo(L.positionScreen.x,L.positionScreen.y),K instanceof THREE.LineBasicMaterial){E(K.linewidth);J(K.linecap);F(K.linejoin);if(K.vertexColors!==THREE.VertexColors)O(K.color.getStyle());else if(B=z.vertexColors[0].getStyle(),z=z.vertexColors[1].getStyle(),B===
z)O(B);else{try{var ga=b.createLinearGradient(u.positionScreen.x,u.positionScreen.y,L.positionScreen.x,L.positionScreen.y);ga.addColorStop(0,B);ga.addColorStop(1,z)}catch(pa){ga=B}O(ga)}b.stroke();fa.expandByScalar(2*K.linewidth)}else K instanceof THREE.LineDashedMaterial&&(E(K.linewidth),J(K.linecap),F(K.linejoin),O(K.color.getStyle()),D([K.dashSize,K.gapSize]),b.stroke(),fa.expandByScalar(2*K.linewidth),D([]))}else if(B instanceof THREE.RenderableFace){w=B.v1;V=B.v2;Q=B.v3;if(-1>w.positionScreen.z||
1<w.positionScreen.z)continue;if(-1>V.positionScreen.z||1<V.positionScreen.z)continue;if(-1>Q.positionScreen.z||1<Q.positionScreen.z)continue;w.positionScreen.x*=m;w.positionScreen.y*=t;V.positionScreen.x*=m;V.positionScreen.y*=t;Q.positionScreen.x*=m;Q.positionScreen.y*=t;0<y.overdraw&&(f(w.positionScreen,V.positionScreen,y.overdraw),f(V.positionScreen,Q.positionScreen,y.overdraw),f(Q.positionScreen,w.positionScreen,y.overdraw));fa.setFromPoints([w.positionScreen,V.positionScreen,Q.positionScreen]);
if(!0===oa.isIntersectionBox(fa)){L=w;z=V;K=Q;u=y;la.info.render.vertices+=3;la.info.render.faces++;r(u.opacity);X(u.blending);ta=L.positionScreen.x;ea=L.positionScreen.y;G=z.positionScreen.x;d=z.positionScreen.y;C=K.positionScreen.x;wa=K.positionScreen.y;var y=ta,v=ea,Z=G,ca=d,ha=C,W=wa;b.beginPath();b.moveTo(y,v);b.lineTo(Z,ca);b.lineTo(ha,W);b.closePath();if((u instanceof THREE.MeshLambertMaterial||u instanceof THREE.MeshPhongMaterial)&&null===u.map){ya.copy(u.color);za.copy(u.emissive);u.vertexColors===
THREE.FaceColors&&ya.multiply(B.color);s.copy(Ba);Ea.copy(L.positionWorld).add(z.positionWorld).add(K.positionWorld).divideScalar(3);L=Ea;z=B.normalModel;K=s;B=0;for(y=ia.length;B<y;B++)v=ia[B],M.copy(v.color),v instanceof THREE.DirectionalLight?(Z=qa.setFromMatrixPosition(v.matrixWorld).normalize(),ca=z.dot(Z),0>=ca||(ca*=v.intensity,K.add(M.multiplyScalar(ca)))):v instanceof THREE.PointLight&&(Z=qa.setFromMatrixPosition(v.matrixWorld),ca=z.dot(qa.subVectors(Z,L).normalize()),0>=ca||(ca*=0==v.distance?
1:1-Math.min(L.distanceTo(Z)/v.distance,1),0!=ca&&(ca*=v.intensity,K.add(M.multiplyScalar(ca)))));s.multiply(ya).add(za);!0===u.wireframe?n(s,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):e(s)}else u instanceof THREE.MeshBasicMaterial||u instanceof THREE.MeshLambertMaterial||u instanceof THREE.MeshPhongMaterial?null!==u.map?u.map.mapping===THREE.UVMapping&&(H=B.uvs,a(ta,ea,G,d,C,wa,H[0].x,H[0].y,H[1].x,H[1].y,H[2].x,H[2].y,u.map)):null!==u.envMap?u.envMap.mapping===THREE.SphericalReflectionMapping&&
(ra.copy(B.vertexNormalsModel[0]).applyMatrix3(Aa),ja=.5*ra.x+.5,ka=.5*ra.y+.5,ra.copy(B.vertexNormalsModel[1]).applyMatrix3(Aa),l=.5*ra.x+.5,N=.5*ra.y+.5,ra.copy(B.vertexNormalsModel[2]).applyMatrix3(Aa),ba=.5*ra.x+.5,xa=.5*ra.y+.5,a(ta,ea,G,d,C,wa,ja,ka,l,N,ba,xa,u.envMap)):(s.copy(u.color),u.vertexColors===THREE.FaceColors&&s.multiply(B.color),!0===u.wireframe?n(s,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):e(s)):(u instanceof THREE.MeshDepthMaterial?s.r=s.g=s.b=1-ma(L.positionScreen.z*
L.positionScreen.w,na.near,na.far):u instanceof THREE.MeshNormalMaterial?(ra.copy(B.normalModel).applyMatrix3(Aa),s.setRGB(ra.x,ra.y,ra.z).multiplyScalar(.5).addScalar(.5)):s.setRGB(1,1,1),!0===u.wireframe?n(s,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):e(s))}}I.union(fa)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(g){this.positionWorld.copy(g.positionWorld);this.positionScreen.copy(g.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function g(){if(F===x){var a=new THREE.RenderableVertex;O.push(a);x++;F++;return a}return O[F++]}function n(){if(ma===da){var a=new THREE.RenderableFace;la.push(a);da++;ma++;return a}return la[ma++]}function e(){if(ia===v){var a=new THREE.RenderableLine;sa.push(a);v++;ia++;return a}return sa[ia++]}function q(){if(p===t){var a=new THREE.RenderableSprite;m.push(a);t++;p++;return a}return m[p++]}function h(a,c){return a.z!==c.z?c.z-a.z:a.id!==c.id?a.id-c.id:0}function a(a,
c){var b=0,e=1,f=a.z+a.w,d=c.z+c.w,g=-a.z+a.w,k=-c.z+c.w;if(0<=f&&0<=d&&0<=g&&0<=k)return!0;if(0>f&&0>d||0>g&&0>k)return!1;0>f?b=Math.max(b,f/(f-d)):0>d&&(e=Math.min(e,f/(f-d)));0>g?b=Math.max(b,g/(g-k)):0>k&&(e=Math.min(e,g/(g-k)));if(e<b)return!1;a.lerp(c,b);c.lerp(a,1-e);return!0}var f,r,X=[],E=0,J,F,O=[],x=0,D,ma,la=[],da=0,S,ia,sa=[],v=0,P,p,m=[],t=0,Y={objects:[],lights:[],elements:[]},k=new THREE.Vector3,R=new THREE.Vector3,T=new THREE.Vector3,c=new THREE.Vector3,b=new THREE.Vector4,aa=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),U=new THREE.Box3,W=Array(3),va=new THREE.Matrix4,z=new THREE.Matrix4,ga,pa=new THREE.Matrix4,y=new THREE.Matrix3,ua=new THREE.Frustum,ha=new THREE.Vector4,na=new THREE.Vector4;this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var w=new function(){var a=[],c=[],b=null,f=null,k=new THREE.Matrix3,d=function(a){var c=a.positionWorld,b=a.positionScreen;c.copy(a.position).applyMatrix4(ga);b.copy(c).applyMatrix4(z);c=1/b.w;b.x*=c;b.y*=c;b.z*=c;a.visible=-1<=b.x&&1>=b.x&&-1<=b.y&&1>=b.y&&-1<=b.z&&1>=b.z},h=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;W[0]=a.positionScreen;W[1]=b.positionScreen;W[2]=c.positionScreen;return aa.isIntersectionBox(U.setFromPoints(W))},p=function(a,b,c){return 0>(c.positionScreen.x-
a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(d){b=d;f=b.material;k.getNormalMatrix(b.matrixWorld);a.length=0;c.length=0},projectVertex:d,checkTriangleVisibility:h,checkBackfaceCulling:p,pushVertex:function(a,b,c){J=g();J.position.set(a,b,c);d(J)},pushNormal:function(b,c,d){a.push(b,c,d)},pushUv:function(a,b){c.push(a,b)},pushLine:function(a,c){var d=O[a],f=O[c];S=e();S.id=b.id;
S.v1.copy(d);S.v2.copy(f);S.z=(d.positionScreen.z+f.positionScreen.z)/2;S.material=b.material;Y.elements.push(S)},pushTriangle:function(d,e,g){var q=O[d],m=O[e],r=O[g];if(!1!==h(q,m,r)&&(f.side===THREE.DoubleSide||!0===p(q,m,r))){D=n();D.id=b.id;D.v1.copy(q);D.v2.copy(m);D.v3.copy(r);D.z=(q.positionScreen.z+m.positionScreen.z+r.positionScreen.z)/3;for(q=0;3>q;q++)m=3*arguments[q],r=D.vertexNormalsModel[q],r.set(a[m],a[m+1],a[m+2]),r.applyMatrix3(k).normalize(),m=2*arguments[q],D.uvs[q].set(c[m],c[m+
1]);D.vertexNormalsLength=3;D.material=b.material;Y.elements.push(D)}}}};this.projectScene=function(m,t,aa,J){p=ia=ma=0;Y.elements.length=0;!0===m.autoUpdate&&m.updateMatrixWorld();void 0===t.parent&&t.updateMatrixWorld();va.copy(t.matrixWorldInverse.getInverse(t.matrixWorld));z.multiplyMatrices(t.projectionMatrix,va);ua.setFromMatrix(z);r=0;Y.objects.length=0;Y.lights.length=0;m.traverseVisible(function(a){if(a instanceof THREE.Light)Y.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof
THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===ua.intersectsObject(a))){if(r===E){var l=new THREE.RenderableObject;X.push(l);E++;r++;f=l}else f=X[r++];f.id=a.id;f.object=a;c.setFromMatrixPosition(a.matrixWorld);c.applyProjection(z);f.z=c.z;Y.objects.push(f)}});!0===aa&&Y.objects.sort(h);m=0;for(aa=Y.objects.length;m<aa;m++){var G=Y.objects[m].object,d=G.geometry;w.setObject(G);ga=G.matrixWorld;F=0;if(G instanceof THREE.Mesh)if(d instanceof THREE.BufferGeometry){var C=
d.attributes,G=d.offsets;if(void 0!==C.position){for(var v=C.position.array,d=0,s=v.length;d<s;d+=3)w.pushVertex(v[d],v[d+1],v[d+2]);if(void 0!==C.normal)for(var x=C.normal.array,d=0,s=x.length;d<s;d+=3)w.pushNormal(x[d],x[d+1],x[d+2]);if(void 0!==C.uv)for(x=C.uv.array,d=0,s=x.length;d<s;d+=2)w.pushUv(x[d],x[d+1]);if(void 0!==C.index)if(C=C.index.array,0<G.length)for(m=0;m<G.length;m++)for(s=G[m],v=s.index,d=s.start,s=s.start+s.count;d<s;d+=3)w.pushTriangle(C[d]+v,C[d+1]+v,C[d+2]+v);else for(d=0,
s=C.length;d<s;d+=3)w.pushTriangle(C[d],C[d+1],C[d+2]);else for(d=0,s=v.length/3;d<s;d+=3)w.pushTriangle(d,d+1,d+2)}}else{if(d instanceof THREE.Geometry){var U=d.vertices,s=d.faces,C=d.faceVertexUvs[0];y.getNormalMatrix(ga);for(var v=G.material instanceof THREE.MeshFaceMaterial,x=!0===v?G.material:null,M=0,A=U.length;M<A;M++){var H=U[M];w.pushVertex(H.x,H.y,H.z)}U=0;for(M=s.length;U<M;U++){var A=s[U],ja=!0===v?x.materials[A.materialIndex]:G.material;if(void 0!==ja){var ka=ja.side,H=O[A.a],l=O[A.b],
N=O[A.c];if(!0===ja.morphTargets){var ba=d.morphTargets,xa=G.morphTargetInfluences,oa=H.position,I=l.position,fa=N.position;k.set(0,0,0);R.set(0,0,0);T.set(0,0,0);for(var da=0,la=ba.length;da<la;da++){var W=xa[da];if(0!==W){var qa=ba[da].vertices;k.x+=(qa[A.a].x-oa.x)*W;k.y+=(qa[A.a].y-oa.y)*W;k.z+=(qa[A.a].z-oa.z)*W;R.x+=(qa[A.b].x-I.x)*W;R.y+=(qa[A.b].y-I.y)*W;R.z+=(qa[A.b].z-I.z)*W;T.x+=(qa[A.c].x-fa.x)*W;T.y+=(qa[A.c].y-fa.y)*W;T.z+=(qa[A.c].z-fa.z)*W}}H.position.add(k);l.position.add(R);N.position.add(T);
w.projectVertex(H);w.projectVertex(l);w.projectVertex(N)}if(!1!==w.checkTriangleVisibility(H,l,N)){ba=w.checkBackfaceCulling(H,l,N);if(ka!==THREE.DoubleSide){if(ka===THREE.FrontSide&&!1===ba)continue;if(ka===THREE.BackSide&&!0===ba)continue}D=n();D.id=G.id;D.v1.copy(H);D.v2.copy(l);D.v3.copy(N);D.normalModel.copy(A.normal);!1!==ba||ka!==THREE.BackSide&&ka!==THREE.DoubleSide||D.normalModel.negate();D.normalModel.applyMatrix3(y).normalize();xa=A.vertexNormals;oa=0;for(I=Math.min(xa.length,3);oa<I;oa++)fa=
D.vertexNormalsModel[oa],fa.copy(xa[oa]),!1!==ba||ka!==THREE.BackSide&&ka!==THREE.DoubleSide||fa.negate(),fa.applyMatrix3(y).normalize();D.vertexNormalsLength=xa.length;ka=C[U];if(void 0!==ka)for(ba=0;3>ba;ba++)D.uvs[ba].copy(ka[ba]);D.color=A.color;D.material=ja;D.z=(H.positionScreen.z+l.positionScreen.z+N.positionScreen.z)/3;Y.elements.push(D)}}}}}else if(G instanceof THREE.Line)if(d instanceof THREE.BufferGeometry){if(C=d.attributes,void 0!==C.position){v=C.position.array;d=0;for(s=v.length;d<
s;d+=3)w.pushVertex(v[d],v[d+1],v[d+2]);if(void 0!==C.index)for(C=C.index.array,d=0,s=C.length;d<s;d+=2)w.pushLine(C[d],C[d+1]);else for(C=G.mode===THREE.LinePieces?2:1,d=0,s=v.length/3-1;d<s;d+=C)w.pushLine(d,d+1)}}else{if(d instanceof THREE.Geometry&&(pa.multiplyMatrices(z,ga),U=G.geometry.vertices,0!==U.length))for(H=g(),H.positionScreen.copy(U[0]).applyMatrix4(pa),C=G.mode===THREE.LinePieces?2:1,M=1,A=U.length;M<A;M++)H=g(),H.positionScreen.copy(U[M]).applyMatrix4(pa),0<(M+1)%C||(l=O[F-2],ha.copy(H.positionScreen),
na.copy(l.positionScreen),!0===a(ha,na)&&(ha.multiplyScalar(1/ha.w),na.multiplyScalar(1/na.w),S=e(),S.id=G.id,S.v1.positionScreen.copy(ha),S.v2.positionScreen.copy(na),S.z=Math.max(ha.z,na.z),S.material=G.material,G.material.vertexColors===THREE.VertexColors&&(S.vertexColors[0].copy(G.geometry.colors[M]),S.vertexColors[1].copy(G.geometry.colors[M-1])),Y.elements.push(S)))}else G instanceof THREE.Sprite&&(b.set(ga.elements[12],ga.elements[13],ga.elements[14],1),b.applyMatrix4(z),d=1/b.w,b.z*=d,-1<=
b.z&&1>=b.z&&(P=q(),P.id=G.id,P.x=b.x*d,P.y=b.y*d,P.z=b.z,P.object=G,P.rotation=G.rotation,P.scale.x=G.scale.x*Math.abs(P.x-(b.x+t.projectionMatrix.elements[0])/(b.w+t.projectionMatrix.elements[12])),P.scale.y=G.scale.y*Math.abs(P.y-(b.y+t.projectionMatrix.elements[5])/(b.w+t.projectionMatrix.elements[13])),P.material=G.material,Y.elements.push(P)))}!0===J&&Y.elements.sort(h);return Y}};
THREE.OrbitControls=function(g,n){function e(c){if(!1!==a.enabled){c.preventDefault();var b=a.domElement===document?a.domElement.body:a.domElement;if(m===p.ROTATE){if(!0===a.noRotate)return;r.set(c.clientX,c.clientY);X.subVectors(r,f);a.rotateLeft(2*Math.PI*X.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*X.y/b.clientHeight*a.rotateSpeed);f.copy(r)}else if(m===p.DOLLY){if(!0===a.noZoom)return;ma.set(c.clientX,c.clientY);la.subVectors(ma,D);0<la.y?a.dollyIn():a.dollyOut();D.copy(ma)}else if(m===
p.PAN){if(!0===a.noPan)return;J.set(c.clientX,c.clientY);F.subVectors(J,E);a.pan(F.x,F.y);E.copy(J)}a.update()}}function q(){!1!==a.enabled&&(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",q,!1),a.dispatchEvent(T),m=p.NONE)}function h(c){if(!1!==a.enabled&&!0!==a.noZoom){c.preventDefault();c.stopPropagation();var b=0;void 0!==c.wheelDelta?b=c.wheelDelta:void 0!==c.detail&&(b=-c.detail);0<b?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(R);a.dispatchEvent(T)}}
this.object=g;this.domElement=void 0!==n?n:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,
ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,f=new THREE.Vector2,r=new THREE.Vector2,X=new THREE.Vector2,E=new THREE.Vector2,J=new THREE.Vector2,F=new THREE.Vector2,O=new THREE.Vector3,x=new THREE.Vector3,D=new THREE.Vector2,ma=new THREE.Vector2,la=new THREE.Vector2,da=0,S=0,ia=1,sa=new THREE.Vector3,v=new THREE.Vector3,P=new THREE.Quaternion,p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},m=p.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
var t=(new THREE.Quaternion).setFromUnitVectors(g.up,new THREE.Vector3(0,1,0)),Y=t.clone().inverse(),k={type:"change"},R={type:"start"},T={type:"end"};this.rotateLeft=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);S-=c};this.rotateUp=function(c){void 0===c&&(c=2*Math.PI/60/60*a.autoRotateSpeed);da-=c};this.panLeft=function(a){var b=this.object.matrix.elements;O.set(b[0],b[1],b[2]);O.multiplyScalar(-a);sa.add(O)};this.panUp=function(a){var b=this.object.matrix.elements;O.set(b[4],b[5],
b[6]);O.multiplyScalar(a);sa.add(O)};this.panForward=function(a){var b=this.object.matrix.elements;O.set(b[8],b[9],b[10]);O.multiplyScalar(a);sa.add(O)};this.pan=function(c,b){var f=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var e=a.object.position.clone().sub(a.target).length(),e=e*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*e/f.clientHeight);a.panUp(2*b*e/f.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/f.clientWidth),
a.panUp(b*(a.object.top-a.object.bottom)/f.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(c,b){var f=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var e=a.object.position.clone().sub(a.target).length(),e=e*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*c*e/f.clientHeight);a.panForward(2*b*e/f.clientHeight)}else void 0!==a.object.top?(a.panLeft(c*(a.object.right-a.object.left)/f.clientWidth),
a.panForward(b*(a.object.top-a.object.bottom)/f.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ia/=c};this.dollyOut=function(c){void 0===c&&(c=Math.pow(.95,a.zoomSpeed));ia*=c};this.update=function(){var c=this.object.position;x.copy(c).sub(this.target);x.applyQuaternion(t);var b=Math.atan2(x.x,x.z),f=Math.atan2(Math.sqrt(x.x*x.x+x.z*x.z),x.y);this.autoRotate&&this.rotateLeft(2*
Math.PI/60/60*a.autoRotateSpeed);var b=b+S,f=f+da,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),f=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,f)),f=Math.max(1E-6,Math.min(Math.PI-1E-6,f)),e=x.length()*ia,e=Math.max(this.minDistance,Math.min(this.maxDistance,e));this.target.add(sa);x.x=e*Math.sin(f)*Math.sin(b);x.y=e*Math.cos(f);x.z=e*Math.sin(f)*Math.cos(b);x.applyQuaternion(Y);c.copy(this.target).add(x);this.object.lookAt(this.target);da=S=0;ia=1;sa.set(0,0,0);if(1E-6<
v.distanceToSquared(this.object.position)||1E-6<8*(1-P.dot(this.object.quaternion)))this.dispatchEvent(k),v.copy(this.object.position),P.copy(this.object.quaternion)};this.reset=function(){m=p.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){if(!1!==a.enabled){c.preventDefault();if(c.button===a.mouseButtons.ORBIT){if(!0===
a.noRotate)return;m=p.ROTATE;f.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;m=p.DOLLY;D.set(c.clientX,c.clientY)}else if(c.button===a.mouseButtons.PAN){if(!0===a.noPan)return;m=p.PAN;E.set(c.clientX,c.clientY)}document.addEventListener("mousemove",e,!1);document.addEventListener("mouseup",q,!1);a.dispatchEvent(R)}},!1);this.domElement.addEventListener("mousewheel",h,!1);this.domElement.addEventListener("DOMMouseScroll",h,!1);this.domElement.addEventListener("touchstart",
function(c){if(!1!==a.enabled){switch(c.touches.length){case 1:if(!0===a.noRotate)return;m=p.TOUCH_ROTATE;f.set(c.touches[0].pageX,c.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;m=p.TOUCH_DOLLY;var b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;b=Math.sqrt(b*b+c*c);D.set(0,b);break;case 3:if(!0===a.noPan)return;m=p.TOUCH_PAN;E.set(c.touches[0].pageX,c.touches[0].pageY);break;default:m=p.NONE}a.dispatchEvent(R)}},!1);this.domElement.addEventListener("touchend",
function(){!1!==a.enabled&&(a.dispatchEvent(T),m=p.NONE)},!1);this.domElement.addEventListener("touchmove",function(c){if(!1!==a.enabled){c.preventDefault();c.stopPropagation();var b=a.domElement===document?a.domElement.body:a.domElement;switch(c.touches.length){case 1:if(!0===a.noRotate)break;if(m!==p.TOUCH_ROTATE)break;r.set(c.touches[0].pageX,c.touches[0].pageY);X.subVectors(r,f);a.rotateLeft(2*Math.PI*X.x/b.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*X.y/b.clientHeight*a.rotateSpeed);f.copy(r);
a.update();break;case 2:if(!0===a.noZoom)break;if(m!==p.TOUCH_DOLLY)break;b=c.touches[0].pageX-c.touches[1].pageX;c=c.touches[0].pageY-c.touches[1].pageY;c=Math.sqrt(b*b+c*c);ma.set(0,c);la.subVectors(ma,D);0<la.y?a.dollyOut():a.dollyIn();D.copy(ma);a.update();break;case 3:if(!0===a.noPan)break;if(m!==p.TOUCH_PAN)break;J.set(c.touches[0].pageX,c.touches[0].pageY);F.subVectors(J,E);a.pan(F.x,F.y);E.copy(J);a.update();break;default:m=p.NONE}}},!1);window.addEventListener("keydown",function(c){if(!1!==
a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(c.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-4*a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,4*a.keyPanSpeed);a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===
a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var g=document.createElement("canvas");return!(!window.WebGLRenderingContext||!g.getContext("webgl")&&!g.getContext("experimental-webgl"))}catch(n){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";
g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){var n,e;g=g||{};n=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";e=Detector.getWebGLErrorMessage();e.id=g;n.appendChild(e)}};"object"===typeof module&&(module.exports=Detector);
(function(g,n,e,q){var h=function(a){this.domParent="object"===typeof a?a:n.body};h.prototype.init=function(a,f,h,X,E,J){g.requestAnimationFrame||(g.requestAnimationFrame=function(){return g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a,f){g.setTimeout(a,1E3/60)}}());this.domParent===n.body&&(this.WINDOW_WIDTH=g.innerWidth,this.WINDOW_HEIGHT=g.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,g.addEventListener("resize",a,!1));this.renderType=q.webgl?"webgl":"canvas";this.renderer=h||(q.webgl?new e.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new e.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=X||new e.Scene;this.camera=E||new e.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
J?this.controls=J:(this.controls=new e.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:32},this.controls.mouseButtons={ORBIT:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT});f()};g.Base=h;"object"===typeof module&&(module.exports=h)})(window,document,THREE,Detector);
(function(){function g(e){return e.charAt(0).toUpperCase()+e.slice(1)}var n={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(e){var g=0;for(e=e.length;g<e;g++);};n.map={};n.Sidebar=function(e,g){_Container.call(this);var h=this.setting=n.Utils.settingMixin({align:"r",width:320},e),a="sidebar",a=h.align&&"r"!==h.align?a+" sidebar-left":a+" sidebar-right";this.domElement.className=a;h.id&&(this.domElement.id=h.id,n.map[h.id]=this);
this.domElement.style.width=h.width.toString()+"px";h.overflow&&(this.domElement.style.overflow=h.overflow.toString());g.appendChild(this.domElement);n.Utils.domCreationDirector(h.children,this.domElement)};n.Sidebar.prototype=Object.create(_Container.prototype);n.Panel=function(e,g){_Container.call(this);var h=this.setting=n.Utils.settingMixin({title:""},e);h.id&&(this.domElement.id=h.id,n.map[h.id]=this);var a=this.domElement;a.className="panel panel-tool";g.appendChild(a);var f=document.createElement("div");
f.className="panel-heading";a.appendChild(f);var r=document.createTextNode(h.title);f.appendChild(r);f=document.createElement("div");f.className="panel-body";h.overflow&&(f.style.overflow=h.overflow.toString());a.appendChild(f);n.Utils.domCreationDirector(h.children,f)};n.Panel.prototype=Object.create(_Container.prototype);n.Toolbar=function(e,g){_Container.call(this);var h=this.setting=n.Utils.settingMixin({title:""},e);h.id&&(this.domElement.id=h.id,n.map[h.id]=this);var a=this.domElement;a.className=
"btn-toolbar";g.appendChild(a);n.Utils.domCreationDirector(h.children,a)};n.Toolbar.prototype=Object.create(_Container.prototype);n.ButtonGroup=function(e,g){_Container.call(this);var h=this.setting=n.Utils.settingMixin({title:"",buttonType:"radio"},e);h.id&&(this.domElement.id=h.id,n.map[h.id]=this);var a=this.domElement;a.className="btn-group"+(h.appendClass?" "+h.appendClass:"");"button"!==h.buttonType.toLowerCase()&&a.setAttribute("data-toggle","buttons");a.title=h.title;g.appendChild(a);var f=
h.buttons;switch(h.buttonType.toLowerCase()){default:case "radio":for(var r=0,X=f.length;r<X;r++){var E=document.createElement("label");E.className="btn btn-tool"+(f[r].checked?" active":"");f[r].height&&(E.style.height=f[r].height+"px");f[r].width&&(E.style.width=f[r].width+"px");if(f[r].bgType&&f[r].bgTypeData){var J;switch(f[r].bgType){case "color":J=f[r].bgTypeData;E.className+=" btn-color";break;case "image":J="url("+f[r].bgTypeData+") no-repeat 50% 50%";E.className+=" btn-image";break;default:return}E.style.background=
J}a.appendChild(E);var F=document.createElement("input");f[r].checked&&F.setAttribute("checked","");F.type=h.buttonType;F.name=h.name;F.id=f[r].id;F.value=r;F.autocomplete="off";E.appendChild(F);J=document.createTextNode(f[r].title);E.appendChild(J)}break;case "button":for(r=0,X=f.length;r<X;r++){F=document.createElement("button");F.className="btn btn-tool";F.id=f[r].id;F.name=h.name;f[r].height&&(F.style.height=f[r].height+"px");f[r].width&&(F.style.width=f[r].width+"px");if(f[r].bgType&&f[r].bgTypeData){switch(f[r].bgType){case "color":J=
f[r].bgTypeData;E.className+=" btn-color";break;case "image":J="url("+f[r].bgTypeData+") no-repeat 50% 50%";E.className+=" btn-image";break;default:return}F.style.background=J}a.appendChild(F);J=document.createTextNode(f[r].title);F.appendChild(J)}}n.Utils.domCreationDirector(h.children,this.domElement)};n.ButtonGroup.prototype=Object.create(_Container.prototype);n.ButtonGroup.prototype.addButton=function(e,g){g||this.setting.buttons.push(e);var h=document.createElement("label");h.className="btn btn-tool"+
(e.checked?" active":"");e.height&&(h.style.height=e.height+"px");e.width&&(h.style.width=e.width+"px");if(e.bgType&&e.bgTypeData){var a;switch(e.bgType){case "color":a=e.bgTypeData;h.className+=" btn-color";break;case "image":a="url("+e.bgTypeData+") no-repeat 50% 50%";h.className+=" btn-image";break;default:return}h.style.background=a}this.domElement.appendChild(h);a=document.createElement("input");e.checked&&a.setAttribute("checked","");a.type=this.setting.buttonType;a.name=this.setting.name;a.id=
e.id;a.value=this.setting.buttons.length-1;a.autocomplete="off";h.appendChild(a);a=document.createTextNode(e.title);h.appendChild(a);return h};n.ButtonGroup.prototype.addButtons=function(e,g){for(var h=0,a=e.length;h<a;h++)this.addButton(e[h],g)};n.Utils={};n.Utils.settingMixin=function(e,g){if("object"===typeof e&&"object"===typeof g){var h={},a;for(a in e)h[a]=e[a];for(var f in g)void 0!==g[f]&&(h[f]=g[f]);return h}return e};n.Utils.domCreationDirector=function(e,q){if(e)if(e instanceof Array)for(var h=
0,a=e.length;h<a;h++)n.Utils.domCreationDirector(e[h],q?q:document.body);else e instanceof Object&&e.UIType&&n[g(e.UIType)]&&new (n[g(e.UIType)])(e,q?q:document.body)};window.GoUI=n;"object"===typeof module&&(module.exports=n)})();var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
(function(g,n,e,q,h){var a,f;function r(l){var b=y.textures+(l?-1:1),b=n.getElementById("texture"+b);if(!b&&(b=l?z.length-1:0,b=n.getElementById("texture"+b),!b))return;l=b.parentElement.className.indexOf("btn-color");var c=b.parentElement.className.indexOf("btn-image");-1<l?(a=Number(b.value),n.getElementById("colorTexture").parentElement.click()):-1<c&&(f=Number(b.value),n.getElementById("imageTexture").parentElement.click())}function X(a,b){var c=b.clone(),d;for(d in a)c[d]=a[d];return c}function E(a){if(null==
a.pageX&&null!=a.clientX){var b=n.documentElement,c=n.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}wa.set(a.pageX/k.WINDOW_WIDTH*2-1,2*-(a.pageY/k.WINDOW_HEIGHT)+1);ya.setFromCamera(wa,k.camera);return ya.intersectObjects(ta)}function J(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(R.width).floor().multiplyScalar(R.width).addScalar(R.width/
2))}function F(a){0<a.length&&J(Q,a[0])}function O(a,c,d,f){a=a||E(event);if(0<a.length){a=a[0];var g=y.toolsType,e=!1,h=ta.length;if(h&&a.object!==b)for(var m=h-1;0<m&&m>h-1-3;m--)if(a.object===ta[m]){e=!0;break}0===g?!0===e&&!1===c||!1===e&&!0===c||(c=ja.draw(0,ua,void 0,a),f?H.appendObjectToCurrentAction(c):H.addAction("draw",c),k.renderer.render(k.scene,k.camera)):1===g&&d&&a.object!==b&&(c=ja.erase(a.object),f?H.appendObjectToCurrentAction(c):H.addAction("erase",c))}}function x(a){0===U&&(A.save(A.storageKeys.camera),
A.save(A.storageKeys.sidebar),A.save())}function D(a){A.save(A.storageKeys.camera);A.save(A.storageKeys.sidebar);A.save();U=1}function ma(a){a.preventDefault();var b;if(1===s[0])try{1===ka?ka=0:(ka=1,b=E(a),O(b,a.ctrlKey,a.ctrlKey,!0))}catch(c){console.warn("draw/erase failed")}finally{ka=0}else b=y.toolsType,1===b?Q.visible&&(Q.visible=!1):(!Q.visible&&pa&&(Q.visible=!0),b=E(a),F(b))}function la(a){a.preventDefault();switch(a.button){case 0:if(!M.endFlag){M.instantComplete(M.loadBoxAnimation);break}s[0]=
1;a=E(a);O(a,void 0,!0,!1);0===y.toolsType&&F(a);break;case 1:s[1]=1;break;case 2:s[2]=1}}function da(l){if("label"===this.nodeName.toLowerCase())switch(l=this.getElementsByTagName("input")[0],y[l.name]=Number(l.value),l.name){case "toolsType":1===Number(l.value)?Q.visible&&(Q.visible=!1):!Q.visible&&pa&&(Q.visible=!0);break;case "textures":ua=y[l.name];ha=z[ua];na=ha.data;w=ha.helperData=z[y[l.name]].helperData||X(va,na);Q.material=w;n.getElementById("cube").parentElement.click();switch(y.texturesType){case 0:f=
l.value;break;default:case 1:a=l.value}break;case "sidebarResize":var b=GoUI.map.sidebar.domElement;"0"===l.value?$(b).animate({top:"0",height:"100%"}):$(b).animate({top:"60%",height:"40%"});break;case "texturesType":l=l.id,"imageTexture"===l?($(".btn-color").hide(),$(".btn-image").show(),n.getElementById("texture"+f).parentElement.click()):"colorTexture"===l&&($(".btn-color").show(),$(".btn-image").hide(),n.getElementById("texture"+a).parentElement.click())}else if("button"===this.type||"button"===
this.nodeName.toLowerCase())y[this.id]()}function S(a){switch(a.button){case 0:s[0]=0;break;case 1:s[1]=0;break;case 2:s[2]=0}}function ia(a){switch(a.keyCode){case 67:r();break;case 88:r(!0)}}function sa(a){if(!s[0])switch(a.keyCode){case 16:0===y.toolsType?n.getElementById("eraser").parentElement.click():1===y.toolsType&&n.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&H.undo();break;case 89:a.ctrlKey&&H.redo()}}function v(){requestAnimationFrame(v);k.renderer.render(k.scene,
k.camera)}var P=n.createElement("a");P.id="imageCapture";P.style.display="none";P.target="_blank";n.body.appendChild(P);var p=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};p.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=M.currentMeshes;M.currentIterator<a.length?a[M.currentIterator].meshObject.visible=!0:(M.endFlag=!0,clearInterval(M.currentAnimationIntervalHandler));M.currentIterator++},begin:function(a,
b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=M.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var m=function(a){this.isLoadingBoxEnd=a};m.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",sidebar:"vp_sidebar"},load:function(a){return g.localStorage&&
g.localStorage.getItem(a||this.storageKeys.meshes)},save:function(b,c){if(g.localStorage){var d="";if(c)d=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>H.currentActionIndex)return;for(var d=d+(R.width+":"),e=0,h=ea.length;e<h;e++)d+=ea[e].geo.id.replace("geo","")+",",d+=ea[e].material.id.replace("texture","")+",",d+=ea[e].meshObject.position.x+",",d+=ea[e].meshObject.position.y+",",d+=ea[e].meshObject.position.z+";";break;case this.storageKeys.camera:d+=
k.controls.target.x+","+k.controls.target.y+","+k.controls.target.z+";";d+=k.controls.object.position.x+","+k.controls.object.position.y+","+k.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=f+","+a+","+y.texturesType+","+y.sidebarResize}g.localStorage.setItem(b||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var d=[],e=R.width;if(a=this.load(a))if(a=a.split(":"))2===a.length?(e=(Number(a[0])||50)/R.width,d=a[1].split(";")):(e=50,d=a[0].split(";"));
if(0<d.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=d.length;b<a;b++){var f=d[b].split(",");2<f.length&&ja.draw(Number(f[0]),Number(f[1]),[Number(f[2])/e,Number(f[3])/e,Number(f[4])/e])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=d.length;b<a;b++)f=d[b].split(","),2<f.length&&ja.draw(Number(f[0]),Number(f[1]),[Number(f[2])/e,Number(f[3])/e,Number(f[4])/e],void 0,void 0,!0);M.begin(c,ea)}else M.endFlag=!0},loadCamera:function(a){var b=[];(a=this.load(a))&&(b=a.split(";"));
if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:k.controls.target.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0);break;case 1:k.controls.object.position.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0)}}k.controls.update()}},loadSidebarSelectedButtons:function(b){var c=[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var d=c.length;b<d;b++){var e=c[b];if(""!==e&&!isNaN(Number(e)))switch(b){case 0:f=Number(e)||0;break;case 1:a=Number(e)||
0;break;case 2:1===Number(e)?n.getElementById("colorTexture").parentElement.click():n.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(e)?n.getElementById("minSidebar").parentElement.click():n.getElementById("normalSidebar").parentElement.click()}}}else n.getElementById("imageTexture").parentElement.click()}};var t=function(){this.currentActionIndex=-1;this.actionArray=[]};t.prototype={undo:function(){var a;if(!(0>this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];
var b=ja.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ja.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ja.erase(e.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;
a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e)switch(b){case "draw":ja.draw(e.geo,e.material,[e.meshObject.position.x,e.meshObject.position.y,e.meshObject.position.z],void 0,e.meshObject);break;case "erase":ja.erase(e.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a){var b=
this.actionArray[this.currentActionIndex];if(void 0===b.meshes)b.meshes=a;else if(b.meshes instanceof Array||(b.meshes=[b.meshes]),a instanceof Array)for(var c=0,d=a.length;c<d;c++)b.meshes.push(a[c]);else b.meshes.push(a)},updateDom:function(){n.getElementById("undo").disabled=0>this.currentActionIndex?!0:!1;n.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var Y=function(){this.drawFlag=!1};Y.prototype={calculateIntersectResult:E,setMeshPositionToFitTheGrid:J,
updateHelperCube:F,draw:function(a,b,c,d,e,f){if(void 0===a||"number"===typeof a)a=ga[a||0];if(void 0===b||"number"===typeof b)b=z[b||0];var g=a.data,h=b.data;e=e||new q.Mesh(g,h);e.castShadow=!0;e.receiveShadow=!0;d?J(e,d):e.position.set(c[0],c[1],c[2]);!f||(e.visible=!1);k.scene.add(e);ta.push(e);ea.push({meshObject:e,geo:a,material:b});return ea[ea.length-1]},erase:function(a){k.scene.remove(a);a=ta.indexOf(a);if(!(0>a)){ta.splice(a,1);var b=ea[a-1];ea.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",
erase:"draw"}};q.ImageUtils.crossOrigin="Anonymous";var k,R={width:50};h=R.width/50;var T={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*h,basePlaneTextureRepeat:200,fogNear:8E3*h,fogFar:25E3*h,sphereRadius:25E3*h},canvas:{ambientLightColor:9474192,directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*h,basePlaneTextureRepeat:16,fogNear:2E3*h,fogFar:3E3*h,sphereRadius:3E3*h}},c,b,aa,U=0;h=m.prototype.LOAD_TYPE.async;var W=new q.MeshLambertMaterial({color:592137}),
va={opacity:.5,transparent:!0},z=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:W,helperData:X(va,W)}],ga=[{name:"default",type:"1",id:"geo0",data:new q.BoxGeometry(R.width,R.width,R.width,1,1,1)}];f=30;a=0;var pa=!0,y={toolsType:0,toolsRadius:0,textures:0,texturesType:0,toggleAux:function(){1===y.toolsType||(Q.visible=!Q.visible);pa=!pa},capture:function(){var a=k.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=
navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)?b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(g.navigator.saveBlob=g.navigator.saveBlob||g.navigator.msSaveBlob,a.msToBlob&&g.navigator.saveBlob?g.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(P.href=a.toDataURL(),P.download="capture.png",P.click())},clearAll:function(){M.endFlag||M.instantComplete(M.loadBoxAnimation);
if(!(1>ea.length)){var a=ja.erase(ea[0].meshObject);H.addAction("erase",a);for(var b=0,c=ea.length;b<c;b++)a=ja.erase(ea[0].meshObject),H.appendObjectToCurrentAction(a)}},undo:function(){H.undo()},redo:function(){H.redo()}},ua=0,ha=z[0],na=ha.data,w=ha.helperData,V=ga[0].data,Q,ta=[],ea=[],G,d,C,wa,s=[0,0,0],ya,za,M=new p,A=new m(!1),H=new t,ja=new Y,ka=0;k=new e(n.body);k.init(function(a){if(k.WINDOW_WIDTH!==g.innerWidth||k.WINDOW_HEIGHT!==g.innerHeight)k.WINDOW_WIDTH=g.innerWidth,k.WINDOW_HEIGHT=
g.innerHeight,k.WINDOW_HEIGHT_HALF=k.WINDOW_HEIGHT/2,k.WINDOW_WIDTH_HALF=k.WINDOW_WIDTH/2,k.camera.aspect=k.WINDOW_WIDTH/k.WINDOW_HEIGHT,k.camera.updateProjectionMatrix(),k.renderer.setSize(k.WINDOW_WIDTH,k.WINDOW_HEIGHT),n.body.height=k.WINDOW_HEIGHT},function(){c=new q.PlaneBufferGeometry(T[k.renderType].basePlaneWidth,T[k.renderType].basePlaneWidth,T[k.renderType].basePlaneSegments,T[k.renderType].basePlaneSegments);c.applyMatrix((new q.Matrix4).makeRotationX(-Math.PI/2));var a=q.ImageUtils.loadTexture("texture/grasslight-big.jpg");
a.wrapT=a.wrapS=q.RepeatWrapping;a.repeat.set(T[k.renderType].basePlaneTextureRepeat,T[k.renderType].basePlaneTextureRepeat);aa=new q.MeshLambertMaterial({color:3394611,map:a,bumpMap:a,emissive:16777215});b=new q.Mesh(c,aa);b.receiveShadow=!0;b.material.side=q.DoubleSide;k.scene.add(b);ta.push(b);G=new q.AmbientLight(T[k.renderType].ambientLightColor);k.scene.add(G);d=new q.DirectionalLight(15658734,T[k.renderType].directionalLightDensity);d.position.set(0,6E3,5E3);d.target.position.set(0,0,0);d.castShadow=
!0;d.shadowCameraNear=k.camera.near;d.shadowCameraFar=k.camera.far;d.shadowCameraFov=k.camera.fov;d.shadowCameraTop=-1E3;d.shadowCameraLeft=-1E3;d.shadowCameraBottom=1E3;d.shadowCameraRight=1E3;d.shadowBias=2E-5;d.shadowDarkness=.4;d.shadowMapWidth=2048;d.shadowMapHeight=2048;k.scene.add(d);C=new q.HemisphereLight(16777215,6316128,1);k.scene.add(C);var a={topColor:{type:"c",value:new q.Color(1131775)},bottomColor:{type:"c",value:new q.Color(16777215)},offset:{type:"f",value:400},exponent:{type:"f",
value:.8}},e=new q.Color;a.topColor.value.copy(e.setHSL(.6,1,.75));e=new q.SphereGeometry(T[k.renderType].sphereRadius,32,15);a=new q.ShaderMaterial({uniforms:a,vertexShader:vertexShader,fragmentShader:fragmentShader,side:q.BackSide});a=new q.Mesh(e,a);k.scene.add(a);Q=new q.Mesh(V,w);Q.position.set(R.width/2,R.width/2,R.width/2);k.scene.add(Q);new q.Mesh(V,na);ya=new q.Raycaster;wa=new q.Vector2;za=new q.Fog(15663086,T[k.renderType].fogNear,T[k.renderType].fogFar);k.scene.fog=za;k.renderer.setClearColor(15790320);
k.renderer.shadowMapEnabled=!0;k.renderer.shadowMapType=q.PCFSoftShadowMap;k.renderer.shadowMapCullFace=q.CullFaceBack;k.renderer.gammaInput=!0;k.renderer.gammaOutput=!0;g.addEventListener("unload",x,!1);g.addEventListener("reload",D,!1);k.renderer.domElement.addEventListener("mousemove",ma,!1);k.renderer.domElement.addEventListener("mousedown",la,!1);k.renderer.domElement.addEventListener("mouseup",S,!1);n.addEventListener("keydown",ia,!1);n.addEventListener("keyup",sa,!1);setInterval(x,12E4)});
v();m={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",
id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",
buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",
buttons:[{title:"",id:"texture0",bgType:z[0].type,bgTypeData:z[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>k.WINDOW_WIDTH){t=m.children;p=0;for(e=t.length;p<e;p++)if("sidebarResize"===t[p].id){p=t[p].buttons;t=0;for(e=p.length;t<e;t++)"normalSidebar"===p[t].id&&delete p[t].checked,"minSidebar"===p[t].id&&(p[t].checked=!0);break}y.sidebarResize=1}else y.sidebarResize=0;GoUI.Utils.domCreationDirector(m);H.updateDom();e=n.querySelectorAll(".btn");if(e instanceof Array||e.length)for(p=e.length-
1;0<=p;p--)e[p].addEventListener("click",da,!1);else e instanceof object&&e.addEventListener("click",da,!1);t=[{color:"#333333"},{color:"#7f7f7f"},{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},
{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];p=0;for(e=t.length;p<e;p++)m={name:t[p].color,type:"color",id:"texture"+(p+1),uniqueData:t[p].color,data:new q.MeshLambertMaterial({color:t[p].color})},z.push(m),GoUI.map.buttonGroup2.addButton({title:"",id:m.id,bgType:m.type,bgTypeData:m.uniqueData,width:50,height:50}).addEventListener("click",da,!1);t="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");
p=0;for(e=t.length;p<e;p++)m={name:t[p].replace("texture/","").replace(".png",""),type:"image",id:"texture"+z.length,uniqueData:t[p],data:new q.MeshLambertMaterial({map:q.ImageUtils.loadTexture(t[p]),transparent:!0})},"glass"===m.data.name&&(m.data.map.opacity=.3),m.data.map.magFilter=q.NearestFilter,m.data.map.minFilter=q.LinearMipMapLinearFilter,z.push(m),GoUI.map.buttonGroup2.addButton({title:"",id:m.id,bgType:m.type,bgTypeData:m.uniqueData,width:50,height:50}).addEventListener("click",da,!1);
A.loadCamera(A.storageKeys.camera);A.loadSidebarSelectedButtons(A.storageKeys.sidebar);A.loadMeshes(void 0,h,M.loadBoxAnimation)})(window,document,Base,THREE,Detector);
