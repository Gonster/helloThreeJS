THREE.SpriteCanvasMaterial=function(f){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(f,g){};this.setValues(f)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;
THREE.SpriteCanvasMaterial.prototype.clone=function(){var f=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,f);f.color.copy(this.color);f.program=this.program;return f};
THREE.CanvasRenderer=function(f){function d(a,A,J,c){K(A);x(J);L(c);T(a.getStyle());b.stroke();fa.expandByScalar(2*A)}function g(a){M(a.getStyle());b.fill()}function p(a){k(a.target)}function k(a){if(!(a instanceof THREE.CompressedTexture)){var A=a.wrapS===THREE.RepeatWrapping,J=a.wrapT===THREE.RepeatWrapping,c=a.image,g=document.createElement("canvas");g.width=c.width;g.height=c.height;var e=g.getContext("2d");e.setTransform(1,0,0,-1,0,c.height);e.drawImage(c,0,0);D[a.id]=b.createPattern(g,!0===
A&&!0===J?"repeat":!0===A&&!1===J?"repeat-x":!1===A&&!0===J?"repeat-y":"no-repeat")}}function n(a,A,J,c,g,e,f,C,oa,d,s,V,H){if(!(H instanceof THREE.DataTexture)){!1===H.hasEventListener("update",p)&&(void 0!==H.image&&0<H.image.width&&k(H),H.addEventListener("update",p));var m=D[H.id];if(void 0!==m){M(m);var m=H.offset.x/H.repeat.x,n=H.offset.y/H.repeat.y,h=H.image.width*H.repeat.x;H=H.image.height*H.repeat.y;f=(f+m)*h;C=(C+n)*H;J-=a;c-=A;g-=a;e-=A;oa=(oa+m)*h-f;d=(d+n)*H-C;s=(s+m)*h-f;V=(V+n)*H-
C;H=oa*V-s*d;0!==H&&(m=1/H,H=(V*J-d*g)*m,d=(V*c-d*e)*m,J=(oa*g-s*J)*m,c=(oa*e-s*c)*m,a=a-H*f-J*C,A=A-d*f-c*C,b.save(),b.transform(H,d,J,c,a,A),b.fill(),b.restore())}else M("rgba(0,0,0,1)"),b.fill()}}function a(a,A,b){var J=A.x-a.x,c=A.y-a.y,g=J*J+c*c;0!==g&&(b/=Math.sqrt(g),J*=b,c*=b,A.x+=J,A.y+=c,a.x-=J,a.y-=c)}function r(a){I!==a&&(I=b.globalAlpha=a)}function aa(a){pa!==a&&(a===THREE.NormalBlending?b.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?b.globalCompositeOperation="lighter":
a===THREE.SubtractiveBlending&&(b.globalCompositeOperation="darker"),pa=a)}function K(a){va!==a&&(va=b.lineWidth=a)}function x(a){la!==a&&(la=b.lineCap=a)}function L(a){F!==a&&(F=b.lineJoin=a)}function T(a){ga!==a&&(ga=b.strokeStyle=a)}function M(a){y!==a&&(y=b.fillStyle=a)}function u(a){ma.length!==a.length&&(b.setLineDash(a),ma=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var ka=THREE.Math.smoothstep;f=f||{};var W=this,ca,X,ha,ia=new THREE.Projector,v=void 0!==f.canvas?f.canvas:document.createElement("canvas"),
Q=v.width,w=v.height,l=Math.floor(Q/2),h=Math.floor(w/2),Z=0,e=0,U=Q,R=w,S=1,b=v.getContext("2d",{alpha:!0===f.alpha}),B=new THREE.Color(0),P=!0===f.alpha?0:1,I=1,pa=0,ga=null,y=null,va=null,la=null,F=null,ma=[],ja,z,V,na;new THREE.RenderableVertex;new THREE.RenderableVertex;var ea,ta,t,c,m,wa,s=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var ua=new THREE.Color,ya=new THREE.Color,za=new THREE.Color,D={},G,da,Y,xa,A,J,oa,H=new THREE.Box2,C=new THREE.Box2,fa=new THREE.Box2,
Ba=new THREE.Color,Ca=new THREE.Color,qa=new THREE.Color,ra=new THREE.Vector3,Da=new THREE.Vector3,sa=new THREE.Vector3,Aa=new THREE.Matrix3;void 0===b.setLineDash&&(b.setLineDash=function(){});this.domElement=v;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return S};this.setPixelRatio=function(a){S=a};this.setSize=function(a,A,b){Q=a*S;w=A*S;v.width=
Q;v.height=w;l=Math.floor(Q/2);h=Math.floor(w/2);!1!==b&&(v.style.width=a+"px",v.style.height=A+"px");H.min.set(-l,-h);H.max.set(l,h);C.min.set(-l,-h);C.max.set(l,h);I=1;pa=0;F=la=va=y=ga=null;this.setViewport(0,0,a,A)};this.setViewport=function(a,A,b,J){Z=a*S;e=A*S;U=b*S;R=J*S};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(a,A){B.set(a);P=void 0!==A?A:1;C.min.set(-l,-h);C.max.set(l,h)};this.setClearColorHex=function(a,A){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,A)};this.getClearColor=function(){return B};this.getClearAlpha=function(){return P};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===C.empty()&&(C.intersect(H),C.expandByScalar(2),C.min.x+=l,C.min.y=-C.min.y+h,C.max.x+=l,C.max.y=-C.max.y+h,1>P&&b.clearRect(C.min.x|0,C.max.y|0,C.max.x-C.min.x|0,C.min.y-C.max.y|0),0<P&&(aa(THREE.NormalBlending),r(1),M("rgba("+Math.floor(255*B.r)+","+Math.floor(255*B.g)+","+Math.floor(255*B.b)+","+P+")"),b.fillRect(C.min.x|0,
C.max.y|0,C.max.x-C.min.x|0,C.min.y-C.max.y|0)),C.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(f,B){if(!1===B instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();W.info.render.vertices=0;W.info.render.faces=0;b.setTransform(U/Q,0,0,-R/w,Z,w-e);b.translate(l,h);ca=ia.projectScene(f,B,this.sortObjects,this.sortElements);X=
ca.elements;ha=ca.lights;ja=B;Aa.getNormalMatrix(B.matrixWorldInverse);Ba.setRGB(0,0,0);Ca.setRGB(0,0,0);qa.setRGB(0,0,0);for(var I=0,S=ha.length;I<S;I++){var q=ha[I],O=q.color;q instanceof THREE.AmbientLight?Ba.add(O):q instanceof THREE.DirectionalLight?Ca.add(O):q instanceof THREE.PointLight&&qa.add(O)}I=0;for(S=X.length;I<S;I++){var E=X[I],F=E.material;if(void 0!==F&&0!==F.opacity){fa.makeEmpty();if(E instanceof THREE.RenderableSprite){z=E;z.x*=l;z.y*=h;var q=z,N=E,O=F;r(O.opacity);aa(O.blending);
var P=N.scale.x*l,N=N.scale.y*h,E=.5*Math.sqrt(P*P+N*N);fa.min.set(q.x-E,q.y-E);fa.max.set(q.x+E,q.y+E);if(O instanceof THREE.SpriteMaterial){var y=O.map;if(null!==y&&void 0!==y.image){!1===y.hasEventListener("update",p)&&(0<y.image.width&&k(y),y.addEventListener("update",p));E=D[y.id];void 0!==E?M(E):M("rgba( 0, 0, 0, 1 )");var ba=y.image,E=ba.width*y.offset.x,F=ba.height*y.offset.y,v=ba.width*y.repeat.x,y=ba.height*y.repeat.y,ba=P/v,pa=N/y;b.save();b.translate(q.x,q.y);0!==O.rotation&&b.rotate(O.rotation);
b.translate(-P/2,-N/2);b.scale(ba,pa);b.translate(-E,-F);b.fillRect(E,F,v,y)}else M(O.color.getStyle()),b.save(),b.translate(q.x,q.y),0!==O.rotation&&b.rotate(O.rotation),b.scale(P,-N),b.fillRect(-.5,-.5,1,1);b.restore()}else O instanceof THREE.SpriteCanvasMaterial&&(T(O.color.getStyle()),M(O.color.getStyle()),b.save(),b.translate(q.x,q.y),0!==O.rotation&&b.rotate(O.rotation),b.scale(P,N),O.program(b),b.restore())}else if(E instanceof THREE.RenderableLine){if(z=E.v1,V=E.v2,z.positionScreen.x*=l,z.positionScreen.y*=
h,V.positionScreen.x*=l,V.positionScreen.y*=h,fa.setFromPoints([z.positionScreen,V.positionScreen]),!0===H.isIntersectionBox(fa))if(q=z,O=V,P=E,N=F,r(N.opacity),aa(N.blending),b.beginPath(),b.moveTo(q.positionScreen.x,q.positionScreen.y),b.lineTo(O.positionScreen.x,O.positionScreen.y),N instanceof THREE.LineBasicMaterial){K(N.linewidth);x(N.linecap);L(N.linejoin);if(N.vertexColors!==THREE.VertexColors)T(N.color.getStyle());else if(E=P.vertexColors[0].getStyle(),P=P.vertexColors[1].getStyle(),E===
P)T(E);else{try{var ga=b.createLinearGradient(q.positionScreen.x,q.positionScreen.y,O.positionScreen.x,O.positionScreen.y);ga.addColorStop(0,E);ga.addColorStop(1,P)}catch(ma){ga=E}T(ga)}b.stroke();fa.expandByScalar(2*N.linewidth)}else N instanceof THREE.LineDashedMaterial&&(K(N.linewidth),x(N.linecap),L(N.linejoin),T(N.color.getStyle()),u([N.dashSize,N.gapSize]),b.stroke(),fa.expandByScalar(2*N.linewidth),u([]))}else if(E instanceof THREE.RenderableFace){z=E.v1;V=E.v2;na=E.v3;if(-1>z.positionScreen.z||
1<z.positionScreen.z)continue;if(-1>V.positionScreen.z||1<V.positionScreen.z)continue;if(-1>na.positionScreen.z||1<na.positionScreen.z)continue;z.positionScreen.x*=l;z.positionScreen.y*=h;V.positionScreen.x*=l;V.positionScreen.y*=h;na.positionScreen.x*=l;na.positionScreen.y*=h;0<F.overdraw&&(a(z.positionScreen,V.positionScreen,F.overdraw),a(V.positionScreen,na.positionScreen,F.overdraw),a(na.positionScreen,z.positionScreen,F.overdraw));fa.setFromPoints([z.positionScreen,V.positionScreen,na.positionScreen]);
if(!0===H.isIntersectionBox(fa)){O=z;P=V;N=na;q=F;W.info.render.vertices+=3;W.info.render.faces++;r(q.opacity);aa(q.blending);ea=O.positionScreen.x;ta=O.positionScreen.y;t=P.positionScreen.x;c=P.positionScreen.y;m=N.positionScreen.x;wa=N.positionScreen.y;var F=ea,v=ta,y=t,ba=c,pa=m,la=wa;b.beginPath();b.moveTo(F,v);b.lineTo(y,ba);b.lineTo(pa,la);b.closePath();if((q instanceof THREE.MeshLambertMaterial||q instanceof THREE.MeshPhongMaterial)&&null===q.map){ua.copy(q.color);ya.copy(q.emissive);q.vertexColors===
THREE.FaceColors&&ua.multiply(E.color);s.copy(Ba);Da.copy(O.positionWorld).add(P.positionWorld).add(N.positionWorld).divideScalar(3);O=Da;P=E.normalModel;N=s;E=0;for(F=ha.length;E<F;E++)v=ha[E],za.copy(v.color),v instanceof THREE.DirectionalLight?(y=ra.setFromMatrixPosition(v.matrixWorld).normalize(),ba=P.dot(y),0>=ba||(ba*=v.intensity,N.add(za.multiplyScalar(ba)))):v instanceof THREE.PointLight&&(y=ra.setFromMatrixPosition(v.matrixWorld),ba=P.dot(ra.subVectors(y,O).normalize()),0>=ba||(ba*=0==v.distance?
1:1-Math.min(O.distanceTo(y)/v.distance,1),0!=ba&&(ba*=v.intensity,N.add(za.multiplyScalar(ba)))));s.multiply(ua).add(ya);!0===q.wireframe?d(s,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):g(s)}else q instanceof THREE.MeshBasicMaterial||q instanceof THREE.MeshLambertMaterial||q instanceof THREE.MeshPhongMaterial?null!==q.map?q.map.mapping===THREE.UVMapping&&(G=E.uvs,n(ea,ta,t,c,m,wa,G[0].x,G[0].y,G[1].x,G[1].y,G[2].x,G[2].y,q.map)):null!==q.envMap?q.envMap.mapping===THREE.SphericalReflectionMapping&&
(sa.copy(E.vertexNormalsModel[0]).applyMatrix3(Aa),da=.5*sa.x+.5,Y=.5*sa.y+.5,sa.copy(E.vertexNormalsModel[1]).applyMatrix3(Aa),xa=.5*sa.x+.5,A=.5*sa.y+.5,sa.copy(E.vertexNormalsModel[2]).applyMatrix3(Aa),J=.5*sa.x+.5,oa=.5*sa.y+.5,n(ea,ta,t,c,m,wa,da,Y,xa,A,J,oa,q.envMap)):(s.copy(q.color),q.vertexColors===THREE.FaceColors&&s.multiply(E.color),!0===q.wireframe?d(s,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):g(s)):(q instanceof THREE.MeshDepthMaterial?s.r=s.g=s.b=1-ka(O.positionScreen.z*
O.positionScreen.w,ja.near,ja.far):q instanceof THREE.MeshNormalMaterial?(sa.copy(E.normalModel).applyMatrix3(Aa),s.setRGB(sa.x,sa.y,sa.z).multiplyScalar(.5).addScalar(.5)):s.setRGB(1,1,1),!0===q.wireframe?d(s,q.wireframeLinewidth,q.wireframeLinecap,q.wireframeLinejoin):g(s))}}C.union(fa)}}b.setTransform(1,0,0,1,0,0)}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(f){this.positionWorld.copy(f.positionWorld);this.positionScreen.copy(f.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};
THREE.Projector=function(){function f(){if(L===M){var a=new THREE.RenderableVertex;T.push(a);M++;L++;return a}return T[L++]}function d(){if(ka===ca){var a=new THREE.RenderableFace;W.push(a);ca++;ka++;return a}return W[ka++]}function g(){if(ha===v){var a=new THREE.RenderableLine;ia.push(a);v++;ha++;return a}return ia[ha++]}function p(){if(w===h){var a=new THREE.RenderableSprite;l.push(a);h++;w++;return a}return l[w++]}function k(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function n(a,b){var g=
0,e=1,f=a.z+a.w,c=b.z+b.w,d=-a.z+a.w,k=-b.z+b.w;if(0<=f&&0<=c&&0<=d&&0<=k)return!0;if(0>f&&0>c||0>d&&0>k)return!1;0>f?g=Math.max(g,f/(f-c)):0>c&&(e=Math.min(e,f/(f-c)));0>d?g=Math.max(g,d/(d-k)):0>k&&(e=Math.min(e,d/(d-k)));if(e<g)return!1;a.lerp(b,g);b.lerp(a,1-e);return!0}var a,r,aa=[],K=0,x,L,T=[],M=0,u,ka,W=[],ca=0,X,ha,ia=[],v=0,Q,w,l=[],h=0,Z={objects:[],lights:[],elements:[]},e=new THREE.Vector3,U=new THREE.Vector3,R=new THREE.Vector3,S=new THREE.Vector3,b=new THREE.Vector4,B=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),P=new THREE.Box3,I=Array(3),pa=new THREE.Matrix4,ga=new THREE.Matrix4,y,va=new THREE.Matrix4,la=new THREE.Matrix3,F=new THREE.Frustum,ma=new THREE.Vector4,ja=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var z=new function(){var a=[],b=[],e=null,k=null,p=new THREE.Matrix3,c=function(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(y);c.copy(b).applyMatrix4(ga);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z},m=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;I[0]=a.positionScreen;I[1]=b.positionScreen;I[2]=c.positionScreen;return B.isIntersectionBox(P.setFromPoints(I))},n=function(a,b,c){return 0>(c.positionScreen.x-
a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(c){e=c;k=e.material;p.getNormalMatrix(e.matrixWorld);a.length=0;b.length=0},projectVertex:c,checkTriangleVisibility:m,checkBackfaceCulling:n,pushVertex:function(a,b,e){x=f();x.position.set(a,b,e);c(x)},pushNormal:function(b,c,e){a.push(b,c,e)},pushUv:function(a,c){b.push(a,c)},pushLine:function(a,b){var c=T[a],f=T[b];X=g();X.id=e.id;
X.v1.copy(c);X.v2.copy(f);X.z=(c.positionScreen.z+f.positionScreen.z)/2;X.material=e.material;Z.elements.push(X)},pushTriangle:function(c,g,f){var h=T[c],B=T[g],l=T[f];if(!1!==m(h,B,l)&&(k.side===THREE.DoubleSide||!0===n(h,B,l))){u=d();u.id=e.id;u.v1.copy(h);u.v2.copy(B);u.v3.copy(l);u.z=(h.positionScreen.z+B.positionScreen.z+l.positionScreen.z)/3;for(h=0;3>h;h++)B=3*arguments[h],l=u.vertexNormalsModel[h],l.set(a[B],a[B+1],a[B+2]),l.applyMatrix3(p).normalize(),B=2*arguments[h],u.uvs[h].set(b[B],b[B+
1]);u.vertexNormalsLength=3;u.material=e.material;Z.elements.push(u)}}}};this.projectScene=function(h,B,l,P){w=ha=ka=0;Z.elements.length=0;!0===h.autoUpdate&&h.updateMatrixWorld();void 0===B.parent&&B.updateMatrixWorld();pa.copy(B.matrixWorldInverse.getInverse(B.matrixWorld));ga.multiplyMatrices(B.projectionMatrix,pa);F.setFromMatrix(ga);r=0;Z.objects.length=0;Z.lights.length=0;h.traverseVisible(function(b){if(b instanceof THREE.Light)Z.lights.push(b);else if((b instanceof THREE.Mesh||b instanceof
THREE.Line||b instanceof THREE.Sprite)&&!1!==b.material.visible&&(!1===b.frustumCulled||!0===F.intersectsObject(b))){if(r===K){var A=new THREE.RenderableObject;aa.push(A);K++;r++;a=A}else a=aa[r++];a.id=b.id;a.object=b;S.setFromMatrixPosition(b.matrixWorld);S.applyProjection(ga);a.z=S.z;Z.objects.push(a)}});!0===l&&Z.objects.sort(k);h=0;for(l=Z.objects.length;h<l;h++){var t=Z.objects[h].object,c=t.geometry;z.setObject(t);y=t.matrixWorld;L=0;if(t instanceof THREE.Mesh)if(c instanceof THREE.BufferGeometry){var m=
c.attributes,t=c.offsets;if(void 0!==m.position){for(var I=m.position.array,c=0,s=I.length;c<s;c+=3)z.pushVertex(I[c],I[c+1],I[c+2]);if(void 0!==m.normal)for(var v=m.normal.array,c=0,s=v.length;c<s;c+=3)z.pushNormal(v[c],v[c+1],v[c+2]);if(void 0!==m.uv)for(v=m.uv.array,c=0,s=v.length;c<s;c+=2)z.pushUv(v[c],v[c+1]);if(void 0!==m.index)if(m=m.index.array,0<t.length)for(h=0;h<t.length;h++)for(s=t[h],I=s.index,c=s.start,s=s.start+s.count;c<s;c+=3)z.pushTriangle(m[c]+I,m[c+1]+I,m[c+2]+I);else for(c=0,
s=m.length;c<s;c+=3)z.pushTriangle(m[c],m[c+1],m[c+2]);else for(c=0,s=I.length/3;c<s;c+=3)z.pushTriangle(c,c+1,c+2)}}else{if(c instanceof THREE.Geometry){var x=c.vertices,s=c.faces,m=c.faceVertexUvs[0];la.getNormalMatrix(y);for(var I=t.material instanceof THREE.MeshFaceMaterial,v=!0===I?t.material:null,M=0,D=x.length;M<D;M++){var G=x[M];z.pushVertex(G.x,G.y,G.z)}x=0;for(M=s.length;x<M;x++){var D=s[x],da=!0===I?v.materials[D.materialIndex]:t.material;if(void 0!==da){var Y=da.side,G=T[D.a],W=T[D.b],
A=T[D.c];if(!0===da.morphTargets){var J=c.morphTargets,oa=t.morphTargetInfluences,H=G.position,C=W.position,fa=A.position;e.set(0,0,0);U.set(0,0,0);R.set(0,0,0);for(var ca=0,ia=J.length;ca<ia;ca++){var qa=oa[ca];if(0!==qa){var ra=J[ca].vertices;e.x+=(ra[D.a].x-H.x)*qa;e.y+=(ra[D.a].y-H.y)*qa;e.z+=(ra[D.a].z-H.z)*qa;U.x+=(ra[D.b].x-C.x)*qa;U.y+=(ra[D.b].y-C.y)*qa;U.z+=(ra[D.b].z-C.z)*qa;R.x+=(ra[D.c].x-fa.x)*qa;R.y+=(ra[D.c].y-fa.y)*qa;R.z+=(ra[D.c].z-fa.z)*qa}}G.position.add(e);W.position.add(U);
A.position.add(R);z.projectVertex(G);z.projectVertex(W);z.projectVertex(A)}if(!1!==z.checkTriangleVisibility(G,W,A)){J=z.checkBackfaceCulling(G,W,A);if(Y!==THREE.DoubleSide){if(Y===THREE.FrontSide&&!1===J)continue;if(Y===THREE.BackSide&&!0===J)continue}u=d();u.id=t.id;u.v1.copy(G);u.v2.copy(W);u.v3.copy(A);u.normalModel.copy(D.normal);!1!==J||Y!==THREE.BackSide&&Y!==THREE.DoubleSide||u.normalModel.negate();u.normalModel.applyMatrix3(la).normalize();oa=D.vertexNormals;H=0;for(C=Math.min(oa.length,
3);H<C;H++)fa=u.vertexNormalsModel[H],fa.copy(oa[H]),!1!==J||Y!==THREE.BackSide&&Y!==THREE.DoubleSide||fa.negate(),fa.applyMatrix3(la).normalize();u.vertexNormalsLength=oa.length;Y=m[x];if(void 0!==Y)for(J=0;3>J;J++)u.uvs[J].copy(Y[J]);u.color=D.color;u.material=da;u.z=(G.positionScreen.z+W.positionScreen.z+A.positionScreen.z)/3;Z.elements.push(u)}}}}}else if(t instanceof THREE.Line)if(c instanceof THREE.BufferGeometry){if(m=c.attributes,void 0!==m.position){I=m.position.array;c=0;for(s=I.length;c<
s;c+=3)z.pushVertex(I[c],I[c+1],I[c+2]);if(void 0!==m.index)for(m=m.index.array,c=0,s=m.length;c<s;c+=2)z.pushLine(m[c],m[c+1]);else for(m=t.mode===THREE.LinePieces?2:1,c=0,s=I.length/3-1;c<s;c+=m)z.pushLine(c,c+1)}}else{if(c instanceof THREE.Geometry&&(va.multiplyMatrices(ga,y),x=t.geometry.vertices,0!==x.length))for(G=f(),G.positionScreen.copy(x[0]).applyMatrix4(va),m=t.mode===THREE.LinePieces?2:1,M=1,D=x.length;M<D;M++)G=f(),G.positionScreen.copy(x[M]).applyMatrix4(va),0<(M+1)%m||(W=T[L-2],ma.copy(G.positionScreen),
ja.copy(W.positionScreen),!0===n(ma,ja)&&(ma.multiplyScalar(1/ma.w),ja.multiplyScalar(1/ja.w),X=g(),X.id=t.id,X.v1.positionScreen.copy(ma),X.v2.positionScreen.copy(ja),X.z=Math.max(ma.z,ja.z),X.material=t.material,t.material.vertexColors===THREE.VertexColors&&(X.vertexColors[0].copy(t.geometry.colors[M]),X.vertexColors[1].copy(t.geometry.colors[M-1])),Z.elements.push(X)))}else t instanceof THREE.Sprite&&(b.set(y.elements[12],y.elements[13],y.elements[14],1),b.applyMatrix4(ga),c=1/b.w,b.z*=c,-1<=b.z&&
1>=b.z&&(Q=p(),Q.id=t.id,Q.x=b.x*c,Q.y=b.y*c,Q.z=b.z,Q.object=t,Q.rotation=t.rotation,Q.scale.x=t.scale.x*Math.abs(Q.x-(b.x+B.projectionMatrix.elements[0])/(b.w+B.projectionMatrix.elements[12])),Q.scale.y=t.scale.y*Math.abs(Q.y-(b.y+B.projectionMatrix.elements[5])/(b.w+B.projectionMatrix.elements[13])),Q.material=t.material,Z.elements.push(Q)))}!0===P&&Z.elements.sort(k);return Z}};
THREE.OrbitControls=function(f,d,g){function p(b){if(!1!==a.enabled){b.preventDefault();var e=a.domElement===document?a.domElement.body:a.domElement;if(h===l.ROTATE){if(!0===a.noRotate)return;aa.set(b.clientX,b.clientY);K.subVectors(aa,r);a.rotateLeft(2*Math.PI*K.x/e.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*K.y/e.clientHeight*a.rotateSpeed);r.copy(aa)}else if(h===l.DOLLY){if(!0===a.noZoom)return;W.set(b.clientX,b.clientY);ca.subVectors(W,ka);0<ca.y?a.dollyIn():a.dollyOut();ka.copy(W)}else if(h===
l.PAN){if(!0===a.noPan)return;L.set(b.clientX,b.clientY);T.subVectors(L,x);a.panXZ(T.x*a.panSpeed,-T.y*a.panSpeed);x.copy(L)}a.update()}}function k(){!1!==a.enabled&&(document.removeEventListener("mousemove",p,!1),document.removeEventListener("mouseup",k,!1),a.dispatchEvent(S),h=l.NONE)}function n(b){if(!1!==a.enabled&&!0!==a.noZoom){b.preventDefault();b.stopPropagation();var e=0;void 0!==b.wheelDelta?e=b.wheelDelta:void 0!==b.detail&&(e=-b.detail);0<e?a.dollyOut():a.dollyIn();a.update();a.dispatchEvent(R);
a.dispatchEvent(S)}}this.settings=g;this.object=f;this.domElement=void 0!==d?d:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.panSpeed=.3;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,
BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a=this,r=new THREE.Vector2,aa=new THREE.Vector2,K=new THREE.Vector2,x=new THREE.Vector2,L=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector3,u=new THREE.Vector3,ka=new THREE.Vector2,W=new THREE.Vector2,ca=new THREE.Vector2,X=0,ha=0,ia=1,v=new THREE.Vector3,Q=new THREE.Vector3,w=new THREE.Quaternion,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},h=l.NONE;this.target0=
this.target.clone();this.position0=this.object.position.clone();var Z=(new THREE.Quaternion).setFromUnitVectors(f.up,new THREE.Vector3(0,1,0)),e=Z.clone().inverse(),U={type:"change"},R={type:"start"},S={type:"end"};this.rotateLeft=function(b){void 0===b&&(b=2*Math.PI/60/60*a.autoRotateSpeed);ha-=b};this.rotateUp=function(b){void 0===b&&(b=2*Math.PI/60/60*a.autoRotateSpeed);X-=b};this.panLeft=function(a){var e=this.object.matrix.elements;M.set(e[0],e[1],e[2]);M.multiplyScalar(-a);v.add(M)};this.panUp=
function(a){var e=this.object.matrix.elements;M.set(e[4],e[5],e[6]);M.multiplyScalar(a);v.add(M)};this.panForward=function(a){var e=this.object.matrix.elements;M.set(e[8],e[9],e[10]);M.multiplyScalar(a);v.add(M)};this.pan=function(b,e){var g=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var f=a.object.position.clone().sub(a.target).length(),f=f*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*b*f/g.clientHeight);a.panUp(2*e*f/g.clientHeight)}else void 0!==a.object.top?
(a.panLeft(b*(a.object.right-a.object.left)/g.clientWidth),a.panUp(e*(a.object.top-a.object.bottom)/g.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.panXZ=function(b,e){var g=a.domElement===document?a.domElement.body:a.domElement;if(void 0!==a.object.fov){var f=a.object.position.clone().sub(a.target).length(),f=f*Math.tan(a.object.fov/2*Math.PI/180);a.panLeft(2*b*f/g.clientHeight);a.panForward(2*e*f/g.clientHeight)}else void 0!==a.object.top?
(a.panLeft(b*(a.object.right-a.object.left)/g.clientWidth),a.panForward(e*(a.object.top-a.object.bottom)/g.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(b){void 0===b&&(b=Math.pow(.95,a.zoomSpeed));ia/=b};this.dollyOut=function(b){void 0===b&&(b=Math.pow(.95,a.zoomSpeed));ia*=b};this.update=function(){var b=this.object.position,g=this.settings&&this.settings.cameraAsOrbitCenter?b:this.target,f=this.settings&&this.settings.cameraAsOrbitCenter?
this.target:b;u.copy(b).sub(this.target);u.applyQuaternion(Z);var b=Math.atan2(u.x,u.z),d=Math.atan2(Math.sqrt(u.x*u.x+u.z*u.z),u.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*a.autoRotateSpeed);var b=b+ha,d=d+X,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),d=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d)),d=Math.max(1E-6,Math.min(Math.PI-1E-6,d)),h=this.settings&&this.settings.cameraAsOrbitCenter?5E3*ia*this.settings.boxScale:u.length()*ia,h=Math.max(this.minDistance,
Math.min(this.maxDistance,h));g.add(v);u.x=h*Math.sin(d)*Math.sin(b);u.y=h*Math.cos(d);u.z=h*Math.sin(d)*Math.cos(b);u.applyQuaternion(e);this.settings&&this.settings.cameraAsOrbitCenter?f.copy(g).sub(u):f.copy(g).add(u);this.object.lookAt(this.target);X=ha=0;ia=1;v.set(0,0,0);if(1E-6<Q.distanceToSquared(g)||1E-6<8*(1-w.dot(this.object.quaternion)))this.dispatchEvent(U),Q.copy(g),w.copy(this.object.quaternion)};this.reset=function(){h=l.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);
this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(b){if(!1!==a.enabled){b.preventDefault();if(b.button===a.mouseButtons.ORBIT){if(!0===a.noRotate)return;h=l.ROTATE;r.set(b.clientX,b.clientY)}else if(b.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;h=l.DOLLY;ka.set(b.clientX,b.clientY)}else if(b.button===a.mouseButtons.PAN){if(!0===a.noPan)return;h=l.PAN;x.set(b.clientX,b.clientY)}document.addEventListener("mousemove",
p,!1);document.addEventListener("mouseup",k,!1);a.dispatchEvent(R)}},!1);this.domElement.addEventListener("mousewheel",n,!1);this.domElement.addEventListener("DOMMouseScroll",n,!1);this.domElement.addEventListener("touchstart",function(b){if(!1!==a.enabled){switch(b.touches.length){case 1:if(!0===a.noRotate)return;h=l.TOUCH_ROTATE;r.set(b.touches[0].pageX,b.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;h=l.TOUCH_DOLLY;var e=b.touches[0].pageX-b.touches[1].pageX;b=b.touches[0].pageY-b.touches[1].pageY;
e=Math.sqrt(e*e+b*b);ka.set(0,e);break;case 3:if(!0===a.noPan)return;h=l.TOUCH_PAN;x.set(b.touches[0].pageX,b.touches[0].pageY);break;default:h=l.NONE}a.dispatchEvent(R)}},!1);this.domElement.addEventListener("touchend",function(){!1!==a.enabled&&(a.dispatchEvent(S),h=l.NONE)},!1);this.domElement.addEventListener("touchmove",function(b){if(!1!==a.enabled){b.preventDefault();b.stopPropagation();var e=a.domElement===document?a.domElement.body:a.domElement;switch(b.touches.length){case 1:if(!0===a.noRotate)break;
if(h!==l.TOUCH_ROTATE)break;aa.set(b.touches[0].pageX,b.touches[0].pageY);K.subVectors(aa,r);a.rotateLeft(2*Math.PI*K.x/e.clientWidth*a.rotateSpeed);a.rotateUp(2*Math.PI*K.y/e.clientHeight*a.rotateSpeed);r.copy(aa);a.update();break;case 2:if(!0===a.noZoom)break;if(h!==l.TOUCH_DOLLY)break;e=b.touches[0].pageX-b.touches[1].pageX;b=b.touches[0].pageY-b.touches[1].pageY;b=Math.sqrt(e*e+b*b);W.set(0,b);ca.subVectors(W,ka);0<ca.y?a.dollyOut():a.dollyIn();ka.copy(W);a.update();break;case 3:if(!0===a.noPan)break;
if(h!==l.TOUCH_PAN)break;L.set(b.touches[0].pageX,b.touches[0].pageY);T.subVectors(L,x);a.panXZ(T.x*a.panSpeed,-T.y*a.panSpeed);x.copy(L);a.update();break;default:h=l.NONE}}},!1);window.addEventListener("keydown",function(b){if(!1!==a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(b.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed);a.update();break;case a.keys.FORWARD:a.panXZ(0,-a.keyPanSpeed);a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed);a.update();break;case a.keys.BACKWARD:a.panXZ(0,a.keyPanSpeed);
a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0);a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0);a.update();break;case a.keys.DOLLY_IN:if(!0===a.noZoom)break;a.dollyIn();a.update();break;case a.keys.DOLLY_OUT:if(!0===a.noZoom)break;a.dollyOut();a.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var f=document.createElement("canvas");return!(!window.WebGLRenderingContext||!f.getContext("webgl")&&!f.getContext("experimental-webgl"))}catch(d){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var f=document.createElement("div");f.id="webgl-error-message";f.style.fontFamily="monospace";f.style.fontSize="13px";f.style.fontWeight="normal";
f.style.textAlign="center";f.style.background="#fff";f.style.color="#000";f.style.padding="1.5em";f.style.width="400px";f.style.margin="5em auto 0";this.webgl||(f.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return f},addGetWebGLMessage:function(f){var d,g;f=f||{};d=void 0!==f.parent?f.parent:document.body;f=void 0!==f.id?f.id:"oldie";g=Detector.getWebGLErrorMessage();g.id=f;d.appendChild(g)}};"object"===typeof module&&(module.exports=Detector);
(function(f,d,g,p){var k=function(g){this.domParent="object"===typeof g?g:d.body};k.prototype.init=function(k,a,r,aa,K,x){f.requestAnimationFrame||(f.requestAnimationFrame=function(){return f.webkitRequestAnimationFrame||f.mozRequestAnimationFrame||f.oRequestAnimationFrame||f.msRequestAnimationFrame||function(a,g){f.setTimeout(a,1E3/60)}}());this.domParent===d.body&&(this.WINDOW_WIDTH=f.innerWidth,this.WINDOW_HEIGHT=f.innerHeight,this.WINDOW_HEIGHT_HALF=this.WINDOW_HEIGHT/2,this.WINDOW_WIDTH_HALF=
this.WINDOW_WIDTH/2,f.addEventListener("resize",k,!1));this.renderType=p.webgl?"webgl":"canvas";this.renderer=r||(p.webgl?new g.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new g.CanvasRenderer({preserveDrawingBuffer:!0}));this.renderer.setSize(this.WINDOW_WIDTH,this.WINDOW_HEIGHT);this.domParent.appendChild(this.renderer.domElement);this.scene=aa||new g.Scene;this.camera=K||new g.PerspectiveCamera(35,this.WINDOW_WIDTH/this.WINDOW_HEIGHT,.1,1E5);this.camera.position.set(1E3,500,1E3);this.camera.lookAt(this.scene.position);
x?this.controls=x:(this.controls=new g.OrbitControls(this.camera,this.renderer.domElement,{cameraAsOrbitCenter:!0}),this.controls.target.set(0,0,0),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.keyPanSpeed=10,this.controls.panSpeed=1,this.controls.noZoom=!0,this.controls.keys={LEFT:65,FORWARD:87,RIGHT:68,BACKWARD:83,UP:81,BOTTOM:69},this.controls.mouseButtons={ORBIT:g.MOUSE.MIDDLE,PAN:g.MOUSE.RIGHT});this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top=
"0px";this.stats.domElement.style.zIndex="999";d.body.appendChild(this.stats.domElement);a()};f.Base=k;"object"===typeof module&&(module.exports=k)})(window,document,THREE,Detector);
(function(){function f(g){return g.charAt(0).toUpperCase()+g.slice(1)}var d={};_Container=function(){this.domElement=document.createElement("div")};_Container.prototype.createComponets=function(g){var f=0;for(g=g.length;f<g;f++);};d.map={};d.Sidebar=function(g,f){_Container.call(this);var k=this.setting=d.Utils.settingMixin({align:"r",width:320},g),n="sidebar",n=k.align&&"r"!==k.align?n+" sidebar-left":n+" sidebar-right";this.domElement.className=n;k.id&&(this.domElement.id=k.id,d.map[k.id]=this);
this.domElement.style.width=k.width.toString()+"px";k.overflow&&(this.domElement.style.overflow=k.overflow.toString());f.appendChild(this.domElement);d.Utils.domCreationDirector(k.children,this.domElement)};d.Sidebar.prototype=Object.create(_Container.prototype);d.Panel=function(g,f){_Container.call(this);var k=this.setting=d.Utils.settingMixin({title:""},g);k.id&&(this.domElement.id=k.id,d.map[k.id]=this);var n=this.domElement;n.className="panel panel-tool";f.appendChild(n);var a=document.createElement("div");
a.className="panel-heading";n.appendChild(a);var r=document.createTextNode(k.title);a.appendChild(r);a=document.createElement("div");a.className="panel-body";k.overflow&&(a.style.overflow=k.overflow.toString());n.appendChild(a);d.Utils.domCreationDirector(k.children,a)};d.Panel.prototype=Object.create(_Container.prototype);d.Toolbar=function(g,f){_Container.call(this);var k=this.setting=d.Utils.settingMixin({title:""},g);k.id&&(this.domElement.id=k.id,d.map[k.id]=this);var n=this.domElement;n.className=
"btn-toolbar";f.appendChild(n);d.Utils.domCreationDirector(k.children,n)};d.Toolbar.prototype=Object.create(_Container.prototype);d.ButtonGroup=function(g,f){_Container.call(this);var k=this.setting=d.Utils.settingMixin({title:"",buttonType:"radio"},g);k.id&&(this.domElement.id=k.id,d.map[k.id]=this);var n=this.domElement;n.className="btn-group"+(k.appendClass?" "+k.appendClass:"");"button"!==k.buttonType.toLowerCase()&&n.setAttribute("data-toggle","buttons");n.title=k.title;f.appendChild(n);var a=
k.buttons;switch(k.buttonType.toLowerCase()){default:case "radio":for(var r=0,aa=a.length;r<aa;r++){var K=document.createElement("label");K.className="btn btn-tool"+(a[r].checked?" active":"");a[r].height&&(K.style.height=a[r].height+"px");a[r].width&&(K.style.width=a[r].width+"px");if(a[r].bgType&&a[r].bgTypeData){var x;switch(a[r].bgType){case "color":x=a[r].bgTypeData;K.className+=" btn-color";break;case "image":x="url("+a[r].bgTypeData+") no-repeat 50% 50%";K.className+=" btn-image";break;default:return}K.style.background=
x}n.appendChild(K);var L=document.createElement("input");a[r].checked&&L.setAttribute("checked","");L.type=k.buttonType;L.name=k.name;L.id=a[r].id;L.value=r;L.autocomplete="off";K.appendChild(L);x=document.createTextNode(a[r].title);K.appendChild(x)}break;case "button":for(r=0,aa=a.length;r<aa;r++){L=document.createElement("button");L.className="btn btn-tool";L.id=a[r].id;L.name=k.name;a[r].height&&(L.style.height=a[r].height+"px");a[r].width&&(L.style.width=a[r].width+"px");if(a[r].bgType&&a[r].bgTypeData){switch(a[r].bgType){case "color":x=
a[r].bgTypeData;K.className+=" btn-color";break;case "image":x="url("+a[r].bgTypeData+") no-repeat 50% 50%";K.className+=" btn-image";break;default:return}L.style.background=x}n.appendChild(L);x=document.createTextNode(a[r].title);L.appendChild(x)}}d.Utils.domCreationDirector(k.children,this.domElement)};d.ButtonGroup.prototype=Object.create(_Container.prototype);d.ButtonGroup.prototype.addButton=function(g,f){f||this.setting.buttons.push(g);var d=document.createElement("label");d.className="btn btn-tool"+
(g.checked?" active":"");g.height&&(d.style.height=g.height+"px");g.width&&(d.style.width=g.width+"px");if(g.bgType&&g.bgTypeData){var n;switch(g.bgType){case "color":n=g.bgTypeData;d.className+=" btn-color";break;case "image":n="url("+g.bgTypeData+") no-repeat 50% 50%";d.className+=" btn-image";break;default:return}d.style.background=n}this.domElement.appendChild(d);n=document.createElement("input");g.checked&&n.setAttribute("checked","");n.type=this.setting.buttonType;n.name=this.setting.name;n.id=
g.id;n.value=this.setting.buttons.length-1;n.autocomplete="off";d.appendChild(n);n=document.createTextNode(g.title);d.appendChild(n);return d};d.ButtonGroup.prototype.addButtons=function(f,d){for(var k=0,n=f.length;k<n;k++)this.addButton(f[k],d)};d.Utils={};d.Utils.settingMixin=function(f,d){if("object"===typeof f&&"object"===typeof d){var k={},n;for(n in f)k[n]=f[n];for(var a in d)void 0!==d[a]&&(k[a]=d[a]);return k}return f};d.Utils.domCreationDirector=function(g,p){if(g)if(g instanceof Array)for(var k=
0,n=g.length;k<n;k++)d.Utils.domCreationDirector(g[k],p?p:document.body);else g instanceof Object&&g.UIType&&d[f(g.UIType)]&&new (d[f(g.UIType)])(g,p?p:document.body)};window.GoUI=d;"object"===typeof module&&(module.exports=d)})();var vertexShader="varying vec3 vWorldPosition;void main() {   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );   vWorldPosition = worldPosition.xyz;    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",fragmentShader="uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main() {float h = normalize( vWorldPosition + offset ).y;gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );}";
(function(f,d,g,p,k){var n,a;function r(b){var e=F.textures+(b?-1:1),e=d.getElementById("texture"+e);if(!e&&(e=b?y.length-1:0,e=d.getElementById("texture"+e),!e))return;b=e.parentElement.className.indexOf("btn-color");var c=e.parentElement.className.indexOf("btn-image");-1<b?(n=Number(e.value),d.getElementById("colorTexture").parentElement.click()):-1<c&&(a=Number(e.value),d.getElementById("imageTexture").parentElement.click())}function aa(a,b){var e=b.clone(),c;for(c in a)e[c]=a[c];return e}function K(a){if(null==
a.pageX&&null!=a.clientX){var b=d.documentElement,c=d.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0)}s.set(a.pageX/e.WINDOW_WIDTH*2-1,2*-(a.pageY/e.WINDOW_HEIGHT)+1);ya.setFromCamera(s,e.camera);return ya.intersectObjects(ta)}function x(a,b){b&&a&&(a.position.copy(b.point).add(b.face.normal),a.position.divideScalar(U.width).floor().multiplyScalar(U.width).addScalar(U.width/
2))}function L(a){0<a.length&&x(ea,a[0])}function T(a,b,c,f){a=a||K(event);if(0<a.length){a=a[0];var d=F.toolsType,g=!1,h=ta.length;if(h&&a.object!==B)for(var k=h-1;0<k&&k>h-1-3;k--)if(a.object===ta[k]){g=!0;break}0===d?!0===g&&!1===b||!1===g&&!0===b||(b=Y.draw(0,ma,void 0,a),f?da.appendObjectToCurrentAction("draw",b):da.addAction("draw",b),e.renderer.render(e.scene,e.camera)):1===d&&c&&a.object!==B&&(b=Y.erase(a.object),f?da.appendObjectToCurrentAction("erase",b):da.addAction("erase",b))}}function M(a){0===
I&&(G.save(G.storageKeys.camera),G.save(G.storageKeys.sidebar),G.save())}function u(a){G.save(G.storageKeys.camera);G.save(G.storageKeys.sidebar);G.save();I=1}function ka(a){a.preventDefault();var b;if(1===ua[0])try{1===xa?xa=0:(xa=1,b=K(a),T(b,a.ctrlKey,a.ctrlKey,!0))}catch(c){console.warn("draw/erase failed")}finally{xa=0}else b=F.toolsType,1===b?ea.visible&&(ea.visible=!1):(!ea.visible&&la&&(ea.visible=!0),b=K(a),L(b))}function W(a){a.preventDefault();switch(a.button){case 0:if(!D.endFlag){D.instantComplete(D.loadBoxAnimation);
break}ua[0]=1;a=K(a);T(a,void 0,!0,!1);0===F.toolsType&&L(a);break;case 1:ua[1]=1;break;case 2:ua[2]=1}}function ca(b){if("label"===this.nodeName.toLowerCase())switch(b=this.getElementsByTagName("input")[0],F[b.name]=Number(b.value),b.name){case "toolsType":1===Number(b.value)?ea.visible&&(ea.visible=!1):!ea.visible&&la&&(ea.visible=!0);break;case "textures":ma=F[b.name];ja=y[ma];z=ja.data;V=ja.helperData=y[F[b.name]].helperData||aa(ga,z);ea.material=V;d.getElementById("cube").parentElement.click();
switch(F.texturesType){case 0:a=b.value;break;default:case 1:n=b.value}break;case "sidebarResize":var c=GoUI.map.sidebar.domElement;"0"===b.value?$(c).animate({top:"0",height:"100%"}):$(c).animate({top:"60%",height:"40%"});break;case "texturesType":b=b.id,"imageTexture"===b?($(".btn-color").hide(),$(".btn-image").show(),d.getElementById("texture"+a).parentElement.click()):"colorTexture"===b&&($(".btn-color").show(),$(".btn-image").hide(),d.getElementById("texture"+n).parentElement.click())}else if("button"===
this.type||"button"===this.nodeName.toLowerCase())F[this.id]()}function X(a){switch(a.button){case 0:ua[0]=0;da.isCurrentActionAlive=!1;break;case 1:ua[1]=0;break;case 2:ua[2]=0}}function ha(a){switch(a.keyCode){case 67:r();break;case 88:r(!0)}}function ia(a){if(!ua[0])switch(a.keyCode){case 16:0===F.toolsType?d.getElementById("eraser").parentElement.click():1===F.toolsType&&d.getElementById("cube").parentElement.click();break;case 90:a.ctrlKey&&da.undo();break;case 89:a.ctrlKey&&da.redo()}}function v(){requestAnimationFrame(v);
e.renderer.render(e.scene,e.camera);e.stats.update()}var Q=d.createElement("a");Q.id="imageCapture";Q.style.display="none";Q.target="_blank";d.body.appendChild(Q);var w=function(a){this.endFlag=a;this.currentAnimationIntervalHandler=-1;this.currentMeshes=[];this.currentIterator=0};w.prototype={asyncLoadDefaultInterval:1,loadBoxAnimation:function(){var a=D.currentMeshes;D.currentIterator<a.length?a[D.currentIterator].meshObject.visible=!0:(D.endFlag=!0,clearInterval(D.currentAnimationIntervalHandler));
D.currentIterator++},begin:function(a,b,c){this.endFlag=!1;this.currentMeshes=b;this.currentIterator=0;this.currentAnimationIntervalHandler=setInterval(a,c||this.asyncLoadDefaultInterval)},instantComplete:function(a){if(!0!==this.endFlag){var b=D.currentMeshes;for(clearInterval(this.currentAnimationIntervalHandler);this.currentIterator<b.length;)a();this.endFlag=!0}}};var l=function(a){this.isLoadingBoxEnd=a};l.prototype={LOAD_TYPE:{async:0,sync:1},storageKeys:{meshes:"vp_meshs",camera:"vp_camera",
sidebar:"vp_sidebar"},load:function(a){return f.localStorage&&f.localStorage.getItem(a||this.storageKeys.meshes)},save:function(b,c){if(f.localStorage){var d="";if(c)d=c;else switch(b){default:case this.storageKeys.meshes:case void 0:if(!this.isLoadingBoxEnd&&0>da.currentActionIndex)return;for(var d=d+(U.width+":"),g=0,h=t.length;g<h;g++)d+=t[g].geo.id.replace("geo","")+",",d+=t[g].material.id.replace("texture","")+",",d+=t[g].meshObject.position.x+",",d+=t[g].meshObject.position.y+",",d+=t[g].meshObject.position.z+
";";break;case this.storageKeys.camera:d+=e.controls.target.x+","+e.controls.target.y+","+e.controls.target.z+";";d+=e.controls.object.position.x+","+e.controls.object.position.y+","+e.controls.object.position.z+";";break;case this.storageKeys.sidebar:d+=a+","+n+","+F.texturesType+","+F.sidebarResize}f.localStorage.setItem(b||this.storageKeys.meshes,d)}},loadMeshes:function(a,b,c){this.isLoadingBoxEnd=!1;var e=[],d=U.width;if(a=this.load(a))if(a=a.split(":"))2===a.length?(d=(Number(a[0])||50)/U.width,
e=a[1].split(";")):(d=50/U.width,e=a[0].split(";"));if(0<e.length)switch(b){case this.LOAD_TYPE.sync:b=0;for(a=e.length;b<a;b++){var f=e[b].split(",");2<f.length&&Y.draw(Number(f[0]),Number(f[1]),[Number(f[2])/d,Number(f[3])/d,Number(f[4])/d])}this.isLoadingBoxEnd=!0;break;default:case this.LOAD_TYPE.async:b=0;for(a=e.length;b<a;b++)f=e[b].split(","),2<f.length&&Y.draw(Number(f[0]),Number(f[1]),[Number(f[2])/d,Number(f[3])/d,Number(f[4])/d],void 0,void 0,!0);D.begin(c,t)}else D.endFlag=!0},loadCamera:function(a){var b=
[];(a=this.load(a))&&(b=a.split(";"));if(0<b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a].split(",");switch(a){case 0:e.controls.target.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0);break;case 1:e.controls.object.position.set(Number(d[0])||0,Number(d[1])||0,Number(d[2])||0)}}e.controls.update()}},loadSidebarSelectedButtons:function(b){var c=[];(b=this.load(b))&&(c=b.split(","));if(0<c.length){b=0;for(var e=c.length;b<e;b++){var f=c[b];if(""!==f&&!isNaN(Number(f)))switch(b){case 0:a=Number(f)||
0;break;case 1:n=Number(f)||0;break;case 2:1===Number(f)?d.getElementById("colorTexture").parentElement.click():d.getElementById("imageTexture").parentElement.click();break;case 3:1===Number(f)?d.getElementById("minSidebar").parentElement.click():d.getElementById("normalSidebar").parentElement.click()}}}else d.getElementById("imageTexture").parentElement.click()}};var h=function(){this.currentActionIndex=-1;this.actionArray=[];this.isCurrentActionAlive=void 0};h.prototype={undo:function(){var a;if(!(0>
this.currentActionIndex)){a=this.actionArray[this.currentActionIndex];var b=Y.reverseOperationMap[a.type];a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d)switch(b){case "draw":Y.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":Y.erase(d.meshObject)}}this.currentActionIndex--;this.updateDom()}},redo:function(){var a;if(!(this.currentActionIndex>=this.actionArray.length-1)){a=
this.actionArray[this.currentActionIndex+1];var b=a.type;a=a.meshes;a instanceof Array||(a=[a]);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d)switch(b){case "draw":Y.draw(d.geo,d.material,[d.meshObject.position.x,d.meshObject.position.y,d.meshObject.position.z],void 0,d.meshObject);break;case "erase":Y.erase(d.meshObject)}}this.currentActionIndex++;this.updateDom()}},addAction:function(a,b){this.actionArray.length=-1<this.currentActionIndex+1?this.currentActionIndex+1:0;this.isCurrentActionAlive=
!0;this.actionArray.push({type:a,meshes:b});this.currentActionIndex++;this.updateDom()},appendObjectToCurrentAction:function(a,b){var c=this.actionArray[this.currentActionIndex];if(!0!==this.isCurrentActionAlive)this.addAction(a,b);else if(void 0===c.meshes)c.meshes=b;else if(c.meshes instanceof Array||(c.meshes=[c.meshes]),b instanceof Array)for(var d=0,e=b.length;d<e;d++)c.meshes.push(b[d]);else c.meshes.push(b)},updateDom:function(){d.getElementById("undo").disabled=0>this.currentActionIndex?!0:
!1;d.getElementById("redo").disabled=this.currentActionIndex>=this.actionArray.length-1?!0:!1}};var Z=function(){this.drawFlag=!1};Z.prototype={calculateIntersectResult:K,setMeshPositionToFitTheGrid:x,updateHelperCube:L,draw:function(a,b,c,d,f,g){if(void 0===a||"number"===typeof a)a=va[a||0];if(void 0===b||"number"===typeof b)b=y[b||0];var h=a.data,k=b.data;f=f||new p.Mesh(h,k);f.castShadow=!0;f.receiveShadow=!0;d?x(f,d):f.position.set(c[0],c[1],c[2]);!g||(f.visible=!1);e.scene.add(f);ta.push(f);
t.push({meshObject:f,geo:a,material:b});return t[t.length-1]},erase:function(a){e.scene.remove(a);a=ta.indexOf(a);if(!(0>a)){ta.splice(a,1);var b=t[a-1];t.splice(a-1,1);return b}},reverseOperationMap:{draw:"erase",erase:"draw"}};p.ImageUtils.crossOrigin="Anonymous";var e,U={width:50},R=U.width/50,S={webgl:{ambientLightColor:3158064,directionalLightDensity:.8,basePlaneSegments:2,basePlaneWidth:5E4*R,basePlaneTextureRepeat:200,fogNear:8E3*R,fogFar:25E3*R,sphereRadius:25E3*R},canvas:{ambientLightColor:9474192,
directionalLightDensity:1,basePlaneSegments:32,basePlaneWidth:6E3*R,basePlaneTextureRepeat:16,fogNear:2E3*R,fogFar:3E3*R,sphereRadius:3E3*R}},b,B,P,I=0;k=l.prototype.LOAD_TYPE.async;var pa=new p.MeshLambertMaterial({color:592137}),ga={opacity:.5,transparent:!0},y=[{name:"default",type:"color",uniqueData:"#090909",id:"texture0",data:pa,helperData:aa(ga,pa)}],va=[{name:"default",type:"1",id:"geo0",data:new p.BoxGeometry(U.width,U.width,U.width,1,1,1)}];a=30;n=0;var la=!0,F={toolsType:0,toolsRadius:0,
textures:0,texturesType:0,toggleAux:function(){1===F.toolsType||(ea.visible=!ea.visible);la=!la},capture:function(){var a=e.renderer.domElement,b=-1;if(-1!=navigator.appName.indexOf("Internet Explorer")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")){var c=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(c)?b=parseFloat(RegExp.$1):(d=/rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(c)&&(b=parseFloat(RegExp.$1)))}-1!==b?(f.navigator.saveBlob=f.navigator.saveBlob||f.navigator.msSaveBlob,
a.msToBlob&&f.navigator.saveBlob?f.navigator.saveBlob(a.msToBlob(),"capture.png"):alert("failed to save image, please use other tools to capture it.")):(Q.href=a.toDataURL(),Q.download="capture.png",Q.click())},clearAll:function(){D.endFlag||D.instantComplete(D.loadBoxAnimation);if(!(1>t.length)){var a=Y.erase(t[0].meshObject);da.addAction("erase",a);for(var b=0,c=t.length;b<c;b++)a=Y.erase(t[0].meshObject),da.appendObjectToCurrentAction("erase",a)}},undo:function(){da.undo()},redo:function(){da.redo()}},
ma=0,ja=y[0],z=ja.data,V=ja.helperData,na=va[0].data,ea,ta=[],t=[],c,m,wa,s,ua=[0,0,0],ya,za,D=new w,G=new l(!1),da=new h,Y=new Z,xa=0;e=new g(d.body);e.init(function(a){if(e.WINDOW_WIDTH!==f.innerWidth||e.WINDOW_HEIGHT!==f.innerHeight)e.WINDOW_WIDTH=f.innerWidth,e.WINDOW_HEIGHT=f.innerHeight,e.WINDOW_HEIGHT_HALF=e.WINDOW_HEIGHT/2,e.WINDOW_WIDTH_HALF=e.WINDOW_WIDTH/2,e.camera.aspect=e.WINDOW_WIDTH/e.WINDOW_HEIGHT,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.WINDOW_WIDTH,e.WINDOW_HEIGHT),
d.body.height=e.WINDOW_HEIGHT},function(){b=new p.PlaneBufferGeometry(S[e.renderType].basePlaneWidth,S[e.renderType].basePlaneWidth,S[e.renderType].basePlaneSegments,S[e.renderType].basePlaneSegments);b.applyMatrix((new p.Matrix4).makeRotationX(-Math.PI/2));var a=p.ImageUtils.loadTexture("texture/grasslight-big.jpg");a.wrapT=a.wrapS=p.RepeatWrapping;a.repeat.set(S[e.renderType].basePlaneTextureRepeat,S[e.renderType].basePlaneTextureRepeat);P=new p.MeshLambertMaterial({color:3394611,map:a,bumpMap:a,
emissive:16777215});B=new p.Mesh(b,P);B.receiveShadow=!0;B.material.side=p.DoubleSide;e.scene.add(B);ta.push(B);c=new p.AmbientLight(S[e.renderType].ambientLightColor);e.scene.add(c);m=new p.DirectionalLight(15658734,S[e.renderType].directionalLightDensity);m.position.set(0,6E3,5E3);m.target.position.set(0,0,0);m.castShadow=!0;m.shadowCameraNear=e.camera.near;m.shadowCameraFar=e.camera.far;m.shadowCameraFov=e.cam;m.shadowCameraTop=-1024*R;m.shadowCameraLeft=-1024*R;m.shadowCameraBottom=1024*R;m.shadowCameraRight=
1024*R;m.shadowBias=2E-5;m.shadowDarkness=.4;m.shadowMapWidth=2048*R;m.shadowMapHeight=2048*R;e.scene.add(m);wa=new p.HemisphereLight(16777215,6316128,1);e.scene.add(wa);var a={topColor:{type:"c",value:new p.Color(3368703)},bottomColor:{type:"c",value:new p.Color(16777215)},offset:{type:"f",value:200},exponent:{type:"f",value:.85}},g=new p.Color;a.topColor.value.copy(g.setHSL(.6,2,.5));g=new p.SphereGeometry(S[e.renderType].sphereRadius,32,15);a=new p.ShaderMaterial({uniforms:a,vertexShader:vertexShader,
fragmentShader:fragmentShader,side:p.BackSide});a=new p.Mesh(g,a);e.scene.add(a);ea=new p.Mesh(na,V);ea.position.set(U.width/2,U.width/2,U.width/2);e.scene.add(ea);new p.Mesh(na,z);ya=new p.Raycaster;s=new p.Vector2;za=new p.FogExp2(16777215,5.5E-5);e.scene.fog=za;e.controls.settings.boxScale=R;e.renderer.setClearColor(15790320);e.renderer.shadowMapEnabled=!0;e.renderer.shadowMapType=p.PCFSoftShadowMap;e.renderer.shadowMapCullFace=p.CullFaceBack;e.renderer.gammaInput=!0;e.renderer.gammaOutput=!0;
f.addEventListener("unload",M,!1);f.addEventListener("reload",u,!1);e.renderer.domElement.addEventListener("mousemove",ka,!1);e.renderer.domElement.addEventListener("mousedown",W,!1);e.renderer.domElement.addEventListener("mouseup",X,!1);d.addEventListener("keydown",ha,!1);d.addEventListener("keyup",ia,!1);setInterval(M,12E4)});v();l={UIType:"sidebar",id:"sidebar",children:[{UIType:"buttonGroup",id:"sidebarResize",name:"sidebarResize",buttons:[{title:" + ",id:"normalSidebar",checked:!0},{title:" -",
id:"minSidebar"}]},{UIType:"panel",title:"\u753b\u7b14",name:"tools",id:"panel1",children:[{UIType:"Toolbar",id:"toolbar0",children:[{UIType:"buttonGroup",title:"\u753b\u7b14\u7c7b\u578b(shift\u5207\u6362 \u6309\u4f4fctrl\u65b9\u5757\u5806\u53e0\u6216\u8fde\u7eed\u64e6\u9664)",id:"buttonGroup0",name:"toolsType",buttons:[{title:"\u65b9\u5757",id:"cube",checked:!0},{title:"\u64e6\u9664",id:"eraser"}]}]}]},{UIType:"panel",title:"\u5176\u4ed6\u529f\u80fd",name:"tools",id:"panel3",children:[{UIType:"buttonGroup",
title:"",id:"buttonGroup3",name:"aux",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u8f85\u52a9\u7269\u4f53\u5f00\u5173",id:"toggleAux",checked:!0},{title:"\u622a\u56fe",id:"capture"},{title:"\u6e05\u7a7a",id:"clearAll"}]},{UIType:"Toolbar",id:"toolbar1",children:[{UIType:"buttonGroup",id:"buttonGroup3",name:"actions",buttonType:"button",appendClass:"btn-group-toolbtn",buttons:[{title:"\u64a4\u9500",id:"undo",checked:!0},{title:"\u91cd\u505a",id:"redo"}]}]}]},{UIType:"panel",
title:"\u6750\u6599",name:"tools",id:"panel2",overflow:"hidden",children:[{UIType:"buttonGroup",title:"",id:"buttonGroupTexturesType",name:"texturesType",buttons:[{title:"\u8d34\u56fe",id:"imageTexture",checked:!0},{title:"\u989c\u8272",id:"colorTexture"}]},{UIType:"buttonGroup",title:"\u6750\u6599",id:"buttonGroup2",name:"textures",appendClass:"btn-group-rect",buttons:[{title:"",id:"texture0",bgType:y[0].type,bgTypeData:y[0].uniqueData,width:50,height:50,checked:!0}]}]}]};if(600>e.WINDOW_WIDTH){h=
l.children;w=0;for(g=h.length;w<g;w++)if("sidebarResize"===h[w].id){w=h[w].buttons;h=0;for(g=w.length;h<g;h++)"normalSidebar"===w[h].id&&delete w[h].checked,"minSidebar"===w[h].id&&(w[h].checked=!0);break}F.sidebarResize=1}else F.sidebarResize=0;GoUI.Utils.domCreationDirector(l);da.updateDom();g=d.querySelectorAll(".btn");if(g instanceof Array||g.length)for(w=g.length-1;0<=w;w--)g[w].addEventListener("click",ca,!1);else g instanceof object&&g.addEventListener("click",ca,!1);h=[{color:"#333333"},{color:"#7f7f7f"},
{color:"#c3c3c3"},{color:"#ffffff"},{color:"#b97a57"},{color:"#ff7f27"},{color:"#880015"},{color:"#ed1c24"},{color:"#ffaec9"},{color:"#ffc90e"},{color:"#fff200"},{color:"#efe4b0"},{color:"#22b14c"},{color:"#b5e61d"},{color:"#00a2e8"},{color:"#3f48cc"},{color:"#7092be"},{color:"#a349a4"},{color:"#c8bfe7"},{color:"#66ccff"},{color:"#ff6600"},{color:"#cc3333"},{color:"#ffcc33"},{color:"#33cc99"},{color:"#ff55cc"},{color:"#b1eb00"},{color:"#b1eb88"},{color:"#ff85cb"},{color:"#ff432e"}];w=0;for(g=h.length;w<
g;w++)l={name:h[w].color,type:"color",id:"texture"+(w+1),uniqueData:h[w].color,data:new p.MeshLambertMaterial({color:h[w].color})},y.push(l),GoUI.map.buttonGroup2.addButton({title:"",id:l.id,bgType:l.type,bgTypeData:l.uniqueData,width:50,height:50}).addEventListener("click",ca,!1);h="texture/grass.png texture/sand.png texture/glass.png texture/rock.png texture/clay.png texture/dirt.png texture/bark.png texture/slats.png".split(" ");w=0;for(g=h.length;w<g;w++)l={name:h[w].replace("texture/","").replace(".png",
""),type:"image",id:"texture"+y.length,uniqueData:h[w],data:new p.MeshLambertMaterial({map:p.ImageUtils.loadTexture(h[w]),transparent:!0})},"glass"===l.data.name&&(l.data.map.opacity=.3),l.data.map.magFilter=p.NearestFilter,l.data.map.minFilter=p.LinearMipMapLinearFilter,y.push(l),GoUI.map.buttonGroup2.addButton({title:"",id:l.id,bgType:l.type,bgTypeData:l.uniqueData,width:50,height:50}).addEventListener("click",ca,!1);G.loadCamera(G.storageKeys.camera);G.loadSidebarSelectedButtons(G.storageKeys.sidebar);
G.loadMeshes(void 0,k,D.loadBoxAnimation)})(window,document,Base,THREE,Detector);
